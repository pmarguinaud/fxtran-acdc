
SUBROUTINE ARP_GROUND_PARAM_OPENACC (YDCST, YDMCC, YDML_PHY_MF, KIDIA, KFDIA, KLON, KTDIA&
&, KLEV, KCSS, PAPHI, PCP, PFRSO, PQ, PRDELP, PT, PU, PV, PXURO, PXQRO, PXTRO, PAPRS, PQL&
&, PQI, PCOEFN, PCD, PCDN, PCDROV, PCHROV, PCEROV, PCPS, PCT, PDQSTS, PEMIS, PFHPS, PHQ,&
& PHTR, PHU, PHV, PLSM, PIVEG, PNEIJ, PQS, PQSATS, PTP, PTS, PVEG, PXDROV, PXHROV, PWS, PWSI&
&, PDSE, PCFAS, PCFAU, PCFBS, PCFBU, PCFBV, PCFBQ, PCOEFA, PALPHA1, PLVT, PQICE, PDIFWQ,&
& PDIFWS, PSFU, PSFV, PSC_FEVI, PSC_FEVN, PSC_FCLL, PSC_FCLN, PFCHSP, PFCLL, PFCLN, PFCS&
&, PFEVI, PFEVL, PFEVN, PFEVV, PFTR, PLHS, PQSH, PFRTH, PGZ0F, PGZ0HF, YDSTACK)
!$ACC ROUTINE (ARP_GROUND_PARAM_OPENACC) SEQ
USE MODEL_PHYSICS_MF_MOD,ONLY:MODEL_PHYSICS_MF_TYPE
USE PARKIND1,ONLY:JPIM, JPRB

USE YOMCST,ONLY:TCST
USE YOMMCC,ONLY:TMCC
#include "fxtran_acdc_stack.h"
USE FXTRAN_ACDC_STACK_MOD
USE FXTRAN_ACDC_ABORT_MOD

IMPLICIT NONE


TYPE (TCST), INTENT (IN)::YDCST
TYPE (TMCC), INTENT (IN)::YDMCC
TYPE (MODEL_PHYSICS_MF_TYPE), INTENT (IN)::YDML_PHY_MF
INTEGER (KIND=JPIM), INTENT (IN)::KLON
INTEGER (KIND=JPIM), INTENT (IN)::KLEV
INTEGER (KIND=JPIM), INTENT (IN)::KCSS
INTEGER (KIND=JPIM), INTENT (IN)::KIDIA
INTEGER (KIND=JPIM), INTENT (IN)::KFDIA
INTEGER (KIND=JPIM), INTENT (IN)::KTDIA
REAL (KIND=JPRB), INTENT (IN)::PAPHI (KLON, 0:KLEV)
REAL (KIND=JPRB), INTENT (IN)::PCP (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PFRSO (KLON, 0:KLEV)
REAL (KIND=JPRB), INTENT (IN)::PQ (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PRDELP (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PT (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PU (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PV (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PAPRS (KLON, 0:KLEV)
REAL (KIND=JPRB), INTENT (IN)::PQL (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PQI (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PCOEFN (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PCD (KLON)
REAL (KIND=JPRB), INTENT (IN)::PCDN (KLON)
REAL (KIND=JPRB), INTENT (IN)::PCDROV (KLON)
REAL (KIND=JPRB), INTENT (IN)::PCHROV (KLON)
REAL (KIND=JPRB), INTENT (IN)::PCEROV (KLON)
REAL (KIND=JPRB), INTENT (IN)::PCPS (KLON)
REAL (KIND=JPRB), INTENT (IN)::PCT (KLON)
REAL (KIND=JPRB), INTENT (IN)::PDQSTS (KLON)
REAL (KIND=JPRB), INTENT (IN)::PEMIS (KLON)
REAL (KIND=JPRB), INTENT (IN)::PFHPS (KLON)
REAL (KIND=JPRB), INTENT (IN)::PHQ (KLON)
REAL (KIND=JPRB), INTENT (IN)::PHTR (KLON)
REAL (KIND=JPRB), INTENT (IN)::PHU (KLON)
REAL (KIND=JPRB), INTENT (IN)::PHV (KLON)
REAL (KIND=JPRB), INTENT (IN)::PLSM (KLON)
REAL (KIND=JPRB), INTENT (IN)::PIVEG (KLON)
REAL (KIND=JPRB), INTENT (IN)::PNEIJ (KLON)
REAL (KIND=JPRB), INTENT (IN)::PQS (KLON)
REAL (KIND=JPRB), INTENT (IN)::PQSATS (KLON)
REAL (KIND=JPRB), INTENT (IN)::PTP (KLON, KCSS)
REAL (KIND=JPRB), INTENT (IN)::PTS (KLON)
REAL (KIND=JPRB), INTENT (IN)::PVEG (KLON)
REAL (KIND=JPRB), INTENT (IN)::PXDROV (KLON)
REAL (KIND=JPRB), INTENT (IN)::PXHROV (KLON)
REAL (KIND=JPRB), INTENT (IN)::PWS (KLON)
REAL (KIND=JPRB), INTENT (IN)::PWSI (KLON)
REAL (KIND=JPRB), INTENT (OUT)::PCFBQ (KLON, KLEV)
REAL (KIND=JPRB), INTENT (OUT)::PALPHA1 (KLON, 0:KLEV)
REAL (KIND=JPRB), INTENT (OUT)::PCOEFA (KLON, 0:KLEV)
REAL (KIND=JPRB), INTENT (OUT)::PLVT (KLON, 0:KLEV)
REAL (KIND=JPRB), INTENT (OUT)::PQICE (KLON, 0:KLEV)
REAL (KIND=JPRB), INTENT (IN)::PDSE (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PCFAS (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PCFAU (KLON, KLEV)
REAL (KIND=JPRB), INTENT (INOUT)::PCFBS (KLON, KLEV)
REAL (KIND=JPRB), INTENT (INOUT)::PCFBU (KLON, KLEV)
REAL (KIND=JPRB), INTENT (INOUT)::PCFBV (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PXURO (KLON, 0:KLEV)
REAL (KIND=JPRB), INTENT (IN)::PXQRO (KLON, 0:KLEV)
REAL (KIND=JPRB), INTENT (IN)::PXTRO (KLON, 0:KLEV)
REAL (KIND=JPRB), INTENT (OUT)::PDIFWQ (KLON)
REAL (KIND=JPRB), INTENT (OUT)::PDIFWS (KLON)
REAL (KIND=JPRB), INTENT (OUT)::PSFU (KLON)
REAL (KIND=JPRB), INTENT (OUT)::PSFV (KLON)
REAL (KIND=JPRB), INTENT (OUT)::PFCHSP (KLON, KCSS)
REAL (KIND=JPRB), INTENT (OUT)::PFCLL (KLON)
REAL (KIND=JPRB), INTENT (OUT)::PFCLN (KLON)
REAL (KIND=JPRB), INTENT (OUT)::PFCS (KLON)
REAL (KIND=JPRB), INTENT (OUT)::PFEVI (KLON)
REAL (KIND=JPRB), INTENT (OUT)::PFEVL (KLON)
REAL (KIND=JPRB), INTENT (OUT)::PFEVN (KLON)
REAL (KIND=JPRB), INTENT (OUT)::PFEVV (KLON)
REAL (KIND=JPRB), INTENT (OUT)::PFTR (KLON)
REAL (KIND=JPRB), INTENT (OUT)::PLHS (KLON)
REAL (KIND=JPRB), INTENT (OUT)::PQSH (KLON)
REAL (KIND=JPRB), INTENT (OUT)::PSC_FEVI (KLON)
REAL (KIND=JPRB), INTENT (OUT)::PSC_FEVN (KLON)
REAL (KIND=JPRB), INTENT (OUT)::PSC_FCLL (KLON)
REAL (KIND=JPRB), INTENT (OUT)::PSC_FCLN (KLON)
REAL (KIND=JPRB), INTENT (INOUT)::PFRTH (KLON, 0:KLEV)
REAL (KIND=JPRB), INTENT (INOUT)::PGZ0F (KLON)
REAL (KIND=JPRB), INTENT (INOUT)::PGZ0HF (KLON)
TYPE(FXTRAN_ACDC_STACK), INTENT (IN) :: YDSTACK
TYPE(FXTRAN_ACDC_STACK) :: YLSTACK
REAL (KIND=JPRB)::ZXSRO 
REAL (KIND=JPRB)::ZXDRO 
REAL (KIND=JPRB)::ZWSI 
REAL (KIND=JPRB)::ZNTS 
REAL (KIND=JPRB)::ZSUBS 
REAL (KIND=JPRB)::ZRHSS 
REAL (KIND=JPRB)::ZRHSQ 
REAL (KIND=JPRB)::ZRCOR 
REAL (KIND=JPRB)::ZPN 
REAL (KIND=JPRB)::ZLHW 
REAL (KIND=JPRB)::ZLHS 
fxtran_acdc_temp (REAL (KIND=JPRB), ZDTPL, (KLON, KCSS))
REAL (KIND=JPRB)::ZDRCN 
REAL (KIND=JPRB)::ZDLS 
REAL (KIND=JPRB)::ZDLLW 
REAL (KIND=JPRB)::ZDLLS 
REAL (KIND=JPRB)::ZCTVT 
REAL (KIND=JPRB)::ZCTVS 
REAL (KIND=JPRB)::ZCTVQ 
REAL (KIND=JPRB)::ZCSDT 
REAL (KIND=JPRB)::ZCQVT 
REAL (KIND=JPRB)::ZCQVQ 
REAL (KIND=JPRB)::ZCHRS 
REAL (KIND=JPRB)::ZCHRL 
REAL (KIND=JPRB)::ZXLRO 
REAL (KIND=JPRB)::ZRHST 
REAL (KIND=JPRB)::ZCSVT 
fxtran_acdc_temp (REAL (KIND=JPRB), ZSUB2, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZSUB1, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZN2, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZN1, (KLON, KLEV))
REAL (KIND=JPRB)::ZMUL
REAL (KIND=JPRB)::ZGDT
fxtran_acdc_temp (REAL (KIND=JPRB), ZIPOI, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZQT, (KLON, KLEV))
INTEGER (KIND=JPIM)::JLON
INTEGER (KIND=JPIM)::JLEV
INTEGER (KIND=JPIM)::JCSS
REAL (KIND=JPRB)::ZELSP
REAL (KIND=JPRB)::ZEISP
REAL (KIND=JPRB)::ZCPH
REAL (KIND=JPRB)::ZQSATI
REAL (KIND=JPRB)::ZTH
REAL (KIND=JPRB)::ZSRVCPT2
REAL (KIND=JPRB)::ZTLI
REAL (KIND=JPRB)::ZQSATL
REAL (KIND=JPRB)::ZICE
REAL (KIND=JPRB)::ZLS
REAL (KIND=JPRB)::ZDQSATI
REAL (KIND=JPRB)::ZLIQ
REAL (KIND=JPRB)::ZLV
REAL (KIND=JPRB)::ZDQSATL
REAL (KIND=JPRB)::ZMERL
REAL (KIND=JPRB)::ZPUL
REAL (KIND=JPRB)::ZFQ
REAL (KIND=JPRB)::ZFENT
REAL (KIND=JPRB)::ZEPS1
REAL (KIND=JPRB)::ZELIM
REAL (KIND=JPRB)::ZDLDQ
REAL (KIND=JPRB)::ZDIVIS
REAL (KIND=JPRB)::ZCPVMW
REAL (KIND=JPRB)::ZCPVMS
REAL (KIND=JPRB)::ZCPVMD

#include "fcttrm.func.h"
#include "fctdoi.func.h"

YLSTACK = YDSTACK



IF (KIND (ZDTPL) == 8) THEN
    fxtran_acdc_alloc8 (ZDTPL)
ELSEIF (KIND (ZDTPL) == 4) THEN
    fxtran_acdc_alloc4 (ZDTPL)
ELSE
    STOP 1
ENDIF


IF (KIND (ZSUB2) == 8) THEN
    fxtran_acdc_alloc8 (ZSUB2)
ELSEIF (KIND (ZSUB2) == 4) THEN
    fxtran_acdc_alloc4 (ZSUB2)
ELSE
    STOP 1
ENDIF


IF (KIND (ZSUB1) == 8) THEN
    fxtran_acdc_alloc8 (ZSUB1)
ELSEIF (KIND (ZSUB1) == 4) THEN
    fxtran_acdc_alloc4 (ZSUB1)
ELSE
    STOP 1
ENDIF


IF (KIND (ZN2) == 8) THEN
    fxtran_acdc_alloc8 (ZN2)
ELSEIF (KIND (ZN2) == 4) THEN
    fxtran_acdc_alloc4 (ZN2)
ELSE
    STOP 1
ENDIF


IF (KIND (ZN1) == 8) THEN
    fxtran_acdc_alloc8 (ZN1)
ELSEIF (KIND (ZN1) == 4) THEN
    fxtran_acdc_alloc4 (ZN1)
ELSE
    STOP 1
ENDIF


IF (KIND (ZIPOI) == 8) THEN
    fxtran_acdc_alloc8 (ZIPOI)
ELSEIF (KIND (ZIPOI) == 4) THEN
    fxtran_acdc_alloc4 (ZIPOI)
ELSE
    STOP 1
ENDIF


IF (KIND (ZQT) == 8) THEN
    fxtran_acdc_alloc8 (ZQT)
ELSEIF (KIND (ZQT) == 4) THEN
    fxtran_acdc_alloc4 (ZQT)
ELSE
    STOP 1
ENDIF


JLON = KIDIA





DO JLEV=KTDIA, KLEV
  
  ZN1 (JLON, JLEV)=0.0_JPRB
  ZN2 (JLON, JLEV)=0.0_JPRB
  ZSUB1 (JLON, JLEV)=0.0_JPRB
  ZSUB2 (JLON, JLEV)=0.0_JPRB
  
ENDDO


IF (YDML_PHY_MF%YRPHY%LDIFCONS) THEN

  DO JLEV=KTDIA, KLEV
    
    ZQT (JLON, JLEV)=PQ (JLON, JLEV)+PQL (JLON, JLEV)+PQI (JLON, JLEV)
  
  ENDDO


  DO JLEV=KTDIA, KLEV-1
    
    ZTH=(PT (JLON, JLEV)+PT (JLON, JLEV+1))*0.5_JPRB
    ZLV=FOLH (ZTH, 0.0_JPRB)
    ZLS=FOLH (ZTH, 1.0_JPRB)
    PQICE (JLON, JLEV)=FONICE (ZTH, YDML_PHY_MF%YRPHY0%RDTFAC)
    ZCPH=(PCP (JLON, JLEV)+PCP (JLON, JLEV+1))*0.5_JPRB
    ZTLI=ZTH-0.5_JPRB*(ZLV*(PQL (JLON, JLEV)+PQL (JLON, JLEV&
    &+1))+ZLS*(PQI (JLON, JLEV)+PQI (JLON, JLEV+1)))/ZCPH
    ZICE=PQICE (JLON, JLEV)
    ZLIQ=1.0_JPRB-ZICE
    PLVT (JLON, JLEV)=ZLV*ZLIQ+ZLS*ZICE
    ZEISP=FOEW (ZTLI, 1.0_JPRB)/PAPRS (JLON, JLEV)
    ZELSP=FOEW (ZTLI, 0.0_JPRB)/PAPRS (JLON, JLEV)
    ZQSATI=FOQS (ZEISP)
    ZQSATL=FOQS (ZELSP)
    ZSRVCPT2=1.0_JPRB/(YDCST%RV*ZTLI*ZTLI*ZCPH)
    ZDQSATI=ZQSATI*FOLH (ZTLI, 1.0_JPRB)*ZSRVCPT2
    ZDQSATL=ZQSATL*FOLH (ZTLI, 0.0_JPRB)*ZSRVCPT2
    PALPHA1 (JLON, JLEV)=(ZLIQ*ZDQSATL+ZICE*ZDQSATI)
    PCOEFA (JLON, JLEV)=(PCOEFN (JLON, JLEV)+PCOEFN (JLON, JLEV+1))*0.5_JPRB&
    &/((1.0_JPRB+ZDQSATL*ZLV)*ZLIQ+(1.0_JPRB+ZDQSATI*ZLS)*ZICE)
  
  ENDDO

ELSE

  DO JLEV=KTDIA, KLEV
    
    ZQT (JLON, JLEV)=PQ (JLON, JLEV)
  
  ENDDO


  DO JLEV=KTDIA, KLEV-1
    
    PQICE (JLON, JLEV)=0.0_JPRB
    PLVT (JLON, JLEV)=0.0_JPRB
    PALPHA1 (JLON, JLEV)=0.0_JPRB
    PCOEFA (JLON, JLEV)=0.0_JPRB
  
  ENDDO

ENDIF

ZGDT=YDCST%RG*YDML_PHY_MF%YRPHY2%TSPHY
ZCPVMD=YDCST%RCPV-YDCST%RCPD
ZCPVMW=YDCST%RCPV-YDCST%RCW
ZCPVMS=YDCST%RCPV-YDCST%RCS
ZPUL=2.0_JPRB*YDCST%RPI/YDCST%RDAY
ZEPS1=1.E-08_JPRB

IF (YDML_PHY_MF%YRPHY%LSOLV) THEN
  
  ZCSDT =PLSM (JLON)*YDML_PHY_MF%YRPHY2%TSPHY*PCT (JLON)

  

  DO JCSS=1, KCSS
    ZDIVIS=1.0_JPRB/(YDML_PHY_MF%YRPHY1%SODELX(0)*(YDML_PHY_MF%YRPHY1&
    &%SODELX(JCSS-1)+YDML_PHY_MF%YRPHY1%SODELX(JCSS)))

    

    IF (YDML_PHY_MF%YRPHY1%NCHSP==0) THEN
      ZDTPL (JLON, JCSS)=PLSM (JLON)*YDML_PHY_MF%YRPHY2%TSPHY*ZPUL*ZDIVIS
    ELSE
      ZDTPL (JLON, JCSS)=PLSM (JLON)*YDML_PHY_MF%YRPHY2%TSPHY*ZPUL&
      &*ZDIVIS*(1.0_JPRB-PNEIJ (JLON)**YDML_PHY_MF%YRPHY1%NCHSP)
    ENDIF

  
  ENDDO

ELSE
  
  ZCSDT =PLSM (JLON)*YDML_PHY_MF%YRPHY2%TSPHY*PCT (JLON)
  ZDTPL (JLON, 1)=PLSM (JLON)*YDML_PHY_MF%YRPHY2%TSPHY*ZPUL

  

  DO JCSS=2, KCSS
    
    ZDTPL (JLON, JCSS)=0.0_JPRB
  
  ENDDO

ENDIF


DO JLEV=KTDIA, KLEV
  
  ZIPOI (JLON, JLEV)=PRDELP (JLON, JLEV)*ZGDT
  
ENDDO


ZXDRO =PCDROV (JLON)*PXDROV (JLON)


ZELIM=PXURO (JLON, KLEV-1)*ZIPOI (JLON, KLEV)
ZMUL=1.0_JPRB/(1.0_JPRB+ZELIM*(1.0_JPRB-PCFAU (JLON, KLEV-1))+ZXDRO *ZIPOI (JLON, KLEV))
PCFBU (JLON, KLEV)=ZMUL*(PU (JLON, KLEV)+ZELIM*PCFBU (JLON, KLEV-1))
PCFBV (JLON, KLEV)=ZMUL*(PV (JLON, KLEV)+ZELIM*PCFBV (JLON, KLEV-1))
ZMERL=(1.0_JPRB-PLSM (JLON))*(1.0_JPRB-MAX (0.0_JPRB, SIGN&
& (1.0_JPRB, YDML_PHY_MF%YRPHY1%TMERGL-PTS (JLON))))
PGZ0F (JLON)=PGZ0F (JLON)+ZMERL*(YDCST%RG*YDML_PHY_MF%YRPHY0%VZ0CM*PCD (JLON)/PCDN&
& (JLON)+YDML_PHY_MF%YRPHY0%VCHRNK*PCD (JLON)*SQRT ((PCFBU (JLON, KLEV)**2+PCFBV&
& (JLON, KLEV)**2)*(PU (JLON, KLEV)**2+PV (JLON, KLEV)**2))-PGZ0F (JLON))
PGZ0HF (JLON)=PGZ0HF (JLON)+ZMERL*(MAX (ZEPS1, PGZ0F (JLON)*EXP (-SQRT (PCD &
&(JLON)*SQRT ((PCFBU (JLON, KLEV)**2+PCFBV (JLON, KLEV)**2)*(PU (JLON, KLEV)&
&**2+PV (JLON, KLEV)**2)))*YDML_PHY_MF%YRPHY0%VZIUSTAR0))-PGZ0HF (JLON))
PSFU (JLON)=PCDROV (JLON)*PCFBU (JLON, KLEV)
PSFV (JLON)=PCDROV (JLON)*PCFBV (JLON, KLEV)



IF (YDML_PHY_MF%YRPHY%LNEIGE) THEN

  IF (YDML_PHY_MF%YRPHY%LFGEL) THEN
    ZWSI =MIN (1.0_JPRB, PWSI (JLON)/MAX (PWSI (JLON)+PWS (JLON), ZEPS1))
  ELSE
    ZWSI =0.0_JPRB
  ENDIF

  ZPN =PLSM (JLON)*(PNEIJ (JLON)+(1.0_JPRB-PNEIJ (JLON))*ZWSI )+(1.0_JPRB-PLSM (JLON&
  &))*MAX (0.0_JPRB, SIGN (1.0_JPRB, YDML_PHY_MF%YRPHY1%TMERGL-PTS (JLON)))

  IF (YDML_PHY_MF%YRPHY%LSOLV.AND.YDMCC%LMCC02) THEN

    IF (NINT (PIVEG (JLON))==YDML_PHY_MF%YRPHY1%NTVGLA)  THEN
      ZPN =1.0_JPRB
    ENDIF

  ENDIF

ELSE
  ZPN =0.0_JPRB
ENDIF

ZLHW =(1.0_JPRB-ZPN )*FOLH (PTS (JLON), 0.0_JPRB)
ZLHS =ZPN *FOLH (PTS (JLON), 1.0_JPRB)
PLHS (JLON)=ZLHW +ZLHS 
ZCHRL =PCEROV (JLON)
ZXLRO =ZCHRL *PXHROV (JLON)
ZCHRS =PCHROV (JLON)
ZXSRO =ZCHRS *PXHROV (JLON)
ZDLS =(PQS (JLON)-PQ (JLON, KLEV))*ZCHRS *ZCPVMD
ZDLLW =(PQS (JLON)-PQ (JLON, KLEV))*ZCHRL *ZCPVMW*(1.0_JPRB-ZPN )
ZDLLS =(PQS (JLON)-PQ (JLON, KLEV))*ZCHRL *ZCPVMS*ZPN 
ZDLDQ=ZDLLW +ZDLLS -ZDLS 
ZDRCN =PEMIS (JLON)*4._JPRB*YDCST%RSIGMA*PTS (JLON)*PTS (JLON)*PTS (JLON)
ZCQVQ =1.0_JPRB-PHQ (JLON)
ZCTVQ =PHU (JLON)*PDQSTS (JLON)
ZRHSQ =PHU (JLON)*(PQSATS (JLON)-PTS (JLON)*PDQSTS (JLON))
ZCTVS =PCPS (JLON)+ZCPVMD*PTS (JLON)*ZCTVQ 
ZRHSS =PAPHI (JLON, KLEV)-ZCPVMD*PTS (JLON)*ZCTVQ *PTS (JLON)
ZCSVT =ZCHRS *ZCSDT 
ZCSVT =ZCSVT *PXHROV (JLON)
ZCTVT =ZDTPL (JLON, 1)+ZCSDT *(ZDRCN +ZDLDQ+ZCHRL *PLHS (JLON)*ZCTVQ +ZCHRS *PCPS (JLON))
ZCTVT =ZCTVT *PXHROV (JLON)
ZCQVT =ZCQVQ *ZCSDT *(ZCHRL *PLHS (JLON)-ZCHRS *ZCPVMD*PTS (JLON))
ZCQVT =ZCQVT *PXHROV (JLON)
ZRHST =ZDTPL (JLON, 1)*PTP (JLON, 1)+ZCSDT *(PFRSO (JLON, KLEV)+PFRTH &
&(JLON, KLEV)+(ZDRCN +ZDLDQ)*PTS (JLON)-ZCHRL *PLHS (JLON)*ZRHSQ -ZCHRS&
& *(PAPHI (JLON, KLEV)-ZCPVMD*PHU (JLON)*PTS (JLON)*PQSATS (JLON)))

IF (YDML_PHY_MF%YRPHY%LPHSPSH) THEN
  ZRHST =ZRHST +PFHPS (JLON)*ZCSDT 
ENDIF

ZRHST =ZRHST *PXHROV (JLON)


ZELIM=PXTRO (JLON, KLEV-1)*ZIPOI (JLON, KLEV)
ZMUL=1.0_JPRB/(1.0_JPRB+ZELIM*(1.0_JPRB-PCFAS (JLON, KLEV-1))+ZXSRO *ZIPOI (JLON, KLEV))
ZSUB1 (JLON, KLEV)=ZMUL*ZXSRO *ZIPOI (JLON, KLEV)*ZCTVS 
PCFBS (JLON, KLEV)=ZMUL*(PDSE (JLON, KLEV)+ZXSRO *ZIPOI&
& (JLON, KLEV)*ZRHSS +ZELIM*PCFBS (JLON, KLEV-1))
ZELIM=ZCSVT 
ZMUL=1.0_JPRB/(1.0_JPRB-ZELIM*ZSUB1 (JLON, KLEV)+ZCTVT )
ZSUBS =ZMUL*ZCQVT 
ZNTS =ZMUL*(PTS (JLON)+ZRHST +ZELIM*PCFBS (JLON, KLEV))
ZELIM=ZXLRO *ZIPOI (JLON, KLEV)*ZCTVQ 
ZMUL=1.0_JPRB/(1.0_JPRB-ZELIM*ZSUBS +ZXLRO *ZIPOI (JLON, KLEV&
&)*ZCQVQ +PXQRO (JLON, KLEV-1)*ZIPOI (JLON, KLEV))
ZSUB2 (JLON, KLEV)=ZMUL*PXQRO (JLON, KLEV-1)*ZIPOI (JLON, KLEV)
ZN2 (JLON, KLEV)=ZMUL*(ZQT (JLON, KLEV)+ZXLRO *ZIPOI (JLON, KLEV)*ZRHSQ +ZELIM*ZNTS )


DO JLEV=KLEV-1, KTDIA+1,-1
  
  ZELIM=PXQRO (JLON, JLEV)*ZIPOI (JLON, JLEV)
  ZMUL=1.0_JPRB/(1.0_JPRB+ZELIM*(1.0_JPRB-ZSUB2 (JLON, JLEV&
  &+1))+PXQRO (JLON, JLEV-1)*ZIPOI (JLON, JLEV))
  ZSUB2 (JLON, JLEV)=ZMUL*PXQRO (JLON, JLEV-1)*ZIPOI (JLON, JLEV)
  ZN2 (JLON, JLEV)=ZMUL*(ZQT (JLON, JLEV)+ZELIM*ZN2 (JLON, JLEV+1))
  
ENDDO


ZELIM=PXQRO (JLON, KTDIA)*ZIPOI (JLON, KTDIA)
ZMUL=1.0_JPRB/(1.0_JPRB+ZELIM*(1.0_JPRB-ZSUB2 (JLON, KTDIA+1)))
ZN2 (JLON, KTDIA)=ZMUL*(ZQT (JLON, KTDIA)+ZELIM*ZN2 (JLON, KTDIA+1))


DO JLEV=KTDIA+1, KLEV
  
  ZN2 (JLON, JLEV)=ZN2 (JLON, JLEV)+ZSUB2 (JLON, JLEV)*ZN2 (JLON, JLEV-1)
  
ENDDO


DO JLEV=KTDIA, KLEV
  
  PCFBQ (JLON, JLEV)=ZN2 (JLON, JLEV)
  
ENDDO


ZNTS =ZNTS +ZSUBS *ZN2 (JLON, KLEV)
PCFBS (JLON, KLEV)=PCFBS (JLON, KLEV)+ZSUB1 (JLON, KLEV)*ZNTS 


DO JLEV=KLEV-1, KTDIA,-1
  
  PCFBS (JLON, JLEV)=PCFBS (JLON, JLEV)+PCFAS (JLON, JLEV)*PCFBS (JLON, JLEV+1)
  
ENDDO


ZFQ=ZCHRL *(ZCQVQ *ZN2 (JLON, KLEV)-ZCTVQ *ZNTS -ZRHSQ )
PFEVI (JLON)=ZFQ*ZWSI *(1.0_JPRB-PNEIJ (JLON))
PFEVL (JLON)=ZFQ*(1.0_JPRB-ZPN )
PFEVN (JLON)=ZFQ*ZPN 
PFCLL (JLON)=ZLHW *ZFQ-ZDLLW *(ZNTS -PTS (JLON))
PFCLN (JLON)=ZLHS *ZFQ-ZDLLS *(ZNTS -PTS (JLON))
PFCHSP (JLON, 1)=(ZNTS -PTP (JLON, 1))*ZDTPL (JLON, 1)/MAX (ZEPS1, ZCSDT )
ZFENT=ZCHRS *(PCFBS (JLON, KLEV)-ZCTVS *ZNTS -ZRHSS )
PFCS (JLON)=ZFENT-ZCPVMD*PTS (JLON)*ZFQ+ZDLS *(ZNTS -PTS (JLON))
ZRCOR =-ZDRCN *(ZNTS -PTS (JLON))
PFRTH (JLON, KLEV)=PFRTH (JLON, KLEV)+ZRCOR 
PDIFWQ (JLON)=ZFQ
PDIFWS (JLON)=ZFENT
PSC_FEVI (JLON)=ZWSI *(1.0_JPRB-PNEIJ (JLON))
PSC_FEVN (JLON)=ZPN 
PSC_FCLL (JLON)=ZLHW 
PSC_FCLN (JLON)=ZLHS 

IF (YDML_PHY_MF%YRPHY%LSOLV) THEN
  PFEVV (JLON)=ZCHRL *PVEG (JLON)*(PHV (JLON)-PNEIJ (JLON))*(ZN2 &
  &(JLON, KLEV)-PQSATS (JLON)-PDQSTS (JLON)*(ZNTS -PTS (JLON)))
  PFTR (JLON)=MAX (0.0_JPRB, SIGN (1.0_JPRB, PQSATS (JLON)-PQ (JLON, KLEV)))*ZCHRL *PHTR (JLON)*PVEG &
  &(JLON)*(1.0_JPRB-PNEIJ (JLON))*(ZN2 (JLON, KLEV)-PQSATS (JLON)-PDQSTS (JLON)*(ZNTS -PTS (JLON)))
ENDIF



DO JCSS=2, KCSS
  
  PFCHSP (JLON, JCSS)=(PTP (JLON, JCSS-1)-PTP (JLON, JCSS))*ZDTPL (JLON, JCSS)/MAX (ZEPS1, ZCSDT )
  
ENDDO


DO JLEV=KLEV-1, KTDIA,-1
  
  PFRTH (JLON, JLEV)=PFRTH (JLON, JLEV)+ZRCOR 
  
ENDDO


PFRTH (JLON, KTDIA-1)=PFRTH (JLON, KTDIA-1)+ZRCOR 


IF (YDML_PHY_MF%YRPHY%LCOEFKTKE) THEN
  
  PQSH (JLON)=ZQT (JLON, KLEV)-PDIFWQ (JLON)/(PCHROV (JLON)*PXHROV (JLON))
  
ENDIF



END SUBROUTINE ARP_GROUND_PARAM_OPENACC
