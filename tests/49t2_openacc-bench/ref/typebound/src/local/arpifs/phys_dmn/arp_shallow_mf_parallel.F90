SUBROUTINE ARP_SHALLOW_MF_PARALLEL (YDCST, YDPHYEX, YDCPG_OPTS, YDCPG_BNDS, PTSPHY&
&, YD_PZZ, YD_PZZF, YD_PR, YD_PCP, YD_PU, YD_PV, YD_PT, YD_PQV, YD_PQL, YD_PQI, YD_PQR&
&, YD_PQS, YD_PTKE, YD_PAPRSF, YD_PDELP, YD_PDIFTQ, YD_PDIFTS, YD_PSTRTU, YD_PSTRTV&
&, YDMF_PHYS_SURF, YD_PRODTH_CVPP, YD_PQLI, YD_PNEB, YD_KNLAB, YD_PMF_UP)

USE YOMHOOK,ONLY:DR_HOOK, JPHOOK, LHOOK
USE YOMCST,ONLY:TCST
USE YOMLSFORC,ONLY:LMUSCLFA, NMUSCLFA
USE MODD_PHYEX,ONLY:PHYEX_T
USE MODD_DIMPHYEX,ONLY:DIMPHYEX_T
USE MODI_SHALLOW_MF,ONLY:SHALLOW_MF
USE MODI_SHALLOW_MF_OPENACC
USE MODE_FILL_DIMPHYEX,ONLY:FILL_DIMPHYEX
USE MF_PHYS_SURFACE_TYPE_MOD,ONLY:MF_PHYS_SURF_TYPE
USE CPG_OPTS_TYPE_MOD,ONLY:CPG_BNDS_TYPE, CPG_OPTS_TYPE
USE FIELD_MODULE
USE FIELD_FACTORY_MODULE
USE FIELD_ACCESS_MODULE
USE FXTRAN_ACDC_PARALLELMETHOD_MOD
USE FXTRAN_ACDC_STACK_MOD
USE PARKIND1
USE FXTRAN_ACDC_ARRAY_COPY_MOD
USE FXTRAN_ACDC_GPUMEM_MOD
#include "fxtran_acdc_stack.h"

IMPLICIT NONE


TYPE (TCST), INTENT (IN)::YDCST
TYPE (PHYEX_T), INTENT (IN)::YDPHYEX
TYPE (CPG_OPTS_TYPE), INTENT (IN)::YDCPG_OPTS
TYPE (CPG_BNDS_TYPE), INTENT (IN)::YDCPG_BNDS
REAL (KIND=JPRB), INTENT (IN)::PTSPHY
CLASS (FIELD_3RB), POINTER :: YD_PZZ
REAL (KIND=JPRB), POINTER::PZZ (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PZZF
REAL (KIND=JPRB), POINTER::PZZF (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PR
REAL (KIND=JPRB), POINTER::PR (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PCP
REAL (KIND=JPRB), POINTER::PCP (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PU
REAL (KIND=JPRB), POINTER::PU (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PV
REAL (KIND=JPRB), POINTER::PV (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PT
REAL (KIND=JPRB), POINTER::PT (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PQV
REAL (KIND=JPRB), POINTER::PQV (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PQL
REAL (KIND=JPRB), POINTER::PQL (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PQI
REAL (KIND=JPRB), POINTER::PQI (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PQR
REAL (KIND=JPRB), POINTER::PQR (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PQS
REAL (KIND=JPRB), POINTER::PQS (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PTKE
REAL (KIND=JPRB), POINTER::PTKE (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PAPRSF
REAL (KIND=JPRB), POINTER::PAPRSF (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PDELP
REAL (KIND=JPRB), POINTER::PDELP (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PDIFTQ
REAL (KIND=JPRB), POINTER::PDIFTQ (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PDIFTS
REAL (KIND=JPRB), POINTER::PDIFTS (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PSTRTU
REAL (KIND=JPRB), POINTER::PSTRTU (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PSTRTV
REAL (KIND=JPRB), POINTER::PSTRTV (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PRODTH_CVPP
REAL (KIND=JPRB), POINTER::PRODTH_CVPP (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PQLI
REAL (KIND=JPRB), POINTER::PQLI (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PNEB
REAL (KIND=JPRB), POINTER::PNEB (:,:,:)
CLASS (FIELD_3IM), POINTER :: YD_KNLAB
INTEGER (KIND=JPIM), POINTER::KNLAB (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PMF_UP
REAL (KIND=JPRB), POINTER::PMF_UP (:,:,:)
TYPE (MF_PHYS_SURF_TYPE), INTENT (IN)::YDMF_PHYS_SURF
INTEGER (KIND=JPIM)::IKL
INTEGER (KIND=JPIM)::IKR
INTEGER (KIND=JPIM)::IKRL
INTEGER (KIND=JPIM)::IKRI
INTEGER (KIND=JPIM)::JLEV
INTEGER (KIND=JPIM)::JLON
INTEGER (KIND=JPIM)::ITCOUNT
INTEGER (KIND=JPIM)::ISV_LGEND
INTEGER (KIND=JPIM)::ISV_LGBEG
REAL (KIND=JPRB)::ZVMD
REAL (KIND=JPRB)::ZTDCP
REAL (KIND=JPRB)::ZINVG
CLASS (FIELD_2IM), POINTER :: YL_IKLCL
INTEGER (KIND=JPIM), POINTER::IKLCL (:,:)
CLASS (FIELD_2IM), POINTER :: YL_IKETL
INTEGER (KIND=JPIM), POINTER::IKETL (:,:)
CLASS (FIELD_2IM), POINTER :: YL_IKCTL
INTEGER (KIND=JPIM), POINTER::IKCTL (:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZFLXZTHMF
REAL (KIND=JPRB), POINTER::ZFLXZTHMF (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZFLXZRMF
REAL (KIND=JPRB), POINTER::ZFLXZRMF (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZFLXZUMF
REAL (KIND=JPRB), POINTER::ZFLXZUMF (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZFLXZVMF
REAL (KIND=JPRB), POINTER::ZFLXZVMF (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZEMF
REAL (KIND=JPRB), POINTER::ZEMF (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZDETR
REAL (KIND=JPRB), POINTER::ZDETR (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZENTR
REAL (KIND=JPRB), POINTER::ZENTR (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZDZZ
REAL (KIND=JPRB), POINTER::ZDZZ (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZZZ
REAL (KIND=JPRB), POINTER::ZZZ (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZZZF
REAL (KIND=JPRB), POINTER::ZZZF (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZTHETA
REAL (KIND=JPRB), POINTER::ZTHETA (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZEXNER
REAL (KIND=JPRB), POINTER::ZEXNER (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZHRO
REAL (KIND=JPRB), POINTER::ZHRO (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZHRODJ
REAL (KIND=JPRB), POINTER::ZHRODJ (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZHRODREF
REAL (KIND=JPRB), POINTER::ZHRODREF (:,:,:)
CLASS (FIELD_4RB), POINTER :: YL_ZRM
REAL (KIND=JPRB), POINTER::ZRM (:,:,:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZSFTH
REAL (KIND=JPRB), POINTER::ZSFTH (:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZSFRV
REAL (KIND=JPRB), POINTER::ZSFRV (:,:)
CLASS (FIELD_4RB), POINTER :: YL_ZSVM
REAL (KIND=JPRB), POINTER::ZSVM (:,:,:,:)
CLASS (FIELD_4RB), POINTER :: YL_ZSVDT_MF
REAL (KIND=JPRB), POINTER::ZSVDT_MF (:,:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZDUDT_MF
REAL (KIND=JPRB), POINTER::ZDUDT_MF (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZDVDT_MF
REAL (KIND=JPRB), POINTER::ZDVDT_MF (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZDTHLDT_MF
REAL (KIND=JPRB), POINTER::ZDTHLDT_MF (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZDRTDT_MF
REAL (KIND=JPRB), POINTER::ZDRTDT_MF (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZSIGMF
REAL (KIND=JPRB), POINTER::ZSIGMF (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZFLXZTHVMF
REAL (KIND=JPRB), POINTER::ZFLXZTHVMF (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZTHL_UP
REAL (KIND=JPRB), POINTER::ZTHL_UP (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZRT_UP
REAL (KIND=JPRB), POINTER::ZRT_UP (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZRV_UP
REAL (KIND=JPRB), POINTER::ZRV_UP (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZU_UP
REAL (KIND=JPRB), POINTER::ZU_UP (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZV_UP
REAL (KIND=JPRB), POINTER::ZV_UP (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZRC_UP
REAL (KIND=JPRB), POINTER::ZRC_UP (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZRI_UP
REAL (KIND=JPRB), POINTER::ZRI_UP (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZTHV_UP
REAL (KIND=JPRB), POINTER::ZTHV_UP (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZW_UP
REAL (KIND=JPRB), POINTER::ZW_UP (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZFRAC_UP
REAL (KIND=JPRB), POINTER::ZFRAC_UP (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZDPSG
REAL (KIND=JPRB), POINTER::ZDPSG (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZFQ_MF
REAL (KIND=JPRB), POINTER::ZFQ_MF (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZFH_MF
REAL (KIND=JPRB), POINTER::ZFH_MF (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZFU_MF
REAL (KIND=JPRB), POINTER::ZFU_MF (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZFV_MF
REAL (KIND=JPRB), POINTER::ZFV_MF (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZQDM
REAL (KIND=JPRB), POINTER::ZQDM (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZTKE
REAL (KIND=JPRB), POINTER::ZTKE (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZU
REAL (KIND=JPRB), POINTER::ZU (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZV
REAL (KIND=JPRB), POINTER::ZV (:,:,:)
TYPE (DIMPHYEX_T)::D
REAL (KIND=JPHOOK)::ZHOOK_HANDLE
INTEGER(KIND=JPIM) :: JBLK
TYPE(CPG_BNDS_TYPE) :: YLCPG_BNDS
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_FIELD_API
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_PARALLEL
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_COMPUTE
TYPE(FXTRAN_ACDC_STACK) :: YLSTACK
TYPE(FXTRAN_ACDC_STACK) :: YLOFFSET
TYPE (DIMPHYEX_T) :: DD
REAL(KIND=JPRB), POINTER :: Z_YDMF_PHYS_SURF_GSD_SFL_PGROUP(:,:,:)
#include "abor1.intfb.h"
IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL', 0, ZHOOK_HANDLE)

CALL FXTRAN_ACDC_GPUMEMSTAT (__FILE__, __LINE__, "BEGIN")


IF (LHOOK) CALL DR_HOOK ('CREATE_TEMPORARIES',0,ZHOOK_HANDLE_FIELD_API)
CALL FIELD_NEW (YL_ZZZF, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZZZ, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZW_UP, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZV_UP, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZV, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZU_UP, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZU, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZTKE, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZTHV_UP, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZTHL_UP, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZTHETA, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZSVM, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, 1, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZSVDT_MF, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, 1, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZSIGMF, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZSFTH, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZSFRV, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZRV_UP, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZRT_UP, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZRM, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, 5, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZRI_UP, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZRC_UP, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZQDM, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZHRODREF, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZHRODJ, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZHRO, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZFV_MF, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZFU_MF, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZFRAC_UP, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZFQ_MF, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZFLXZVMF, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZFLXZUMF, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZFLXZTHVMF, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZFLXZTHMF, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZFLXZRMF, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZFH_MF, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZEXNER, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZENTR, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZEMF, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZDZZ, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZDVDT_MF, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZDUDT_MF, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZDTHLDT_MF, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZDRTDT_MF, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZDPSG, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZDETR, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_IKLCL, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_IKETL, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_IKCTL, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
IF (LHOOK) CALL DR_HOOK ('CREATE_TEMPORARIES',1,ZHOOK_HANDLE_FIELD_API)

CALL FILL_DIMPHYEX (D, YDCPG_OPTS%KLON, 1, YDCPG_OPTS%KFLEVG, 0, YDCPG_BNDS%KFDIA)
IKR=5
IKRL=2
IKRI=2
ISV_LGBEG=0
ISV_LGEND=0
ITCOUNT=1
ZINVG=1./YDCST%RG
ZVMD=YDCST%RCPV-YDCST%RCPD


IF (YDCPG_OPTS%NSTEP==0) THEN
  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:ZERO',0,ZHOOK_HANDLE_PARALLEL)

  IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','ARP_SHALLOW_MF_PARALLEL:ZERO')) THEN
    
    IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:ZERO:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
    Z_YDMF_PHYS_SURF_GSD_SFL_PGROUP => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSD_SFL%F_GROUP)
    IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:ZERO:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
    IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:ZERO:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
    
    CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
    !$OMP PARALLEL DO PRIVATE (JBLK) FIRSTPRIVATE (YLCPG_BNDS)

    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
      CALL YLCPG_BNDS%UPDATE (JBLK)
      
      Z_YDMF_PHYS_SURF_GSD_SFL_PGROUP (:,:, JBLK)=0.0_JPRB
    ENDDO

    IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:ZERO:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

    IF (FXTRAN_ACDC_LSYNCHOST ('ARP_SHALLOW_MF_PARALLEL:ZERO')) THEN
      IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:ZERO:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
      Z_YDMF_PHYS_SURF_GSD_SFL_PGROUP => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSD_SFL%F_GROUP)
      IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:ZERO:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
      
      
    ENDIF

    IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:ZERO:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
    Z_YDMF_PHYS_SURF_GSD_SFL_PGROUP => NULL ()
    IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:ZERO:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMPSINGLECOLUMN','ARP_SHALLOW_MF_PARALLEL:ZERO')) THEN
    
    IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:ZERO:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
    Z_YDMF_PHYS_SURF_GSD_SFL_PGROUP => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSD_SFL%F_GROUP)
    IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:ZERO:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
    IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:ZERO:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
    
    !$OMP PARALLEL DO PRIVATE (JBLK, JLON, YLCPG_BNDS)

    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX

      

      

      DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
        YLCPG_BNDS%KIDIA = JLON
        YLCPG_BNDS%KFDIA = JLON
        
        Z_YDMF_PHYS_SURF_GSD_SFL_PGROUP (JLON,:, JBLK)=0.0_JPRB
      ENDDO

    ENDDO

    IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:ZERO:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

    IF (FXTRAN_ACDC_LSYNCHOST ('ARP_SHALLOW_MF_PARALLEL:ZERO')) THEN
      IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:ZERO:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
      Z_YDMF_PHYS_SURF_GSD_SFL_PGROUP => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSD_SFL%F_GROUP)
      IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:ZERO:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
      
      
    ENDIF

    IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:ZERO:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
    Z_YDMF_PHYS_SURF_GSD_SFL_PGROUP => NULL ()
    IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:ZERO:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN','ARP_SHALLOW_MF_PARALLEL:ZERO')) THEN
    
    IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:ZERO:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
    Z_YDMF_PHYS_SURF_GSD_SFL_PGROUP => GET_DEVICE_DATA_RDWR (YDMF_PHYS_SURF%GSD_SFL%F_GROUP)
    IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:ZERO:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
    IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:ZERO:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
    
    
      !$ACC PARALLEL LOOP GANG &
      !$ACC&PRESENT (YDCPG_OPTS, YFXTRAN_ACDC_STACK, Z_YDMF_PHYS_SURF_GSD_SFL_PGROUP) &
      !$ACC&PRIVATE (JBLK) &
      !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
      
      DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
      
      
      
      !$ACC LOOP VECTOR &
      !$ACC&PRIVATE (JLON, YLCPG_BNDS) 

      

      DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
        YLCPG_BNDS%KIDIA = JLON
        YLCPG_BNDS%KFDIA = JLON
        
        Z_YDMF_PHYS_SURF_GSD_SFL_PGROUP (JLON,:, JBLK)=0.0_JPRB
      ENDDO

    ENDDO

    IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:ZERO:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

    IF (FXTRAN_ACDC_LSYNCHOST ('ARP_SHALLOW_MF_PARALLEL:ZERO')) THEN
      IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:ZERO:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
      Z_YDMF_PHYS_SURF_GSD_SFL_PGROUP => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSD_SFL%F_GROUP)
      IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:ZERO:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
      
      
    ENDIF

    IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:ZERO:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
    Z_YDMF_PHYS_SURF_GSD_SFL_PGROUP => NULL ()
    IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:ZERO:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ELSE
      CALL ABOR1 ('ARP_SHALLOW_MF_PARALLEL: NOT METHOD WAS FOUND')
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:ZERO',1,ZHOOK_HANDLE_PARALLEL)
ENDIF

IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:INIT',0,ZHOOK_HANDLE_PARALLEL)

IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','ARP_SHALLOW_MF_PARALLEL:INIT')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:INIT:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  KNLAB => GET_HOST_DATA_RDWR (YD_KNLAB)
  PAPRSF => GET_HOST_DATA_RDONLY (YD_PAPRSF)
  PDELP => GET_HOST_DATA_RDONLY (YD_PDELP)
  PMF_UP => GET_HOST_DATA_RDWR (YD_PMF_UP)
  PQI => GET_HOST_DATA_RDONLY (YD_PQI)
  PQL => GET_HOST_DATA_RDONLY (YD_PQL)
  PQLI => GET_HOST_DATA_RDWR (YD_PQLI)
  PQR => GET_HOST_DATA_RDONLY (YD_PQR)
  PQS => GET_HOST_DATA_RDONLY (YD_PQS)
  PQV => GET_HOST_DATA_RDONLY (YD_PQV)
  PR => GET_HOST_DATA_RDONLY (YD_PR)
  PT => GET_HOST_DATA_RDONLY (YD_PT)
  PZZ => GET_HOST_DATA_RDONLY (YD_PZZ)
  PZZF => GET_HOST_DATA_RDONLY (YD_PZZF)
  ZDPSG => GET_HOST_DATA_RDWR (YL_ZDPSG)
  ZDRTDT_MF => GET_HOST_DATA_RDWR (YL_ZDRTDT_MF)
  ZDTHLDT_MF => GET_HOST_DATA_RDWR (YL_ZDTHLDT_MF)
  ZDUDT_MF => GET_HOST_DATA_RDWR (YL_ZDUDT_MF)
  ZDVDT_MF => GET_HOST_DATA_RDWR (YL_ZDVDT_MF)
  ZDZZ => GET_HOST_DATA_RDWR (YL_ZDZZ)
  ZEMF => GET_HOST_DATA_RDWR (YL_ZEMF)
  ZEXNER => GET_HOST_DATA_RDWR (YL_ZEXNER)
  ZFLXZTHMF => GET_HOST_DATA_RDWR (YL_ZFLXZTHMF)
  ZFLXZTHVMF => GET_HOST_DATA_RDWR (YL_ZFLXZTHVMF)
  ZFLXZUMF => GET_HOST_DATA_RDWR (YL_ZFLXZUMF)
  ZFLXZVMF => GET_HOST_DATA_RDWR (YL_ZFLXZVMF)
  ZFRAC_UP => GET_HOST_DATA_RDWR (YL_ZFRAC_UP)
  ZHRO => GET_HOST_DATA_RDWR (YL_ZHRO)
  ZHRODJ => GET_HOST_DATA_RDWR (YL_ZHRODJ)
  ZHRODREF => GET_HOST_DATA_RDWR (YL_ZHRODREF)
  ZQDM => GET_HOST_DATA_RDWR (YL_ZQDM)
  ZRC_UP => GET_HOST_DATA_RDWR (YL_ZRC_UP)
  ZRI_UP => GET_HOST_DATA_RDWR (YL_ZRI_UP)
  ZRM => GET_HOST_DATA_RDWR (YL_ZRM)
  ZRT_UP => GET_HOST_DATA_RDWR (YL_ZRT_UP)
  ZRV_UP => GET_HOST_DATA_RDWR (YL_ZRV_UP)
  ZSFRV => GET_HOST_DATA_RDWR (YL_ZSFRV)
  ZSFTH => GET_HOST_DATA_RDWR (YL_ZSFTH)
  ZSVM => GET_HOST_DATA_RDWR (YL_ZSVM)
  ZTHETA => GET_HOST_DATA_RDWR (YL_ZTHETA)
  ZTHL_UP => GET_HOST_DATA_RDWR (YL_ZTHL_UP)
  ZU_UP => GET_HOST_DATA_RDWR (YL_ZU_UP)
  ZW_UP => GET_HOST_DATA_RDWR (YL_ZW_UP)
  ZZZ => GET_HOST_DATA_RDWR (YL_ZZZ)
  ZZZF => GET_HOST_DATA_RDWR (YL_ZZZF)
  Z_YDMF_PHYS_SURF_GSD_SFL_PGROUP => GET_HOST_DATA_RDONLY (YDMF_PHYS_SURF%GSD_SFL%F_GROUP)
  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:INIT:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:INIT:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
  !$OMP PARALLEL DO PRIVATE (JBLK, JLEV, JLON) FIRSTPRIVATE (YLCPG_BNDS)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    CALL YLCPG_BNDS%UPDATE (JBLK)

    

    DO JLEV=1, YDCPG_OPTS%KFLEVG

      DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
        ZZZ (JLON, JLEV, JBLK)=PZZ (JLON, JLEV, JBLK)*ZINVG
        ZZZF (JLON, JLEV, JBLK)=PZZF (JLON, JLEV, JBLK)*ZINVG
      ENDDO

    ENDDO


    DO JLEV=2, YDCPG_OPTS%KFLEVG

      DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
        ZDZZ (JLON, JLEV, JBLK)=ZZZF (JLON, JLEV-1, JBLK)-ZZZF (JLON, JLEV, JBLK)
      ENDDO

    ENDDO


    DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
      ZDZZ (JLON, 1, JBLK)=ZDZZ (JLON, 2, JBLK)
    ENDDO


    DO JLEV=1, YDCPG_OPTS%KFLEVG

      DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
        ZEXNER (JLON, JLEV, JBLK)=(PAPRSF (JLON, JLEV, JBLK)/YDCST%RATM)**YDCST%RKAPPA
        ZTHETA (JLON, JLEV, JBLK)=PT (JLON, JLEV, JBLK)/ZEXNER (JLON, JLEV, JBLK)
        ZHRO (JLON, JLEV, JBLK)=PAPRSF (JLON, JLEV, JBLK)/(PT (JLON, JLEV, JBLK)*PR (JLON, JLEV, JBLK))
        ZQDM (JLON, JLEV, JBLK)=(1.-PQV (JLON, JLEV, JBLK)-PQL (JLON, JLEV, JBLK)&
        &-PQI (JLON, JLEV, JBLK)-PQR (JLON, JLEV, JBLK)-PQS (JLON, JLEV, JBLK))
        ZHRODREF (JLON, JLEV, JBLK)=ZHRO (JLON, JLEV, JBLK)*ZQDM (JLON, JLEV, JBLK)
        ZHRODJ (JLON, JLEV, JBLK)=PDELP (JLON, JLEV, JBLK)*ZINVG
        ZRM (JLON, JLEV, 1, JBLK)=PQV (JLON, JLEV, JBLK)/ZQDM (JLON, JLEV, JBLK)
        ZRM (JLON, JLEV, 2, JBLK)=PQL (JLON, JLEV, JBLK)/ZQDM (JLON, JLEV, JBLK)
        ZRM (JLON, JLEV, 3, JBLK)=PQR (JLON, JLEV, JBLK)/ZQDM (JLON, JLEV, JBLK)
        ZRM (JLON, JLEV, 4, JBLK)=PQI (JLON, JLEV, JBLK)/ZQDM (JLON, JLEV, JBLK)
        ZRM (JLON, JLEV, 5, JBLK)=PQS (JLON, JLEV, JBLK)/ZQDM (JLON, JLEV, JBLK)
        ZDPSG (JLON, JLEV, JBLK)=MAX (1.E-15, PDELP (JLON, JLEV, JBLK)/YDCST%RG)
      ENDDO

    ENDDO

    ZSVM (:,:,:, JBLK)=0.

    DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
      ZSFTH (JLON, JBLK)=-Z_YDMF_PHYS_SURF_GSD_SFL_PGROUP (JLON, 1&
      &, JBLK)/ZHRO (JLON, YDCPG_OPTS%KFLEVG, JBLK)/YDCST%RCPD
      ZSFRV (JLON, JBLK)=-Z_YDMF_PHYS_SURF_GSD_SFL_PGROUP (JLON&
      &, 2, JBLK)/ZHRO (JLON, YDCPG_OPTS%KFLEVG, JBLK)
    ENDDO

    ZDUDT_MF (:,:, JBLK)=0._JPRB
    ZDVDT_MF (:,:, JBLK)=0._JPRB
    ZDTHLDT_MF (:,:, JBLK)=0._JPRB
    ZDRTDT_MF (:,:, JBLK)=0._JPRB
    PMF_UP (:,:, JBLK)=0._JPRB
    ZEMF (:,:, JBLK)=0._JPRB
    PQLI (:,:, JBLK)=0._JPRB
    KNLAB (:,:, JBLK)=0
    ZRC_UP (:,:, JBLK)=0._JPRB
    ZRI_UP (:,:, JBLK)=0._JPRB
    ZRT_UP (:,:, JBLK)=0._JPRB
    ZFLXZTHVMF (:,:, JBLK)=0._JPRB
    ZFLXZTHMF (:,:, JBLK)=0._JPRB
    ZFLXZTHMF (:,:, JBLK)=0._JPRB
    ZFLXZUMF (:,:, JBLK)=0._JPRB
    ZFLXZVMF (:,:, JBLK)=0._JPRB
    ZTHL_UP (:,:, JBLK)=0._JPRB
    ZRV_UP (:,:, JBLK)=0._JPRB
    ZU_UP (:,:, JBLK)=0._JPRB
    ZW_UP (:,:, JBLK)=0._JPRB
    ZFRAC_UP (:,:, JBLK)=0._JPRB
  ENDDO

  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:INIT:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

  IF (FXTRAN_ACDC_LSYNCHOST ('ARP_SHALLOW_MF_PARALLEL:INIT')) THEN
    IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:INIT:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
    KNLAB => GET_HOST_DATA_RDWR (YD_KNLAB)
    PAPRSF => GET_HOST_DATA_RDWR (YD_PAPRSF)
    PDELP => GET_HOST_DATA_RDWR (YD_PDELP)
    PMF_UP => GET_HOST_DATA_RDWR (YD_PMF_UP)
    PQI => GET_HOST_DATA_RDWR (YD_PQI)
    PQL => GET_HOST_DATA_RDWR (YD_PQL)
    PQLI => GET_HOST_DATA_RDWR (YD_PQLI)
    PQR => GET_HOST_DATA_RDWR (YD_PQR)
    PQS => GET_HOST_DATA_RDWR (YD_PQS)
    PQV => GET_HOST_DATA_RDWR (YD_PQV)
    PR => GET_HOST_DATA_RDWR (YD_PR)
    PT => GET_HOST_DATA_RDWR (YD_PT)
    PZZ => GET_HOST_DATA_RDWR (YD_PZZ)
    PZZF => GET_HOST_DATA_RDWR (YD_PZZF)
    ZDPSG => GET_HOST_DATA_RDWR (YL_ZDPSG)
    ZDRTDT_MF => GET_HOST_DATA_RDWR (YL_ZDRTDT_MF)
    ZDTHLDT_MF => GET_HOST_DATA_RDWR (YL_ZDTHLDT_MF)
    ZDUDT_MF => GET_HOST_DATA_RDWR (YL_ZDUDT_MF)
    ZDVDT_MF => GET_HOST_DATA_RDWR (YL_ZDVDT_MF)
    ZDZZ => GET_HOST_DATA_RDWR (YL_ZDZZ)
    ZEMF => GET_HOST_DATA_RDWR (YL_ZEMF)
    ZEXNER => GET_HOST_DATA_RDWR (YL_ZEXNER)
    ZFLXZTHMF => GET_HOST_DATA_RDWR (YL_ZFLXZTHMF)
    ZFLXZTHVMF => GET_HOST_DATA_RDWR (YL_ZFLXZTHVMF)
    ZFLXZUMF => GET_HOST_DATA_RDWR (YL_ZFLXZUMF)
    ZFLXZVMF => GET_HOST_DATA_RDWR (YL_ZFLXZVMF)
    ZFRAC_UP => GET_HOST_DATA_RDWR (YL_ZFRAC_UP)
    ZHRO => GET_HOST_DATA_RDWR (YL_ZHRO)
    ZHRODJ => GET_HOST_DATA_RDWR (YL_ZHRODJ)
    ZHRODREF => GET_HOST_DATA_RDWR (YL_ZHRODREF)
    ZQDM => GET_HOST_DATA_RDWR (YL_ZQDM)
    ZRC_UP => GET_HOST_DATA_RDWR (YL_ZRC_UP)
    ZRI_UP => GET_HOST_DATA_RDWR (YL_ZRI_UP)
    ZRM => GET_HOST_DATA_RDWR (YL_ZRM)
    ZRT_UP => GET_HOST_DATA_RDWR (YL_ZRT_UP)
    ZRV_UP => GET_HOST_DATA_RDWR (YL_ZRV_UP)
    ZSFRV => GET_HOST_DATA_RDWR (YL_ZSFRV)
    ZSFTH => GET_HOST_DATA_RDWR (YL_ZSFTH)
    ZSVM => GET_HOST_DATA_RDWR (YL_ZSVM)
    ZTHETA => GET_HOST_DATA_RDWR (YL_ZTHETA)
    ZTHL_UP => GET_HOST_DATA_RDWR (YL_ZTHL_UP)
    ZU_UP => GET_HOST_DATA_RDWR (YL_ZU_UP)
    ZW_UP => GET_HOST_DATA_RDWR (YL_ZW_UP)
    ZZZ => GET_HOST_DATA_RDWR (YL_ZZZ)
    ZZZF => GET_HOST_DATA_RDWR (YL_ZZZF)
    Z_YDMF_PHYS_SURF_GSD_SFL_PGROUP => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSD_SFL%F_GROUP)
    IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:INIT:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:INIT:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  KNLAB => NULL ()
  PAPRSF => NULL ()
  PDELP => NULL ()
  PMF_UP => NULL ()
  PQI => NULL ()
  PQL => NULL ()
  PQLI => NULL ()
  PQR => NULL ()
  PQS => NULL ()
  PQV => NULL ()
  PR => NULL ()
  PT => NULL ()
  PZZ => NULL ()
  PZZF => NULL ()
  ZDPSG => NULL ()
  ZDRTDT_MF => NULL ()
  ZDTHLDT_MF => NULL ()
  ZDUDT_MF => NULL ()
  ZDVDT_MF => NULL ()
  ZDZZ => NULL ()
  ZEMF => NULL ()
  ZEXNER => NULL ()
  ZFLXZTHMF => NULL ()
  ZFLXZTHVMF => NULL ()
  ZFLXZUMF => NULL ()
  ZFLXZVMF => NULL ()
  ZFRAC_UP => NULL ()
  ZHRO => NULL ()
  ZHRODJ => NULL ()
  ZHRODREF => NULL ()
  ZQDM => NULL ()
  ZRC_UP => NULL ()
  ZRI_UP => NULL ()
  ZRM => NULL ()
  ZRT_UP => NULL ()
  ZRV_UP => NULL ()
  ZSFRV => NULL ()
  ZSFTH => NULL ()
  ZSVM => NULL ()
  ZTHETA => NULL ()
  ZTHL_UP => NULL ()
  ZU_UP => NULL ()
  ZW_UP => NULL ()
  ZZZ => NULL ()
  ZZZF => NULL ()
  Z_YDMF_PHYS_SURF_GSD_SFL_PGROUP => NULL ()
  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:INIT:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMPSINGLECOLUMN','ARP_SHALLOW_MF_PARALLEL:INIT')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:INIT:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  KNLAB => GET_HOST_DATA_RDWR (YD_KNLAB)
  PAPRSF => GET_HOST_DATA_RDONLY (YD_PAPRSF)
  PDELP => GET_HOST_DATA_RDONLY (YD_PDELP)
  PMF_UP => GET_HOST_DATA_RDWR (YD_PMF_UP)
  PQI => GET_HOST_DATA_RDONLY (YD_PQI)
  PQL => GET_HOST_DATA_RDONLY (YD_PQL)
  PQLI => GET_HOST_DATA_RDWR (YD_PQLI)
  PQR => GET_HOST_DATA_RDONLY (YD_PQR)
  PQS => GET_HOST_DATA_RDONLY (YD_PQS)
  PQV => GET_HOST_DATA_RDONLY (YD_PQV)
  PR => GET_HOST_DATA_RDONLY (YD_PR)
  PT => GET_HOST_DATA_RDONLY (YD_PT)
  PZZ => GET_HOST_DATA_RDONLY (YD_PZZ)
  PZZF => GET_HOST_DATA_RDONLY (YD_PZZF)
  ZDPSG => GET_HOST_DATA_RDWR (YL_ZDPSG)
  ZDRTDT_MF => GET_HOST_DATA_RDWR (YL_ZDRTDT_MF)
  ZDTHLDT_MF => GET_HOST_DATA_RDWR (YL_ZDTHLDT_MF)
  ZDUDT_MF => GET_HOST_DATA_RDWR (YL_ZDUDT_MF)
  ZDVDT_MF => GET_HOST_DATA_RDWR (YL_ZDVDT_MF)
  ZDZZ => GET_HOST_DATA_RDWR (YL_ZDZZ)
  ZEMF => GET_HOST_DATA_RDWR (YL_ZEMF)
  ZEXNER => GET_HOST_DATA_RDWR (YL_ZEXNER)
  ZFLXZTHMF => GET_HOST_DATA_RDWR (YL_ZFLXZTHMF)
  ZFLXZTHVMF => GET_HOST_DATA_RDWR (YL_ZFLXZTHVMF)
  ZFLXZUMF => GET_HOST_DATA_RDWR (YL_ZFLXZUMF)
  ZFLXZVMF => GET_HOST_DATA_RDWR (YL_ZFLXZVMF)
  ZFRAC_UP => GET_HOST_DATA_RDWR (YL_ZFRAC_UP)
  ZHRO => GET_HOST_DATA_RDWR (YL_ZHRO)
  ZHRODJ => GET_HOST_DATA_RDWR (YL_ZHRODJ)
  ZHRODREF => GET_HOST_DATA_RDWR (YL_ZHRODREF)
  ZQDM => GET_HOST_DATA_RDWR (YL_ZQDM)
  ZRC_UP => GET_HOST_DATA_RDWR (YL_ZRC_UP)
  ZRI_UP => GET_HOST_DATA_RDWR (YL_ZRI_UP)
  ZRM => GET_HOST_DATA_RDWR (YL_ZRM)
  ZRT_UP => GET_HOST_DATA_RDWR (YL_ZRT_UP)
  ZRV_UP => GET_HOST_DATA_RDWR (YL_ZRV_UP)
  ZSFRV => GET_HOST_DATA_RDWR (YL_ZSFRV)
  ZSFTH => GET_HOST_DATA_RDWR (YL_ZSFTH)
  ZSVM => GET_HOST_DATA_RDWR (YL_ZSVM)
  ZTHETA => GET_HOST_DATA_RDWR (YL_ZTHETA)
  ZTHL_UP => GET_HOST_DATA_RDWR (YL_ZTHL_UP)
  ZU_UP => GET_HOST_DATA_RDWR (YL_ZU_UP)
  ZW_UP => GET_HOST_DATA_RDWR (YL_ZW_UP)
  ZZZ => GET_HOST_DATA_RDWR (YL_ZZZ)
  ZZZF => GET_HOST_DATA_RDWR (YL_ZZZF)
  Z_YDMF_PHYS_SURF_GSD_SFL_PGROUP => GET_HOST_DATA_RDONLY (YDMF_PHYS_SURF%GSD_SFL%F_GROUP)
  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:INIT:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:INIT:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  !$OMP PARALLEL DO PRIVATE (JBLK, JLEV, JLON, YLCPG_BNDS)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX

    

    

    DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JLON
      YLCPG_BNDS%KFDIA = JLON

      

      DO JLEV=1, YDCPG_OPTS%KFLEVG
        
        ZZZ (JLON, JLEV, JBLK)=PZZ (JLON, JLEV, JBLK)*ZINVG
        ZZZF (JLON, JLEV, JBLK)=PZZF (JLON, JLEV, JBLK)*ZINVG
      
      ENDDO


      DO JLEV=2, YDCPG_OPTS%KFLEVG
        
        ZDZZ (JLON, JLEV, JBLK)=ZZZF (JLON, JLEV-1, JBLK)-ZZZF (JLON, JLEV, JBLK)
      
      ENDDO

      
      ZDZZ (JLON, 1, JBLK)=ZDZZ (JLON, 2, JBLK)

      

      DO JLEV=1, YDCPG_OPTS%KFLEVG
        
        ZEXNER (JLON, JLEV, JBLK)=(PAPRSF (JLON, JLEV, JBLK)/YDCST%RATM)**YDCST%RKAPPA
        ZTHETA (JLON, JLEV, JBLK)=PT (JLON, JLEV, JBLK)/ZEXNER (JLON, JLEV, JBLK)
        ZHRO (JLON, JLEV, JBLK)=PAPRSF (JLON, JLEV, JBLK)/(PT (JLON, JLEV, JBLK)*PR (JLON, JLEV, JBLK))
        ZQDM (JLON, JLEV, JBLK)=(1.-PQV (JLON, JLEV, JBLK)-PQL (JLON, JLEV, JBLK)&
        &-PQI (JLON, JLEV, JBLK)-PQR (JLON, JLEV, JBLK)-PQS (JLON, JLEV, JBLK))
        ZHRODREF (JLON, JLEV, JBLK)=ZHRO (JLON, JLEV, JBLK)*ZQDM (JLON, JLEV, JBLK)
        ZHRODJ (JLON, JLEV, JBLK)=PDELP (JLON, JLEV, JBLK)*ZINVG
        ZRM (JLON, JLEV, 1, JBLK)=PQV (JLON, JLEV, JBLK)/ZQDM (JLON, JLEV, JBLK)
        ZRM (JLON, JLEV, 2, JBLK)=PQL (JLON, JLEV, JBLK)/ZQDM (JLON, JLEV, JBLK)
        ZRM (JLON, JLEV, 3, JBLK)=PQR (JLON, JLEV, JBLK)/ZQDM (JLON, JLEV, JBLK)
        ZRM (JLON, JLEV, 4, JBLK)=PQI (JLON, JLEV, JBLK)/ZQDM (JLON, JLEV, JBLK)
        ZRM (JLON, JLEV, 5, JBLK)=PQS (JLON, JLEV, JBLK)/ZQDM (JLON, JLEV, JBLK)
        ZDPSG (JLON, JLEV, JBLK)=MAX (1.E-15, PDELP (JLON, JLEV, JBLK)/YDCST%RG)
      
      ENDDO

      ZSVM (JLON,:,:, JBLK)=0.
      
      ZSFTH (JLON, JBLK)=-Z_YDMF_PHYS_SURF_GSD_SFL_PGROUP (JLON, 1&
      &, JBLK)/ZHRO (JLON, YDCPG_OPTS%KFLEVG, JBLK)/YDCST%RCPD
      ZSFRV (JLON, JBLK)=-Z_YDMF_PHYS_SURF_GSD_SFL_PGROUP (JLON&
      &, 2, JBLK)/ZHRO (JLON, YDCPG_OPTS%KFLEVG, JBLK)
      
      ZDUDT_MF (JLON,:, JBLK)=0._JPRB
      ZDVDT_MF (JLON,:, JBLK)=0._JPRB
      ZDTHLDT_MF (JLON,:, JBLK)=0._JPRB
      ZDRTDT_MF (JLON,:, JBLK)=0._JPRB
      PMF_UP (JLON,:, JBLK)=0._JPRB
      ZEMF (JLON,:, JBLK)=0._JPRB
      PQLI (JLON,:, JBLK)=0._JPRB
      KNLAB (JLON,:, JBLK)=0
      ZRC_UP (JLON,:, JBLK)=0._JPRB
      ZRI_UP (JLON,:, JBLK)=0._JPRB
      ZRT_UP (JLON,:, JBLK)=0._JPRB
      ZFLXZTHVMF (JLON,:, JBLK)=0._JPRB
      ZFLXZTHMF (JLON,:, JBLK)=0._JPRB
      ZFLXZTHMF (JLON,:, JBLK)=0._JPRB
      ZFLXZUMF (JLON,:, JBLK)=0._JPRB
      ZFLXZVMF (JLON,:, JBLK)=0._JPRB
      ZTHL_UP (JLON,:, JBLK)=0._JPRB
      ZRV_UP (JLON,:, JBLK)=0._JPRB
      ZU_UP (JLON,:, JBLK)=0._JPRB
      ZW_UP (JLON,:, JBLK)=0._JPRB
      ZFRAC_UP (JLON,:, JBLK)=0._JPRB
    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:INIT:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

  IF (FXTRAN_ACDC_LSYNCHOST ('ARP_SHALLOW_MF_PARALLEL:INIT')) THEN
    IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:INIT:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
    KNLAB => GET_HOST_DATA_RDWR (YD_KNLAB)
    PAPRSF => GET_HOST_DATA_RDWR (YD_PAPRSF)
    PDELP => GET_HOST_DATA_RDWR (YD_PDELP)
    PMF_UP => GET_HOST_DATA_RDWR (YD_PMF_UP)
    PQI => GET_HOST_DATA_RDWR (YD_PQI)
    PQL => GET_HOST_DATA_RDWR (YD_PQL)
    PQLI => GET_HOST_DATA_RDWR (YD_PQLI)
    PQR => GET_HOST_DATA_RDWR (YD_PQR)
    PQS => GET_HOST_DATA_RDWR (YD_PQS)
    PQV => GET_HOST_DATA_RDWR (YD_PQV)
    PR => GET_HOST_DATA_RDWR (YD_PR)
    PT => GET_HOST_DATA_RDWR (YD_PT)
    PZZ => GET_HOST_DATA_RDWR (YD_PZZ)
    PZZF => GET_HOST_DATA_RDWR (YD_PZZF)
    ZDPSG => GET_HOST_DATA_RDWR (YL_ZDPSG)
    ZDRTDT_MF => GET_HOST_DATA_RDWR (YL_ZDRTDT_MF)
    ZDTHLDT_MF => GET_HOST_DATA_RDWR (YL_ZDTHLDT_MF)
    ZDUDT_MF => GET_HOST_DATA_RDWR (YL_ZDUDT_MF)
    ZDVDT_MF => GET_HOST_DATA_RDWR (YL_ZDVDT_MF)
    ZDZZ => GET_HOST_DATA_RDWR (YL_ZDZZ)
    ZEMF => GET_HOST_DATA_RDWR (YL_ZEMF)
    ZEXNER => GET_HOST_DATA_RDWR (YL_ZEXNER)
    ZFLXZTHMF => GET_HOST_DATA_RDWR (YL_ZFLXZTHMF)
    ZFLXZTHVMF => GET_HOST_DATA_RDWR (YL_ZFLXZTHVMF)
    ZFLXZUMF => GET_HOST_DATA_RDWR (YL_ZFLXZUMF)
    ZFLXZVMF => GET_HOST_DATA_RDWR (YL_ZFLXZVMF)
    ZFRAC_UP => GET_HOST_DATA_RDWR (YL_ZFRAC_UP)
    ZHRO => GET_HOST_DATA_RDWR (YL_ZHRO)
    ZHRODJ => GET_HOST_DATA_RDWR (YL_ZHRODJ)
    ZHRODREF => GET_HOST_DATA_RDWR (YL_ZHRODREF)
    ZQDM => GET_HOST_DATA_RDWR (YL_ZQDM)
    ZRC_UP => GET_HOST_DATA_RDWR (YL_ZRC_UP)
    ZRI_UP => GET_HOST_DATA_RDWR (YL_ZRI_UP)
    ZRM => GET_HOST_DATA_RDWR (YL_ZRM)
    ZRT_UP => GET_HOST_DATA_RDWR (YL_ZRT_UP)
    ZRV_UP => GET_HOST_DATA_RDWR (YL_ZRV_UP)
    ZSFRV => GET_HOST_DATA_RDWR (YL_ZSFRV)
    ZSFTH => GET_HOST_DATA_RDWR (YL_ZSFTH)
    ZSVM => GET_HOST_DATA_RDWR (YL_ZSVM)
    ZTHETA => GET_HOST_DATA_RDWR (YL_ZTHETA)
    ZTHL_UP => GET_HOST_DATA_RDWR (YL_ZTHL_UP)
    ZU_UP => GET_HOST_DATA_RDWR (YL_ZU_UP)
    ZW_UP => GET_HOST_DATA_RDWR (YL_ZW_UP)
    ZZZ => GET_HOST_DATA_RDWR (YL_ZZZ)
    ZZZF => GET_HOST_DATA_RDWR (YL_ZZZF)
    Z_YDMF_PHYS_SURF_GSD_SFL_PGROUP => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSD_SFL%F_GROUP)
    IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:INIT:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:INIT:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  KNLAB => NULL ()
  PAPRSF => NULL ()
  PDELP => NULL ()
  PMF_UP => NULL ()
  PQI => NULL ()
  PQL => NULL ()
  PQLI => NULL ()
  PQR => NULL ()
  PQS => NULL ()
  PQV => NULL ()
  PR => NULL ()
  PT => NULL ()
  PZZ => NULL ()
  PZZF => NULL ()
  ZDPSG => NULL ()
  ZDRTDT_MF => NULL ()
  ZDTHLDT_MF => NULL ()
  ZDUDT_MF => NULL ()
  ZDVDT_MF => NULL ()
  ZDZZ => NULL ()
  ZEMF => NULL ()
  ZEXNER => NULL ()
  ZFLXZTHMF => NULL ()
  ZFLXZTHVMF => NULL ()
  ZFLXZUMF => NULL ()
  ZFLXZVMF => NULL ()
  ZFRAC_UP => NULL ()
  ZHRO => NULL ()
  ZHRODJ => NULL ()
  ZHRODREF => NULL ()
  ZQDM => NULL ()
  ZRC_UP => NULL ()
  ZRI_UP => NULL ()
  ZRM => NULL ()
  ZRT_UP => NULL ()
  ZRV_UP => NULL ()
  ZSFRV => NULL ()
  ZSFTH => NULL ()
  ZSVM => NULL ()
  ZTHETA => NULL ()
  ZTHL_UP => NULL ()
  ZU_UP => NULL ()
  ZW_UP => NULL ()
  ZZZ => NULL ()
  ZZZF => NULL ()
  Z_YDMF_PHYS_SURF_GSD_SFL_PGROUP => NULL ()
  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:INIT:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN','ARP_SHALLOW_MF_PARALLEL:INIT')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:INIT:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  KNLAB => GET_DEVICE_DATA_RDWR (YD_KNLAB)
  PAPRSF => GET_DEVICE_DATA_RDONLY (YD_PAPRSF)
  PDELP => GET_DEVICE_DATA_RDONLY (YD_PDELP)
  PMF_UP => GET_DEVICE_DATA_RDWR (YD_PMF_UP)
  PQI => GET_DEVICE_DATA_RDONLY (YD_PQI)
  PQL => GET_DEVICE_DATA_RDONLY (YD_PQL)
  PQLI => GET_DEVICE_DATA_RDWR (YD_PQLI)
  PQR => GET_DEVICE_DATA_RDONLY (YD_PQR)
  PQS => GET_DEVICE_DATA_RDONLY (YD_PQS)
  PQV => GET_DEVICE_DATA_RDONLY (YD_PQV)
  PR => GET_DEVICE_DATA_RDONLY (YD_PR)
  PT => GET_DEVICE_DATA_RDONLY (YD_PT)
  PZZ => GET_DEVICE_DATA_RDONLY (YD_PZZ)
  PZZF => GET_DEVICE_DATA_RDONLY (YD_PZZF)
  ZDPSG => GET_DEVICE_DATA_RDWR (YL_ZDPSG)
  ZDRTDT_MF => GET_DEVICE_DATA_RDWR (YL_ZDRTDT_MF)
  ZDTHLDT_MF => GET_DEVICE_DATA_RDWR (YL_ZDTHLDT_MF)
  ZDUDT_MF => GET_DEVICE_DATA_RDWR (YL_ZDUDT_MF)
  ZDVDT_MF => GET_DEVICE_DATA_RDWR (YL_ZDVDT_MF)
  ZDZZ => GET_DEVICE_DATA_RDWR (YL_ZDZZ)
  ZEMF => GET_DEVICE_DATA_RDWR (YL_ZEMF)
  ZEXNER => GET_DEVICE_DATA_RDWR (YL_ZEXNER)
  ZFLXZTHMF => GET_DEVICE_DATA_RDWR (YL_ZFLXZTHMF)
  ZFLXZTHVMF => GET_DEVICE_DATA_RDWR (YL_ZFLXZTHVMF)
  ZFLXZUMF => GET_DEVICE_DATA_RDWR (YL_ZFLXZUMF)
  ZFLXZVMF => GET_DEVICE_DATA_RDWR (YL_ZFLXZVMF)
  ZFRAC_UP => GET_DEVICE_DATA_RDWR (YL_ZFRAC_UP)
  ZHRO => GET_DEVICE_DATA_RDWR (YL_ZHRO)
  ZHRODJ => GET_DEVICE_DATA_RDWR (YL_ZHRODJ)
  ZHRODREF => GET_DEVICE_DATA_RDWR (YL_ZHRODREF)
  ZQDM => GET_DEVICE_DATA_RDWR (YL_ZQDM)
  ZRC_UP => GET_DEVICE_DATA_RDWR (YL_ZRC_UP)
  ZRI_UP => GET_DEVICE_DATA_RDWR (YL_ZRI_UP)
  ZRM => GET_DEVICE_DATA_RDWR (YL_ZRM)
  ZRT_UP => GET_DEVICE_DATA_RDWR (YL_ZRT_UP)
  ZRV_UP => GET_DEVICE_DATA_RDWR (YL_ZRV_UP)
  ZSFRV => GET_DEVICE_DATA_RDWR (YL_ZSFRV)
  ZSFTH => GET_DEVICE_DATA_RDWR (YL_ZSFTH)
  ZSVM => GET_DEVICE_DATA_RDWR (YL_ZSVM)
  ZTHETA => GET_DEVICE_DATA_RDWR (YL_ZTHETA)
  ZTHL_UP => GET_DEVICE_DATA_RDWR (YL_ZTHL_UP)
  ZU_UP => GET_DEVICE_DATA_RDWR (YL_ZU_UP)
  ZW_UP => GET_DEVICE_DATA_RDWR (YL_ZW_UP)
  ZZZ => GET_DEVICE_DATA_RDWR (YL_ZZZ)
  ZZZF => GET_DEVICE_DATA_RDWR (YL_ZZZF)
  Z_YDMF_PHYS_SURF_GSD_SFL_PGROUP => GET_DEVICE_DATA_RDONLY (YDMF_PHYS_SURF%GSD_SFL%F_GROUP)
  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:INIT:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:INIT:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  
    !$ACC PARALLEL LOOP GANG &
    !$ACC&PRESENT (KNLAB, PAPRSF, PDELP, PMF_UP, PQI, PQL, PQLI, PQR, PQS, PQV, PR, PT, PZZ, PZZF, &
    !$ACC&         YDCPG_OPTS, YDCST, YFXTRAN_ACDC_STACK, ZDPSG, ZDRTDT_MF, ZDTHLDT_MF, &
    !$ACC&         ZDUDT_MF, ZDVDT_MF, ZDZZ, ZEMF, ZEXNER, ZFLXZTHMF, ZFLXZTHVMF, ZFLXZUMF, &
    !$ACC&         ZFLXZVMF, ZFRAC_UP, ZHRO, ZHRODJ, ZHRODREF, ZQDM, ZRC_UP, ZRI_UP, ZRM, &
    !$ACC&         ZRT_UP, ZRV_UP, ZSFRV, ZSFTH, ZSVM, ZTHETA, ZTHL_UP, ZU_UP, ZW_UP, ZZZ, &
    !$ACC&         ZZZF, Z_YDMF_PHYS_SURF_GSD_SFL_PGROUP) &
    !$ACC&PRIVATE (JBLK) &
    !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
    
    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    
    
    
    !$ACC LOOP VECTOR &
    !$ACC&PRIVATE (JLEV, JLON, YLCPG_BNDS) 

    

    DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JLON
      YLCPG_BNDS%KFDIA = JLON

      

      DO JLEV=1, YDCPG_OPTS%KFLEVG
        
        ZZZ (JLON, JLEV, JBLK)=PZZ (JLON, JLEV, JBLK)*ZINVG
        ZZZF (JLON, JLEV, JBLK)=PZZF (JLON, JLEV, JBLK)*ZINVG
      
      ENDDO


      DO JLEV=2, YDCPG_OPTS%KFLEVG
        
        ZDZZ (JLON, JLEV, JBLK)=ZZZF (JLON, JLEV-1, JBLK)-ZZZF (JLON, JLEV, JBLK)
      
      ENDDO

      
      ZDZZ (JLON, 1, JBLK)=ZDZZ (JLON, 2, JBLK)

      

      DO JLEV=1, YDCPG_OPTS%KFLEVG
        
        ZEXNER (JLON, JLEV, JBLK)=(PAPRSF (JLON, JLEV, JBLK)/YDCST%RATM)**YDCST%RKAPPA
        ZTHETA (JLON, JLEV, JBLK)=PT (JLON, JLEV, JBLK)/ZEXNER (JLON, JLEV, JBLK)
        ZHRO (JLON, JLEV, JBLK)=PAPRSF (JLON, JLEV, JBLK)/(PT (JLON, JLEV, JBLK)*PR (JLON, JLEV, JBLK))
        ZQDM (JLON, JLEV, JBLK)=(1.-PQV (JLON, JLEV, JBLK)-PQL (JLON, JLEV, JBLK)&
        &-PQI (JLON, JLEV, JBLK)-PQR (JLON, JLEV, JBLK)-PQS (JLON, JLEV, JBLK))
        ZHRODREF (JLON, JLEV, JBLK)=ZHRO (JLON, JLEV, JBLK)*ZQDM (JLON, JLEV, JBLK)
        ZHRODJ (JLON, JLEV, JBLK)=PDELP (JLON, JLEV, JBLK)*ZINVG
        ZRM (JLON, JLEV, 1, JBLK)=PQV (JLON, JLEV, JBLK)/ZQDM (JLON, JLEV, JBLK)
        ZRM (JLON, JLEV, 2, JBLK)=PQL (JLON, JLEV, JBLK)/ZQDM (JLON, JLEV, JBLK)
        ZRM (JLON, JLEV, 3, JBLK)=PQR (JLON, JLEV, JBLK)/ZQDM (JLON, JLEV, JBLK)
        ZRM (JLON, JLEV, 4, JBLK)=PQI (JLON, JLEV, JBLK)/ZQDM (JLON, JLEV, JBLK)
        ZRM (JLON, JLEV, 5, JBLK)=PQS (JLON, JLEV, JBLK)/ZQDM (JLON, JLEV, JBLK)
        ZDPSG (JLON, JLEV, JBLK)=MAX (1.E-15, PDELP (JLON, JLEV, JBLK)/YDCST%RG)
      
      ENDDO

      ZSVM (JLON,:,:, JBLK)=0.
      
      ZSFTH (JLON, JBLK)=-Z_YDMF_PHYS_SURF_GSD_SFL_PGROUP (JLON, 1&
      &, JBLK)/ZHRO (JLON, YDCPG_OPTS%KFLEVG, JBLK)/YDCST%RCPD
      ZSFRV (JLON, JBLK)=-Z_YDMF_PHYS_SURF_GSD_SFL_PGROUP (JLON&
      &, 2, JBLK)/ZHRO (JLON, YDCPG_OPTS%KFLEVG, JBLK)
      
      ZDUDT_MF (JLON,:, JBLK)=0._JPRB
      ZDVDT_MF (JLON,:, JBLK)=0._JPRB
      ZDTHLDT_MF (JLON,:, JBLK)=0._JPRB
      ZDRTDT_MF (JLON,:, JBLK)=0._JPRB
      PMF_UP (JLON,:, JBLK)=0._JPRB
      ZEMF (JLON,:, JBLK)=0._JPRB
      PQLI (JLON,:, JBLK)=0._JPRB
      KNLAB (JLON,:, JBLK)=0
      ZRC_UP (JLON,:, JBLK)=0._JPRB
      ZRI_UP (JLON,:, JBLK)=0._JPRB
      ZRT_UP (JLON,:, JBLK)=0._JPRB
      ZFLXZTHVMF (JLON,:, JBLK)=0._JPRB
      ZFLXZTHMF (JLON,:, JBLK)=0._JPRB
      ZFLXZTHMF (JLON,:, JBLK)=0._JPRB
      ZFLXZUMF (JLON,:, JBLK)=0._JPRB
      ZFLXZVMF (JLON,:, JBLK)=0._JPRB
      ZTHL_UP (JLON,:, JBLK)=0._JPRB
      ZRV_UP (JLON,:, JBLK)=0._JPRB
      ZU_UP (JLON,:, JBLK)=0._JPRB
      ZW_UP (JLON,:, JBLK)=0._JPRB
      ZFRAC_UP (JLON,:, JBLK)=0._JPRB
    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:INIT:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

  IF (FXTRAN_ACDC_LSYNCHOST ('ARP_SHALLOW_MF_PARALLEL:INIT')) THEN
    IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:INIT:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
    KNLAB => GET_HOST_DATA_RDWR (YD_KNLAB)
    PAPRSF => GET_HOST_DATA_RDWR (YD_PAPRSF)
    PDELP => GET_HOST_DATA_RDWR (YD_PDELP)
    PMF_UP => GET_HOST_DATA_RDWR (YD_PMF_UP)
    PQI => GET_HOST_DATA_RDWR (YD_PQI)
    PQL => GET_HOST_DATA_RDWR (YD_PQL)
    PQLI => GET_HOST_DATA_RDWR (YD_PQLI)
    PQR => GET_HOST_DATA_RDWR (YD_PQR)
    PQS => GET_HOST_DATA_RDWR (YD_PQS)
    PQV => GET_HOST_DATA_RDWR (YD_PQV)
    PR => GET_HOST_DATA_RDWR (YD_PR)
    PT => GET_HOST_DATA_RDWR (YD_PT)
    PZZ => GET_HOST_DATA_RDWR (YD_PZZ)
    PZZF => GET_HOST_DATA_RDWR (YD_PZZF)
    ZDPSG => GET_HOST_DATA_RDWR (YL_ZDPSG)
    ZDRTDT_MF => GET_HOST_DATA_RDWR (YL_ZDRTDT_MF)
    ZDTHLDT_MF => GET_HOST_DATA_RDWR (YL_ZDTHLDT_MF)
    ZDUDT_MF => GET_HOST_DATA_RDWR (YL_ZDUDT_MF)
    ZDVDT_MF => GET_HOST_DATA_RDWR (YL_ZDVDT_MF)
    ZDZZ => GET_HOST_DATA_RDWR (YL_ZDZZ)
    ZEMF => GET_HOST_DATA_RDWR (YL_ZEMF)
    ZEXNER => GET_HOST_DATA_RDWR (YL_ZEXNER)
    ZFLXZTHMF => GET_HOST_DATA_RDWR (YL_ZFLXZTHMF)
    ZFLXZTHVMF => GET_HOST_DATA_RDWR (YL_ZFLXZTHVMF)
    ZFLXZUMF => GET_HOST_DATA_RDWR (YL_ZFLXZUMF)
    ZFLXZVMF => GET_HOST_DATA_RDWR (YL_ZFLXZVMF)
    ZFRAC_UP => GET_HOST_DATA_RDWR (YL_ZFRAC_UP)
    ZHRO => GET_HOST_DATA_RDWR (YL_ZHRO)
    ZHRODJ => GET_HOST_DATA_RDWR (YL_ZHRODJ)
    ZHRODREF => GET_HOST_DATA_RDWR (YL_ZHRODREF)
    ZQDM => GET_HOST_DATA_RDWR (YL_ZQDM)
    ZRC_UP => GET_HOST_DATA_RDWR (YL_ZRC_UP)
    ZRI_UP => GET_HOST_DATA_RDWR (YL_ZRI_UP)
    ZRM => GET_HOST_DATA_RDWR (YL_ZRM)
    ZRT_UP => GET_HOST_DATA_RDWR (YL_ZRT_UP)
    ZRV_UP => GET_HOST_DATA_RDWR (YL_ZRV_UP)
    ZSFRV => GET_HOST_DATA_RDWR (YL_ZSFRV)
    ZSFTH => GET_HOST_DATA_RDWR (YL_ZSFTH)
    ZSVM => GET_HOST_DATA_RDWR (YL_ZSVM)
    ZTHETA => GET_HOST_DATA_RDWR (YL_ZTHETA)
    ZTHL_UP => GET_HOST_DATA_RDWR (YL_ZTHL_UP)
    ZU_UP => GET_HOST_DATA_RDWR (YL_ZU_UP)
    ZW_UP => GET_HOST_DATA_RDWR (YL_ZW_UP)
    ZZZ => GET_HOST_DATA_RDWR (YL_ZZZ)
    ZZZF => GET_HOST_DATA_RDWR (YL_ZZZF)
    Z_YDMF_PHYS_SURF_GSD_SFL_PGROUP => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSD_SFL%F_GROUP)
    IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:INIT:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:INIT:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  KNLAB => NULL ()
  PAPRSF => NULL ()
  PDELP => NULL ()
  PMF_UP => NULL ()
  PQI => NULL ()
  PQL => NULL ()
  PQLI => NULL ()
  PQR => NULL ()
  PQS => NULL ()
  PQV => NULL ()
  PR => NULL ()
  PT => NULL ()
  PZZ => NULL ()
  PZZF => NULL ()
  ZDPSG => NULL ()
  ZDRTDT_MF => NULL ()
  ZDTHLDT_MF => NULL ()
  ZDUDT_MF => NULL ()
  ZDVDT_MF => NULL ()
  ZDZZ => NULL ()
  ZEMF => NULL ()
  ZEXNER => NULL ()
  ZFLXZTHMF => NULL ()
  ZFLXZTHVMF => NULL ()
  ZFLXZUMF => NULL ()
  ZFLXZVMF => NULL ()
  ZFRAC_UP => NULL ()
  ZHRO => NULL ()
  ZHRODJ => NULL ()
  ZHRODREF => NULL ()
  ZQDM => NULL ()
  ZRC_UP => NULL ()
  ZRI_UP => NULL ()
  ZRM => NULL ()
  ZRT_UP => NULL ()
  ZRV_UP => NULL ()
  ZSFRV => NULL ()
  ZSFTH => NULL ()
  ZSVM => NULL ()
  ZTHETA => NULL ()
  ZTHL_UP => NULL ()
  ZU_UP => NULL ()
  ZW_UP => NULL ()
  ZZZ => NULL ()
  ZZZF => NULL ()
  Z_YDMF_PHYS_SURF_GSD_SFL_PGROUP => NULL ()
  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:INIT:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSE
    CALL ABOR1 ('ARP_SHALLOW_MF_PARALLEL: NOT METHOD WAS FOUND')
ENDIF

IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:INIT',1,ZHOOK_HANDLE_PARALLEL)
IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:SHALLOW_MF',0,ZHOOK_HANDLE_PARALLEL)

IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','ARP_SHALLOW_MF_PARALLEL:SHALLOW_MF')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:SHALLOW_MF:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  IKCTL => GET_HOST_DATA_RDWR (YL_IKCTL)
  IKETL => GET_HOST_DATA_RDWR (YL_IKETL)
  IKLCL => GET_HOST_DATA_RDWR (YL_IKLCL)
  PAPRSF => GET_HOST_DATA_RDONLY (YD_PAPRSF)
  PNEB => GET_HOST_DATA_RDWR (YD_PNEB)
  PTKE => GET_HOST_DATA_RDONLY (YD_PTKE)
  PU => GET_HOST_DATA_RDONLY (YD_PU)
  PV => GET_HOST_DATA_RDONLY (YD_PV)
  ZDETR => GET_HOST_DATA_RDWR (YL_ZDETR)
  ZDRTDT_MF => GET_HOST_DATA_RDWR (YL_ZDRTDT_MF)
  ZDTHLDT_MF => GET_HOST_DATA_RDWR (YL_ZDTHLDT_MF)
  ZDUDT_MF => GET_HOST_DATA_RDWR (YL_ZDUDT_MF)
  ZDVDT_MF => GET_HOST_DATA_RDWR (YL_ZDVDT_MF)
  ZDZZ => GET_HOST_DATA_RDONLY (YL_ZDZZ)
  ZEMF => GET_HOST_DATA_RDWR (YL_ZEMF)
  ZENTR => GET_HOST_DATA_RDWR (YL_ZENTR)
  ZEXNER => GET_HOST_DATA_RDONLY (YL_ZEXNER)
  ZFLXZRMF => GET_HOST_DATA_RDWR (YL_ZFLXZRMF)
  ZFLXZTHMF => GET_HOST_DATA_RDWR (YL_ZFLXZTHMF)
  ZFLXZTHVMF => GET_HOST_DATA_RDWR (YL_ZFLXZTHVMF)
  ZFLXZUMF => GET_HOST_DATA_RDWR (YL_ZFLXZUMF)
  ZFLXZVMF => GET_HOST_DATA_RDWR (YL_ZFLXZVMF)
  ZFRAC_UP => GET_HOST_DATA_RDWR (YL_ZFRAC_UP)
  ZHRODJ => GET_HOST_DATA_RDONLY (YL_ZHRODJ)
  ZHRODREF => GET_HOST_DATA_RDONLY (YL_ZHRODREF)
  ZRC_UP => GET_HOST_DATA_RDWR (YL_ZRC_UP)
  ZRI_UP => GET_HOST_DATA_RDWR (YL_ZRI_UP)
  ZRM => GET_HOST_DATA_RDONLY (YL_ZRM)
  ZRT_UP => GET_HOST_DATA_RDWR (YL_ZRT_UP)
  ZRV_UP => GET_HOST_DATA_RDWR (YL_ZRV_UP)
  ZSFRV => GET_HOST_DATA_RDONLY (YL_ZSFRV)
  ZSFTH => GET_HOST_DATA_RDONLY (YL_ZSFTH)
  ZSIGMF => GET_HOST_DATA_RDWR (YL_ZSIGMF)
  ZSVDT_MF => GET_HOST_DATA_RDWR (YL_ZSVDT_MF)
  ZSVM => GET_HOST_DATA_RDONLY (YL_ZSVM)
  ZTHETA => GET_HOST_DATA_RDONLY (YL_ZTHETA)
  ZTHL_UP => GET_HOST_DATA_RDWR (YL_ZTHL_UP)
  ZTHV_UP => GET_HOST_DATA_RDWR (YL_ZTHV_UP)
  ZU_UP => GET_HOST_DATA_RDWR (YL_ZU_UP)
  ZV_UP => GET_HOST_DATA_RDWR (YL_ZV_UP)
  ZW_UP => GET_HOST_DATA_RDWR (YL_ZW_UP)
  ZZZ => GET_HOST_DATA_RDONLY (YL_ZZZ)
  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:SHALLOW_MF:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:SHALLOW_MF:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
  !$OMP PARALLEL DO PRIVATE (JBLK) FIRSTPRIVATE (YLCPG_BNDS, D)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    CALL YLCPG_BNDS%UPDATE (JBLK)
    D%NIJB = YLCPG_BNDS%KIDIA
    D%NIJE = YLCPG_BNDS%KFDIA
    D%NIB = YLCPG_BNDS%KIDIA
    D%NIE = YLCPG_BNDS%KFDIA
    
    CALL SHALLOW_MF (D, YDPHYEX%CST, YDPHYEX%NEBN, YDPHYEX%PARAM_MFSHALLN, YDPHYEX%TURBN, YDPHYEX%CSTURB&
    &, KRR=IKR, KRRL=IKRL, KRRI=IKRI, KSV=1, ONOMIXLG=YDPHYEX%MISC%ONOMIXLG, KSV_LGBEG=ISV_LGBEG, KSV_LGEND&
    &=ISV_LGEND, PTSTEP=PTSPHY, PDZZ=ZDZZ(:,:, JBLK), PZZ=ZZZ(:,:, JBLK), PRHODJ=ZHRODJ(:,:, JBLK),&
    & PRHODREF=ZHRODREF(:,:, JBLK), PPABSM=PAPRSF(:,:, JBLK), PEXNM=ZEXNER(:,:, JBLK), PSFTH=ZSFTH(&
    &:, JBLK), PSFRV=ZSFRV(:, JBLK), PTHM=ZTHETA(:,:, JBLK), PRM=ZRM(:,:,:, JBLK), PUM=PU(:,:, JBLK&
    &), PVM=PV(:,:, JBLK), PTKEM=PTKE(:,:, JBLK), PSVM=ZSVM(:,:,:, JBLK), PDUDT_MF=ZDUDT_MF(:,:, JBLK&
    &), PDVDT_MF=ZDVDT_MF(:,:, JBLK), PDTHLDT_MF=ZDTHLDT_MF(:,:, JBLK), PDRTDT_MF=ZDRTDT_MF(:,:, JBLK&
    &), PDSVDT_MF=ZSVDT_MF(:,:,:, JBLK), PSIGMF=ZSIGMF(:,:, JBLK), PRC_MF=ZRC_UP(:,:, JBLK), PRI_MF&
    &=ZRI_UP(:,:, JBLK), PCF_MF=PNEB(:,:, JBLK), PFLXZTHVMF=ZFLXZTHVMF(:,:, JBLK), PFLXZTHMF=ZFLXZTHMF&
    &(:,:, JBLK), PFLXZRMF=ZFLXZRMF(:,:, JBLK), PFLXZUMF=ZFLXZUMF(:,:, JBLK), PFLXZVMF=ZFLXZVMF(:,:&
    &, JBLK), PTHL_UP=ZTHL_UP(:,:, JBLK), PRT_UP=ZRT_UP(:,:, JBLK), PRV_UP=ZRV_UP(:,:, JBLK), PRC_UP&
    &=ZRC_UP(:,:, JBLK), PRI_UP=ZRI_UP(:,:, JBLK), PU_UP=ZU_UP(:,:, JBLK), PV_UP=ZV_UP(:,:, JBLK), PTHV_UP&
    &=ZTHV_UP(:,:, JBLK), PW_UP=ZW_UP(:,:, JBLK), PFRAC_UP=ZFRAC_UP(:,:, JBLK), PEMF=ZEMF(:,:, JBLK&
    &), PDETR=ZDETR(:,:, JBLK), PENTR=ZENTR(:,:, JBLK), KKLCL=IKLCL(:, JBLK), KKETL=IKETL(:, JBLK),&
    & KKCTL=IKCTL(:, JBLK), PDX=0._JPRB, PDY=0._JPRB, KBUDGETS=0)
  ENDDO

  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:SHALLOW_MF:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

  IF (FXTRAN_ACDC_LSYNCHOST ('ARP_SHALLOW_MF_PARALLEL:SHALLOW_MF')) THEN
    IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:SHALLOW_MF:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
    IKCTL => GET_HOST_DATA_RDWR (YL_IKCTL)
    IKETL => GET_HOST_DATA_RDWR (YL_IKETL)
    IKLCL => GET_HOST_DATA_RDWR (YL_IKLCL)
    PAPRSF => GET_HOST_DATA_RDWR (YD_PAPRSF)
    PNEB => GET_HOST_DATA_RDWR (YD_PNEB)
    PTKE => GET_HOST_DATA_RDWR (YD_PTKE)
    PU => GET_HOST_DATA_RDWR (YD_PU)
    PV => GET_HOST_DATA_RDWR (YD_PV)
    ZDETR => GET_HOST_DATA_RDWR (YL_ZDETR)
    ZDRTDT_MF => GET_HOST_DATA_RDWR (YL_ZDRTDT_MF)
    ZDTHLDT_MF => GET_HOST_DATA_RDWR (YL_ZDTHLDT_MF)
    ZDUDT_MF => GET_HOST_DATA_RDWR (YL_ZDUDT_MF)
    ZDVDT_MF => GET_HOST_DATA_RDWR (YL_ZDVDT_MF)
    ZDZZ => GET_HOST_DATA_RDWR (YL_ZDZZ)
    ZEMF => GET_HOST_DATA_RDWR (YL_ZEMF)
    ZENTR => GET_HOST_DATA_RDWR (YL_ZENTR)
    ZEXNER => GET_HOST_DATA_RDWR (YL_ZEXNER)
    ZFLXZRMF => GET_HOST_DATA_RDWR (YL_ZFLXZRMF)
    ZFLXZTHMF => GET_HOST_DATA_RDWR (YL_ZFLXZTHMF)
    ZFLXZTHVMF => GET_HOST_DATA_RDWR (YL_ZFLXZTHVMF)
    ZFLXZUMF => GET_HOST_DATA_RDWR (YL_ZFLXZUMF)
    ZFLXZVMF => GET_HOST_DATA_RDWR (YL_ZFLXZVMF)
    ZFRAC_UP => GET_HOST_DATA_RDWR (YL_ZFRAC_UP)
    ZHRODJ => GET_HOST_DATA_RDWR (YL_ZHRODJ)
    ZHRODREF => GET_HOST_DATA_RDWR (YL_ZHRODREF)
    ZRC_UP => GET_HOST_DATA_RDWR (YL_ZRC_UP)
    ZRI_UP => GET_HOST_DATA_RDWR (YL_ZRI_UP)
    ZRM => GET_HOST_DATA_RDWR (YL_ZRM)
    ZRT_UP => GET_HOST_DATA_RDWR (YL_ZRT_UP)
    ZRV_UP => GET_HOST_DATA_RDWR (YL_ZRV_UP)
    ZSFRV => GET_HOST_DATA_RDWR (YL_ZSFRV)
    ZSFTH => GET_HOST_DATA_RDWR (YL_ZSFTH)
    ZSIGMF => GET_HOST_DATA_RDWR (YL_ZSIGMF)
    ZSVDT_MF => GET_HOST_DATA_RDWR (YL_ZSVDT_MF)
    ZSVM => GET_HOST_DATA_RDWR (YL_ZSVM)
    ZTHETA => GET_HOST_DATA_RDWR (YL_ZTHETA)
    ZTHL_UP => GET_HOST_DATA_RDWR (YL_ZTHL_UP)
    ZTHV_UP => GET_HOST_DATA_RDWR (YL_ZTHV_UP)
    ZU_UP => GET_HOST_DATA_RDWR (YL_ZU_UP)
    ZV_UP => GET_HOST_DATA_RDWR (YL_ZV_UP)
    ZW_UP => GET_HOST_DATA_RDWR (YL_ZW_UP)
    ZZZ => GET_HOST_DATA_RDWR (YL_ZZZ)
    IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:SHALLOW_MF:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:SHALLOW_MF:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  IKCTL => NULL ()
  IKETL => NULL ()
  IKLCL => NULL ()
  PAPRSF => NULL ()
  PNEB => NULL ()
  PTKE => NULL ()
  PU => NULL ()
  PV => NULL ()
  ZDETR => NULL ()
  ZDRTDT_MF => NULL ()
  ZDTHLDT_MF => NULL ()
  ZDUDT_MF => NULL ()
  ZDVDT_MF => NULL ()
  ZDZZ => NULL ()
  ZEMF => NULL ()
  ZENTR => NULL ()
  ZEXNER => NULL ()
  ZFLXZRMF => NULL ()
  ZFLXZTHMF => NULL ()
  ZFLXZTHVMF => NULL ()
  ZFLXZUMF => NULL ()
  ZFLXZVMF => NULL ()
  ZFRAC_UP => NULL ()
  ZHRODJ => NULL ()
  ZHRODREF => NULL ()
  ZRC_UP => NULL ()
  ZRI_UP => NULL ()
  ZRM => NULL ()
  ZRT_UP => NULL ()
  ZRV_UP => NULL ()
  ZSFRV => NULL ()
  ZSFTH => NULL ()
  ZSIGMF => NULL ()
  ZSVDT_MF => NULL ()
  ZSVM => NULL ()
  ZTHETA => NULL ()
  ZTHL_UP => NULL ()
  ZTHV_UP => NULL ()
  ZU_UP => NULL ()
  ZV_UP => NULL ()
  ZW_UP => NULL ()
  ZZZ => NULL ()
  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:SHALLOW_MF:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMPSINGLECOLUMN&
  &','ARP_SHALLOW_MF_PARALLEL:SHALLOW_MF')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:SHALLOW_MF:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  IKCTL => GET_HOST_DATA_RDWR (YL_IKCTL)
  IKETL => GET_HOST_DATA_RDWR (YL_IKETL)
  IKLCL => GET_HOST_DATA_RDWR (YL_IKLCL)
  PAPRSF => GET_HOST_DATA_RDONLY (YD_PAPRSF)
  PNEB => GET_HOST_DATA_RDWR (YD_PNEB)
  PTKE => GET_HOST_DATA_RDONLY (YD_PTKE)
  PU => GET_HOST_DATA_RDONLY (YD_PU)
  PV => GET_HOST_DATA_RDONLY (YD_PV)
  ZDETR => GET_HOST_DATA_RDWR (YL_ZDETR)
  ZDRTDT_MF => GET_HOST_DATA_RDWR (YL_ZDRTDT_MF)
  ZDTHLDT_MF => GET_HOST_DATA_RDWR (YL_ZDTHLDT_MF)
  ZDUDT_MF => GET_HOST_DATA_RDWR (YL_ZDUDT_MF)
  ZDVDT_MF => GET_HOST_DATA_RDWR (YL_ZDVDT_MF)
  ZDZZ => GET_HOST_DATA_RDONLY (YL_ZDZZ)
  ZEMF => GET_HOST_DATA_RDWR (YL_ZEMF)
  ZENTR => GET_HOST_DATA_RDWR (YL_ZENTR)
  ZEXNER => GET_HOST_DATA_RDONLY (YL_ZEXNER)
  ZFLXZRMF => GET_HOST_DATA_RDWR (YL_ZFLXZRMF)
  ZFLXZTHMF => GET_HOST_DATA_RDWR (YL_ZFLXZTHMF)
  ZFLXZTHVMF => GET_HOST_DATA_RDWR (YL_ZFLXZTHVMF)
  ZFLXZUMF => GET_HOST_DATA_RDWR (YL_ZFLXZUMF)
  ZFLXZVMF => GET_HOST_DATA_RDWR (YL_ZFLXZVMF)
  ZFRAC_UP => GET_HOST_DATA_RDWR (YL_ZFRAC_UP)
  ZHRODJ => GET_HOST_DATA_RDONLY (YL_ZHRODJ)
  ZHRODREF => GET_HOST_DATA_RDONLY (YL_ZHRODREF)
  ZRC_UP => GET_HOST_DATA_RDWR (YL_ZRC_UP)
  ZRI_UP => GET_HOST_DATA_RDWR (YL_ZRI_UP)
  ZRM => GET_HOST_DATA_RDONLY (YL_ZRM)
  ZRT_UP => GET_HOST_DATA_RDWR (YL_ZRT_UP)
  ZRV_UP => GET_HOST_DATA_RDWR (YL_ZRV_UP)
  ZSFRV => GET_HOST_DATA_RDONLY (YL_ZSFRV)
  ZSFTH => GET_HOST_DATA_RDONLY (YL_ZSFTH)
  ZSIGMF => GET_HOST_DATA_RDWR (YL_ZSIGMF)
  ZSVDT_MF => GET_HOST_DATA_RDWR (YL_ZSVDT_MF)
  ZSVM => GET_HOST_DATA_RDONLY (YL_ZSVM)
  ZTHETA => GET_HOST_DATA_RDONLY (YL_ZTHETA)
  ZTHL_UP => GET_HOST_DATA_RDWR (YL_ZTHL_UP)
  ZTHV_UP => GET_HOST_DATA_RDWR (YL_ZTHV_UP)
  ZU_UP => GET_HOST_DATA_RDWR (YL_ZU_UP)
  ZV_UP => GET_HOST_DATA_RDWR (YL_ZV_UP)
  ZW_UP => GET_HOST_DATA_RDWR (YL_ZW_UP)
  ZZZ => GET_HOST_DATA_RDONLY (YL_ZZZ)
  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:SHALLOW_MF:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:SHALLOW_MF:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  !$OMP PARALLEL DO PRIVATE (JBLK, JLON, YLCPG_BNDS, YLSTACK) FIRSTPRIVATE (D)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX

    

    

    DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JLON
      YLCPG_BNDS%KFDIA = JLON
      D%NIJB = YLCPG_BNDS%KIDIA
      D%NIJE = YLCPG_BNDS%KFDIA
      D%NIB = YLCPG_BNDS%KIDIA
      D%NIE = YLCPG_BNDS%KFDIA
      YLSTACK%L8 = fxtran_acdc_stack_l8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%U8 = fxtran_acdc_stack_u8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%L4 = fxtran_acdc_stack_l4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%U4 = fxtran_acdc_stack_u4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      
      CALL SHALLOW_MF_OPENACC (D, YDPHYEX%CST, YDPHYEX%NEBN, YDPHYEX%PARAM_MFSHALLN, YDPHYEX%TURBN, YDPHYEX&
      &%CSTURB, KRR=IKR, KRRL=IKRL, KRRI=IKRI, KSV=1, ONOMIXLG=YDPHYEX%MISC%ONOMIXLG, KSV_LGBEG=ISV_LGBEG&
      &, KSV_LGEND=ISV_LGEND, PTSTEP=PTSPHY, PDZZ=ZDZZ(:,:, JBLK), PZZ=ZZZ(:,:, JBLK), PRHODJ=ZHRODJ(:,&
      &:, JBLK), PRHODREF=ZHRODREF(:,:, JBLK), PPABSM=PAPRSF(:,:, JBLK), PEXNM=ZEXNER(:,:, JBLK), PSFTH&
      &=ZSFTH(:, JBLK), PSFRV=ZSFRV(:, JBLK), PTHM=ZTHETA(:,:, JBLK), PRM=ZRM(:,:,:, JBLK), PUM=PU(:,:,&
      & JBLK), PVM=PV(:,:, JBLK), PTKEM=PTKE(:,:, JBLK), PSVM=ZSVM(:,:,:, JBLK), PDUDT_MF=ZDUDT_MF(:,:,&
      & JBLK), PDVDT_MF=ZDVDT_MF(:,:, JBLK), PDTHLDT_MF=ZDTHLDT_MF(:,:, JBLK), PDRTDT_MF=ZDRTDT_MF(:,:,&
      & JBLK), PDSVDT_MF=ZSVDT_MF(:,:,:, JBLK), PSIGMF=ZSIGMF(:,:, JBLK), PRC_MF=ZRC_UP(:,:, JBLK), PRI_MF&
      &=ZRI_UP(:,:, JBLK), PCF_MF=PNEB(:,:, JBLK), PFLXZTHVMF=ZFLXZTHVMF(:,:, JBLK), PFLXZTHMF=ZFLXZTHMF&
      &(:,:, JBLK), PFLXZRMF=ZFLXZRMF(:,:, JBLK), PFLXZUMF=ZFLXZUMF(:,:, JBLK), PFLXZVMF=ZFLXZVMF(:,:, JBLK&
      &), PTHL_UP=ZTHL_UP(:,:, JBLK), PRT_UP=ZRT_UP(:,:, JBLK), PRV_UP=ZRV_UP(:,:, JBLK), PRC_UP=ZRC_UP&
      &(:,:, JBLK), PRI_UP=ZRI_UP(:,:, JBLK), PU_UP=ZU_UP(:,:, JBLK), PV_UP=ZV_UP(:,:, JBLK), PTHV_UP=ZTHV_UP&
      &(:,:, JBLK), PW_UP=ZW_UP(:,:, JBLK), PFRAC_UP=ZFRAC_UP(:,:, JBLK), PEMF=ZEMF(:,:, JBLK), PDETR=ZDETR&
      &(:,:, JBLK), PENTR=ZENTR(:,:, JBLK), KKLCL=IKLCL(:, JBLK), KKETL=IKETL(:, JBLK), KKCTL=IKCTL(:, JBLK&
      &), PDX=0._JPRB, PDY=0._JPRB, KBUDGETS=0,YDSTACK=YLSTACK)
    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:SHALLOW_MF:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

  IF (FXTRAN_ACDC_LSYNCHOST ('ARP_SHALLOW_MF_PARALLEL:SHALLOW_MF')) THEN
    IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:SHALLOW_MF:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
    IKCTL => GET_HOST_DATA_RDWR (YL_IKCTL)
    IKETL => GET_HOST_DATA_RDWR (YL_IKETL)
    IKLCL => GET_HOST_DATA_RDWR (YL_IKLCL)
    PAPRSF => GET_HOST_DATA_RDWR (YD_PAPRSF)
    PNEB => GET_HOST_DATA_RDWR (YD_PNEB)
    PTKE => GET_HOST_DATA_RDWR (YD_PTKE)
    PU => GET_HOST_DATA_RDWR (YD_PU)
    PV => GET_HOST_DATA_RDWR (YD_PV)
    ZDETR => GET_HOST_DATA_RDWR (YL_ZDETR)
    ZDRTDT_MF => GET_HOST_DATA_RDWR (YL_ZDRTDT_MF)
    ZDTHLDT_MF => GET_HOST_DATA_RDWR (YL_ZDTHLDT_MF)
    ZDUDT_MF => GET_HOST_DATA_RDWR (YL_ZDUDT_MF)
    ZDVDT_MF => GET_HOST_DATA_RDWR (YL_ZDVDT_MF)
    ZDZZ => GET_HOST_DATA_RDWR (YL_ZDZZ)
    ZEMF => GET_HOST_DATA_RDWR (YL_ZEMF)
    ZENTR => GET_HOST_DATA_RDWR (YL_ZENTR)
    ZEXNER => GET_HOST_DATA_RDWR (YL_ZEXNER)
    ZFLXZRMF => GET_HOST_DATA_RDWR (YL_ZFLXZRMF)
    ZFLXZTHMF => GET_HOST_DATA_RDWR (YL_ZFLXZTHMF)
    ZFLXZTHVMF => GET_HOST_DATA_RDWR (YL_ZFLXZTHVMF)
    ZFLXZUMF => GET_HOST_DATA_RDWR (YL_ZFLXZUMF)
    ZFLXZVMF => GET_HOST_DATA_RDWR (YL_ZFLXZVMF)
    ZFRAC_UP => GET_HOST_DATA_RDWR (YL_ZFRAC_UP)
    ZHRODJ => GET_HOST_DATA_RDWR (YL_ZHRODJ)
    ZHRODREF => GET_HOST_DATA_RDWR (YL_ZHRODREF)
    ZRC_UP => GET_HOST_DATA_RDWR (YL_ZRC_UP)
    ZRI_UP => GET_HOST_DATA_RDWR (YL_ZRI_UP)
    ZRM => GET_HOST_DATA_RDWR (YL_ZRM)
    ZRT_UP => GET_HOST_DATA_RDWR (YL_ZRT_UP)
    ZRV_UP => GET_HOST_DATA_RDWR (YL_ZRV_UP)
    ZSFRV => GET_HOST_DATA_RDWR (YL_ZSFRV)
    ZSFTH => GET_HOST_DATA_RDWR (YL_ZSFTH)
    ZSIGMF => GET_HOST_DATA_RDWR (YL_ZSIGMF)
    ZSVDT_MF => GET_HOST_DATA_RDWR (YL_ZSVDT_MF)
    ZSVM => GET_HOST_DATA_RDWR (YL_ZSVM)
    ZTHETA => GET_HOST_DATA_RDWR (YL_ZTHETA)
    ZTHL_UP => GET_HOST_DATA_RDWR (YL_ZTHL_UP)
    ZTHV_UP => GET_HOST_DATA_RDWR (YL_ZTHV_UP)
    ZU_UP => GET_HOST_DATA_RDWR (YL_ZU_UP)
    ZV_UP => GET_HOST_DATA_RDWR (YL_ZV_UP)
    ZW_UP => GET_HOST_DATA_RDWR (YL_ZW_UP)
    ZZZ => GET_HOST_DATA_RDWR (YL_ZZZ)
    IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:SHALLOW_MF:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:SHALLOW_MF:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  IKCTL => NULL ()
  IKETL => NULL ()
  IKLCL => NULL ()
  PAPRSF => NULL ()
  PNEB => NULL ()
  PTKE => NULL ()
  PU => NULL ()
  PV => NULL ()
  ZDETR => NULL ()
  ZDRTDT_MF => NULL ()
  ZDTHLDT_MF => NULL ()
  ZDUDT_MF => NULL ()
  ZDVDT_MF => NULL ()
  ZDZZ => NULL ()
  ZEMF => NULL ()
  ZENTR => NULL ()
  ZEXNER => NULL ()
  ZFLXZRMF => NULL ()
  ZFLXZTHMF => NULL ()
  ZFLXZTHVMF => NULL ()
  ZFLXZUMF => NULL ()
  ZFLXZVMF => NULL ()
  ZFRAC_UP => NULL ()
  ZHRODJ => NULL ()
  ZHRODREF => NULL ()
  ZRC_UP => NULL ()
  ZRI_UP => NULL ()
  ZRM => NULL ()
  ZRT_UP => NULL ()
  ZRV_UP => NULL ()
  ZSFRV => NULL ()
  ZSFTH => NULL ()
  ZSIGMF => NULL ()
  ZSVDT_MF => NULL ()
  ZSVM => NULL ()
  ZTHETA => NULL ()
  ZTHL_UP => NULL ()
  ZTHV_UP => NULL ()
  ZU_UP => NULL ()
  ZV_UP => NULL ()
  ZW_UP => NULL ()
  ZZZ => NULL ()
  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:SHALLOW_MF:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN&
  &','ARP_SHALLOW_MF_PARALLEL:SHALLOW_MF')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:SHALLOW_MF:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  IKCTL => GET_DEVICE_DATA_RDWR (YL_IKCTL)
  IKETL => GET_DEVICE_DATA_RDWR (YL_IKETL)
  IKLCL => GET_DEVICE_DATA_RDWR (YL_IKLCL)
  PAPRSF => GET_DEVICE_DATA_RDONLY (YD_PAPRSF)
  PNEB => GET_DEVICE_DATA_RDWR (YD_PNEB)
  PTKE => GET_DEVICE_DATA_RDONLY (YD_PTKE)
  PU => GET_DEVICE_DATA_RDONLY (YD_PU)
  PV => GET_DEVICE_DATA_RDONLY (YD_PV)
  ZDETR => GET_DEVICE_DATA_RDWR (YL_ZDETR)
  ZDRTDT_MF => GET_DEVICE_DATA_RDWR (YL_ZDRTDT_MF)
  ZDTHLDT_MF => GET_DEVICE_DATA_RDWR (YL_ZDTHLDT_MF)
  ZDUDT_MF => GET_DEVICE_DATA_RDWR (YL_ZDUDT_MF)
  ZDVDT_MF => GET_DEVICE_DATA_RDWR (YL_ZDVDT_MF)
  ZDZZ => GET_DEVICE_DATA_RDONLY (YL_ZDZZ)
  ZEMF => GET_DEVICE_DATA_RDWR (YL_ZEMF)
  ZENTR => GET_DEVICE_DATA_RDWR (YL_ZENTR)
  ZEXNER => GET_DEVICE_DATA_RDONLY (YL_ZEXNER)
  ZFLXZRMF => GET_DEVICE_DATA_RDWR (YL_ZFLXZRMF)
  ZFLXZTHMF => GET_DEVICE_DATA_RDWR (YL_ZFLXZTHMF)
  ZFLXZTHVMF => GET_DEVICE_DATA_RDWR (YL_ZFLXZTHVMF)
  ZFLXZUMF => GET_DEVICE_DATA_RDWR (YL_ZFLXZUMF)
  ZFLXZVMF => GET_DEVICE_DATA_RDWR (YL_ZFLXZVMF)
  ZFRAC_UP => GET_DEVICE_DATA_RDWR (YL_ZFRAC_UP)
  ZHRODJ => GET_DEVICE_DATA_RDONLY (YL_ZHRODJ)
  ZHRODREF => GET_DEVICE_DATA_RDONLY (YL_ZHRODREF)
  ZRC_UP => GET_DEVICE_DATA_RDWR (YL_ZRC_UP)
  ZRI_UP => GET_DEVICE_DATA_RDWR (YL_ZRI_UP)
  ZRM => GET_DEVICE_DATA_RDONLY (YL_ZRM)
  ZRT_UP => GET_DEVICE_DATA_RDWR (YL_ZRT_UP)
  ZRV_UP => GET_DEVICE_DATA_RDWR (YL_ZRV_UP)
  ZSFRV => GET_DEVICE_DATA_RDONLY (YL_ZSFRV)
  ZSFTH => GET_DEVICE_DATA_RDONLY (YL_ZSFTH)
  ZSIGMF => GET_DEVICE_DATA_RDWR (YL_ZSIGMF)
  ZSVDT_MF => GET_DEVICE_DATA_RDWR (YL_ZSVDT_MF)
  ZSVM => GET_DEVICE_DATA_RDONLY (YL_ZSVM)
  ZTHETA => GET_DEVICE_DATA_RDONLY (YL_ZTHETA)
  ZTHL_UP => GET_DEVICE_DATA_RDWR (YL_ZTHL_UP)
  ZTHV_UP => GET_DEVICE_DATA_RDWR (YL_ZTHV_UP)
  ZU_UP => GET_DEVICE_DATA_RDWR (YL_ZU_UP)
  ZV_UP => GET_DEVICE_DATA_RDWR (YL_ZV_UP)
  ZW_UP => GET_DEVICE_DATA_RDWR (YL_ZW_UP)
  ZZZ => GET_DEVICE_DATA_RDONLY (YL_ZZZ)
  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:SHALLOW_MF:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:SHALLOW_MF:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  
    !$ACC PARALLEL LOOP GANG &
    !$ACC&PRESENT (IKCTL, IKETL, IKLCL, PAPRSF, PNEB, PTKE, PU, PV, YDCPG_OPTS, YDPHYEX, YFXTRAN_ACDC_STACK, &
    !$ACC&         ZDETR, ZDRTDT_MF, ZDTHLDT_MF, ZDUDT_MF, ZDVDT_MF, ZDZZ, ZEMF, ZENTR, &
    !$ACC&         ZEXNER, ZFLXZRMF, ZFLXZTHMF, ZFLXZTHVMF, ZFLXZUMF, ZFLXZVMF, ZFRAC_UP, &
    !$ACC&         ZHRODJ, ZHRODREF, ZRC_UP, ZRI_UP, ZRM, ZRT_UP, ZRV_UP, ZSFRV, ZSFTH, &
    !$ACC&         ZSIGMF, ZSVDT_MF, ZSVM, ZTHETA, ZTHL_UP, ZTHV_UP, ZU_UP, ZV_UP, ZW_UP, &
    !$ACC&         ZZZ) &
    !$ACC&PRIVATE (JBLK) &
    !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
    
    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    
    
    
    !$ACC LOOP VECTOR &
    !$ACC&PRIVATE (DD, JLON, YLCPG_BNDS, YLSTACK) 

    

    DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JLON
      YLCPG_BNDS%KFDIA = JLON
      DD = D
      DD%NIJB = YLCPG_BNDS%KIDIA
      DD%NIJE = YLCPG_BNDS%KFDIA
      DD%NIB = YLCPG_BNDS%KIDIA
      DD%NIE = YLCPG_BNDS%KFDIA
      YLSTACK%L8 = fxtran_acdc_stack_l8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%U8 = fxtran_acdc_stack_u8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%L4 = fxtran_acdc_stack_l4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%U4 = fxtran_acdc_stack_u4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      
      CALL SHALLOW_MF_OPENACC (DD, YDPHYEX%CST, YDPHYEX%NEBN, YDPHYEX%PARAM_MFSHALLN, YDPHYEX%TURBN, YDPHYEX&
      &%CSTURB, KRR=IKR, KRRL=IKRL, KRRI=IKRI, KSV=1, ONOMIXLG=YDPHYEX%MISC%ONOMIXLG, KSV_LGBEG=ISV_LGBEG&
      &, KSV_LGEND=ISV_LGEND, PTSTEP=PTSPHY, PDZZ=ZDZZ(:,:, JBLK), PZZ=ZZZ(:,:, JBLK), PRHODJ=ZHRODJ(:,&
      &:, JBLK), PRHODREF=ZHRODREF(:,:, JBLK), PPABSM=PAPRSF(:,:, JBLK), PEXNM=ZEXNER(:,:, JBLK), PSFTH&
      &=ZSFTH(:, JBLK), PSFRV=ZSFRV(:, JBLK), PTHM=ZTHETA(:,:, JBLK), PRM=ZRM(:,:,:, JBLK), PUM=PU(:,:,&
      & JBLK), PVM=PV(:,:, JBLK), PTKEM=PTKE(:,:, JBLK), PSVM=ZSVM(:,:,:, JBLK), PDUDT_MF=ZDUDT_MF(:,:,&
      & JBLK), PDVDT_MF=ZDVDT_MF(:,:, JBLK), PDTHLDT_MF=ZDTHLDT_MF(:,:, JBLK), PDRTDT_MF=ZDRTDT_MF(:,:,&
      & JBLK), PDSVDT_MF=ZSVDT_MF(:,:,:, JBLK), PSIGMF=ZSIGMF(:,:, JBLK), PRC_MF=ZRC_UP(:,:, JBLK), PRI_MF&
      &=ZRI_UP(:,:, JBLK), PCF_MF=PNEB(:,:, JBLK), PFLXZTHVMF=ZFLXZTHVMF(:,:, JBLK), PFLXZTHMF=ZFLXZTHMF&
      &(:,:, JBLK), PFLXZRMF=ZFLXZRMF(:,:, JBLK), PFLXZUMF=ZFLXZUMF(:,:, JBLK), PFLXZVMF=ZFLXZVMF(:,:, JBLK&
      &), PTHL_UP=ZTHL_UP(:,:, JBLK), PRT_UP=ZRT_UP(:,:, JBLK), PRV_UP=ZRV_UP(:,:, JBLK), PRC_UP=ZRC_UP&
      &(:,:, JBLK), PRI_UP=ZRI_UP(:,:, JBLK), PU_UP=ZU_UP(:,:, JBLK), PV_UP=ZV_UP(:,:, JBLK), PTHV_UP=ZTHV_UP&
      &(:,:, JBLK), PW_UP=ZW_UP(:,:, JBLK), PFRAC_UP=ZFRAC_UP(:,:, JBLK), PEMF=ZEMF(:,:, JBLK), PDETR=ZDETR&
      &(:,:, JBLK), PENTR=ZENTR(:,:, JBLK), KKLCL=IKLCL(:, JBLK), KKETL=IKETL(:, JBLK), KKCTL=IKCTL(:, JBLK&
      &), PDX=0._JPRB, PDY=0._JPRB, KBUDGETS=0,YDSTACK=YLSTACK)
    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:SHALLOW_MF:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

  IF (FXTRAN_ACDC_LSYNCHOST ('ARP_SHALLOW_MF_PARALLEL:SHALLOW_MF')) THEN
    IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:SHALLOW_MF:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
    IKCTL => GET_HOST_DATA_RDWR (YL_IKCTL)
    IKETL => GET_HOST_DATA_RDWR (YL_IKETL)
    IKLCL => GET_HOST_DATA_RDWR (YL_IKLCL)
    PAPRSF => GET_HOST_DATA_RDWR (YD_PAPRSF)
    PNEB => GET_HOST_DATA_RDWR (YD_PNEB)
    PTKE => GET_HOST_DATA_RDWR (YD_PTKE)
    PU => GET_HOST_DATA_RDWR (YD_PU)
    PV => GET_HOST_DATA_RDWR (YD_PV)
    ZDETR => GET_HOST_DATA_RDWR (YL_ZDETR)
    ZDRTDT_MF => GET_HOST_DATA_RDWR (YL_ZDRTDT_MF)
    ZDTHLDT_MF => GET_HOST_DATA_RDWR (YL_ZDTHLDT_MF)
    ZDUDT_MF => GET_HOST_DATA_RDWR (YL_ZDUDT_MF)
    ZDVDT_MF => GET_HOST_DATA_RDWR (YL_ZDVDT_MF)
    ZDZZ => GET_HOST_DATA_RDWR (YL_ZDZZ)
    ZEMF => GET_HOST_DATA_RDWR (YL_ZEMF)
    ZENTR => GET_HOST_DATA_RDWR (YL_ZENTR)
    ZEXNER => GET_HOST_DATA_RDWR (YL_ZEXNER)
    ZFLXZRMF => GET_HOST_DATA_RDWR (YL_ZFLXZRMF)
    ZFLXZTHMF => GET_HOST_DATA_RDWR (YL_ZFLXZTHMF)
    ZFLXZTHVMF => GET_HOST_DATA_RDWR (YL_ZFLXZTHVMF)
    ZFLXZUMF => GET_HOST_DATA_RDWR (YL_ZFLXZUMF)
    ZFLXZVMF => GET_HOST_DATA_RDWR (YL_ZFLXZVMF)
    ZFRAC_UP => GET_HOST_DATA_RDWR (YL_ZFRAC_UP)
    ZHRODJ => GET_HOST_DATA_RDWR (YL_ZHRODJ)
    ZHRODREF => GET_HOST_DATA_RDWR (YL_ZHRODREF)
    ZRC_UP => GET_HOST_DATA_RDWR (YL_ZRC_UP)
    ZRI_UP => GET_HOST_DATA_RDWR (YL_ZRI_UP)
    ZRM => GET_HOST_DATA_RDWR (YL_ZRM)
    ZRT_UP => GET_HOST_DATA_RDWR (YL_ZRT_UP)
    ZRV_UP => GET_HOST_DATA_RDWR (YL_ZRV_UP)
    ZSFRV => GET_HOST_DATA_RDWR (YL_ZSFRV)
    ZSFTH => GET_HOST_DATA_RDWR (YL_ZSFTH)
    ZSIGMF => GET_HOST_DATA_RDWR (YL_ZSIGMF)
    ZSVDT_MF => GET_HOST_DATA_RDWR (YL_ZSVDT_MF)
    ZSVM => GET_HOST_DATA_RDWR (YL_ZSVM)
    ZTHETA => GET_HOST_DATA_RDWR (YL_ZTHETA)
    ZTHL_UP => GET_HOST_DATA_RDWR (YL_ZTHL_UP)
    ZTHV_UP => GET_HOST_DATA_RDWR (YL_ZTHV_UP)
    ZU_UP => GET_HOST_DATA_RDWR (YL_ZU_UP)
    ZV_UP => GET_HOST_DATA_RDWR (YL_ZV_UP)
    ZW_UP => GET_HOST_DATA_RDWR (YL_ZW_UP)
    ZZZ => GET_HOST_DATA_RDWR (YL_ZZZ)
    IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:SHALLOW_MF:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:SHALLOW_MF:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  IKCTL => NULL ()
  IKETL => NULL ()
  IKLCL => NULL ()
  PAPRSF => NULL ()
  PNEB => NULL ()
  PTKE => NULL ()
  PU => NULL ()
  PV => NULL ()
  ZDETR => NULL ()
  ZDRTDT_MF => NULL ()
  ZDTHLDT_MF => NULL ()
  ZDUDT_MF => NULL ()
  ZDVDT_MF => NULL ()
  ZDZZ => NULL ()
  ZEMF => NULL ()
  ZENTR => NULL ()
  ZEXNER => NULL ()
  ZFLXZRMF => NULL ()
  ZFLXZTHMF => NULL ()
  ZFLXZTHVMF => NULL ()
  ZFLXZUMF => NULL ()
  ZFLXZVMF => NULL ()
  ZFRAC_UP => NULL ()
  ZHRODJ => NULL ()
  ZHRODREF => NULL ()
  ZRC_UP => NULL ()
  ZRI_UP => NULL ()
  ZRM => NULL ()
  ZRT_UP => NULL ()
  ZRV_UP => NULL ()
  ZSFRV => NULL ()
  ZSFTH => NULL ()
  ZSIGMF => NULL ()
  ZSVDT_MF => NULL ()
  ZSVM => NULL ()
  ZTHETA => NULL ()
  ZTHL_UP => NULL ()
  ZTHV_UP => NULL ()
  ZU_UP => NULL ()
  ZV_UP => NULL ()
  ZW_UP => NULL ()
  ZZZ => NULL ()
  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:SHALLOW_MF:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSE
    CALL ABOR1 ('ARP_SHALLOW_MF_PARALLEL: NOT METHOD WAS FOUND')
ENDIF

IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:SHALLOW_MF',1,ZHOOK_HANDLE_PARALLEL)

IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:FINISH',0,ZHOOK_HANDLE_PARALLEL)

IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','ARP_SHALLOW_MF_PARALLEL:FINISH')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:FINISH:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  KNLAB => GET_HOST_DATA_RDWR (YD_KNLAB)
  PCP => GET_HOST_DATA_RDONLY (YD_PCP)
  PDIFTQ => GET_HOST_DATA_RDWR (YD_PDIFTQ)
  PDIFTS => GET_HOST_DATA_RDWR (YD_PDIFTS)
  PMF_UP => GET_HOST_DATA_RDWR (YD_PMF_UP)
  PQLI => GET_HOST_DATA_RDWR (YD_PQLI)
  PRODTH_CVPP => GET_HOST_DATA_RDWR (YD_PRODTH_CVPP)
  PSTRTU => GET_HOST_DATA_RDWR (YD_PSTRTU)
  PSTRTV => GET_HOST_DATA_RDWR (YD_PSTRTV)
  PT => GET_HOST_DATA_RDONLY (YD_PT)
  ZDPSG => GET_HOST_DATA_RDONLY (YL_ZDPSG)
  ZDRTDT_MF => GET_HOST_DATA_RDONLY (YL_ZDRTDT_MF)
  ZDTHLDT_MF => GET_HOST_DATA_RDONLY (YL_ZDTHLDT_MF)
  ZDUDT_MF => GET_HOST_DATA_RDONLY (YL_ZDUDT_MF)
  ZDVDT_MF => GET_HOST_DATA_RDONLY (YL_ZDVDT_MF)
  ZEMF => GET_HOST_DATA_RDONLY (YL_ZEMF)
  ZEXNER => GET_HOST_DATA_RDONLY (YL_ZEXNER)
  ZFH_MF => GET_HOST_DATA_RDWR (YL_ZFH_MF)
  ZFLXZTHVMF => GET_HOST_DATA_RDONLY (YL_ZFLXZTHVMF)
  ZFQ_MF => GET_HOST_DATA_RDWR (YL_ZFQ_MF)
  ZFU_MF => GET_HOST_DATA_RDWR (YL_ZFU_MF)
  ZFV_MF => GET_HOST_DATA_RDWR (YL_ZFV_MF)
  ZHRODREF => GET_HOST_DATA_RDONLY (YL_ZHRODREF)
  ZQDM => GET_HOST_DATA_RDONLY (YL_ZQDM)
  ZRC_UP => GET_HOST_DATA_RDONLY (YL_ZRC_UP)
  ZRI_UP => GET_HOST_DATA_RDONLY (YL_ZRI_UP)
  ZRT_UP => GET_HOST_DATA_RDONLY (YL_ZRT_UP)
  ZTHETA => GET_HOST_DATA_RDONLY (YL_ZTHETA)
  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:FINISH:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:FINISH:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
  !$OMP PARALLEL DO PRIVATE (JBLK, JLEV, JLON, ZTDCP) FIRSTPRIVATE (YLCPG_BNDS)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    CALL YLCPG_BNDS%UPDATE (JBLK)
    
    ZFQ_MF (:,:, JBLK)=0.
    ZFH_MF (:,:, JBLK)=0.
    ZFU_MF (:,:, JBLK)=0.
    ZFV_MF (:,:, JBLK)=0.

    DO JLEV=2, YDCPG_OPTS%KFLEVG

      DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
        ZFQ_MF (JLON, JLEV, JBLK)=ZFQ_MF (JLON, JLEV-1, JBLK)-ZDPSG (JLON, JLEV&
        &, JBLK)*ZDRTDT_MF (JLON, JLEV, JBLK)*ZQDM (JLON, JLEV, JBLK)
        ZTDCP=ZVMD*ZDRTDT_MF (JLON, JLEV, JBLK)
        ZFH_MF (JLON, JLEV, JBLK)=ZFH_MF (JLON, JLEV-1, JBLK)-ZDPSG (JLON, JLEV&
        &, JBLK)*(ZDTHLDT_MF (JLON, JLEV, JBLK)*ZEXNER (JLON, JLEV, JBLK)*(PCP&
        & (JLON, JLEV, JBLK)+PTSPHY*ZTDCP)+PT (JLON, JLEV, JBLK)*ZTDCP)
        ZFU_MF (JLON, JLEV, JBLK)=ZFU_MF (JLON, JLEV-1, JBLK)-ZDPSG&
        & (JLON, JLEV, JBLK)*ZDUDT_MF (JLON, JLEV, JBLK)
        ZFV_MF (JLON, JLEV, JBLK)=ZFV_MF (JLON, JLEV-1, JBLK)-ZDPSG&
        & (JLON, JLEV, JBLK)*ZDVDT_MF (JLON, JLEV, JBLK)
      ENDDO

    ENDDO

    PRODTH_CVPP (:,:, JBLK)=0.

    DO JLEV=1, YDCPG_OPTS%KFLEVG

      DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
        PDIFTQ (JLON, JLEV, JBLK)=PDIFTQ (JLON, JLEV, JBLK)+ZFQ_MF (JLON, JLEV, JBLK)
        PDIFTS (JLON, JLEV, JBLK)=PDIFTS (JLON, JLEV, JBLK)+ZFH_MF (JLON, JLEV, JBLK)
        PSTRTU (JLON, JLEV, JBLK)=PSTRTU (JLON, JLEV, JBLK)+ZFU_MF (JLON, JLEV, JBLK)
        PSTRTV (JLON, JLEV, JBLK)=PSTRTV (JLON, JLEV, JBLK)+ZFV_MF (JLON, JLEV, JBLK)
        PRODTH_CVPP (JLON, JLEV, JBLK)=YDCST%RG/ZTHETA (JLON, JLEV, JBLK)*ZFLXZTHVMF (JLON, JLEV, JBLK)
        PQLI (JLON, JLEV, JBLK)=(ZRC_UP (JLON, JLEV, JBLK)+ZRI_UP&
        & (JLON, JLEV, JBLK))/(1.+ZRT_UP (JLON, JLEV, JBLK))
        KNLAB (JLON, JLEV, JBLK)=INT (MAX (0., SIGN (1., PQLI (JLON, JLEV, JBLK)-1.E-8)))
        PMF_UP (JLON, JLEV, JBLK)=-ZEMF (JLON, JLEV, JBLK)/ZHRODREF (JLON, JLEV, JBLK)
      ENDDO

    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:FINISH:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

  IF (FXTRAN_ACDC_LSYNCHOST ('ARP_SHALLOW_MF_PARALLEL:FINISH')) THEN
    IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:FINISH:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
    KNLAB => GET_HOST_DATA_RDWR (YD_KNLAB)
    PCP => GET_HOST_DATA_RDWR (YD_PCP)
    PDIFTQ => GET_HOST_DATA_RDWR (YD_PDIFTQ)
    PDIFTS => GET_HOST_DATA_RDWR (YD_PDIFTS)
    PMF_UP => GET_HOST_DATA_RDWR (YD_PMF_UP)
    PQLI => GET_HOST_DATA_RDWR (YD_PQLI)
    PRODTH_CVPP => GET_HOST_DATA_RDWR (YD_PRODTH_CVPP)
    PSTRTU => GET_HOST_DATA_RDWR (YD_PSTRTU)
    PSTRTV => GET_HOST_DATA_RDWR (YD_PSTRTV)
    PT => GET_HOST_DATA_RDWR (YD_PT)
    ZDPSG => GET_HOST_DATA_RDWR (YL_ZDPSG)
    ZDRTDT_MF => GET_HOST_DATA_RDWR (YL_ZDRTDT_MF)
    ZDTHLDT_MF => GET_HOST_DATA_RDWR (YL_ZDTHLDT_MF)
    ZDUDT_MF => GET_HOST_DATA_RDWR (YL_ZDUDT_MF)
    ZDVDT_MF => GET_HOST_DATA_RDWR (YL_ZDVDT_MF)
    ZEMF => GET_HOST_DATA_RDWR (YL_ZEMF)
    ZEXNER => GET_HOST_DATA_RDWR (YL_ZEXNER)
    ZFH_MF => GET_HOST_DATA_RDWR (YL_ZFH_MF)
    ZFLXZTHVMF => GET_HOST_DATA_RDWR (YL_ZFLXZTHVMF)
    ZFQ_MF => GET_HOST_DATA_RDWR (YL_ZFQ_MF)
    ZFU_MF => GET_HOST_DATA_RDWR (YL_ZFU_MF)
    ZFV_MF => GET_HOST_DATA_RDWR (YL_ZFV_MF)
    ZHRODREF => GET_HOST_DATA_RDWR (YL_ZHRODREF)
    ZQDM => GET_HOST_DATA_RDWR (YL_ZQDM)
    ZRC_UP => GET_HOST_DATA_RDWR (YL_ZRC_UP)
    ZRI_UP => GET_HOST_DATA_RDWR (YL_ZRI_UP)
    ZRT_UP => GET_HOST_DATA_RDWR (YL_ZRT_UP)
    ZTHETA => GET_HOST_DATA_RDWR (YL_ZTHETA)
    IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:FINISH:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:FINISH:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  KNLAB => NULL ()
  PCP => NULL ()
  PDIFTQ => NULL ()
  PDIFTS => NULL ()
  PMF_UP => NULL ()
  PQLI => NULL ()
  PRODTH_CVPP => NULL ()
  PSTRTU => NULL ()
  PSTRTV => NULL ()
  PT => NULL ()
  ZDPSG => NULL ()
  ZDRTDT_MF => NULL ()
  ZDTHLDT_MF => NULL ()
  ZDUDT_MF => NULL ()
  ZDVDT_MF => NULL ()
  ZEMF => NULL ()
  ZEXNER => NULL ()
  ZFH_MF => NULL ()
  ZFLXZTHVMF => NULL ()
  ZFQ_MF => NULL ()
  ZFU_MF => NULL ()
  ZFV_MF => NULL ()
  ZHRODREF => NULL ()
  ZQDM => NULL ()
  ZRC_UP => NULL ()
  ZRI_UP => NULL ()
  ZRT_UP => NULL ()
  ZTHETA => NULL ()
  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:FINISH:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMPSINGLECOLUMN','ARP_SHALLOW_MF_PARALLEL:FINISH')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:FINISH:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  KNLAB => GET_HOST_DATA_RDWR (YD_KNLAB)
  PCP => GET_HOST_DATA_RDONLY (YD_PCP)
  PDIFTQ => GET_HOST_DATA_RDWR (YD_PDIFTQ)
  PDIFTS => GET_HOST_DATA_RDWR (YD_PDIFTS)
  PMF_UP => GET_HOST_DATA_RDWR (YD_PMF_UP)
  PQLI => GET_HOST_DATA_RDWR (YD_PQLI)
  PRODTH_CVPP => GET_HOST_DATA_RDWR (YD_PRODTH_CVPP)
  PSTRTU => GET_HOST_DATA_RDWR (YD_PSTRTU)
  PSTRTV => GET_HOST_DATA_RDWR (YD_PSTRTV)
  PT => GET_HOST_DATA_RDONLY (YD_PT)
  ZDPSG => GET_HOST_DATA_RDONLY (YL_ZDPSG)
  ZDRTDT_MF => GET_HOST_DATA_RDONLY (YL_ZDRTDT_MF)
  ZDTHLDT_MF => GET_HOST_DATA_RDONLY (YL_ZDTHLDT_MF)
  ZDUDT_MF => GET_HOST_DATA_RDONLY (YL_ZDUDT_MF)
  ZDVDT_MF => GET_HOST_DATA_RDONLY (YL_ZDVDT_MF)
  ZEMF => GET_HOST_DATA_RDONLY (YL_ZEMF)
  ZEXNER => GET_HOST_DATA_RDONLY (YL_ZEXNER)
  ZFH_MF => GET_HOST_DATA_RDWR (YL_ZFH_MF)
  ZFLXZTHVMF => GET_HOST_DATA_RDONLY (YL_ZFLXZTHVMF)
  ZFQ_MF => GET_HOST_DATA_RDWR (YL_ZFQ_MF)
  ZFU_MF => GET_HOST_DATA_RDWR (YL_ZFU_MF)
  ZFV_MF => GET_HOST_DATA_RDWR (YL_ZFV_MF)
  ZHRODREF => GET_HOST_DATA_RDONLY (YL_ZHRODREF)
  ZQDM => GET_HOST_DATA_RDONLY (YL_ZQDM)
  ZRC_UP => GET_HOST_DATA_RDONLY (YL_ZRC_UP)
  ZRI_UP => GET_HOST_DATA_RDONLY (YL_ZRI_UP)
  ZRT_UP => GET_HOST_DATA_RDONLY (YL_ZRT_UP)
  ZTHETA => GET_HOST_DATA_RDONLY (YL_ZTHETA)
  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:FINISH:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:FINISH:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  !$OMP PARALLEL DO PRIVATE (JBLK, JLEV, JLON, YLCPG_BNDS, ZTDCP)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX

    

    

    DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JLON
      YLCPG_BNDS%KFDIA = JLON
      
      ZFQ_MF (JLON,:, JBLK)=0.
      ZFH_MF (JLON,:, JBLK)=0.
      ZFU_MF (JLON,:, JBLK)=0.
      ZFV_MF (JLON,:, JBLK)=0.

      DO JLEV=2, YDCPG_OPTS%KFLEVG
        
        ZFQ_MF (JLON, JLEV, JBLK)=ZFQ_MF (JLON, JLEV-1, JBLK)-ZDPSG (JLON, JLEV&
        &, JBLK)*ZDRTDT_MF (JLON, JLEV, JBLK)*ZQDM (JLON, JLEV, JBLK)
        ZTDCP=ZVMD*ZDRTDT_MF (JLON, JLEV, JBLK)
        ZFH_MF (JLON, JLEV, JBLK)=ZFH_MF (JLON, JLEV-1, JBLK)-ZDPSG (JLON, JLEV&
        &, JBLK)*(ZDTHLDT_MF (JLON, JLEV, JBLK)*ZEXNER (JLON, JLEV, JBLK)*(PCP&
        & (JLON, JLEV, JBLK)+PTSPHY*ZTDCP)+PT (JLON, JLEV, JBLK)*ZTDCP)
        ZFU_MF (JLON, JLEV, JBLK)=ZFU_MF (JLON, JLEV-1, JBLK)-ZDPSG&
        & (JLON, JLEV, JBLK)*ZDUDT_MF (JLON, JLEV, JBLK)
        ZFV_MF (JLON, JLEV, JBLK)=ZFV_MF (JLON, JLEV-1, JBLK)-ZDPSG&
        & (JLON, JLEV, JBLK)*ZDVDT_MF (JLON, JLEV, JBLK)
      
      ENDDO

      PRODTH_CVPP (JLON,:, JBLK)=0.

      DO JLEV=1, YDCPG_OPTS%KFLEVG
        
        PDIFTQ (JLON, JLEV, JBLK)=PDIFTQ (JLON, JLEV, JBLK)+ZFQ_MF (JLON, JLEV, JBLK)
        PDIFTS (JLON, JLEV, JBLK)=PDIFTS (JLON, JLEV, JBLK)+ZFH_MF (JLON, JLEV, JBLK)
        PSTRTU (JLON, JLEV, JBLK)=PSTRTU (JLON, JLEV, JBLK)+ZFU_MF (JLON, JLEV, JBLK)
        PSTRTV (JLON, JLEV, JBLK)=PSTRTV (JLON, JLEV, JBLK)+ZFV_MF (JLON, JLEV, JBLK)
        PRODTH_CVPP (JLON, JLEV, JBLK)=YDCST%RG/ZTHETA (JLON, JLEV, JBLK)*ZFLXZTHVMF (JLON, JLEV, JBLK)
        PQLI (JLON, JLEV, JBLK)=(ZRC_UP (JLON, JLEV, JBLK)+ZRI_UP&
        & (JLON, JLEV, JBLK))/(1.+ZRT_UP (JLON, JLEV, JBLK))
        KNLAB (JLON, JLEV, JBLK)=INT (MAX (0., SIGN (1., PQLI (JLON, JLEV, JBLK)-1.E-8)))
        PMF_UP (JLON, JLEV, JBLK)=-ZEMF (JLON, JLEV, JBLK)/ZHRODREF (JLON, JLEV, JBLK)
      
      ENDDO

    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:FINISH:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

  IF (FXTRAN_ACDC_LSYNCHOST ('ARP_SHALLOW_MF_PARALLEL:FINISH')) THEN
    IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:FINISH:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
    KNLAB => GET_HOST_DATA_RDWR (YD_KNLAB)
    PCP => GET_HOST_DATA_RDWR (YD_PCP)
    PDIFTQ => GET_HOST_DATA_RDWR (YD_PDIFTQ)
    PDIFTS => GET_HOST_DATA_RDWR (YD_PDIFTS)
    PMF_UP => GET_HOST_DATA_RDWR (YD_PMF_UP)
    PQLI => GET_HOST_DATA_RDWR (YD_PQLI)
    PRODTH_CVPP => GET_HOST_DATA_RDWR (YD_PRODTH_CVPP)
    PSTRTU => GET_HOST_DATA_RDWR (YD_PSTRTU)
    PSTRTV => GET_HOST_DATA_RDWR (YD_PSTRTV)
    PT => GET_HOST_DATA_RDWR (YD_PT)
    ZDPSG => GET_HOST_DATA_RDWR (YL_ZDPSG)
    ZDRTDT_MF => GET_HOST_DATA_RDWR (YL_ZDRTDT_MF)
    ZDTHLDT_MF => GET_HOST_DATA_RDWR (YL_ZDTHLDT_MF)
    ZDUDT_MF => GET_HOST_DATA_RDWR (YL_ZDUDT_MF)
    ZDVDT_MF => GET_HOST_DATA_RDWR (YL_ZDVDT_MF)
    ZEMF => GET_HOST_DATA_RDWR (YL_ZEMF)
    ZEXNER => GET_HOST_DATA_RDWR (YL_ZEXNER)
    ZFH_MF => GET_HOST_DATA_RDWR (YL_ZFH_MF)
    ZFLXZTHVMF => GET_HOST_DATA_RDWR (YL_ZFLXZTHVMF)
    ZFQ_MF => GET_HOST_DATA_RDWR (YL_ZFQ_MF)
    ZFU_MF => GET_HOST_DATA_RDWR (YL_ZFU_MF)
    ZFV_MF => GET_HOST_DATA_RDWR (YL_ZFV_MF)
    ZHRODREF => GET_HOST_DATA_RDWR (YL_ZHRODREF)
    ZQDM => GET_HOST_DATA_RDWR (YL_ZQDM)
    ZRC_UP => GET_HOST_DATA_RDWR (YL_ZRC_UP)
    ZRI_UP => GET_HOST_DATA_RDWR (YL_ZRI_UP)
    ZRT_UP => GET_HOST_DATA_RDWR (YL_ZRT_UP)
    ZTHETA => GET_HOST_DATA_RDWR (YL_ZTHETA)
    IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:FINISH:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:FINISH:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  KNLAB => NULL ()
  PCP => NULL ()
  PDIFTQ => NULL ()
  PDIFTS => NULL ()
  PMF_UP => NULL ()
  PQLI => NULL ()
  PRODTH_CVPP => NULL ()
  PSTRTU => NULL ()
  PSTRTV => NULL ()
  PT => NULL ()
  ZDPSG => NULL ()
  ZDRTDT_MF => NULL ()
  ZDTHLDT_MF => NULL ()
  ZDUDT_MF => NULL ()
  ZDVDT_MF => NULL ()
  ZEMF => NULL ()
  ZEXNER => NULL ()
  ZFH_MF => NULL ()
  ZFLXZTHVMF => NULL ()
  ZFQ_MF => NULL ()
  ZFU_MF => NULL ()
  ZFV_MF => NULL ()
  ZHRODREF => NULL ()
  ZQDM => NULL ()
  ZRC_UP => NULL ()
  ZRI_UP => NULL ()
  ZRT_UP => NULL ()
  ZTHETA => NULL ()
  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:FINISH:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN','ARP_SHALLOW_MF_PARALLEL:FINISH')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:FINISH:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  KNLAB => GET_DEVICE_DATA_RDWR (YD_KNLAB)
  PCP => GET_DEVICE_DATA_RDONLY (YD_PCP)
  PDIFTQ => GET_DEVICE_DATA_RDWR (YD_PDIFTQ)
  PDIFTS => GET_DEVICE_DATA_RDWR (YD_PDIFTS)
  PMF_UP => GET_DEVICE_DATA_RDWR (YD_PMF_UP)
  PQLI => GET_DEVICE_DATA_RDWR (YD_PQLI)
  PRODTH_CVPP => GET_DEVICE_DATA_RDWR (YD_PRODTH_CVPP)
  PSTRTU => GET_DEVICE_DATA_RDWR (YD_PSTRTU)
  PSTRTV => GET_DEVICE_DATA_RDWR (YD_PSTRTV)
  PT => GET_DEVICE_DATA_RDONLY (YD_PT)
  ZDPSG => GET_DEVICE_DATA_RDONLY (YL_ZDPSG)
  ZDRTDT_MF => GET_DEVICE_DATA_RDONLY (YL_ZDRTDT_MF)
  ZDTHLDT_MF => GET_DEVICE_DATA_RDONLY (YL_ZDTHLDT_MF)
  ZDUDT_MF => GET_DEVICE_DATA_RDONLY (YL_ZDUDT_MF)
  ZDVDT_MF => GET_DEVICE_DATA_RDONLY (YL_ZDVDT_MF)
  ZEMF => GET_DEVICE_DATA_RDONLY (YL_ZEMF)
  ZEXNER => GET_DEVICE_DATA_RDONLY (YL_ZEXNER)
  ZFH_MF => GET_DEVICE_DATA_RDWR (YL_ZFH_MF)
  ZFLXZTHVMF => GET_DEVICE_DATA_RDONLY (YL_ZFLXZTHVMF)
  ZFQ_MF => GET_DEVICE_DATA_RDWR (YL_ZFQ_MF)
  ZFU_MF => GET_DEVICE_DATA_RDWR (YL_ZFU_MF)
  ZFV_MF => GET_DEVICE_DATA_RDWR (YL_ZFV_MF)
  ZHRODREF => GET_DEVICE_DATA_RDONLY (YL_ZHRODREF)
  ZQDM => GET_DEVICE_DATA_RDONLY (YL_ZQDM)
  ZRC_UP => GET_DEVICE_DATA_RDONLY (YL_ZRC_UP)
  ZRI_UP => GET_DEVICE_DATA_RDONLY (YL_ZRI_UP)
  ZRT_UP => GET_DEVICE_DATA_RDONLY (YL_ZRT_UP)
  ZTHETA => GET_DEVICE_DATA_RDONLY (YL_ZTHETA)
  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:FINISH:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:FINISH:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  
    !$ACC PARALLEL LOOP GANG &
    !$ACC&PRESENT (KNLAB, PCP, PDIFTQ, PDIFTS, PMF_UP, PQLI, PRODTH_CVPP, PSTRTU, PSTRTV, &
    !$ACC&         PT, YDCPG_OPTS, YDCST, YFXTRAN_ACDC_STACK, ZDPSG, ZDRTDT_MF, ZDTHLDT_MF, &
    !$ACC&         ZDUDT_MF, ZDVDT_MF, ZEMF, ZEXNER, ZFH_MF, ZFLXZTHVMF, ZFQ_MF, ZFU_MF, &
    !$ACC&         ZFV_MF, ZHRODREF, ZQDM, ZRC_UP, ZRI_UP, ZRT_UP, ZTHETA) &
    !$ACC&PRIVATE (JBLK) &
    !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
    
    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    
    
    
    !$ACC LOOP VECTOR &
    !$ACC&PRIVATE (JLEV, JLON, YLCPG_BNDS, ZTDCP) 

    

    DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JLON
      YLCPG_BNDS%KFDIA = JLON
      
      ZFQ_MF (JLON,:, JBLK)=0.
      ZFH_MF (JLON,:, JBLK)=0.
      ZFU_MF (JLON,:, JBLK)=0.
      ZFV_MF (JLON,:, JBLK)=0.

      DO JLEV=2, YDCPG_OPTS%KFLEVG
        
        ZFQ_MF (JLON, JLEV, JBLK)=ZFQ_MF (JLON, JLEV-1, JBLK)-ZDPSG (JLON, JLEV&
        &, JBLK)*ZDRTDT_MF (JLON, JLEV, JBLK)*ZQDM (JLON, JLEV, JBLK)
        ZTDCP=ZVMD*ZDRTDT_MF (JLON, JLEV, JBLK)
        ZFH_MF (JLON, JLEV, JBLK)=ZFH_MF (JLON, JLEV-1, JBLK)-ZDPSG (JLON, JLEV&
        &, JBLK)*(ZDTHLDT_MF (JLON, JLEV, JBLK)*ZEXNER (JLON, JLEV, JBLK)*(PCP&
        & (JLON, JLEV, JBLK)+PTSPHY*ZTDCP)+PT (JLON, JLEV, JBLK)*ZTDCP)
        ZFU_MF (JLON, JLEV, JBLK)=ZFU_MF (JLON, JLEV-1, JBLK)-ZDPSG&
        & (JLON, JLEV, JBLK)*ZDUDT_MF (JLON, JLEV, JBLK)
        ZFV_MF (JLON, JLEV, JBLK)=ZFV_MF (JLON, JLEV-1, JBLK)-ZDPSG&
        & (JLON, JLEV, JBLK)*ZDVDT_MF (JLON, JLEV, JBLK)
      
      ENDDO

      PRODTH_CVPP (JLON,:, JBLK)=0.

      DO JLEV=1, YDCPG_OPTS%KFLEVG
        
        PDIFTQ (JLON, JLEV, JBLK)=PDIFTQ (JLON, JLEV, JBLK)+ZFQ_MF (JLON, JLEV, JBLK)
        PDIFTS (JLON, JLEV, JBLK)=PDIFTS (JLON, JLEV, JBLK)+ZFH_MF (JLON, JLEV, JBLK)
        PSTRTU (JLON, JLEV, JBLK)=PSTRTU (JLON, JLEV, JBLK)+ZFU_MF (JLON, JLEV, JBLK)
        PSTRTV (JLON, JLEV, JBLK)=PSTRTV (JLON, JLEV, JBLK)+ZFV_MF (JLON, JLEV, JBLK)
        PRODTH_CVPP (JLON, JLEV, JBLK)=YDCST%RG/ZTHETA (JLON, JLEV, JBLK)*ZFLXZTHVMF (JLON, JLEV, JBLK)
        PQLI (JLON, JLEV, JBLK)=(ZRC_UP (JLON, JLEV, JBLK)+ZRI_UP&
        & (JLON, JLEV, JBLK))/(1.+ZRT_UP (JLON, JLEV, JBLK))
        KNLAB (JLON, JLEV, JBLK)=INT (MAX (0., SIGN (1., PQLI (JLON, JLEV, JBLK)-1.E-8)))
        PMF_UP (JLON, JLEV, JBLK)=-ZEMF (JLON, JLEV, JBLK)/ZHRODREF (JLON, JLEV, JBLK)
      
      ENDDO

    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:FINISH:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

  IF (FXTRAN_ACDC_LSYNCHOST ('ARP_SHALLOW_MF_PARALLEL:FINISH')) THEN
    IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:FINISH:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
    KNLAB => GET_HOST_DATA_RDWR (YD_KNLAB)
    PCP => GET_HOST_DATA_RDWR (YD_PCP)
    PDIFTQ => GET_HOST_DATA_RDWR (YD_PDIFTQ)
    PDIFTS => GET_HOST_DATA_RDWR (YD_PDIFTS)
    PMF_UP => GET_HOST_DATA_RDWR (YD_PMF_UP)
    PQLI => GET_HOST_DATA_RDWR (YD_PQLI)
    PRODTH_CVPP => GET_HOST_DATA_RDWR (YD_PRODTH_CVPP)
    PSTRTU => GET_HOST_DATA_RDWR (YD_PSTRTU)
    PSTRTV => GET_HOST_DATA_RDWR (YD_PSTRTV)
    PT => GET_HOST_DATA_RDWR (YD_PT)
    ZDPSG => GET_HOST_DATA_RDWR (YL_ZDPSG)
    ZDRTDT_MF => GET_HOST_DATA_RDWR (YL_ZDRTDT_MF)
    ZDTHLDT_MF => GET_HOST_DATA_RDWR (YL_ZDTHLDT_MF)
    ZDUDT_MF => GET_HOST_DATA_RDWR (YL_ZDUDT_MF)
    ZDVDT_MF => GET_HOST_DATA_RDWR (YL_ZDVDT_MF)
    ZEMF => GET_HOST_DATA_RDWR (YL_ZEMF)
    ZEXNER => GET_HOST_DATA_RDWR (YL_ZEXNER)
    ZFH_MF => GET_HOST_DATA_RDWR (YL_ZFH_MF)
    ZFLXZTHVMF => GET_HOST_DATA_RDWR (YL_ZFLXZTHVMF)
    ZFQ_MF => GET_HOST_DATA_RDWR (YL_ZFQ_MF)
    ZFU_MF => GET_HOST_DATA_RDWR (YL_ZFU_MF)
    ZFV_MF => GET_HOST_DATA_RDWR (YL_ZFV_MF)
    ZHRODREF => GET_HOST_DATA_RDWR (YL_ZHRODREF)
    ZQDM => GET_HOST_DATA_RDWR (YL_ZQDM)
    ZRC_UP => GET_HOST_DATA_RDWR (YL_ZRC_UP)
    ZRI_UP => GET_HOST_DATA_RDWR (YL_ZRI_UP)
    ZRT_UP => GET_HOST_DATA_RDWR (YL_ZRT_UP)
    ZTHETA => GET_HOST_DATA_RDWR (YL_ZTHETA)
    IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:FINISH:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:FINISH:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  KNLAB => NULL ()
  PCP => NULL ()
  PDIFTQ => NULL ()
  PDIFTS => NULL ()
  PMF_UP => NULL ()
  PQLI => NULL ()
  PRODTH_CVPP => NULL ()
  PSTRTU => NULL ()
  PSTRTV => NULL ()
  PT => NULL ()
  ZDPSG => NULL ()
  ZDRTDT_MF => NULL ()
  ZDTHLDT_MF => NULL ()
  ZDUDT_MF => NULL ()
  ZDVDT_MF => NULL ()
  ZEMF => NULL ()
  ZEXNER => NULL ()
  ZFH_MF => NULL ()
  ZFLXZTHVMF => NULL ()
  ZFQ_MF => NULL ()
  ZFU_MF => NULL ()
  ZFV_MF => NULL ()
  ZHRODREF => NULL ()
  ZQDM => NULL ()
  ZRC_UP => NULL ()
  ZRI_UP => NULL ()
  ZRT_UP => NULL ()
  ZTHETA => NULL ()
  IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:FINISH:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSE
    CALL ABOR1 ('ARP_SHALLOW_MF_PARALLEL: NOT METHOD WAS FOUND')
ENDIF

IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL:FINISH',1,ZHOOK_HANDLE_PARALLEL)


CALL FXTRAN_ACDC_GPUMEMSTAT (__FILE__, __LINE__, "END")

IF (LHOOK) CALL DR_HOOK ('DELETE_TEMPORARIES',0,ZHOOK_HANDLE_FIELD_API)
IF (ASSOCIATED (YL_IKCTL)) CALL FIELD_DELETE (YL_IKCTL)
IF (ASSOCIATED (YL_IKETL)) CALL FIELD_DELETE (YL_IKETL)
IF (ASSOCIATED (YL_IKLCL)) CALL FIELD_DELETE (YL_IKLCL)
IF (ASSOCIATED (YL_ZDETR)) CALL FIELD_DELETE (YL_ZDETR)
IF (ASSOCIATED (YL_ZDPSG)) CALL FIELD_DELETE (YL_ZDPSG)
IF (ASSOCIATED (YL_ZDRTDT_MF)) CALL FIELD_DELETE (YL_ZDRTDT_MF)
IF (ASSOCIATED (YL_ZDTHLDT_MF)) CALL FIELD_DELETE (YL_ZDTHLDT_MF)
IF (ASSOCIATED (YL_ZDUDT_MF)) CALL FIELD_DELETE (YL_ZDUDT_MF)
IF (ASSOCIATED (YL_ZDVDT_MF)) CALL FIELD_DELETE (YL_ZDVDT_MF)
IF (ASSOCIATED (YL_ZDZZ)) CALL FIELD_DELETE (YL_ZDZZ)
IF (ASSOCIATED (YL_ZEMF)) CALL FIELD_DELETE (YL_ZEMF)
IF (ASSOCIATED (YL_ZENTR)) CALL FIELD_DELETE (YL_ZENTR)
IF (ASSOCIATED (YL_ZEXNER)) CALL FIELD_DELETE (YL_ZEXNER)
IF (ASSOCIATED (YL_ZFH_MF)) CALL FIELD_DELETE (YL_ZFH_MF)
IF (ASSOCIATED (YL_ZFLXZRMF)) CALL FIELD_DELETE (YL_ZFLXZRMF)
IF (ASSOCIATED (YL_ZFLXZTHMF)) CALL FIELD_DELETE (YL_ZFLXZTHMF)
IF (ASSOCIATED (YL_ZFLXZTHVMF)) CALL FIELD_DELETE (YL_ZFLXZTHVMF)
IF (ASSOCIATED (YL_ZFLXZUMF)) CALL FIELD_DELETE (YL_ZFLXZUMF)
IF (ASSOCIATED (YL_ZFLXZVMF)) CALL FIELD_DELETE (YL_ZFLXZVMF)
IF (ASSOCIATED (YL_ZFQ_MF)) CALL FIELD_DELETE (YL_ZFQ_MF)
IF (ASSOCIATED (YL_ZFRAC_UP)) CALL FIELD_DELETE (YL_ZFRAC_UP)
IF (ASSOCIATED (YL_ZFU_MF)) CALL FIELD_DELETE (YL_ZFU_MF)
IF (ASSOCIATED (YL_ZFV_MF)) CALL FIELD_DELETE (YL_ZFV_MF)
IF (ASSOCIATED (YL_ZHRO)) CALL FIELD_DELETE (YL_ZHRO)
IF (ASSOCIATED (YL_ZHRODJ)) CALL FIELD_DELETE (YL_ZHRODJ)
IF (ASSOCIATED (YL_ZHRODREF)) CALL FIELD_DELETE (YL_ZHRODREF)
IF (ASSOCIATED (YL_ZQDM)) CALL FIELD_DELETE (YL_ZQDM)
IF (ASSOCIATED (YL_ZRC_UP)) CALL FIELD_DELETE (YL_ZRC_UP)
IF (ASSOCIATED (YL_ZRI_UP)) CALL FIELD_DELETE (YL_ZRI_UP)
IF (ASSOCIATED (YL_ZRM)) CALL FIELD_DELETE (YL_ZRM)
IF (ASSOCIATED (YL_ZRT_UP)) CALL FIELD_DELETE (YL_ZRT_UP)
IF (ASSOCIATED (YL_ZRV_UP)) CALL FIELD_DELETE (YL_ZRV_UP)
IF (ASSOCIATED (YL_ZSFRV)) CALL FIELD_DELETE (YL_ZSFRV)
IF (ASSOCIATED (YL_ZSFTH)) CALL FIELD_DELETE (YL_ZSFTH)
IF (ASSOCIATED (YL_ZSIGMF)) CALL FIELD_DELETE (YL_ZSIGMF)
IF (ASSOCIATED (YL_ZSVDT_MF)) CALL FIELD_DELETE (YL_ZSVDT_MF)
IF (ASSOCIATED (YL_ZSVM)) CALL FIELD_DELETE (YL_ZSVM)
IF (ASSOCIATED (YL_ZTHETA)) CALL FIELD_DELETE (YL_ZTHETA)
IF (ASSOCIATED (YL_ZTHL_UP)) CALL FIELD_DELETE (YL_ZTHL_UP)
IF (ASSOCIATED (YL_ZTHV_UP)) CALL FIELD_DELETE (YL_ZTHV_UP)
IF (ASSOCIATED (YL_ZTKE)) CALL FIELD_DELETE (YL_ZTKE)
IF (ASSOCIATED (YL_ZU)) CALL FIELD_DELETE (YL_ZU)
IF (ASSOCIATED (YL_ZU_UP)) CALL FIELD_DELETE (YL_ZU_UP)
IF (ASSOCIATED (YL_ZV)) CALL FIELD_DELETE (YL_ZV)
IF (ASSOCIATED (YL_ZV_UP)) CALL FIELD_DELETE (YL_ZV_UP)
IF (ASSOCIATED (YL_ZW_UP)) CALL FIELD_DELETE (YL_ZW_UP)
IF (ASSOCIATED (YL_ZZZ)) CALL FIELD_DELETE (YL_ZZZ)
IF (ASSOCIATED (YL_ZZZF)) CALL FIELD_DELETE (YL_ZZZF)
IF (LHOOK) CALL DR_HOOK ('DELETE_TEMPORARIES',1,ZHOOK_HANDLE_FIELD_API)
IF (LHOOK) CALL DR_HOOK ('ARP_SHALLOW_MF_PARALLEL', 1, ZHOOK_HANDLE)
END SUBROUTINE ARP_SHALLOW_MF_PARALLEL
