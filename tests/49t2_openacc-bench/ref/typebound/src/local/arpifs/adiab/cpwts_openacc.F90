
SUBROUTINE CPWTS_OPENACC (YDCST, YDCPG_OPTS, YDMCC, YDPHY, YDPHY1, KLON, KIDIA, KFDIA, KCSS, PDT&
&, PTDTS, PTDTP, PTDWS, PTDWSI, PTDWP, PTDWPI, PTDWL, PTDSNS, PTDALBNS, PTDRHONS, PTPCLI, PWPCLI&
&, PLSM, PIVEG, PTS1, PTP1, PWS1, PWSI1, PWP1, PWPI1, PWL1, PSNS1, PALBNS1, PRHONS1, YDSTACK)
!$ACC ROUTINE (CPWTS_OPENACC) SEQ
USE PARKIND1,ONLY:JPIM, JPRB

USE CPG_OPTS_TYPE_MOD,ONLY:CPG_OPTS_TYPE
USE YOMCST,ONLY:TCST
USE YOMPHY,ONLY:TPHY
USE YOMPHY1,ONLY:TPHY1
USE YOMMCC,ONLY:TMCC
#include "fxtran_acdc_stack.h"
USE FXTRAN_ACDC_STACK_MOD
USE FXTRAN_ACDC_ABORT_MOD

IMPLICIT NONE


TYPE (TCST), INTENT (IN)::YDCST
TYPE (CPG_OPTS_TYPE), INTENT (IN)::YDCPG_OPTS
TYPE (TMCC), INTENT (IN)::YDMCC
TYPE (TPHY), INTENT (IN)::YDPHY
TYPE (TPHY1), INTENT (IN)::YDPHY1
INTEGER (KIND=JPIM), INTENT (IN)::KLON
INTEGER (KIND=JPIM), INTENT (IN)::KIDIA
INTEGER (KIND=JPIM), INTENT (IN)::KFDIA
INTEGER (KIND=JPIM), INTENT (IN)::KCSS
REAL (KIND=JPRB), INTENT (IN)::PDT
REAL (KIND=JPRB), INTENT (IN)::PTDTS (KLON)
REAL (KIND=JPRB), INTENT (IN)::PTDTP (KLON, KCSS)
REAL (KIND=JPRB), INTENT (IN)::PTDWS (KLON)
REAL (KIND=JPRB), INTENT (IN)::PTDWSI (KLON)
REAL (KIND=JPRB), INTENT (IN)::PTDWP (KLON)
REAL (KIND=JPRB), INTENT (IN)::PTDWPI (KLON)
REAL (KIND=JPRB), INTENT (IN)::PTDWL (KLON)
REAL (KIND=JPRB), INTENT (IN)::PTDSNS (KLON)
REAL (KIND=JPRB), INTENT (IN)::PTDALBNS (KLON)
REAL (KIND=JPRB), INTENT (IN)::PTDRHONS (KLON)
REAL (KIND=JPRB), INTENT (IN)::PTPCLI (KLON)
REAL (KIND=JPRB), INTENT (IN)::PWPCLI (KLON)
REAL (KIND=JPRB), INTENT (IN)::PLSM (KLON)
REAL (KIND=JPRB), INTENT (IN)::PIVEG (KLON)
REAL (KIND=JPRB), INTENT (INOUT)::PTS1 (KLON)
REAL (KIND=JPRB), INTENT (INOUT)::PTP1 (KLON, KCSS)
REAL (KIND=JPRB), INTENT (INOUT)::PWS1 (KLON)
REAL (KIND=JPRB), INTENT (INOUT)::PWSI1 (KLON)
REAL (KIND=JPRB), INTENT (INOUT)::PWP1 (KLON)
REAL (KIND=JPRB), INTENT (INOUT)::PWPI1 (KLON)
REAL (KIND=JPRB), INTENT (INOUT)::PWL1 (KLON)
REAL (KIND=JPRB), INTENT (INOUT)::PSNS1 (KLON)
REAL (KIND=JPRB), INTENT (INOUT)::PALBNS1 (KLON)
REAL (KIND=JPRB), INTENT (INOUT)::PRHONS1 (KLON)
TYPE(FXTRAN_ACDC_STACK), INTENT (IN) :: YDSTACK
INTEGER (KIND=JPIM)::JLON
INTEGER (KIND=JPIM)::JCSS
INTEGER (KIND=JPIM)::ITVGLAM
REAL (KIND=JPRB)::ZEPSN


JLON = KIDIA



ZEPSN=1.E-3_JPRB

DO JCSS=1, KCSS
  
  PTP1 (JLON, JCSS)=PTP1 (JLON, JCSS)+PDT*PTDTP (JLON, JCSS)
  
ENDDO


PTS1 (JLON)=PTS1 (JLON)+PDT*PTDTS (JLON)

IF (YDCPG_OPTS%YRSURF_OPTS%YSD_VP%YTPC%LSET) THEN
  PTP1 (JLON, KCSS)=PTP1 (JLON, KCSS)+PDT*PLSM (JLON)*YDPHY1%OMTPRO*(PTPCLI (JLON)-PTP1 (JLON, KCSS))
ENDIF

PWS1 (JLON)=PWS1 (JLON)+PDT*PTDWS (JLON)
PWS1 (JLON)=MAX (0.0_JPRB, PWS1 (JLON))


IF (YDPHY%LSOLV) THEN
  
  PWL1 (JLON)=PWL1 (JLON)+PDT*PTDWL (JLON)
  PWL1 (JLON)=MAX (0.0_JPRB, PWL1 (JLON))
  PWP1 (JLON)=PWP1 (JLON)+PDT*PTDWP (JLON)

  IF (YDCPG_OPTS%YRSURF_OPTS%YSD_VP%YWPC%LSET) THEN
    PWP1 (JLON)=PWP1 (JLON)+PDT*PLSM (JLON)*YDPHY1%OMWPRO*(PWPCLI (JLON)-PWP1 (JLON))
  ENDIF

  PWP1 (JLON)=MAX (0.0_JPRB, PWP1 (JLON))

  IF (YDPHY%LFGEL) THEN
    PWPI1 (JLON)=PWPI1 (JLON)+PDT*PTDWPI (JLON)
    PWPI1 (JLON)=MAX (0.0_JPRB, PWPI1 (JLON))
    PWSI1 (JLON)=PWSI1 (JLON)+PDT*PTDWSI (JLON)
    PWSI1 (JLON)=MAX (0.0_JPRB, PWSI1 (JLON))
  ENDIF

  
ELSE
  
  PWP1 (JLON)=PWP1 (JLON)+PDT*PTDWP (JLON)

  IF (YDCPG_OPTS%YRSURF_OPTS%YSD_VP%YWPC%LSET) THEN
    PWP1 (JLON)=PWP1 (JLON)+PDT*PLSM (JLON)*YDPHY1%OMWPRO*(PWPCLI (JLON)-PWP1 (JLON))
  ENDIF

  
ENDIF


IF (YDPHY%LNEIGE) THEN
  
  PSNS1 (JLON)=PSNS1 (JLON)+PDT*PTDSNS (JLON)

  IF (YDPHY%LSOLV) THEN

    IF (NINT (PIVEG (JLON))==YDPHY1%NTVGLA) THEN
      PSNS1 (JLON)=MAX (ZEPSN, PSNS1 (JLON))
    ENDIF

  ENDIF

  PSNS1 (JLON)=MAX (0.0_JPRB, PSNS1 (JLON))

  IF (YDPHY%LSNV.OR.YDPHY%LVGSN) THEN

    IF (PSNS1 (JLON)>0.0_JPRB) THEN
      PALBNS1 (JLON)=PALBNS1 (JLON)+PTDALBNS (JLON)*PDT
      PALBNS1 (JLON)=MIN (MAX (PALBNS1 (JLON), YDPHY1%ALBMIN), YDPHY1%ALBMAX)
    ELSE
      PALBNS1 (JLON)=YDPHY1%ALBMAX
    ENDIF


    IF (PSNS1 (JLON)>0) THEN
      PRHONS1 (JLON)=PRHONS1 (JLON)+PTDRHONS (JLON)*PDT
      PRHONS1 (JLON)=MIN (MAX (PRHONS1 (JLON), YDPHY1%RHOMIN), YDPHY1%RHOMAX)
    ELSE
      PRHONS1 (JLON)=YDPHY1%RHOMIN
    ENDIF

  ENDIF

  
ENDIF


IF (YDMCC%LMCC02.AND.YDPHY%LSOLV) THEN
  ITVGLAM=10*YDPHY1%NTVGLA+1

  DO JCSS=1, KCSS

    

    IF (NINT (10._JPRB*PIVEG (JLON))==ITVGLAM) THEN
      PTP1 (JLON, JCSS)=MIN (PTP1 (JLON, JCSS), YDCST%RTT)
    ENDIF

  
  ENDDO


  

  IF (NINT (10._JPRB*PIVEG (JLON))==ITVGLAM) THEN
    PTS1 (JLON)=MIN (PTS1 (JLON), YDCST%RTT)
  ENDIF

  
ENDIF



END SUBROUTINE CPWTS_OPENACC
