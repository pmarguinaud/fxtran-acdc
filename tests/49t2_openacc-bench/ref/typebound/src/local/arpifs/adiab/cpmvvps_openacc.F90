
SUBROUTINE CPMVVPS_OPENACC (YDCST, YDVAB, KLON, KIDIA, KFDIA, KFLEV&
&, PDT, PFP, PRES, PFEVL, PFEVN, PEVEL, PSDVBC, PSPT1, YDSTACK)
!$ACC ROUTINE (CPMVVPS_OPENACC) SEQ
USE YOMVERT,ONLY:TVAB
USE PARKIND1,ONLY:JPIM, JPRB

USE YOMCST,ONLY:TCST
#include "fxtran_acdc_stack.h"
USE FXTRAN_ACDC_STACK_MOD
USE FXTRAN_ACDC_ABORT_MOD

IMPLICIT NONE


TYPE (TCST), INTENT (IN)::YDCST
TYPE (TVAB), INTENT (IN)::YDVAB
INTEGER (KIND=JPIM), INTENT (IN)::KLON
INTEGER (KIND=JPIM), INTENT (IN)::KIDIA
INTEGER (KIND=JPIM), INTENT (IN)::KFDIA
INTEGER (KIND=JPIM), INTENT (IN)::KFLEV
REAL (KIND=JPRB), INTENT (IN)::PDT
REAL (KIND=JPRB), INTENT (IN)::PFP (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PRES (KLON)
REAL (KIND=JPRB), INTENT (IN)::PFEVL (KLON)
REAL (KIND=JPRB), INTENT (IN)::PFEVN (KLON)
REAL (KIND=JPRB), INTENT (INOUT)::PEVEL (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (INOUT)::PSDVBC (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (INOUT)::PSPT1 (KLON)
TYPE(FXTRAN_ACDC_STACK), INTENT (IN) :: YDSTACK
TYPE(FXTRAN_ACDC_STACK) :: YLSTACK
INTEGER (KIND=JPIM)::JLON
INTEGER (KIND=JPIM)::JLEV
fxtran_acdc_temp (REAL (KIND=JPRB), ZFE, (KLON, 0:KFLEV))
REAL (KIND=JPRB)::ZEVELS 


YLSTACK = YDSTACK



IF (KIND (ZFE) == 8) THEN
    fxtran_acdc_alloc8 (ZFE)
ELSEIF (KIND (ZFE) == 4) THEN
    fxtran_acdc_alloc4 (ZFE)
ELSE
    STOP 1
ENDIF


JLON = KIDIA




ZFE (JLON, KFLEV)=PFEVL (JLON)+PFEVN (JLON)
ZEVELS =ZFE (JLON, KFLEV)+PFP (JLON, KFLEV)

ZFE (JLON, 0:KFLEV-1)=0.0_JPRB

PEVEL (JLON, KFLEV)=PEVEL (JLON, KFLEV)+YDCST%RG*ZEVELS 
PSDVBC (JLON, KFLEV)=PSDVBC (JLON, KFLEV)+YDCST%RG*ZEVELS 


DO JLEV=1, KFLEV-1
  
  PEVEL (JLON, JLEV)=PEVEL (JLON, JLEV)+YDCST%RG*(YDVAB%VBH (JLEV)*ZEVELS )
  PSDVBC (JLON, JLEV)=PSDVBC (JLON, JLEV)+YDCST%RG*(YDVAB%VBH (JLEV)*ZEVELS )
  
ENDDO


PSPT1 (JLON)=PSPT1 (JLON)-PDT*YDCST%RG*(PFP (JLON, KFLEV)+ZFE (JLON, KFLEV))/PRES (JLON)



END SUBROUTINE CPMVVPS_OPENACC
