
SUBROUTINE LAITRI_OPENACC (KSLB1, KPROMA, KST, KEND, KFLEV, KFLDN, KFLDX, KQM&
&, CDTYPE, PDLAT, PCLA, PDLO, PCLO, KL0, PVINTW, PXSL, PXF, LDADD, YDSTACK)
!$ACC ROUTINE (LAITRI_OPENACC) SEQ
USE PARKIND1,ONLY:JPIM, JPRB

#include "fxtran_acdc_stack.h"
USE FXTRAN_ACDC_STACK_MOD
USE FXTRAN_ACDC_ABORT_MOD

IMPLICIT NONE


INTEGER (KIND=JPIM), INTENT (IN)::KSLB1
INTEGER (KIND=JPIM), INTENT (IN)::KPROMA
INTEGER (KIND=JPIM), INTENT (IN)::KFLEV
INTEGER (KIND=JPIM), INTENT (IN)::KFLDN
INTEGER (KIND=JPIM), INTENT (IN)::KFLDX
INTEGER (KIND=JPIM), INTENT (IN)::KST
INTEGER (KIND=JPIM), INTENT (IN)::KEND
INTEGER (KIND=JPIM), INTENT (IN)::KQM
CHARACTER (LEN=*), INTENT (IN)::CDTYPE
INTEGER (KIND=JPIM), INTENT (IN)::KL0 (KPROMA, KFLEV, 0:3)
REAL (KIND=JPRB), INTENT (IN)::PDLAT (KPROMA, KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PCLA (KPROMA, KFLEV, 3)
REAL (KIND=JPRB), INTENT (IN)::PDLO (KPROMA, KFLEV, 0:3)
REAL (KIND=JPRB), INTENT (IN)::PCLO (KPROMA, KFLEV, 3, 2)
REAL (KIND=JPRB), INTENT (IN)::PVINTW (KPROMA, KFLEV, 3)
REAL (KIND=JPRB), INTENT (IN)::PXSL (KSLB1*(KFLDX-KFLDN+1))
REAL (KIND=JPRB), INTENT (INOUT)::PXF (KPROMA, KFLEV)
LOGICAL, OPTIONAL, INTENT (IN)::LDADD
TYPE(FXTRAN_ACDC_STACK), INTENT (IN) :: YDSTACK
TYPE(FXTRAN_ACDC_STACK) :: YLSTACK
INTEGER (KIND=JPIM)::JROF
INTEGER (KIND=JPIM)::JLEV
LOGICAL::LLADD
fxtran_acdc_temp (REAL (KIND=JPRB), ZXF, (KPROMA, KFLEV))

#include "laitri_scalar_openacc.intfb.h"
#include "laitri_vector_openacc.intfb.h"


YLSTACK = YDSTACK



IF (KIND (ZXF) == 8) THEN
    fxtran_acdc_alloc8 (ZXF)
ELSEIF (KIND (ZXF) == 4) THEN
    fxtran_acdc_alloc4 (ZXF)
ELSE
    STOP 1
ENDIF


JROF = KST


LLADD=.FALSE.

IF (PRESENT (LDADD))  THEN
  LLADD=LDADD
ENDIF


IF (CDTYPE=='SCALAR') THEN

  IF (LLADD) THEN
    CALL LAITRI_SCALAR_OPENACC (KSLB1, KPROMA, KST, KEND, KFLEV, KFLDN, KFLDX,&
    & KQM, PDLAT, PCLA, PDLO, PCLO, KL0, PVINTW, PXSL, ZXF, YDSTACK=YLSTACK)
  ELSE
    CALL LAITRI_SCALAR_OPENACC (KSLB1, KPROMA, KST, KEND, KFLEV, KFLDN, KFLDX,&
    & KQM, PDLAT, PCLA, PDLO, PCLO, KL0, PVINTW, PXSL, PXF, YDSTACK=YLSTACK)
  ENDIF

ELSEIF (CDTYPE=='VECTOR') THEN

  IF (LLADD) THEN
    CALL LAITRI_VECTOR_OPENACC (KSLB1, KPROMA, KST, KEND, KFLEV, KFLDN, KFLDX,&
    & KQM, PDLAT, PCLA, PDLO, PCLO, KL0, PVINTW, PXSL, ZXF, YDSTACK=YLSTACK)
  ELSE
    CALL LAITRI_VECTOR_OPENACC (KSLB1, KPROMA, KST, KEND, KFLEV, KFLDN, KFLDX,&
    & KQM, PDLAT, PCLA, PDLO, PCLO, KL0, PVINTW, PXSL, PXF, YDSTACK=YLSTACK)
  ENDIF

ELSE
  CALL FXTRAN_ACDC_ABORT ('LAITRI: UNEXPECTED CDTYPE')
ENDIF


IF (LLADD) THEN

  DO JLEV=1, KFLEV
    
    PXF (JROF, JLEV)=PXF (JROF, JLEV)+ZXF (JROF, JLEV)
  
  ENDDO

ENDIF


END SUBROUTINE LAITRI_OPENACC
