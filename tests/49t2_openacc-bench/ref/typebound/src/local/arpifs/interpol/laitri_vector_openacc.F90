
SUBROUTINE LAITRI_VECTOR_OPENACC (KSLB1, KPROMA, KST, KEND, KFLEV, KFLDN,&
& KFLDX, KQM, PDLAT, PCLA, PDLO, PCLO, KL0, PVINTW, PXSL, PXF, YDSTACK)
!$ACC ROUTINE (LAITRI_VECTOR_OPENACC) SEQ
USE PARKIND1,ONLY:JPIM, JPRB, JPIB

#include "fxtran_acdc_stack.h"
USE FXTRAN_ACDC_STACK_MOD
USE FXTRAN_ACDC_ABORT_MOD

IMPLICIT NONE


INTEGER (KIND=JPIM), INTENT (IN)::KSLB1
INTEGER (KIND=JPIM), INTENT (IN)::KPROMA
INTEGER (KIND=JPIM), INTENT (IN)::KFLEV
INTEGER (KIND=JPIM), INTENT (IN)::KFLDN
INTEGER (KIND=JPIM), INTENT (IN)::KFLDX
INTEGER (KIND=JPIM), INTENT (IN)::KST
INTEGER (KIND=JPIM), INTENT (IN)::KEND
INTEGER (KIND=JPIM), INTENT (IN)::KQM
INTEGER (KIND=JPIM), INTENT (IN)::KL0 (KPROMA, KFLEV, 0:3)
REAL (KIND=JPRB), INTENT (IN)::PDLAT (KPROMA, KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PCLA (KPROMA, KFLEV, 3)
REAL (KIND=JPRB), INTENT (IN)::PDLO (KPROMA, KFLEV, 0:3)
REAL (KIND=JPRB), INTENT (IN)::PCLO (KPROMA, KFLEV, 3, 2)
REAL (KIND=JPRB), INTENT (IN)::PVINTW (KPROMA, KFLEV, 3)
REAL (KIND=JPRB), INTENT (IN)::PXSL (KSLB1*(KFLDX-KFLDN+1))
REAL (KIND=JPRB), INTENT (OUT)::PXF (KPROMA, KFLEV)
TYPE(FXTRAN_ACDC_STACK), INTENT (IN) :: YDSTACK
INTEGER (KIND=JPIB)::IV3L2
INTEGER (KIND=JPIB)::IV3L1
INTEGER (KIND=JPIB)::IV2L3
INTEGER (KIND=JPIB)::IV2L2
INTEGER (KIND=JPIB)::IV2L1
INTEGER (KIND=JPIB)::IV2L0
INTEGER (KIND=JPIB)::IV1L3
INTEGER (KIND=JPIB)::IV1L2
INTEGER (KIND=JPIB)::IV1L1
INTEGER (KIND=JPIB)::IV1L0
INTEGER (KIND=JPIB)::IV0L2
INTEGER (KIND=JPIB)::IV0L1
INTEGER (KIND=JPIM)::IQM
INTEGER (KIND=JPIM)::JROF
INTEGER (KIND=JPIM)::JL
LOGICAL::LQM0
LOGICAL::LQMV
LOGICAL::LQMH
REAL (KIND=JPRB)::ZZF122
REAL (KIND=JPRB)::ZZF121
REAL (KIND=JPRB)::ZZF112
REAL (KIND=JPRB)::ZZF111
REAL (KIND=JPRB)::ZZF222
REAL (KIND=JPRB)::ZZF221
REAL (KIND=JPRB)::ZZF212
REAL (KIND=JPRB)::ZZF211
REAL (KIND=JPRB)::ZZ3
REAL (KIND=JPRB)::ZZ2
REAL (KIND=JPRB)::ZZ1
REAL (KIND=JPRB)::ZZ0
REAL (KIND=JPRB)::ZZ13
REAL (KIND=JPRB)::ZZ12
REAL (KIND=JPRB)::ZZ11
REAL (KIND=JPRB)::ZZ10
REAL (KIND=JPRB)::ZZ02
REAL (KIND=JPRB)::ZZ01
REAL (KIND=JPRB)::ZZ32
REAL (KIND=JPRB)::ZZ31
REAL (KIND=JPRB)::ZZ23
REAL (KIND=JPRB)::ZZ22
REAL (KIND=JPRB)::ZZ21
REAL (KIND=JPRB)::ZZ20
REAL (KIND=JPRB)::ZMAX
REAL (KIND=JPRB)::ZMIN
#include "lainterpol.func.h"


JROF = KST


IQM=ABS (KQM)
LQMH=IQM==1.OR.IQM==2
LQMV=IQM==2.OR.IQM==3
LQM0=IQM>=4
IV0L1=1
IV1L1=1+KSLB1
IV2L1=IV1L1+KSLB1
IV3L1=IV2L1+KSLB1
IV0L2=2
IV1L0=KSLB1
IV1L2=2+KSLB1
IV1L3=3+KSLB1
IV2L0=IV1L0+KSLB1
IV2L2=IV1L2+KSLB1
IV2L3=IV1L3+KSLB1
IV3L2=IV2L2+KSLB1

DO JL=1, KFLEV
  
  ZZ10=PXSL (KL0 (JROF, JL, 1)+IV0L1)+PDLO (JROF, JL, 1)*(PXSL &
  &(KL0 (JROF, JL, 1)+IV0L2)-PXSL (KL0 (JROF, JL, 1)+IV0L1))
  ZZ20=PXSL (KL0 (JROF, JL, 2)+IV0L1)+PDLO (JROF, JL, 2)*(PXSL &
  &(KL0 (JROF, JL, 2)+IV0L2)-PXSL (KL0 (JROF, JL, 2)+IV0L1))
  ZZ01=PXSL (KL0 (JROF, JL, 0)+IV1L1)+PDLO (JROF, JL, 0)*(PXSL &
  &(KL0 (JROF, JL, 0)+IV1L2)-PXSL (KL0 (JROF, JL, 0)+IV1L1))
  ZZF111=PXSL (KL0 (JROF, JL, 1)+IV1L1)
  ZZF211=PXSL (KL0 (JROF, JL, 1)+IV1L2)
  ZZ11=PXSL (KL0 (JROF, JL, 1)+IV1L0)+PCLO (JROF, JL, 1, 1)*(ZZF111-PXSL (KL0 (JROF, JL&
  &, 1)+IV1L0))+PCLO (JROF, JL, 2, 1)*(ZZF211-PXSL (KL0 (JROF, JL, 1)+IV1L0))+PCLO (JROF&
  &, JL, 3, 1)*(PXSL (KL0 (JROF, JL, 1)+IV1L3)-PXSL (KL0 (JROF, JL, 1)+IV1L0))
  ZZF121=PXSL (KL0 (JROF, JL, 2)+IV1L1)
  ZZF221=PXSL (KL0 (JROF, JL, 2)+IV1L2)
  ZZ21=PXSL (KL0 (JROF, JL, 2)+IV1L0)+PCLO (JROF, JL, 1, 2)*(ZZF121-PXSL (KL0 (JROF, JL&
  &, 2)+IV1L0))+PCLO (JROF, JL, 2, 2)*(ZZF221-PXSL (KL0 (JROF, JL, 2)+IV1L0))+PCLO (JROF&
  &, JL, 3, 2)*(PXSL (KL0 (JROF, JL, 2)+IV1L3)-PXSL (KL0 (JROF, JL, 2)+IV1L0))
  ZZ31=PXSL (KL0 (JROF, JL, 3)+IV1L1)+PDLO (JROF, JL, 3)*(PXSL &
  &(KL0 (JROF, JL, 3)+IV1L2)-PXSL (KL0 (JROF, JL, 3)+IV1L1))
  ZZ02=PXSL (KL0 (JROF, JL, 0)+IV2L1)+PDLO (JROF, JL, 0)*(PXSL &
  &(KL0 (JROF, JL, 0)+IV2L2)-PXSL (KL0 (JROF, JL, 0)+IV2L1))
  ZZF112=PXSL (KL0 (JROF, JL, 1)+IV2L1)
  ZZF212=PXSL (KL0 (JROF, JL, 1)+IV2L2)
  ZZ12=PXSL (KL0 (JROF, JL, 1)+IV2L0)+PCLO (JROF, JL, 1, 1)*(ZZF112-PXSL (KL0 (JROF, JL&
  &, 1)+IV2L0))+PCLO (JROF, JL, 2, 1)*(ZZF212-PXSL (KL0 (JROF, JL, 1)+IV2L0))+PCLO (JROF&
  &, JL, 3, 1)*(PXSL (KL0 (JROF, JL, 1)+IV2L3)-PXSL (KL0 (JROF, JL, 1)+IV2L0))
  ZZF122=PXSL (KL0 (JROF, JL, 2)+IV2L1)
  ZZF222=PXSL (KL0 (JROF, JL, 2)+IV2L2)
  ZZ22=PXSL (KL0 (JROF, JL, 2)+IV2L0)+PCLO (JROF, JL, 1, 2)*(ZZF122-PXSL (KL0 (JROF, JL&
  &, 2)+IV2L0))+PCLO (JROF, JL, 2, 2)*(ZZF222-PXSL (KL0 (JROF, JL, 2)+IV2L0))+PCLO (JROF&
  &, JL, 3, 2)*(PXSL (KL0 (JROF, JL, 2)+IV2L3)-PXSL (KL0 (JROF, JL, 2)+IV2L0))
  ZZ32=PXSL (KL0 (JROF, JL, 3)+IV2L1)+PDLO (JROF, JL, 3)*(PXSL &
  &(KL0 (JROF, JL, 3)+IV2L2)-PXSL (KL0 (JROF, JL, 3)+IV2L1))
  ZZ13=PXSL (KL0 (JROF, JL, 1)+IV3L1)+PDLO (JROF, JL, 1)*(PXSL &
  &(KL0 (JROF, JL, 1)+IV3L2)-PXSL (KL0 (JROF, JL, 1)+IV3L1))
  ZZ23=PXSL (KL0 (JROF, JL, 2)+IV3L1)+PDLO (JROF, JL, 2)*(PXSL &
  &(KL0 (JROF, JL, 2)+IV3L2)-PXSL (KL0 (JROF, JL, 2)+IV3L1))

  IF (LQMH) THEN
    ZMIN=FMINJ (ZZF111, ZZF211)
    ZMAX=FMAXJ (ZZF111, ZZF211)
    ZZ11=FMAXJ (ZMIN, FMINJ (ZMAX, ZZ11))
    ZMIN=FMINJ (ZZF121, ZZF221)
    ZMAX=FMAXJ (ZZF121, ZZF221)
    ZZ21=FMAXJ (ZMIN, FMINJ (ZMAX, ZZ21))
    ZMIN=FMINJ (ZZF112, ZZF212)
    ZMAX=FMAXJ (ZZF112, ZZF212)
    ZZ12=FMAXJ (ZMIN, FMINJ (ZMAX, ZZ12))
    ZMIN=FMINJ (ZZF122, ZZF222)
    ZMAX=FMAXJ (ZZF122, ZZF222)
    ZZ22=FMAXJ (ZMIN, FMINJ (ZMAX, ZZ22))
  ENDIF

  ZZ0=ZZ10+PDLAT (JROF, JL)*(ZZ20-ZZ10)
  ZZ1=ZZ01+PCLA (JROF, JL, 1)*(ZZ11-ZZ01)+PCLA (JROF, JL&
  &, 2)*(ZZ21-ZZ01)+PCLA (JROF, JL, 3)*(ZZ31-ZZ01)
  ZZ2=ZZ02+PCLA (JROF, JL, 1)*(ZZ12-ZZ02)+PCLA (JROF, JL&
  &, 2)*(ZZ22-ZZ02)+PCLA (JROF, JL, 3)*(ZZ32-ZZ02)
  ZZ3=ZZ13+PDLAT (JROF, JL)*(ZZ23-ZZ13)

  IF (LQMH) THEN
    ZMIN=FMINJ (ZZ11, ZZ21)
    ZMAX=FMAXJ (ZZ11, ZZ21)
    ZZ1=FMAXJ (ZMIN, FMINJ (ZMAX, ZZ1))
    ZMIN=FMINJ (ZZ12, ZZ22)
    ZMAX=FMAXJ (ZZ12, ZZ22)
    ZZ2=FMAXJ (ZMIN, FMINJ (ZMAX, ZZ2))
  ENDIF

  PXF (JROF, JL)=ZZ0+PVINTW (JROF, JL, 1)*(ZZ1-ZZ0)+PVINTW &
  &(JROF, JL, 2)*(ZZ2-ZZ0)+PVINTW (JROF, JL, 3)*(ZZ3-ZZ0)

  IF (LQMV) THEN
    ZMIN=FMINJ (ZZ1, ZZ2)
    ZMAX=FMAXJ (ZZ1, ZZ2)
    PXF (JROF, JL)=FMAXJ (ZMIN, FMINJ (ZMAX, PXF (JROF, JL)))
  ENDIF


  

  IF (LQM0) THEN
    
    PXF (JROF, JL)=FMAXJ (PXF (JROF, JL), 0._JPRB)
  
  ENDIF

ENDDO


END SUBROUTINE LAITRI_VECTOR_OPENACC
