
SUBROUTINE GPTF1_YDVARS_PARALLEL (YDGEOMETRY, YDML_GCONF, YDDYN&
&, YDDYNA, YDVARS, LDTF1, YDCPG_BNDS, YDCPG_OPTS, LDLSTEP)
USE MODEL_GENERAL_CONF_MOD,ONLY:MODEL_GENERAL_CONF_TYPE
USE GEOMETRY_MOD,ONLY:GEOMETRY
USE YOMGMV,ONLY:TGMV

USE YOMHOOK,ONLY:LHOOK, DR_HOOK, JPHOOK
USE YOMDYN,ONLY:TDYN
USE YOMDYNA,ONLY:TDYNA
USE FIELD_VARIABLES_MOD,ONLY:FIELD_VARIABLES
USE CPG_OPTS_TYPE_MOD,ONLY:CPG_BNDS_TYPE, CPG_OPTS_TYPE
USE FIELD_MODULE
USE FIELD_FACTORY_MODULE
USE FIELD_ACCESS_MODULE
USE FXTRAN_ACDC_PARALLELMETHOD_MOD
USE FXTRAN_ACDC_STACK_MOD
USE PARKIND1
USE FXTRAN_ACDC_ARRAY_COPY_MOD
USE FXTRAN_ACDC_GPUMEM_MOD
#include "fxtran_acdc_stack.h"

IMPLICIT NONE


TYPE (GEOMETRY), INTENT (IN)::YDGEOMETRY
TYPE (TDYN), INTENT (IN)::YDDYN
TYPE (TDYNA), INTENT (IN)::YDDYNA
TYPE (MODEL_GENERAL_CONF_TYPE), INTENT (IN)::YDML_GCONF
TYPE (FIELD_VARIABLES), INTENT (INOUT)::YDVARS
LOGICAL, INTENT (IN)::LDTF1
TYPE (CPG_BNDS_TYPE), INTENT (IN)::YDCPG_BNDS
TYPE (CPG_OPTS_TYPE), INTENT (IN)::YDCPG_OPTS
LOGICAL, INTENT (IN)::LDLSTEP
REAL (KIND=JPRB)::ZRESTM
REAL (KIND=JPRB)::ZREST
INTEGER (KIND=JPIM)::JFLD
INTEGER (KIND=JPIM)::JLEV
INTEGER (KIND=JPIM)::JROF
INTEGER (KIND=JPIM)::JGFL
REAL (KIND=JPHOOK)::ZHOOK_HANDLE
INTEGER(KIND=JPIM) :: JBLK
TYPE(CPG_BNDS_TYPE) :: YLCPG_BNDS
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_FIELD_API
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_PARALLEL
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_COMPUTE
TYPE(FXTRAN_ACDC_STACK) :: YLSTACK
TYPE(FXTRAN_ACDC_STACK) :: YLOFFSET
REAL(KIND=JPRB), POINTER :: Z_YDVARS_SGRTL_T0(:,:,:)
REAL(KIND=JPRB), POINTER :: Z_YDVARS_SGRTL_T9(:,:,:)
REAL(KIND=JPRB), POINTER :: Z_YDVARS_SGRTM_T0(:,:,:)
REAL(KIND=JPRB), POINTER :: Z_YDVARS_SGRTM_T9(:,:,:)
REAL(KIND=JPRB), POINTER :: Z_YDVARS_U_T0(:,:,:)
REAL(KIND=JPRB), POINTER :: Z_YDVARS_U_T9(:,:,:)
REAL(KIND=JPRB), POINTER :: Z_YDVARS_V_T0(:,:,:)
REAL(KIND=JPRB), POINTER :: Z_YDVARS_V_T9(:,:,:)
#include "abor1.intfb.h"
IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL', 0, ZHOOK_HANDLE)

CALL FXTRAN_ACDC_GPUMEMSTAT (__FILE__, __LINE__, "BEGIN")


IF (LHOOK) CALL DR_HOOK ('CREATE_TEMPORARIES',0,ZHOOK_HANDLE_FIELD_API)
IF (LHOOK) CALL DR_HOOK ('CREATE_TEMPORARIES',1,ZHOOK_HANDLE_FIELD_API)





IF (.NOT.LDLSTEP) THEN
  ZREST=1.0_JPRB-(YDDYN%REPS1+YDDYN%REPS2)
  ZRESTM=1.0_JPRB-(YDDYN%REPSM1+YDDYN%REPSM2)
ENDIF


IF (LDTF1) THEN

  IF (YDDYNA%LTWOTL) THEN
    IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LTWOTL',0,ZHOOK_HANDLE_PARALLEL)

    IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','GPTF1_YDVARS_PARALLEL:LTWOTL')) THEN
      
      IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LTWOTL:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
      Z_YDVARS_U_T0 => GET_HOST_DATA_RDONLY (YDVARS%U%FT0)
      Z_YDVARS_U_T9 => GET_HOST_DATA_RDWR (YDVARS%U%FT9)
      Z_YDVARS_V_T0 => GET_HOST_DATA_RDONLY (YDVARS%V%FT0)
      Z_YDVARS_V_T9 => GET_HOST_DATA_RDWR (YDVARS%V%FT9)
      IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LTWOTL:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
      IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LTWOTL:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
      
      CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
      !$OMP PARALLEL DO PRIVATE (JBLK) FIRSTPRIVATE (YLCPG_BNDS)

      DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
        CALL YLCPG_BNDS%UPDATE (JBLK)
        
        Z_YDVARS_U_T9(:,:, JBLK)=Z_YDVARS_U_T0(:,:, JBLK)
        Z_YDVARS_V_T9(:,:, JBLK)=Z_YDVARS_V_T0(:,:, JBLK)
      ENDDO

      IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LTWOTL:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

      IF (FXTRAN_ACDC_LSYNCHOST ('GPTF1_YDVARS_PARALLEL:LTWOTL')) THEN
        IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LTWOTL:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
        Z_YDVARS_U_T0 => GET_HOST_DATA_RDWR (YDVARS%U%FT0)
        Z_YDVARS_U_T9 => GET_HOST_DATA_RDWR (YDVARS%U%FT9)
        Z_YDVARS_V_T0 => GET_HOST_DATA_RDWR (YDVARS%V%FT0)
        Z_YDVARS_V_T9 => GET_HOST_DATA_RDWR (YDVARS%V%FT9)
        IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LTWOTL:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
        
        
      ENDIF

      IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LTWOTL:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
      Z_YDVARS_U_T0 => NULL ()
      Z_YDVARS_U_T9 => NULL ()
      Z_YDVARS_V_T0 => NULL ()
      Z_YDVARS_V_T9 => NULL ()
      IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LTWOTL:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
      
      
    ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMPSINGLECOLUMN','GPTF1_YDVARS_PARALLEL:LTWOTL')) THEN
      
      IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LTWOTL:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
      Z_YDVARS_U_T0 => GET_HOST_DATA_RDONLY (YDVARS%U%FT0)
      Z_YDVARS_U_T9 => GET_HOST_DATA_RDWR (YDVARS%U%FT9)
      Z_YDVARS_V_T0 => GET_HOST_DATA_RDONLY (YDVARS%V%FT0)
      Z_YDVARS_V_T9 => GET_HOST_DATA_RDWR (YDVARS%V%FT9)
      IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LTWOTL:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
      IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LTWOTL:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
      
      !$OMP PARALLEL DO PRIVATE (JBLK, JROF, YLCPG_BNDS)

      DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX

        

        

        DO JROF = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
          YLCPG_BNDS%KIDIA = JROF
          YLCPG_BNDS%KFDIA = JROF
          
          Z_YDVARS_U_T9(JROF,:, JBLK)=Z_YDVARS_U_T0(JROF,:, JBLK)
          Z_YDVARS_V_T9(JROF,:, JBLK)=Z_YDVARS_V_T0(JROF,:, JBLK)
        ENDDO

      ENDDO

      IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LTWOTL:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

      IF (FXTRAN_ACDC_LSYNCHOST ('GPTF1_YDVARS_PARALLEL:LTWOTL')) THEN
        IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LTWOTL:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
        Z_YDVARS_U_T0 => GET_HOST_DATA_RDWR (YDVARS%U%FT0)
        Z_YDVARS_U_T9 => GET_HOST_DATA_RDWR (YDVARS%U%FT9)
        Z_YDVARS_V_T0 => GET_HOST_DATA_RDWR (YDVARS%V%FT0)
        Z_YDVARS_V_T9 => GET_HOST_DATA_RDWR (YDVARS%V%FT9)
        IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LTWOTL:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
        
        
      ENDIF

      IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LTWOTL:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
      Z_YDVARS_U_T0 => NULL ()
      Z_YDVARS_U_T9 => NULL ()
      Z_YDVARS_V_T0 => NULL ()
      Z_YDVARS_V_T9 => NULL ()
      IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LTWOTL:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
      
      
    ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN','GPTF1_YDVARS_PARALLEL:LTWOTL')) THEN
      
      IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LTWOTL:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
      Z_YDVARS_U_T0 => GET_DEVICE_DATA_RDONLY (YDVARS%U%FT0)
      Z_YDVARS_U_T9 => GET_DEVICE_DATA_RDWR (YDVARS%U%FT9)
      Z_YDVARS_V_T0 => GET_DEVICE_DATA_RDONLY (YDVARS%V%FT0)
      Z_YDVARS_V_T9 => GET_DEVICE_DATA_RDWR (YDVARS%V%FT9)
      IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LTWOTL:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
      IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LTWOTL:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
      
      
        !$ACC PARALLEL LOOP GANG &
        !$ACC&PRESENT (YDCPG_OPTS, YFXTRAN_ACDC_STACK, Z_YDVARS_U_T0, Z_YDVARS_U_T9, &
        !$ACC&         Z_YDVARS_V_T0, Z_YDVARS_V_T9) &
        !$ACC&PRIVATE (JBLK) &
        !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
        
        DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
        
        
        
        !$ACC LOOP VECTOR &
        !$ACC&PRIVATE (JROF, YLCPG_BNDS) 

        

        DO JROF = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
          YLCPG_BNDS%KIDIA = JROF
          YLCPG_BNDS%KFDIA = JROF
          
          CALL FXTRAN_ACDC_ARRAY_COPY (JROF, Z_YDVARS_U_T9(:,:, JBLK), Z_YDVARS_U_T0(:,:, JBLK))
          CALL FXTRAN_ACDC_ARRAY_COPY (JROF, Z_YDVARS_V_T9(:,:, JBLK), Z_YDVARS_V_T0(:,:, JBLK))
        ENDDO

      ENDDO

      IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LTWOTL:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

      IF (FXTRAN_ACDC_LSYNCHOST ('GPTF1_YDVARS_PARALLEL:LTWOTL')) THEN
        IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LTWOTL:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
        Z_YDVARS_U_T0 => GET_HOST_DATA_RDWR (YDVARS%U%FT0)
        Z_YDVARS_U_T9 => GET_HOST_DATA_RDWR (YDVARS%U%FT9)
        Z_YDVARS_V_T0 => GET_HOST_DATA_RDWR (YDVARS%V%FT0)
        Z_YDVARS_V_T9 => GET_HOST_DATA_RDWR (YDVARS%V%FT9)
        IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LTWOTL:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
        
        
      ENDIF

      IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LTWOTL:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
      Z_YDVARS_U_T0 => NULL ()
      Z_YDVARS_U_T9 => NULL ()
      Z_YDVARS_V_T0 => NULL ()
      Z_YDVARS_V_T9 => NULL ()
      IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LTWOTL:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
      
      
    ELSE
        CALL ABOR1 ('GPTF1_YDVARS_PARALLEL: NOT METHOD WAS FOUND')
    ENDIF

    IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LTWOTL',1,ZHOOK_HANDLE_PARALLEL)

    IF (YDDYNA%LGRADSP) THEN
      IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LGRADSP',0,ZHOOK_HANDLE_PARALLEL)

      IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','GPTF1_YDVARS_PARALLEL:LGRADSP')) THEN
        
        IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LGRADSP:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
        Z_YDVARS_SGRTL_T0 => GET_HOST_DATA_RDONLY (YDVARS%SGRTL%FT0)
        Z_YDVARS_SGRTL_T9 => GET_HOST_DATA_RDWR (YDVARS%SGRTL%FT9)
        Z_YDVARS_SGRTM_T0 => GET_HOST_DATA_RDONLY (YDVARS%SGRTM%FT0)
        Z_YDVARS_SGRTM_T9 => GET_HOST_DATA_RDWR (YDVARS%SGRTM%FT9)
        IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LGRADSP:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
        IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LGRADSP:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
        
        CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
        !$OMP PARALLEL DO PRIVATE (JBLK) FIRSTPRIVATE (YLCPG_BNDS)

        DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
          CALL YLCPG_BNDS%UPDATE (JBLK)
          
          Z_YDVARS_SGRTL_T9(:,:, JBLK)=Z_YDVARS_SGRTL_T0(:,:, JBLK)
          Z_YDVARS_SGRTM_T9(:,:, JBLK)=Z_YDVARS_SGRTM_T0(:,:, JBLK)
        ENDDO

        IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LGRADSP:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

        IF (FXTRAN_ACDC_LSYNCHOST ('GPTF1_YDVARS_PARALLEL:LGRADSP')) THEN
          IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LGRADSP:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
          Z_YDVARS_SGRTL_T0 => GET_HOST_DATA_RDWR (YDVARS%SGRTL%FT0)
          Z_YDVARS_SGRTL_T9 => GET_HOST_DATA_RDWR (YDVARS%SGRTL%FT9)
          Z_YDVARS_SGRTM_T0 => GET_HOST_DATA_RDWR (YDVARS%SGRTM%FT0)
          Z_YDVARS_SGRTM_T9 => GET_HOST_DATA_RDWR (YDVARS%SGRTM%FT9)
          IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LGRADSP:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
          
          
        ENDIF

        IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LGRADSP:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
        Z_YDVARS_SGRTL_T0 => NULL ()
        Z_YDVARS_SGRTL_T9 => NULL ()
        Z_YDVARS_SGRTM_T0 => NULL ()
        Z_YDVARS_SGRTM_T9 => NULL ()
        IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LGRADSP:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
        
        
      ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMPSINGLECOLUMN','GPTF1_YDVARS_PARALLEL:LGRADSP')) THEN
        
        IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LGRADSP:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
        Z_YDVARS_SGRTL_T0 => GET_HOST_DATA_RDONLY (YDVARS%SGRTL%FT0)
        Z_YDVARS_SGRTL_T9 => GET_HOST_DATA_RDWR (YDVARS%SGRTL%FT9)
        Z_YDVARS_SGRTM_T0 => GET_HOST_DATA_RDONLY (YDVARS%SGRTM%FT0)
        Z_YDVARS_SGRTM_T9 => GET_HOST_DATA_RDWR (YDVARS%SGRTM%FT9)
        IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LGRADSP:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
        IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LGRADSP:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
        
        !$OMP PARALLEL DO PRIVATE (JBLK, JROF, YLCPG_BNDS)

        DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX

          

          

          DO JROF = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
            YLCPG_BNDS%KIDIA = JROF
            YLCPG_BNDS%KFDIA = JROF
            
            Z_YDVARS_SGRTL_T9(JROF,:, JBLK)=Z_YDVARS_SGRTL_T0(JROF,:, JBLK)
            Z_YDVARS_SGRTM_T9(JROF,:, JBLK)=Z_YDVARS_SGRTM_T0(JROF,:, JBLK)
          ENDDO

        ENDDO

        IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LGRADSP:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

        IF (FXTRAN_ACDC_LSYNCHOST ('GPTF1_YDVARS_PARALLEL:LGRADSP')) THEN
          IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LGRADSP:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
          Z_YDVARS_SGRTL_T0 => GET_HOST_DATA_RDWR (YDVARS%SGRTL%FT0)
          Z_YDVARS_SGRTL_T9 => GET_HOST_DATA_RDWR (YDVARS%SGRTL%FT9)
          Z_YDVARS_SGRTM_T0 => GET_HOST_DATA_RDWR (YDVARS%SGRTM%FT0)
          Z_YDVARS_SGRTM_T9 => GET_HOST_DATA_RDWR (YDVARS%SGRTM%FT9)
          IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LGRADSP:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
          
          
        ENDIF

        IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LGRADSP:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
        Z_YDVARS_SGRTL_T0 => NULL ()
        Z_YDVARS_SGRTL_T9 => NULL ()
        Z_YDVARS_SGRTM_T0 => NULL ()
        Z_YDVARS_SGRTM_T9 => NULL ()
        IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LGRADSP:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
        
        
      ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN','GPTF1_YDVARS_PARALLEL:LGRADSP')) THEN
        
        IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LGRADSP:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
        Z_YDVARS_SGRTL_T0 => GET_DEVICE_DATA_RDONLY (YDVARS%SGRTL%FT0)
        Z_YDVARS_SGRTL_T9 => GET_DEVICE_DATA_RDWR (YDVARS%SGRTL%FT9)
        Z_YDVARS_SGRTM_T0 => GET_DEVICE_DATA_RDONLY (YDVARS%SGRTM%FT0)
        Z_YDVARS_SGRTM_T9 => GET_DEVICE_DATA_RDWR (YDVARS%SGRTM%FT9)
        IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LGRADSP:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
        IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LGRADSP:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
        
        
          !$ACC PARALLEL LOOP GANG &
          !$ACC&PRESENT (YDCPG_OPTS, YFXTRAN_ACDC_STACK, Z_YDVARS_SGRTL_T0, Z_YDVARS_SGRTL_T9, &
          !$ACC&         Z_YDVARS_SGRTM_T0, Z_YDVARS_SGRTM_T9) &
          !$ACC&PRIVATE (JBLK) &
          !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
          
          DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
          
          
          
          !$ACC LOOP VECTOR &
          !$ACC&PRIVATE (JROF, YLCPG_BNDS) 

          

          DO JROF = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
            YLCPG_BNDS%KIDIA = JROF
            YLCPG_BNDS%KFDIA = JROF
            
            CALL FXTRAN_ACDC_ARRAY_COPY (JROF, Z_YDVARS_SGRTL_T9(:,:, JBLK), Z_YDVARS_SGRTL_T0(:,:, JBLK))
            CALL FXTRAN_ACDC_ARRAY_COPY (JROF, Z_YDVARS_SGRTM_T9(:,:, JBLK), Z_YDVARS_SGRTM_T0(:,:, JBLK))
          ENDDO

        ENDDO

        IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LGRADSP:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

        IF (FXTRAN_ACDC_LSYNCHOST ('GPTF1_YDVARS_PARALLEL:LGRADSP')) THEN
          IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LGRADSP:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
          Z_YDVARS_SGRTL_T0 => GET_HOST_DATA_RDWR (YDVARS%SGRTL%FT0)
          Z_YDVARS_SGRTL_T9 => GET_HOST_DATA_RDWR (YDVARS%SGRTL%FT9)
          Z_YDVARS_SGRTM_T0 => GET_HOST_DATA_RDWR (YDVARS%SGRTM%FT0)
          Z_YDVARS_SGRTM_T9 => GET_HOST_DATA_RDWR (YDVARS%SGRTM%FT9)
          IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LGRADSP:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
          
          
        ENDIF

        IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LGRADSP:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
        Z_YDVARS_SGRTL_T0 => NULL ()
        Z_YDVARS_SGRTL_T9 => NULL ()
        Z_YDVARS_SGRTM_T0 => NULL ()
        Z_YDVARS_SGRTM_T9 => NULL ()
        IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LGRADSP:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
        
        
      ELSE
          CALL ABOR1 ('GPTF1_YDVARS_PARALLEL: NOT METHOD WAS FOUND')
      ENDIF

      IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:LGRADSP',1,ZHOOK_HANDLE_PARALLEL)
    ENDIF


    IF (YDDYNA%LPC_FULL) THEN
      
      
      
      
      
      
      
      
      
      CALL ABOR1 ("ERROR: WRONG SETTINGS")
      
    ENDIF

  ELSE
    
    
    CALL ABOR1 ("ERROR: WRONG SETTINGS")
    
  ENDIF

ELSE

  IF (YDDYNA%LGRADSP) THEN
    IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:NOTLDTF1',0,ZHOOK_HANDLE_PARALLEL)

    IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','GPTF1_YDVARS_PARALLEL:NOTLDTF1')) THEN
      
      IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:NOTLDTF1:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
      Z_YDVARS_SGRTL_T0 => GET_HOST_DATA_RDONLY (YDVARS%SGRTL%FT0)
      Z_YDVARS_SGRTL_T9 => GET_HOST_DATA_RDWR (YDVARS%SGRTL%FT9)
      Z_YDVARS_SGRTM_T0 => GET_HOST_DATA_RDONLY (YDVARS%SGRTM%FT0)
      Z_YDVARS_SGRTM_T9 => GET_HOST_DATA_RDWR (YDVARS%SGRTM%FT9)
      IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:NOTLDTF1:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
      IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:NOTLDTF1:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
      
      CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
      !$OMP PARALLEL DO PRIVATE (JBLK) FIRSTPRIVATE (YLCPG_BNDS)

      DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
        CALL YLCPG_BNDS%UPDATE (JBLK)
        
        Z_YDVARS_SGRTL_T9(:,:, JBLK)=Z_YDVARS_SGRTL_T0(:,:, JBLK)
        Z_YDVARS_SGRTM_T9(:,:, JBLK)=Z_YDVARS_SGRTM_T0(:,:, JBLK)
      ENDDO

      IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:NOTLDTF1:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

      IF (FXTRAN_ACDC_LSYNCHOST ('GPTF1_YDVARS_PARALLEL:NOTLDTF1')) THEN
        IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:NOTLDTF1:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
        Z_YDVARS_SGRTL_T0 => GET_HOST_DATA_RDWR (YDVARS%SGRTL%FT0)
        Z_YDVARS_SGRTL_T9 => GET_HOST_DATA_RDWR (YDVARS%SGRTL%FT9)
        Z_YDVARS_SGRTM_T0 => GET_HOST_DATA_RDWR (YDVARS%SGRTM%FT0)
        Z_YDVARS_SGRTM_T9 => GET_HOST_DATA_RDWR (YDVARS%SGRTM%FT9)
        IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:NOTLDTF1:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
        
        
      ENDIF

      IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:NOTLDTF1:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
      Z_YDVARS_SGRTL_T0 => NULL ()
      Z_YDVARS_SGRTL_T9 => NULL ()
      Z_YDVARS_SGRTM_T0 => NULL ()
      Z_YDVARS_SGRTM_T9 => NULL ()
      IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:NOTLDTF1:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
      
      
    ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMPSINGLECOLUMN','GPTF1_YDVARS_PARALLEL:NOTLDTF1')) THEN
      
      IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:NOTLDTF1:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
      Z_YDVARS_SGRTL_T0 => GET_HOST_DATA_RDONLY (YDVARS%SGRTL%FT0)
      Z_YDVARS_SGRTL_T9 => GET_HOST_DATA_RDWR (YDVARS%SGRTL%FT9)
      Z_YDVARS_SGRTM_T0 => GET_HOST_DATA_RDONLY (YDVARS%SGRTM%FT0)
      Z_YDVARS_SGRTM_T9 => GET_HOST_DATA_RDWR (YDVARS%SGRTM%FT9)
      IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:NOTLDTF1:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
      IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:NOTLDTF1:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
      
      !$OMP PARALLEL DO PRIVATE (JBLK, JROF, YLCPG_BNDS)

      DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX

        

        

        DO JROF = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
          YLCPG_BNDS%KIDIA = JROF
          YLCPG_BNDS%KFDIA = JROF
          
          Z_YDVARS_SGRTL_T9(JROF,:, JBLK)=Z_YDVARS_SGRTL_T0(JROF,:, JBLK)
          Z_YDVARS_SGRTM_T9(JROF,:, JBLK)=Z_YDVARS_SGRTM_T0(JROF,:, JBLK)
        ENDDO

      ENDDO

      IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:NOTLDTF1:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

      IF (FXTRAN_ACDC_LSYNCHOST ('GPTF1_YDVARS_PARALLEL:NOTLDTF1')) THEN
        IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:NOTLDTF1:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
        Z_YDVARS_SGRTL_T0 => GET_HOST_DATA_RDWR (YDVARS%SGRTL%FT0)
        Z_YDVARS_SGRTL_T9 => GET_HOST_DATA_RDWR (YDVARS%SGRTL%FT9)
        Z_YDVARS_SGRTM_T0 => GET_HOST_DATA_RDWR (YDVARS%SGRTM%FT0)
        Z_YDVARS_SGRTM_T9 => GET_HOST_DATA_RDWR (YDVARS%SGRTM%FT9)
        IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:NOTLDTF1:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
        
        
      ENDIF

      IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:NOTLDTF1:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
      Z_YDVARS_SGRTL_T0 => NULL ()
      Z_YDVARS_SGRTL_T9 => NULL ()
      Z_YDVARS_SGRTM_T0 => NULL ()
      Z_YDVARS_SGRTM_T9 => NULL ()
      IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:NOTLDTF1:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
      
      
    ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN','GPTF1_YDVARS_PARALLEL:NOTLDTF1')) THEN
      
      IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:NOTLDTF1:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
      Z_YDVARS_SGRTL_T0 => GET_DEVICE_DATA_RDONLY (YDVARS%SGRTL%FT0)
      Z_YDVARS_SGRTL_T9 => GET_DEVICE_DATA_RDWR (YDVARS%SGRTL%FT9)
      Z_YDVARS_SGRTM_T0 => GET_DEVICE_DATA_RDONLY (YDVARS%SGRTM%FT0)
      Z_YDVARS_SGRTM_T9 => GET_DEVICE_DATA_RDWR (YDVARS%SGRTM%FT9)
      IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:NOTLDTF1:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
      IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:NOTLDTF1:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
      
      
        !$ACC PARALLEL LOOP GANG &
        !$ACC&PRESENT (YDCPG_OPTS, YFXTRAN_ACDC_STACK, Z_YDVARS_SGRTL_T0, Z_YDVARS_SGRTL_T9, &
        !$ACC&         Z_YDVARS_SGRTM_T0, Z_YDVARS_SGRTM_T9) &
        !$ACC&PRIVATE (JBLK) &
        !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
        
        DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
        
        
        
        !$ACC LOOP VECTOR &
        !$ACC&PRIVATE (JROF, YLCPG_BNDS) 

        

        DO JROF = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
          YLCPG_BNDS%KIDIA = JROF
          YLCPG_BNDS%KFDIA = JROF
          
          CALL FXTRAN_ACDC_ARRAY_COPY (JROF, Z_YDVARS_SGRTL_T9(:,:, JBLK), Z_YDVARS_SGRTL_T0(:,:, JBLK))
          CALL FXTRAN_ACDC_ARRAY_COPY (JROF, Z_YDVARS_SGRTM_T9(:,:, JBLK), Z_YDVARS_SGRTM_T0(:,:, JBLK))
        ENDDO

      ENDDO

      IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:NOTLDTF1:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

      IF (FXTRAN_ACDC_LSYNCHOST ('GPTF1_YDVARS_PARALLEL:NOTLDTF1')) THEN
        IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:NOTLDTF1:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
        Z_YDVARS_SGRTL_T0 => GET_HOST_DATA_RDWR (YDVARS%SGRTL%FT0)
        Z_YDVARS_SGRTL_T9 => GET_HOST_DATA_RDWR (YDVARS%SGRTL%FT9)
        Z_YDVARS_SGRTM_T0 => GET_HOST_DATA_RDWR (YDVARS%SGRTM%FT0)
        Z_YDVARS_SGRTM_T9 => GET_HOST_DATA_RDWR (YDVARS%SGRTM%FT9)
        IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:NOTLDTF1:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
        
        
      ENDIF

      IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:NOTLDTF1:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
      Z_YDVARS_SGRTL_T0 => NULL ()
      Z_YDVARS_SGRTL_T9 => NULL ()
      Z_YDVARS_SGRTM_T0 => NULL ()
      Z_YDVARS_SGRTM_T9 => NULL ()
      IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:NOTLDTF1:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
      
      
    ELSE
        CALL ABOR1 ('GPTF1_YDVARS_PARALLEL: NOT METHOD WAS FOUND')
    ENDIF

    IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL:NOTLDTF1',1,ZHOOK_HANDLE_PARALLEL)
  ENDIF

ENDIF




CALL FXTRAN_ACDC_GPUMEMSTAT (__FILE__, __LINE__, "END")

IF (LHOOK) CALL DR_HOOK ('DELETE_TEMPORARIES',0,ZHOOK_HANDLE_FIELD_API)
IF (LHOOK) CALL DR_HOOK ('DELETE_TEMPORARIES',1,ZHOOK_HANDLE_FIELD_API)
IF (LHOOK) CALL DR_HOOK ('GPTF1_YDVARS_PARALLEL', 1, ZHOOK_HANDLE)
END SUBROUTINE GPTF1_YDVARS_PARALLEL
