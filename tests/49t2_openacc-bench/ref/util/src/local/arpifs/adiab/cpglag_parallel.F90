SUBROUTINE CPGLAG_PARALLEL (YDGEOMETRY, YDCPG_BNDS, YDCPG_OPTS, YDCPG_SL2, YDCPG_DDH_TNDHD&
&, YDMODEL, YDVARS, LDCONFX, YDDDH, YDA_PGPSTRESS, YDTDDH, PTRAJEC, PTRAJEC_OOPS)
USE MODEL_DIAGNOSTICS_MOD,ONLY:MODEL_DIAGNOSTICS_TYPE
USE MODEL_GENERAL_CONF_MOD,ONLY:MODEL_GENERAL_CONF_TYPE
USE MODEL_DYNAMICS_MOD,ONLY:MODEL_DYNAMICS_TYPE
USE GEOMETRY_MOD,ONLY:GEOMETRY
USE YOMGMV,ONLY:TGMV

USE YOMHOOK,ONLY:LHOOK, DR_HOOK, JPHOOK
USE YOMTRAJ,ONLY:TRAJ_TYPE, LPRTTRAJ, LTRAJSAVE, LTRAJSLAG
USE YOMTRAJ_OOPS,ONLY:TRAJ_TYPE_OOPS, LTRAJSAVE_OOPS, LTRAJSLAG_OOPS
USE YOMLUN,ONLY:NULOUT
USE DDH_MIX,ONLY:TYP_DDH
USE FIELD_VARIABLES_MOD,ONLY:FIELD_VARIABLES
USE TYPE_MODEL,ONLY:MODEL
USE CPG_OPTS_TYPE_MOD,ONLY:CPG_BNDS_TYPE, CPG_OPTS_TYPE
USE CPG_SL2_TYPE_MOD,ONLY:CPG_SL2_TYPE
USE CPG_DDH_TND_TYPE_MOD,ONLY:CPG_TNDHD_DDH_TYPE
USE FIELD_ARRAY_MODULE
USE YOMTDDH,ONLY:TTDDH
USE FIELD_MODULE
USE FIELD_FACTORY_MODULE
USE FIELD_ACCESS_MODULE
USE FXTRAN_ACDC_PARALLELMETHOD_MOD
USE FXTRAN_ACDC_STACK_MOD
USE PARKIND1
USE FXTRAN_ACDC_ARRAY_COPY_MOD
USE FXTRAN_ACDC_GPUMEM_MOD
#include "fxtran_acdc_stack.h"

IMPLICIT NONE


TYPE (GEOMETRY), INTENT (IN)::YDGEOMETRY
TYPE (MODEL), INTENT (IN)::YDMODEL
TYPE (FIELD_VARIABLES), INTENT (INOUT)::YDVARS
TYPE (CPG_BNDS_TYPE), INTENT (IN)::YDCPG_BNDS
TYPE (CPG_OPTS_TYPE), INTENT (IN)::YDCPG_OPTS
TYPE (CPG_SL2_TYPE), INTENT (IN)::YDCPG_SL2
TYPE (CPG_TNDHD_DDH_TYPE), INTENT (INOUT)::YDCPG_DDH_TNDHD
LOGICAL, INTENT (IN)::LDCONFX
TYPE (TYP_DDH), INTENT (INOUT)::YDDDH
TYPE (FIELD_4RB_ARRAY), INTENT (IN)::YDA_PGPSTRESS
TYPE (TTDDH), INTENT (INOUT)::YDTDDH
TYPE (TRAJ_TYPE), INTENT (INOUT), OPTIONAL::PTRAJEC
TYPE (TRAJ_TYPE_OOPS), INTENT (INOUT), OPTIONAL::PTRAJEC_OOPS
INTEGER (KIND=JPIM)::JROF
INTEGER (KIND=JPIM)::JLEV
LOGICAL::LL_DIAG_NHX
LOGICAL::LLTF1
LOGICAL::LLSTR
LOGICAL::LLLSTEP
REAL (KIND=JPRB)::ZEPS
CLASS (FIELD_2RB), POINTER :: YL_ZOROGL_SR
REAL (KIND=JPRB), POINTER::ZOROGL_SR (:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZOROGM_SR
REAL (KIND=JPRB), POINTER::ZOROGM_SR (:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZGMVNHXT1B
REAL (KIND=JPRB), POINTER::ZGMVNHXT1B (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZR1
REAL (KIND=JPRB), POINTER::ZR1 (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZGMVSVDT1A
REAL (KIND=JPRB), POINTER::ZGMVSVDT1A (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZGMVSVDT1B
REAL (KIND=JPRB), POINTER::ZGMVSVDT1B (:,:,:)
REAL (KIND=JPRB)::ZRD_R
#include "gprcp_expl_parallel.intfb.h"
#include "abor1.intfb.h"
#include "gptf1_ydvars_parallel.intfb.h"
REAL (KIND=JPHOOK)::ZHOOK_HANDLE
INTEGER(KIND=JPIM) :: JBLK
TYPE(CPG_BNDS_TYPE) :: YLCPG_BNDS
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_FIELD_API
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_PARALLEL
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_COMPUTE
TYPE(FXTRAN_ACDC_STACK) :: YLSTACK
TYPE(FXTRAN_ACDC_STACK) :: YLOFFSET
REAL (KIND=JPRB), POINTER :: Z_YDCPG_SL2_PDSI(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDCPG_SL2_SPSI(:,:)
REAL (KIND=JPRB), POINTER :: Z_YDCPG_SL2_TSI(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDCPG_SL2_USI(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDCPG_SL2_VDSI(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDCPG_SL2_VSI(:,:,:)
REAL(KIND=JPRB), POINTER :: Z_YDVARS_GEOMETRY_GM_P(:,:)
REAL(KIND=JPRB), POINTER :: Z_YDVARS_SPD_T1(:,:,:)
REAL(KIND=JPRB), POINTER :: Z_YDVARS_SP_T1(:,:)
REAL(KIND=JPRB), POINTER :: Z_YDVARS_SVD_T1(:,:,:)
REAL(KIND=JPRB), POINTER :: Z_YDVARS_T_T1(:,:,:)
REAL(KIND=JPRB), POINTER :: Z_YDVARS_U_T1(:,:,:)
REAL(KIND=JPRB), POINTER :: Z_YDVARS_V_T1(:,:,:)
IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL', 0, ZHOOK_HANDLE)

CALL FXTRAN_ACDC_GPUMEMSTAT (__FILE__, __LINE__, "BEGIN")


IF (LHOOK) CALL DR_HOOK ('CREATE_TEMPORARIES',0,ZHOOK_HANDLE_FIELD_API)
CALL FIELD_NEW (YL_ZR1, UBOUNDS=[YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG&
&, YDCPG_OPTS%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZOROGM_SR, UBOUNDS=[YDGEOMETRY%YRDIM%NPROMA, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZOROGL_SR, UBOUNDS=[YDGEOMETRY%YRDIM%NPROMA, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZGMVSVDT1B, UBOUNDS=[YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG&
&, YDCPG_OPTS%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZGMVSVDT1A, UBOUNDS=[YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG&
&, YDCPG_OPTS%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZGMVNHXT1B, UBOUNDS=[YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG&
&, YDCPG_OPTS%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
IF (LHOOK) CALL DR_HOOK ('CREATE_TEMPORARIES',1,ZHOOK_HANDLE_FIELD_API)


LL_DIAG_NHX=(YDMODEL%YRML_DYN%YRDYNA%ND4SYS==0.OR.YDMODEL%YRML_DYN%YRDYNA%ND4SYS==3)

IF (YDMODEL%YRML_DYN%YRDYNA%LNHDYN.AND.YDMODEL%YRML_DYN%YRDYNA%LSLAG.AND.(YDMODEL%YRML_DYN%YRDYNA%NVDVAR&
  &==4.OR.YDMODEL%YRML_DYN%YRDYNA%NVDVAR==5).AND.(YDMODEL%YRML_DYN%YRDYNA%ND4SYS==2.OR.LL_DIAG_NHX).AND&
  &.(YDMODEL%YRML_DYN%YRDYN%NCURRENT_ITER==YDMODEL%YRML_DYN%YRDYN%NSITER.OR.LL_DIAG_NHX)) THEN
  
  
  
  
  
  CALL ABOR1 ("ERROR: WRONG SETTINGS")
  
ENDIF


IF ((YDMODEL%YRML_DYN%YRDYNA%LPC_FULL.AND.YDMODEL%YRML_DYN%YRDYN%NCURRENT_ITER==YDMODEL&
  &%YRML_DYN%YRDYN%NSITER).OR..NOT.YDMODEL%YRML_DYN%YRDYNA%LPC_FULL) THEN

  IF (YDMODEL%YRML_DYN%YRDYN%LGPSTRESS) THEN
    
    
    
    CALL ABOR1 ("ERROR: WRONG SETTINGS")
    
  ENDIF

ENDIF


IF (YDCPG_OPTS%NSTEP<YDMODEL%YRML_GCONF%YRRIP%NSTOP) THEN
  LLLSTEP=.FALSE.
ELSE
  LLLSTEP=.TRUE.
ENDIF

LLTF1=.FALSE.

IF (YDMODEL%YRML_DYN%YRDYN%NCURRENT_ITER==0) THEN
  LLTF1=.TRUE.
ENDIF

CALL GPTF1_YDVARS_PARALLEL (YDGEOMETRY, YDMODEL%YRML_GCONF, YDMODEL%YRML_DYN%YRDYN&
&, YDMODEL%YRML_DYN%YRDYNA, YDVARS, LLTF1, YDCPG_BNDS, YDCPG_OPTS, LLLSTEP)

IF (PRESENT (PTRAJEC)) THEN

  IF (YDMODEL%YRML_DYN%YRDYNA%LSPRT.AND.LTRAJSAVE.AND.LTRAJSLAG) THEN
    
    
    
    
    CALL ABOR1 ("ERROR: WRONG SETTINGS")
    
  ENDIF

ELSE

  IF (YDMODEL%YRML_DYN%YRDYNA%LSPRT.AND.LTRAJSAVE_OOPS.AND.LTRAJSLAG_OOPS) THEN
    
    
    
    
    CALL ABOR1 ("ERROR: WRONG SETTINGS")
    
  ENDIF

ENDIF

IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:0',0,ZHOOK_HANDLE_PARALLEL)

IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','CPGLAG_PARALLEL:0')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:0:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  Z_YDCPG_SL2_PDSI => GET_HOST_DATA_RDONLY (YDCPG_SL2%F_PDSI)
  Z_YDCPG_SL2_SPSI => GET_HOST_DATA_RDONLY (YDCPG_SL2%F_SPSI)
  Z_YDCPG_SL2_TSI => GET_HOST_DATA_RDONLY (YDCPG_SL2%F_TSI)
  Z_YDCPG_SL2_USI => GET_HOST_DATA_RDONLY (YDCPG_SL2%F_USI)
  Z_YDCPG_SL2_VDSI => GET_HOST_DATA_RDONLY (YDCPG_SL2%F_VDSI)
  Z_YDCPG_SL2_VSI => GET_HOST_DATA_RDONLY (YDCPG_SL2%F_VSI)
  Z_YDVARS_SPD_T1 => GET_HOST_DATA_RDWR (YDVARS%SPD%FT1)
  Z_YDVARS_SP_T1 => GET_HOST_DATA_RDWR (YDVARS%SP%FT1)
  Z_YDVARS_SVD_T1 => GET_HOST_DATA_RDWR (YDVARS%SVD%FT1)
  Z_YDVARS_T_T1 => GET_HOST_DATA_RDWR (YDVARS%T%FT1)
  Z_YDVARS_U_T1 => GET_HOST_DATA_RDWR (YDVARS%U%FT1)
  Z_YDVARS_V_T1 => GET_HOST_DATA_RDWR (YDVARS%V%FT1)
  IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:0:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:0:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
  !$OMP PARALLEL DO PRIVATE (JBLK, JLEV, JROF) FIRSTPRIVATE (YLCPG_BNDS)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    CALL YLCPG_BNDS%UPDATE (JBLK)

    

    DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG

      DO JROF=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
        Z_YDVARS_U_T1 (JROF, JLEV, JBLK)=Z_YDVARS_U_T1 (JROF, JLEV, JBLK)+Z_YDCPG_SL2_USI (JROF, JLEV, JBLK)
        Z_YDVARS_V_T1 (JROF, JLEV, JBLK)=Z_YDVARS_V_T1 (JROF, JLEV, JBLK)+Z_YDCPG_SL2_VSI (JROF, JLEV, JBLK)
        Z_YDVARS_T_T1 (JROF, JLEV, JBLK)=Z_YDVARS_T_T1 (JROF, JLEV, JBLK)+Z_YDCPG_SL2_TSI (JROF, JLEV, JBLK)
      ENDDO

    ENDDO


    IF (YDMODEL%YRML_DYN%YRDYNA%LNHDYN) THEN

      DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG

        DO JROF=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
          Z_YDVARS_SVD_T1 (JROF, JLEV, JBLK)=Z_YDVARS_SVD_T1 (JROF&
          &, JLEV, JBLK)+Z_YDCPG_SL2_VDSI (JROF, JLEV, JBLK)
          Z_YDVARS_SPD_T1 (JROF, JLEV, JBLK)=Z_YDVARS_SPD_T1 (JROF&
          &, JLEV, JBLK)+Z_YDCPG_SL2_PDSI (JROF, JLEV, JBLK)
        ENDDO

      ENDDO

    ENDIF


    IF (YDMODEL%YRML_DYN%YRDYNA%LNHQE_SOLVER_QE) THEN
      Z_YDVARS_SPD_T1 (:, 1:YDGEOMETRY%YRDIMV%NFLEVG, JBLK)=0.0_JPRB
    ENDIF


    DO JROF=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
      Z_YDVARS_SP_T1 (JROF, JBLK)=Z_YDVARS_SP_T1 (JROF, JBLK)+Z_YDCPG_SL2_SPSI (JROF, JBLK)
    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:0:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

  IF (FXTRAN_ACDC_LSYNCHOST ('CPGLAG_PARALLEL:0')) THEN
    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:0:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
    Z_YDCPG_SL2_PDSI => GET_HOST_DATA_RDWR (YDCPG_SL2%F_PDSI)
    Z_YDCPG_SL2_SPSI => GET_HOST_DATA_RDWR (YDCPG_SL2%F_SPSI)
    Z_YDCPG_SL2_TSI => GET_HOST_DATA_RDWR (YDCPG_SL2%F_TSI)
    Z_YDCPG_SL2_USI => GET_HOST_DATA_RDWR (YDCPG_SL2%F_USI)
    Z_YDCPG_SL2_VDSI => GET_HOST_DATA_RDWR (YDCPG_SL2%F_VDSI)
    Z_YDCPG_SL2_VSI => GET_HOST_DATA_RDWR (YDCPG_SL2%F_VSI)
    Z_YDVARS_SPD_T1 => GET_HOST_DATA_RDWR (YDVARS%SPD%FT1)
    Z_YDVARS_SP_T1 => GET_HOST_DATA_RDWR (YDVARS%SP%FT1)
    Z_YDVARS_SVD_T1 => GET_HOST_DATA_RDWR (YDVARS%SVD%FT1)
    Z_YDVARS_T_T1 => GET_HOST_DATA_RDWR (YDVARS%T%FT1)
    Z_YDVARS_U_T1 => GET_HOST_DATA_RDWR (YDVARS%U%FT1)
    Z_YDVARS_V_T1 => GET_HOST_DATA_RDWR (YDVARS%V%FT1)
    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:0:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:0:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  Z_YDCPG_SL2_PDSI => NULL ()
  Z_YDCPG_SL2_SPSI => NULL ()
  Z_YDCPG_SL2_TSI => NULL ()
  Z_YDCPG_SL2_USI => NULL ()
  Z_YDCPG_SL2_VDSI => NULL ()
  Z_YDCPG_SL2_VSI => NULL ()
  Z_YDVARS_SPD_T1 => NULL ()
  Z_YDVARS_SP_T1 => NULL ()
  Z_YDVARS_SVD_T1 => NULL ()
  Z_YDVARS_T_T1 => NULL ()
  Z_YDVARS_U_T1 => NULL ()
  Z_YDVARS_V_T1 => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:0:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMPSINGLECOLUMN','CPGLAG_PARALLEL:0')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:0:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  Z_YDCPG_SL2_PDSI => GET_HOST_DATA_RDONLY (YDCPG_SL2%F_PDSI)
  Z_YDCPG_SL2_SPSI => GET_HOST_DATA_RDONLY (YDCPG_SL2%F_SPSI)
  Z_YDCPG_SL2_TSI => GET_HOST_DATA_RDONLY (YDCPG_SL2%F_TSI)
  Z_YDCPG_SL2_USI => GET_HOST_DATA_RDONLY (YDCPG_SL2%F_USI)
  Z_YDCPG_SL2_VDSI => GET_HOST_DATA_RDONLY (YDCPG_SL2%F_VDSI)
  Z_YDCPG_SL2_VSI => GET_HOST_DATA_RDONLY (YDCPG_SL2%F_VSI)
  Z_YDVARS_SPD_T1 => GET_HOST_DATA_RDWR (YDVARS%SPD%FT1)
  Z_YDVARS_SP_T1 => GET_HOST_DATA_RDWR (YDVARS%SP%FT1)
  Z_YDVARS_SVD_T1 => GET_HOST_DATA_RDWR (YDVARS%SVD%FT1)
  Z_YDVARS_T_T1 => GET_HOST_DATA_RDWR (YDVARS%T%FT1)
  Z_YDVARS_U_T1 => GET_HOST_DATA_RDWR (YDVARS%U%FT1)
  Z_YDVARS_V_T1 => GET_HOST_DATA_RDWR (YDVARS%V%FT1)
  IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:0:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:0:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  !$OMP PARALLEL DO PRIVATE (JBLK, JLEV, JROF, YLCPG_BNDS)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX

    

    

    DO JROF = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JROF
      YLCPG_BNDS%KFDIA = JROF

      

      DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
        
        Z_YDVARS_U_T1 (JROF, JLEV, JBLK)=Z_YDVARS_U_T1 (JROF, JLEV, JBLK)+Z_YDCPG_SL2_USI (JROF, JLEV, JBLK)
        Z_YDVARS_V_T1 (JROF, JLEV, JBLK)=Z_YDVARS_V_T1 (JROF, JLEV, JBLK)+Z_YDCPG_SL2_VSI (JROF, JLEV, JBLK)
        Z_YDVARS_T_T1 (JROF, JLEV, JBLK)=Z_YDVARS_T_T1 (JROF, JLEV, JBLK)+Z_YDCPG_SL2_TSI (JROF, JLEV, JBLK)
      
      ENDDO


      IF (YDMODEL%YRML_DYN%YRDYNA%LNHDYN) THEN

        DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
          
          Z_YDVARS_SVD_T1 (JROF, JLEV, JBLK)=Z_YDVARS_SVD_T1 (JROF&
          &, JLEV, JBLK)+Z_YDCPG_SL2_VDSI (JROF, JLEV, JBLK)
          Z_YDVARS_SPD_T1 (JROF, JLEV, JBLK)=Z_YDVARS_SPD_T1 (JROF&
          &, JLEV, JBLK)+Z_YDCPG_SL2_PDSI (JROF, JLEV, JBLK)
        
        ENDDO

      ENDIF


      IF (YDMODEL%YRML_DYN%YRDYNA%LNHQE_SOLVER_QE) THEN
        Z_YDVARS_SPD_T1 (JROF, 1:YDGEOMETRY%YRDIMV%NFLEVG, JBLK)=0.0_JPRB
      ENDIF

      
      Z_YDVARS_SP_T1 (JROF, JBLK)=Z_YDVARS_SP_T1 (JROF, JBLK)+Z_YDCPG_SL2_SPSI (JROF, JBLK)
    
    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:0:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

  IF (FXTRAN_ACDC_LSYNCHOST ('CPGLAG_PARALLEL:0')) THEN
    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:0:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
    Z_YDCPG_SL2_PDSI => GET_HOST_DATA_RDWR (YDCPG_SL2%F_PDSI)
    Z_YDCPG_SL2_SPSI => GET_HOST_DATA_RDWR (YDCPG_SL2%F_SPSI)
    Z_YDCPG_SL2_TSI => GET_HOST_DATA_RDWR (YDCPG_SL2%F_TSI)
    Z_YDCPG_SL2_USI => GET_HOST_DATA_RDWR (YDCPG_SL2%F_USI)
    Z_YDCPG_SL2_VDSI => GET_HOST_DATA_RDWR (YDCPG_SL2%F_VDSI)
    Z_YDCPG_SL2_VSI => GET_HOST_DATA_RDWR (YDCPG_SL2%F_VSI)
    Z_YDVARS_SPD_T1 => GET_HOST_DATA_RDWR (YDVARS%SPD%FT1)
    Z_YDVARS_SP_T1 => GET_HOST_DATA_RDWR (YDVARS%SP%FT1)
    Z_YDVARS_SVD_T1 => GET_HOST_DATA_RDWR (YDVARS%SVD%FT1)
    Z_YDVARS_T_T1 => GET_HOST_DATA_RDWR (YDVARS%T%FT1)
    Z_YDVARS_U_T1 => GET_HOST_DATA_RDWR (YDVARS%U%FT1)
    Z_YDVARS_V_T1 => GET_HOST_DATA_RDWR (YDVARS%V%FT1)
    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:0:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:0:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  Z_YDCPG_SL2_PDSI => NULL ()
  Z_YDCPG_SL2_SPSI => NULL ()
  Z_YDCPG_SL2_TSI => NULL ()
  Z_YDCPG_SL2_USI => NULL ()
  Z_YDCPG_SL2_VDSI => NULL ()
  Z_YDCPG_SL2_VSI => NULL ()
  Z_YDVARS_SPD_T1 => NULL ()
  Z_YDVARS_SP_T1 => NULL ()
  Z_YDVARS_SVD_T1 => NULL ()
  Z_YDVARS_T_T1 => NULL ()
  Z_YDVARS_U_T1 => NULL ()
  Z_YDVARS_V_T1 => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:0:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN','CPGLAG_PARALLEL:0')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:0:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  Z_YDCPG_SL2_PDSI => GET_DEVICE_DATA_RDONLY (YDCPG_SL2%F_PDSI)
  Z_YDCPG_SL2_SPSI => GET_DEVICE_DATA_RDONLY (YDCPG_SL2%F_SPSI)
  Z_YDCPG_SL2_TSI => GET_DEVICE_DATA_RDONLY (YDCPG_SL2%F_TSI)
  Z_YDCPG_SL2_USI => GET_DEVICE_DATA_RDONLY (YDCPG_SL2%F_USI)
  Z_YDCPG_SL2_VDSI => GET_DEVICE_DATA_RDONLY (YDCPG_SL2%F_VDSI)
  Z_YDCPG_SL2_VSI => GET_DEVICE_DATA_RDONLY (YDCPG_SL2%F_VSI)
  Z_YDVARS_SPD_T1 => GET_DEVICE_DATA_RDWR (YDVARS%SPD%FT1)
  Z_YDVARS_SP_T1 => GET_DEVICE_DATA_RDWR (YDVARS%SP%FT1)
  Z_YDVARS_SVD_T1 => GET_DEVICE_DATA_RDWR (YDVARS%SVD%FT1)
  Z_YDVARS_T_T1 => GET_DEVICE_DATA_RDWR (YDVARS%T%FT1)
  Z_YDVARS_U_T1 => GET_DEVICE_DATA_RDWR (YDVARS%U%FT1)
  Z_YDVARS_V_T1 => GET_DEVICE_DATA_RDWR (YDVARS%V%FT1)
  IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:0:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:0:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  
    !$ACC PARALLEL LOOP GANG &
    !$ACC&PRESENT (YDCPG_OPTS, YDGEOMETRY, YDMODEL, YFXTRAN_ACDC_STACK, Z_YDCPG_SL2_PDSI, &
    !$ACC&         Z_YDCPG_SL2_SPSI, Z_YDCPG_SL2_TSI, Z_YDCPG_SL2_USI, Z_YDCPG_SL2_VDSI, &
    !$ACC&         Z_YDCPG_SL2_VSI, Z_YDVARS_SPD_T1, Z_YDVARS_SP_T1, Z_YDVARS_SVD_T1, &
    !$ACC&         Z_YDVARS_T_T1, Z_YDVARS_U_T1, Z_YDVARS_V_T1) &
    !$ACC&PRIVATE (JBLK) &
    !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
    
    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    
    
    
    !$ACC LOOP VECTOR &
    !$ACC&PRIVATE (JLEV, JROF, YLCPG_BNDS) 

    

    DO JROF = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JROF
      YLCPG_BNDS%KFDIA = JROF

      

      DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
        
        Z_YDVARS_U_T1 (JROF, JLEV, JBLK)=Z_YDVARS_U_T1 (JROF, JLEV, JBLK)+Z_YDCPG_SL2_USI (JROF, JLEV, JBLK)
        Z_YDVARS_V_T1 (JROF, JLEV, JBLK)=Z_YDVARS_V_T1 (JROF, JLEV, JBLK)+Z_YDCPG_SL2_VSI (JROF, JLEV, JBLK)
        Z_YDVARS_T_T1 (JROF, JLEV, JBLK)=Z_YDVARS_T_T1 (JROF, JLEV, JBLK)+Z_YDCPG_SL2_TSI (JROF, JLEV, JBLK)
      
      ENDDO


      IF (YDMODEL%YRML_DYN%YRDYNA%LNHDYN) THEN

        DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
          
          Z_YDVARS_SVD_T1 (JROF, JLEV, JBLK)=Z_YDVARS_SVD_T1 (JROF&
          &, JLEV, JBLK)+Z_YDCPG_SL2_VDSI (JROF, JLEV, JBLK)
          Z_YDVARS_SPD_T1 (JROF, JLEV, JBLK)=Z_YDVARS_SPD_T1 (JROF&
          &, JLEV, JBLK)+Z_YDCPG_SL2_PDSI (JROF, JLEV, JBLK)
        
        ENDDO

      ENDIF


      IF (YDMODEL%YRML_DYN%YRDYNA%LNHQE_SOLVER_QE) THEN
        Z_YDVARS_SPD_T1 (JROF, 1:YDGEOMETRY%YRDIMV%NFLEVG, JBLK)=0.0_JPRB
      ENDIF

      
      Z_YDVARS_SP_T1 (JROF, JBLK)=Z_YDVARS_SP_T1 (JROF, JBLK)+Z_YDCPG_SL2_SPSI (JROF, JBLK)
    
    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:0:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

  IF (FXTRAN_ACDC_LSYNCHOST ('CPGLAG_PARALLEL:0')) THEN
    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:0:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
    Z_YDCPG_SL2_PDSI => GET_HOST_DATA_RDWR (YDCPG_SL2%F_PDSI)
    Z_YDCPG_SL2_SPSI => GET_HOST_DATA_RDWR (YDCPG_SL2%F_SPSI)
    Z_YDCPG_SL2_TSI => GET_HOST_DATA_RDWR (YDCPG_SL2%F_TSI)
    Z_YDCPG_SL2_USI => GET_HOST_DATA_RDWR (YDCPG_SL2%F_USI)
    Z_YDCPG_SL2_VDSI => GET_HOST_DATA_RDWR (YDCPG_SL2%F_VDSI)
    Z_YDCPG_SL2_VSI => GET_HOST_DATA_RDWR (YDCPG_SL2%F_VSI)
    Z_YDVARS_SPD_T1 => GET_HOST_DATA_RDWR (YDVARS%SPD%FT1)
    Z_YDVARS_SP_T1 => GET_HOST_DATA_RDWR (YDVARS%SP%FT1)
    Z_YDVARS_SVD_T1 => GET_HOST_DATA_RDWR (YDVARS%SVD%FT1)
    Z_YDVARS_T_T1 => GET_HOST_DATA_RDWR (YDVARS%T%FT1)
    Z_YDVARS_U_T1 => GET_HOST_DATA_RDWR (YDVARS%U%FT1)
    Z_YDVARS_V_T1 => GET_HOST_DATA_RDWR (YDVARS%V%FT1)
    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:0:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:0:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  Z_YDCPG_SL2_PDSI => NULL ()
  Z_YDCPG_SL2_SPSI => NULL ()
  Z_YDCPG_SL2_TSI => NULL ()
  Z_YDCPG_SL2_USI => NULL ()
  Z_YDCPG_SL2_VDSI => NULL ()
  Z_YDCPG_SL2_VSI => NULL ()
  Z_YDVARS_SPD_T1 => NULL ()
  Z_YDVARS_SP_T1 => NULL ()
  Z_YDVARS_SVD_T1 => NULL ()
  Z_YDVARS_T_T1 => NULL ()
  Z_YDVARS_U_T1 => NULL ()
  Z_YDVARS_V_T1 => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:0:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSE
    CALL ABOR1 ('CPGLAG_PARALLEL: NOT METHOD WAS FOUND')
ENDIF

IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:0',1,ZHOOK_HANDLE_PARALLEL)

IF (YDMODEL%YRML_DYN%YRDYNA%LSPRT) THEN
  CALL GPRCP_EXPL_PARALLEL (YDMODEL%YRCST, YDCPG_BNDS, YDCPG_OPTS&
  &, YD_PR=YL_ZR1, YDVARS=YDVARS, KGFLTYP=1)
  ZRD_R=1.0_JPRB/YDMODEL%YRCST%RD
  IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:1',0,ZHOOK_HANDLE_PARALLEL)

  IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','CPGLAG_PARALLEL:1')) THEN
    
    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:1:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
    ZR1 => GET_HOST_DATA_RDONLY (YL_ZR1)
    Z_YDVARS_T_T1 => GET_HOST_DATA_RDWR (YDVARS%T%FT1)
    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:1:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:1:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
    
    CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
    !$OMP PARALLEL DO PRIVATE (JBLK, JLEV, JROF) FIRSTPRIVATE (YLCPG_BNDS)

    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
      CALL YLCPG_BNDS%UPDATE (JBLK)

      

      DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG

        DO JROF=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
          Z_YDVARS_T_T1 (JROF, JLEV, JBLK)=ZR1 (JROF, JLEV, JBLK)*Z_YDVARS_T_T1 (JROF, JLEV, JBLK)*ZRD_R
        ENDDO

      ENDDO

    ENDDO

    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:1:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

    IF (FXTRAN_ACDC_LSYNCHOST ('CPGLAG_PARALLEL:1')) THEN
      IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:1:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
      ZR1 => GET_HOST_DATA_RDWR (YL_ZR1)
      Z_YDVARS_T_T1 => GET_HOST_DATA_RDWR (YDVARS%T%FT1)
      IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:1:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
      
      
    ENDIF

    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:1:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
    ZR1 => NULL ()
    Z_YDVARS_T_T1 => NULL ()
    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:1:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMPSINGLECOLUMN','CPGLAG_PARALLEL:1')) THEN
    
    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:1:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
    ZR1 => GET_HOST_DATA_RDONLY (YL_ZR1)
    Z_YDVARS_T_T1 => GET_HOST_DATA_RDWR (YDVARS%T%FT1)
    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:1:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:1:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
    
    !$OMP PARALLEL DO PRIVATE (JBLK, JLEV, JROF, YLCPG_BNDS)

    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX

      

      

      DO JROF = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
        YLCPG_BNDS%KIDIA = JROF
        YLCPG_BNDS%KFDIA = JROF

        

        DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
          
          Z_YDVARS_T_T1 (JROF, JLEV, JBLK)=ZR1 (JROF, JLEV, JBLK)*Z_YDVARS_T_T1 (JROF, JLEV, JBLK)*ZRD_R
        
        ENDDO

      ENDDO

    ENDDO

    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:1:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

    IF (FXTRAN_ACDC_LSYNCHOST ('CPGLAG_PARALLEL:1')) THEN
      IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:1:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
      ZR1 => GET_HOST_DATA_RDWR (YL_ZR1)
      Z_YDVARS_T_T1 => GET_HOST_DATA_RDWR (YDVARS%T%FT1)
      IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:1:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
      
      
    ENDIF

    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:1:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
    ZR1 => NULL ()
    Z_YDVARS_T_T1 => NULL ()
    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:1:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN','CPGLAG_PARALLEL:1')) THEN
    
    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:1:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
    ZR1 => GET_DEVICE_DATA_RDONLY (YL_ZR1)
    Z_YDVARS_T_T1 => GET_DEVICE_DATA_RDWR (YDVARS%T%FT1)
    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:1:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:1:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
    
    
      !$ACC PARALLEL LOOP GANG &
      !$ACC&PRESENT (YDCPG_OPTS, YDGEOMETRY, YFXTRAN_ACDC_STACK, ZR1, Z_YDVARS_T_T1) &
      !$ACC&PRIVATE (JBLK) &
      !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
      
      DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
      
      
      
      !$ACC LOOP VECTOR &
      !$ACC&PRIVATE (JLEV, JROF, YLCPG_BNDS) 

      

      DO JROF = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
        YLCPG_BNDS%KIDIA = JROF
        YLCPG_BNDS%KFDIA = JROF

        

        DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
          
          Z_YDVARS_T_T1 (JROF, JLEV, JBLK)=ZR1 (JROF, JLEV, JBLK)*Z_YDVARS_T_T1 (JROF, JLEV, JBLK)*ZRD_R
        
        ENDDO

      ENDDO

    ENDDO

    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:1:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

    IF (FXTRAN_ACDC_LSYNCHOST ('CPGLAG_PARALLEL:1')) THEN
      IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:1:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
      ZR1 => GET_HOST_DATA_RDWR (YL_ZR1)
      Z_YDVARS_T_T1 => GET_HOST_DATA_RDWR (YDVARS%T%FT1)
      IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:1:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
      
      
    ENDIF

    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:1:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
    ZR1 => NULL ()
    Z_YDVARS_T_T1 => NULL ()
    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:1:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ELSE
      CALL ABOR1 ('CPGLAG_PARALLEL: NOT METHOD WAS FOUND')
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:1',1,ZHOOK_HANDLE_PARALLEL)
ENDIF

ZEPS=100.0_JPRB*TINY (1.0_JPRB)
LLSTR=(ABS (YDGEOMETRY%YRGEM%RSTRET-1.0_JPRB)>ZEPS)

IF (LLSTR) THEN
  IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:STR',0,ZHOOK_HANDLE_PARALLEL)

  IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','CPGLAG_PARALLEL:STR')) THEN
    
    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:STR:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
    Z_YDVARS_GEOMETRY_GM_P => GET_HOST_DATA_RDONLY (YDVARS%GEOMETRY%GM%FT0)
    Z_YDVARS_U_T1 => GET_HOST_DATA_RDWR (YDVARS%U%FT1)
    Z_YDVARS_V_T1 => GET_HOST_DATA_RDWR (YDVARS%V%FT1)
    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:STR:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:STR:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
    
    CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
    !$OMP PARALLEL DO PRIVATE (JBLK, JLEV, JROF) FIRSTPRIVATE (YLCPG_BNDS)

    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
      CALL YLCPG_BNDS%UPDATE (JBLK)

      

      DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG

        DO JROF=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
          Z_YDVARS_U_T1 (JROF, JLEV, JBLK)=Z_YDVARS_U_T1 (JROF&
          &, JLEV, JBLK)/Z_YDVARS_GEOMETRY_GM_P (JROF, JBLK)
          Z_YDVARS_V_T1 (JROF, JLEV, JBLK)=Z_YDVARS_V_T1 (JROF&
          &, JLEV, JBLK)/Z_YDVARS_GEOMETRY_GM_P (JROF, JBLK)
        ENDDO

      ENDDO

    ENDDO

    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:STR:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

    IF (FXTRAN_ACDC_LSYNCHOST ('CPGLAG_PARALLEL:STR')) THEN
      IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:STR:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
      Z_YDVARS_GEOMETRY_GM_P => GET_HOST_DATA_RDWR (YDVARS%GEOMETRY%GM%FT0)
      Z_YDVARS_U_T1 => GET_HOST_DATA_RDWR (YDVARS%U%FT1)
      Z_YDVARS_V_T1 => GET_HOST_DATA_RDWR (YDVARS%V%FT1)
      IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:STR:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
      
      
    ENDIF

    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:STR:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
    Z_YDVARS_GEOMETRY_GM_P => NULL ()
    Z_YDVARS_U_T1 => NULL ()
    Z_YDVARS_V_T1 => NULL ()
    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:STR:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMPSINGLECOLUMN','CPGLAG_PARALLEL:STR')) THEN
    
    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:STR:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
    Z_YDVARS_GEOMETRY_GM_P => GET_HOST_DATA_RDONLY (YDVARS%GEOMETRY%GM%FT0)
    Z_YDVARS_U_T1 => GET_HOST_DATA_RDWR (YDVARS%U%FT1)
    Z_YDVARS_V_T1 => GET_HOST_DATA_RDWR (YDVARS%V%FT1)
    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:STR:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:STR:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
    
    !$OMP PARALLEL DO PRIVATE (JBLK, JLEV, JROF, YLCPG_BNDS)

    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX

      

      

      DO JROF = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
        YLCPG_BNDS%KIDIA = JROF
        YLCPG_BNDS%KFDIA = JROF

        

        DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
          
          Z_YDVARS_U_T1 (JROF, JLEV, JBLK)=Z_YDVARS_U_T1 (JROF&
          &, JLEV, JBLK)/Z_YDVARS_GEOMETRY_GM_P (JROF, JBLK)
          Z_YDVARS_V_T1 (JROF, JLEV, JBLK)=Z_YDVARS_V_T1 (JROF&
          &, JLEV, JBLK)/Z_YDVARS_GEOMETRY_GM_P (JROF, JBLK)
        
        ENDDO

      ENDDO

    ENDDO

    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:STR:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

    IF (FXTRAN_ACDC_LSYNCHOST ('CPGLAG_PARALLEL:STR')) THEN
      IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:STR:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
      Z_YDVARS_GEOMETRY_GM_P => GET_HOST_DATA_RDWR (YDVARS%GEOMETRY%GM%FT0)
      Z_YDVARS_U_T1 => GET_HOST_DATA_RDWR (YDVARS%U%FT1)
      Z_YDVARS_V_T1 => GET_HOST_DATA_RDWR (YDVARS%V%FT1)
      IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:STR:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
      
      
    ENDIF

    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:STR:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
    Z_YDVARS_GEOMETRY_GM_P => NULL ()
    Z_YDVARS_U_T1 => NULL ()
    Z_YDVARS_V_T1 => NULL ()
    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:STR:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN','CPGLAG_PARALLEL:STR')) THEN
    
    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:STR:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
    Z_YDVARS_GEOMETRY_GM_P => GET_DEVICE_DATA_RDONLY (YDVARS%GEOMETRY%GM%FT0)
    Z_YDVARS_U_T1 => GET_DEVICE_DATA_RDWR (YDVARS%U%FT1)
    Z_YDVARS_V_T1 => GET_DEVICE_DATA_RDWR (YDVARS%V%FT1)
    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:STR:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:STR:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
    
    
      !$ACC PARALLEL LOOP GANG &
      !$ACC&PRESENT (YDCPG_OPTS, YDGEOMETRY, YFXTRAN_ACDC_STACK, Z_YDVARS_GEOMETRY_GM_P, &
      !$ACC&         Z_YDVARS_U_T1, Z_YDVARS_V_T1) &
      !$ACC&PRIVATE (JBLK) &
      !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
      
      DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
      
      
      
      !$ACC LOOP VECTOR &
      !$ACC&PRIVATE (JLEV, JROF, YLCPG_BNDS) 

      

      DO JROF = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
        YLCPG_BNDS%KIDIA = JROF
        YLCPG_BNDS%KFDIA = JROF

        

        DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
          
          Z_YDVARS_U_T1 (JROF, JLEV, JBLK)=Z_YDVARS_U_T1 (JROF&
          &, JLEV, JBLK)/Z_YDVARS_GEOMETRY_GM_P (JROF, JBLK)
          Z_YDVARS_V_T1 (JROF, JLEV, JBLK)=Z_YDVARS_V_T1 (JROF&
          &, JLEV, JBLK)/Z_YDVARS_GEOMETRY_GM_P (JROF, JBLK)
        
        ENDDO

      ENDDO

    ENDDO

    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:STR:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

    IF (FXTRAN_ACDC_LSYNCHOST ('CPGLAG_PARALLEL:STR')) THEN
      IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:STR:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
      Z_YDVARS_GEOMETRY_GM_P => GET_HOST_DATA_RDWR (YDVARS%GEOMETRY%GM%FT0)
      Z_YDVARS_U_T1 => GET_HOST_DATA_RDWR (YDVARS%U%FT1)
      Z_YDVARS_V_T1 => GET_HOST_DATA_RDWR (YDVARS%V%FT1)
      IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:STR:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
      
      
    ENDIF

    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:STR:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
    Z_YDVARS_GEOMETRY_GM_P => NULL ()
    Z_YDVARS_U_T1 => NULL ()
    Z_YDVARS_V_T1 => NULL ()
    IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:STR:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ELSE
      CALL ABOR1 ('CPGLAG_PARALLEL: NOT METHOD WAS FOUND')
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL:STR',1,ZHOOK_HANDLE_PARALLEL)
ENDIF


IF (YDMODEL%YRML_DYN%YRDYNA%LSLAG.AND.YDMODEL%YRML_DIAG%YRLDDH%LRSLDDH.AND.(.NOT.LDCONFX)) THEN
  
  
  CALL ABOR1 ("ERROR: WRONG SETTINGS")
  
ENDIF




CALL FXTRAN_ACDC_GPUMEMSTAT (__FILE__, __LINE__, "END")

IF (LHOOK) CALL DR_HOOK ('DELETE_TEMPORARIES',0,ZHOOK_HANDLE_FIELD_API)
IF (ASSOCIATED (YL_ZGMVNHXT1B)) CALL FIELD_DELETE (YL_ZGMVNHXT1B)
IF (ASSOCIATED (YL_ZGMVSVDT1A)) CALL FIELD_DELETE (YL_ZGMVSVDT1A)
IF (ASSOCIATED (YL_ZGMVSVDT1B)) CALL FIELD_DELETE (YL_ZGMVSVDT1B)
IF (ASSOCIATED (YL_ZOROGL_SR)) CALL FIELD_DELETE (YL_ZOROGL_SR)
IF (ASSOCIATED (YL_ZOROGM_SR)) CALL FIELD_DELETE (YL_ZOROGM_SR)
IF (ASSOCIATED (YL_ZR1)) CALL FIELD_DELETE (YL_ZR1)
IF (LHOOK) CALL DR_HOOK ('DELETE_TEMPORARIES',1,ZHOOK_HANDLE_FIELD_API)
IF (LHOOK) CALL DR_HOOK ('CPGLAG_PARALLEL', 1, ZHOOK_HANDLE)
END SUBROUTINE CPGLAG_PARALLEL
