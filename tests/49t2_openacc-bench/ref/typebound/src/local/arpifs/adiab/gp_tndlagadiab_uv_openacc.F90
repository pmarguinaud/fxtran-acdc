
SUBROUTINE GP_TNDLAGADIAB_UV_OPENACC (LDRPLANE, YDGEOMETRY, YDEPHY, YDDYN, KST, KEND, PRCORI&
&, PGNORDL, PGNORDM, PSGRTL, PSGRTM, PU, PV, PTNDU, PTNDV, PTNDU_NOC, PTNDV_NOC, YDSTACK)
!$ACC ROUTINE (GP_TNDLAGADIAB_UV_OPENACC) SEQ

USE PARKIND1,ONLY:JPIM, JPRB
USE GEOMETRY_MOD,ONLY:GEOMETRY

USE YOMDYN,ONLY:TDYN
USE YOEPHY,ONLY:TEPHY
#include "fxtran_acdc_stack.h"
USE FXTRAN_ACDC_STACK_MOD
USE FXTRAN_ACDC_ABORT_MOD

IMPLICIT NONE


LOGICAL, INTENT (IN)::LDRPLANE
TYPE (GEOMETRY), INTENT (IN)::YDGEOMETRY
TYPE (TEPHY), INTENT (IN)::YDEPHY
TYPE (TDYN), INTENT (IN)::YDDYN
INTEGER (KIND=JPIM), INTENT (IN)::KEND
INTEGER (KIND=JPIM), INTENT (IN)::KST
REAL (KIND=JPRB), INTENT (IN)::PRCORI (YDGEOMETRY%YRDIM%NPROMA)
REAL (KIND=JPRB), INTENT (IN)::PGNORDL (YDGEOMETRY%YRDIM%NPROMA)
REAL (KIND=JPRB), INTENT (IN)::PGNORDM (YDGEOMETRY%YRDIM%NPROMA)
REAL (KIND=JPRB), INTENT (IN)::PSGRTL (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PSGRTM (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PU (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PV (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB), INTENT (OUT)::PTNDU (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB), INTENT (OUT)::PTNDV (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB), INTENT (OUT)::PTNDU_NOC (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
REAL (KIND=JPRB), INTENT (OUT)::PTNDV_NOC (YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG)
TYPE(FXTRAN_ACDC_STACK), INTENT (IN) :: YDSTACK

INTEGER (KIND=JPIM)::JLEV
INTEGER (KIND=JPIM)::JROF
REAL (KIND=JPRB)::ZGNORDL2 
REAL (KIND=JPRB)::ZGNORDLM 
REAL (KIND=JPRB)::ZGNORDM2 

JROF = KST







IF (YDEPHY%LEGWWMS.OR..NOT.YDDYN%LRFRIC) THEN
  
  PTNDU_NOC (JROF, 1:YDGEOMETRY%YRDIMV%NFLEVG)=-PSGRTL (JROF, 1:YDGEOMETRY%YRDIMV%NFLEVG)
  PTNDV_NOC (JROF, 1:YDGEOMETRY%YRDIMV%NFLEVG)=-PSGRTM (JROF, 1:YDGEOMETRY%YRDIMV%NFLEVG)
  
ELSEIF (YDDYN%LRFRICISOTR) THEN

  DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
    
    PTNDU_NOC (JROF, JLEV)=-YDDYN%RKRF(JLEV)*PU (JROF, JLEV)-PSGRTL (JROF, JLEV)
    PTNDV_NOC (JROF, JLEV)=-YDDYN%RKRF(JLEV)*PV (JROF, JLEV)-PSGRTM (JROF, JLEV)
  
  ENDDO

ELSEIF (.NOT.LDRPLANE.AND.YDGEOMETRY%YRGEM%NSTTYP==1) THEN

  DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
    
    PTNDU_NOC (JROF, JLEV)=-YDDYN%RKRF(JLEV)*PU (JROF, JLEV)-PSGRTL (JROF, JLEV)
    PTNDV_NOC (JROF, JLEV)=-PSGRTM (JROF, JLEV)
  
  ENDDO

ELSE
  
  ZGNORDLM =PGNORDM (JROF)*PGNORDL (JROF)
  ZGNORDL2 =PGNORDL (JROF)**2
  ZGNORDM2 =PGNORDM (JROF)**2

  

  DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
    
    PTNDU_NOC (JROF, JLEV)=YDDYN%RKRF(JLEV)*(ZGNORDLM *PV (JROF&
    &, JLEV)-ZGNORDM2 *PU (JROF, JLEV))-PSGRTL (JROF, JLEV)
    PTNDV_NOC (JROF, JLEV)=YDDYN%RKRF(JLEV)*(ZGNORDLM *PU (JROF&
    &, JLEV)-ZGNORDL2 *PV (JROF, JLEV))-PSGRTM (JROF, JLEV)
  
  ENDDO

ENDIF


DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
  
  PTNDU (JROF, JLEV)=PTNDU_NOC (JROF, JLEV)+PRCORI (JROF)*PV (JROF, JLEV)
  PTNDV (JROF, JLEV)=PTNDV_NOC (JROF, JLEV)-PRCORI (JROF)*PU (JROF, JLEV)
  
ENDDO




END SUBROUTINE GP_TNDLAGADIAB_UV_OPENACC
