SUBROUTINE MF_PHYS_SAVE_PHSURF_PART1_PARALLEL (YDCPG_BNDS, YDCPG_OPTS, YD_PSAV_DDAL, YD_PSAV_DDOM&
&, YD_PSAV_ENTCH, YD_PSAV_FHPS, YD_PSAV_GZ0F, YD_PSAV_GZ0HF, YD_PSAV_HV, YD_PSAV_PBLH, YD_PSAV_QSH&
&, YD_PSAV_UDAL, YD_PSAV_UDGRO, YD_PSAV_UDOM, YD_PSAV_UNEBH, YD_PGSD_VF_PZ0F, YD_PGSD_VH_PPBLH&
&, YD_PGSD_VH_PQSH, YD_PGSD_VH_PSPSH, YD_PGSD_VK_PUDGRO, YD_PGSD_VV_PHV, YD_PGSD_VV_PZ0H, YD_PDAL_T0&
&, YD_PDOM_T0, YD_PUAL_T0, YD_PUEN_T0, YD_PUNEBH_T0, YD_PUOM_T0, YDMODEL)
USE YOMHOOK,ONLY:LHOOK, DR_HOOK, JPHOOK

USE CPG_OPTS_TYPE_MOD,ONLY:CPG_BNDS_TYPE, CPG_OPTS_TYPE
USE TYPE_MODEL,ONLY:MODEL
USE FIELD_MODULE
USE FIELD_FACTORY_MODULE
USE FIELD_ACCESS_MODULE
USE FXTRAN_ACDC_PARALLELMETHOD_MOD
USE FXTRAN_ACDC_STACK_MOD
USE PARKIND1
USE FXTRAN_ACDC_ARRAY_COPY_MOD
USE FXTRAN_ACDC_GPUMEM_MOD
#include "fxtran_acdc_stack.h"

IMPLICIT NONE


TYPE (CPG_BNDS_TYPE), INTENT (IN)::YDCPG_BNDS
TYPE (CPG_OPTS_TYPE), INTENT (IN)::YDCPG_OPTS
CLASS (FIELD_3RB), POINTER :: YD_PSAV_DDAL
REAL (KIND=JPRB), POINTER::PSAV_DDAL (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PSAV_DDOM
REAL (KIND=JPRB), POINTER::PSAV_DDOM (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PSAV_ENTCH
REAL (KIND=JPRB), POINTER::PSAV_ENTCH (:,:,:)
CLASS (FIELD_2RB), POINTER :: YD_PSAV_FHPS
REAL (KIND=JPRB), POINTER::PSAV_FHPS (:,:)
CLASS (FIELD_2RB), POINTER :: YD_PSAV_GZ0F
REAL (KIND=JPRB), POINTER::PSAV_GZ0F (:,:)
CLASS (FIELD_2RB), POINTER :: YD_PSAV_GZ0HF
REAL (KIND=JPRB), POINTER::PSAV_GZ0HF (:,:)
CLASS (FIELD_2RB), POINTER :: YD_PSAV_HV
REAL (KIND=JPRB), POINTER::PSAV_HV (:,:)
CLASS (FIELD_2RB), POINTER :: YD_PSAV_PBLH
REAL (KIND=JPRB), POINTER::PSAV_PBLH (:,:)
CLASS (FIELD_2RB), POINTER :: YD_PSAV_QSH
REAL (KIND=JPRB), POINTER::PSAV_QSH (:,:)
CLASS (FIELD_3RB), POINTER :: YD_PSAV_UDAL
REAL (KIND=JPRB), POINTER::PSAV_UDAL (:,:,:)
CLASS (FIELD_2RB), POINTER :: YD_PSAV_UDGRO
REAL (KIND=JPRB), POINTER::PSAV_UDGRO (:,:)
CLASS (FIELD_3RB), POINTER :: YD_PSAV_UDOM
REAL (KIND=JPRB), POINTER::PSAV_UDOM (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PSAV_UNEBH
REAL (KIND=JPRB), POINTER::PSAV_UNEBH (:,:,:)
CLASS (FIELD_2RB), POINTER :: YD_PGSD_VF_PZ0F
REAL (KIND=JPRB), POINTER::PGSD_VF_PZ0F (:,:)
CLASS (FIELD_2RB), POINTER :: YD_PGSD_VH_PPBLH
REAL (KIND=JPRB), POINTER::PGSD_VH_PPBLH (:,:)
CLASS (FIELD_2RB), POINTER :: YD_PGSD_VH_PQSH
REAL (KIND=JPRB), POINTER::PGSD_VH_PQSH (:,:)
CLASS (FIELD_2RB), POINTER :: YD_PGSD_VH_PSPSH
REAL (KIND=JPRB), POINTER::PGSD_VH_PSPSH (:,:)
CLASS (FIELD_2RB), POINTER :: YD_PGSD_VK_PUDGRO
REAL (KIND=JPRB), POINTER::PGSD_VK_PUDGRO (:,:)
CLASS (FIELD_2RB), POINTER :: YD_PGSD_VV_PHV
REAL (KIND=JPRB), POINTER::PGSD_VV_PHV (:,:)
CLASS (FIELD_2RB), POINTER :: YD_PGSD_VV_PZ0H
REAL (KIND=JPRB), POINTER::PGSD_VV_PZ0H (:,:)
CLASS (FIELD_3RB), POINTER :: YD_PDAL_T0
REAL (KIND=JPRB), POINTER::PDAL_T0 (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PDOM_T0
REAL (KIND=JPRB), POINTER::PDOM_T0 (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PUAL_T0
REAL (KIND=JPRB), POINTER::PUAL_T0 (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PUEN_T0
REAL (KIND=JPRB), POINTER::PUEN_T0 (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PUNEBH_T0
REAL (KIND=JPRB), POINTER::PUNEBH_T0 (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PUOM_T0
REAL (KIND=JPRB), POINTER::PUOM_T0 (:,:,:)
TYPE (MODEL), INTENT (IN)::YDMODEL
REAL (KIND=JPHOOK)::ZHOOK_HANDLE
INTEGER (KIND=JPIM) :: JLON
INTEGER(KIND=JPIM) :: JBLK
TYPE(CPG_BNDS_TYPE) :: YLCPG_BNDS
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_FIELD_API
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_PARALLEL
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_COMPUTE
TYPE(FXTRAN_ACDC_STACK) :: YLSTACK
TYPE(FXTRAN_ACDC_STACK) :: YLOFFSET
#include "abor1.intfb.h"
IF (LHOOK) CALL DR_HOOK ('MF_PHYS_SAVE_PHSURF_PART1_PARALLEL', 0, ZHOOK_HANDLE)

CALL FXTRAN_ACDC_GPUMEMSTAT (__FILE__, __LINE__, "BEGIN")


IF (LHOOK) CALL DR_HOOK ('CREATE_TEMPORARIES',0,ZHOOK_HANDLE_FIELD_API)
IF (LHOOK) CALL DR_HOOK ('CREATE_TEMPORARIES',1,ZHOOK_HANDLE_FIELD_API)


IF (LHOOK) CALL DR_HOOK ('MF_PHYS_SAVE_PHSURF_PART1_PARALLEL:PART1',0,ZHOOK_HANDLE_PARALLEL)

IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','MF_PHYS_SAVE_PHSURF_PART1_PARALLEL:PART1')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('MF_PHYS_SAVE_PHSURF_PART1_PARALLEL&
  &:PART1:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  PDAL_T0 => GET_HOST_DATA_RDONLY (YD_PDAL_T0)
  PDOM_T0 => GET_HOST_DATA_RDONLY (YD_PDOM_T0)
  PGSD_VF_PZ0F => GET_HOST_DATA_RDONLY (YD_PGSD_VF_PZ0F)
  PGSD_VH_PPBLH => GET_HOST_DATA_RDONLY (YD_PGSD_VH_PPBLH)
  PGSD_VH_PQSH => GET_HOST_DATA_RDONLY (YD_PGSD_VH_PQSH)
  PGSD_VH_PSPSH => GET_HOST_DATA_RDONLY (YD_PGSD_VH_PSPSH)
  PGSD_VK_PUDGRO => GET_HOST_DATA_RDONLY (YD_PGSD_VK_PUDGRO)
  PGSD_VV_PHV => GET_HOST_DATA_RDONLY (YD_PGSD_VV_PHV)
  PGSD_VV_PZ0H => GET_HOST_DATA_RDONLY (YD_PGSD_VV_PZ0H)
  PSAV_DDAL => GET_HOST_DATA_RDWR (YD_PSAV_DDAL)
  PSAV_DDOM => GET_HOST_DATA_RDWR (YD_PSAV_DDOM)
  PSAV_ENTCH => GET_HOST_DATA_RDWR (YD_PSAV_ENTCH)
  PSAV_FHPS => GET_HOST_DATA_RDWR (YD_PSAV_FHPS)
  PSAV_GZ0F => GET_HOST_DATA_RDWR (YD_PSAV_GZ0F)
  PSAV_GZ0HF => GET_HOST_DATA_RDWR (YD_PSAV_GZ0HF)
  PSAV_HV => GET_HOST_DATA_RDWR (YD_PSAV_HV)
  PSAV_PBLH => GET_HOST_DATA_RDWR (YD_PSAV_PBLH)
  PSAV_QSH => GET_HOST_DATA_RDWR (YD_PSAV_QSH)
  PSAV_UDAL => GET_HOST_DATA_RDWR (YD_PSAV_UDAL)
  PSAV_UDGRO => GET_HOST_DATA_RDWR (YD_PSAV_UDGRO)
  PSAV_UDOM => GET_HOST_DATA_RDWR (YD_PSAV_UDOM)
  PSAV_UNEBH => GET_HOST_DATA_RDWR (YD_PSAV_UNEBH)
  PUAL_T0 => GET_HOST_DATA_RDONLY (YD_PUAL_T0)
  PUEN_T0 => GET_HOST_DATA_RDONLY (YD_PUEN_T0)
  PUNEBH_T0 => GET_HOST_DATA_RDONLY (YD_PUNEBH_T0)
  PUOM_T0 => GET_HOST_DATA_RDONLY (YD_PUOM_T0)
  IF (LHOOK) CALL DR_HOOK ('MF_PHYS_SAVE_PHSURF_PART1_PARALLEL&
  &:PART1:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('MF_PHYS_SAVE_PHSURF_PART1_PARALLEL:PART1:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
  !$OMP PARALLEL DO PRIVATE (JBLK) FIRSTPRIVATE (YLCPG_BNDS)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    CALL YLCPG_BNDS%UPDATE (JBLK)

    

    IF (YDCPG_OPTS%YRSURF_OPTS%YSD_VV%YHV%LSET)  THEN
      PSAV_HV (:, JBLK)=PGSD_VV_PHV (:, JBLK)
    ENDIF


    IF (YDCPG_OPTS%YRSURF_OPTS%YSD_VF%YZ0F%LSET)  THEN
      PSAV_GZ0F (:, JBLK)=PGSD_VF_PZ0F (:, JBLK)
    ENDIF


    IF (YDCPG_OPTS%YRSURF_OPTS%YSD_VV%YZ0H%LSET)  THEN
      PSAV_GZ0HF (:, JBLK)=PGSD_VV_PZ0H (:, JBLK)
    ENDIF


    IF (YDCPG_OPTS%YRSURF_OPTS%YSD_VH%YPBLH%LSET)  THEN
      PSAV_PBLH (:, JBLK)=PGSD_VH_PPBLH (:, JBLK)
    ENDIF


    IF (YDCPG_OPTS%YRSURF_OPTS%YSD_VH%YSPSH%LSET)  THEN
      PSAV_FHPS (:, JBLK)=PGSD_VH_PSPSH (:, JBLK)
    ENDIF


    IF (YDCPG_OPTS%YRSURF_OPTS%YSD_VH%YQSH%LSET)  THEN
      PSAV_QSH (:, JBLK)=PGSD_VH_PQSH (:, JBLK)
    ENDIF


    IF (YDCPG_OPTS%YRSURF_OPTS%YSD_VK%YUDGRO%LSET)  THEN
      PSAV_UDGRO (:, JBLK)=PGSD_VK_PUDGRO (:, JBLK)
    ENDIF


    IF (YDMODEL%YRML_PHY_MF%YRPHY%LCVPRO.OR.YDMODEL%YRML_PHY_MF%YRPHY%LGPCMT) THEN
      PSAV_UDAL (:,:, JBLK)=PUAL_T0 (:,:, JBLK)
      PSAV_UDOM (:,:, JBLK)=PUOM_T0 (:,:, JBLK)

      IF (YDMODEL%YRML_PHY_MF%YRPHY%LCDDPRO) THEN
        PSAV_DDAL (:,:, JBLK)=PDAL_T0 (:,:, JBLK)
        PSAV_DDOM (:,:, JBLK)=PDOM_T0 (:,:, JBLK)
      ENDIF

    ENDIF


    IF (YDMODEL%YRML_GCONF%YGFL%YUNEBH%LACTIVE)  THEN
      PSAV_UNEBH (:,:, JBLK)=PUNEBH_T0 (:,:, JBLK)
    ENDIF


    IF (YDMODEL%YRML_GCONF%YGFL%YUEN%LACTIVE)  THEN
      PSAV_ENTCH (:,:, JBLK)=PUEN_T0 (:,:, JBLK)
    ENDIF

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('MF_PHYS_SAVE_PHSURF_PART1_PARALLEL:PART1:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

  IF (FXTRAN_ACDC_LSYNCHOST ('MF_PHYS_SAVE_PHSURF_PART1_PARALLEL:PART1')) THEN
    IF (LHOOK) CALL DR_HOOK ('MF_PHYS_SAVE_PHSURF_PART1_PARALLEL&
    &:PART1:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
    PDAL_T0 => GET_HOST_DATA_RDWR (YD_PDAL_T0)
    PDOM_T0 => GET_HOST_DATA_RDWR (YD_PDOM_T0)
    PGSD_VF_PZ0F => GET_HOST_DATA_RDWR (YD_PGSD_VF_PZ0F)
    PGSD_VH_PPBLH => GET_HOST_DATA_RDWR (YD_PGSD_VH_PPBLH)
    PGSD_VH_PQSH => GET_HOST_DATA_RDWR (YD_PGSD_VH_PQSH)
    PGSD_VH_PSPSH => GET_HOST_DATA_RDWR (YD_PGSD_VH_PSPSH)
    PGSD_VK_PUDGRO => GET_HOST_DATA_RDWR (YD_PGSD_VK_PUDGRO)
    PGSD_VV_PHV => GET_HOST_DATA_RDWR (YD_PGSD_VV_PHV)
    PGSD_VV_PZ0H => GET_HOST_DATA_RDWR (YD_PGSD_VV_PZ0H)
    PSAV_DDAL => GET_HOST_DATA_RDWR (YD_PSAV_DDAL)
    PSAV_DDOM => GET_HOST_DATA_RDWR (YD_PSAV_DDOM)
    PSAV_ENTCH => GET_HOST_DATA_RDWR (YD_PSAV_ENTCH)
    PSAV_FHPS => GET_HOST_DATA_RDWR (YD_PSAV_FHPS)
    PSAV_GZ0F => GET_HOST_DATA_RDWR (YD_PSAV_GZ0F)
    PSAV_GZ0HF => GET_HOST_DATA_RDWR (YD_PSAV_GZ0HF)
    PSAV_HV => GET_HOST_DATA_RDWR (YD_PSAV_HV)
    PSAV_PBLH => GET_HOST_DATA_RDWR (YD_PSAV_PBLH)
    PSAV_QSH => GET_HOST_DATA_RDWR (YD_PSAV_QSH)
    PSAV_UDAL => GET_HOST_DATA_RDWR (YD_PSAV_UDAL)
    PSAV_UDGRO => GET_HOST_DATA_RDWR (YD_PSAV_UDGRO)
    PSAV_UDOM => GET_HOST_DATA_RDWR (YD_PSAV_UDOM)
    PSAV_UNEBH => GET_HOST_DATA_RDWR (YD_PSAV_UNEBH)
    PUAL_T0 => GET_HOST_DATA_RDWR (YD_PUAL_T0)
    PUEN_T0 => GET_HOST_DATA_RDWR (YD_PUEN_T0)
    PUNEBH_T0 => GET_HOST_DATA_RDWR (YD_PUNEBH_T0)
    PUOM_T0 => GET_HOST_DATA_RDWR (YD_PUOM_T0)
    IF (LHOOK) CALL DR_HOOK ('MF_PHYS_SAVE_PHSURF_PART1_PARALLEL&
    &:PART1:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('MF_PHYS_SAVE_PHSURF_PART1_PARALLEL&
  &:PART1:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  PDAL_T0 => NULL ()
  PDOM_T0 => NULL ()
  PGSD_VF_PZ0F => NULL ()
  PGSD_VH_PPBLH => NULL ()
  PGSD_VH_PQSH => NULL ()
  PGSD_VH_PSPSH => NULL ()
  PGSD_VK_PUDGRO => NULL ()
  PGSD_VV_PHV => NULL ()
  PGSD_VV_PZ0H => NULL ()
  PSAV_DDAL => NULL ()
  PSAV_DDOM => NULL ()
  PSAV_ENTCH => NULL ()
  PSAV_FHPS => NULL ()
  PSAV_GZ0F => NULL ()
  PSAV_GZ0HF => NULL ()
  PSAV_HV => NULL ()
  PSAV_PBLH => NULL ()
  PSAV_QSH => NULL ()
  PSAV_UDAL => NULL ()
  PSAV_UDGRO => NULL ()
  PSAV_UDOM => NULL ()
  PSAV_UNEBH => NULL ()
  PUAL_T0 => NULL ()
  PUEN_T0 => NULL ()
  PUNEBH_T0 => NULL ()
  PUOM_T0 => NULL ()
  IF (LHOOK) CALL DR_HOOK ('MF_PHYS_SAVE_PHSURF_PART1_PARALLEL&
  &:PART1:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMPSINGLECOLUMN&
  &','MF_PHYS_SAVE_PHSURF_PART1_PARALLEL:PART1')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('MF_PHYS_SAVE_PHSURF_PART1_PARALLEL&
  &:PART1:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  PDAL_T0 => GET_HOST_DATA_RDONLY (YD_PDAL_T0)
  PDOM_T0 => GET_HOST_DATA_RDONLY (YD_PDOM_T0)
  PGSD_VF_PZ0F => GET_HOST_DATA_RDONLY (YD_PGSD_VF_PZ0F)
  PGSD_VH_PPBLH => GET_HOST_DATA_RDONLY (YD_PGSD_VH_PPBLH)
  PGSD_VH_PQSH => GET_HOST_DATA_RDONLY (YD_PGSD_VH_PQSH)
  PGSD_VH_PSPSH => GET_HOST_DATA_RDONLY (YD_PGSD_VH_PSPSH)
  PGSD_VK_PUDGRO => GET_HOST_DATA_RDONLY (YD_PGSD_VK_PUDGRO)
  PGSD_VV_PHV => GET_HOST_DATA_RDONLY (YD_PGSD_VV_PHV)
  PGSD_VV_PZ0H => GET_HOST_DATA_RDONLY (YD_PGSD_VV_PZ0H)
  PSAV_DDAL => GET_HOST_DATA_RDWR (YD_PSAV_DDAL)
  PSAV_DDOM => GET_HOST_DATA_RDWR (YD_PSAV_DDOM)
  PSAV_ENTCH => GET_HOST_DATA_RDWR (YD_PSAV_ENTCH)
  PSAV_FHPS => GET_HOST_DATA_RDWR (YD_PSAV_FHPS)
  PSAV_GZ0F => GET_HOST_DATA_RDWR (YD_PSAV_GZ0F)
  PSAV_GZ0HF => GET_HOST_DATA_RDWR (YD_PSAV_GZ0HF)
  PSAV_HV => GET_HOST_DATA_RDWR (YD_PSAV_HV)
  PSAV_PBLH => GET_HOST_DATA_RDWR (YD_PSAV_PBLH)
  PSAV_QSH => GET_HOST_DATA_RDWR (YD_PSAV_QSH)
  PSAV_UDAL => GET_HOST_DATA_RDWR (YD_PSAV_UDAL)
  PSAV_UDGRO => GET_HOST_DATA_RDWR (YD_PSAV_UDGRO)
  PSAV_UDOM => GET_HOST_DATA_RDWR (YD_PSAV_UDOM)
  PSAV_UNEBH => GET_HOST_DATA_RDWR (YD_PSAV_UNEBH)
  PUAL_T0 => GET_HOST_DATA_RDONLY (YD_PUAL_T0)
  PUEN_T0 => GET_HOST_DATA_RDONLY (YD_PUEN_T0)
  PUNEBH_T0 => GET_HOST_DATA_RDONLY (YD_PUNEBH_T0)
  PUOM_T0 => GET_HOST_DATA_RDONLY (YD_PUOM_T0)
  IF (LHOOK) CALL DR_HOOK ('MF_PHYS_SAVE_PHSURF_PART1_PARALLEL&
  &:PART1:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('MF_PHYS_SAVE_PHSURF_PART1_PARALLEL:PART1:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  !$OMP PARALLEL DO PRIVATE (JBLK, JLON, YLCPG_BNDS)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX

    

    

    DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JLON
      YLCPG_BNDS%KFDIA = JLON

      

      IF (YDCPG_OPTS%YRSURF_OPTS%YSD_VV%YHV%LSET)  THEN
        PSAV_HV (JLON, JBLK)=PGSD_VV_PHV (JLON, JBLK)
      ENDIF


      IF (YDCPG_OPTS%YRSURF_OPTS%YSD_VF%YZ0F%LSET)  THEN
        PSAV_GZ0F (JLON, JBLK)=PGSD_VF_PZ0F (JLON, JBLK)
      ENDIF


      IF (YDCPG_OPTS%YRSURF_OPTS%YSD_VV%YZ0H%LSET)  THEN
        PSAV_GZ0HF (JLON, JBLK)=PGSD_VV_PZ0H (JLON, JBLK)
      ENDIF


      IF (YDCPG_OPTS%YRSURF_OPTS%YSD_VH%YPBLH%LSET)  THEN
        PSAV_PBLH (JLON, JBLK)=PGSD_VH_PPBLH (JLON, JBLK)
      ENDIF


      IF (YDCPG_OPTS%YRSURF_OPTS%YSD_VH%YSPSH%LSET)  THEN
        PSAV_FHPS (JLON, JBLK)=PGSD_VH_PSPSH (JLON, JBLK)
      ENDIF


      IF (YDCPG_OPTS%YRSURF_OPTS%YSD_VH%YQSH%LSET)  THEN
        PSAV_QSH (JLON, JBLK)=PGSD_VH_PQSH (JLON, JBLK)
      ENDIF


      IF (YDCPG_OPTS%YRSURF_OPTS%YSD_VK%YUDGRO%LSET)  THEN
        PSAV_UDGRO (JLON, JBLK)=PGSD_VK_PUDGRO (JLON, JBLK)
      ENDIF


      IF (YDMODEL%YRML_PHY_MF%YRPHY%LCVPRO.OR.YDMODEL%YRML_PHY_MF%YRPHY%LGPCMT) THEN
        PSAV_UDAL (JLON,:, JBLK)=PUAL_T0 (JLON,:, JBLK)
        PSAV_UDOM (JLON,:, JBLK)=PUOM_T0 (JLON,:, JBLK)

        IF (YDMODEL%YRML_PHY_MF%YRPHY%LCDDPRO) THEN
          PSAV_DDAL (JLON,:, JBLK)=PDAL_T0 (JLON,:, JBLK)
          PSAV_DDOM (JLON,:, JBLK)=PDOM_T0 (JLON,:, JBLK)
        ENDIF

      ENDIF


      IF (YDMODEL%YRML_GCONF%YGFL%YUNEBH%LACTIVE)  THEN
        PSAV_UNEBH (JLON,:, JBLK)=PUNEBH_T0 (JLON,:, JBLK)
      ENDIF


      IF (YDMODEL%YRML_GCONF%YGFL%YUEN%LACTIVE)  THEN
        PSAV_ENTCH (JLON,:, JBLK)=PUEN_T0 (JLON,:, JBLK)
      ENDIF

    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('MF_PHYS_SAVE_PHSURF_PART1_PARALLEL:PART1:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

  IF (FXTRAN_ACDC_LSYNCHOST ('MF_PHYS_SAVE_PHSURF_PART1_PARALLEL:PART1')) THEN
    IF (LHOOK) CALL DR_HOOK ('MF_PHYS_SAVE_PHSURF_PART1_PARALLEL&
    &:PART1:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
    PDAL_T0 => GET_HOST_DATA_RDWR (YD_PDAL_T0)
    PDOM_T0 => GET_HOST_DATA_RDWR (YD_PDOM_T0)
    PGSD_VF_PZ0F => GET_HOST_DATA_RDWR (YD_PGSD_VF_PZ0F)
    PGSD_VH_PPBLH => GET_HOST_DATA_RDWR (YD_PGSD_VH_PPBLH)
    PGSD_VH_PQSH => GET_HOST_DATA_RDWR (YD_PGSD_VH_PQSH)
    PGSD_VH_PSPSH => GET_HOST_DATA_RDWR (YD_PGSD_VH_PSPSH)
    PGSD_VK_PUDGRO => GET_HOST_DATA_RDWR (YD_PGSD_VK_PUDGRO)
    PGSD_VV_PHV => GET_HOST_DATA_RDWR (YD_PGSD_VV_PHV)
    PGSD_VV_PZ0H => GET_HOST_DATA_RDWR (YD_PGSD_VV_PZ0H)
    PSAV_DDAL => GET_HOST_DATA_RDWR (YD_PSAV_DDAL)
    PSAV_DDOM => GET_HOST_DATA_RDWR (YD_PSAV_DDOM)
    PSAV_ENTCH => GET_HOST_DATA_RDWR (YD_PSAV_ENTCH)
    PSAV_FHPS => GET_HOST_DATA_RDWR (YD_PSAV_FHPS)
    PSAV_GZ0F => GET_HOST_DATA_RDWR (YD_PSAV_GZ0F)
    PSAV_GZ0HF => GET_HOST_DATA_RDWR (YD_PSAV_GZ0HF)
    PSAV_HV => GET_HOST_DATA_RDWR (YD_PSAV_HV)
    PSAV_PBLH => GET_HOST_DATA_RDWR (YD_PSAV_PBLH)
    PSAV_QSH => GET_HOST_DATA_RDWR (YD_PSAV_QSH)
    PSAV_UDAL => GET_HOST_DATA_RDWR (YD_PSAV_UDAL)
    PSAV_UDGRO => GET_HOST_DATA_RDWR (YD_PSAV_UDGRO)
    PSAV_UDOM => GET_HOST_DATA_RDWR (YD_PSAV_UDOM)
    PSAV_UNEBH => GET_HOST_DATA_RDWR (YD_PSAV_UNEBH)
    PUAL_T0 => GET_HOST_DATA_RDWR (YD_PUAL_T0)
    PUEN_T0 => GET_HOST_DATA_RDWR (YD_PUEN_T0)
    PUNEBH_T0 => GET_HOST_DATA_RDWR (YD_PUNEBH_T0)
    PUOM_T0 => GET_HOST_DATA_RDWR (YD_PUOM_T0)
    IF (LHOOK) CALL DR_HOOK ('MF_PHYS_SAVE_PHSURF_PART1_PARALLEL&
    &:PART1:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('MF_PHYS_SAVE_PHSURF_PART1_PARALLEL&
  &:PART1:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  PDAL_T0 => NULL ()
  PDOM_T0 => NULL ()
  PGSD_VF_PZ0F => NULL ()
  PGSD_VH_PPBLH => NULL ()
  PGSD_VH_PQSH => NULL ()
  PGSD_VH_PSPSH => NULL ()
  PGSD_VK_PUDGRO => NULL ()
  PGSD_VV_PHV => NULL ()
  PGSD_VV_PZ0H => NULL ()
  PSAV_DDAL => NULL ()
  PSAV_DDOM => NULL ()
  PSAV_ENTCH => NULL ()
  PSAV_FHPS => NULL ()
  PSAV_GZ0F => NULL ()
  PSAV_GZ0HF => NULL ()
  PSAV_HV => NULL ()
  PSAV_PBLH => NULL ()
  PSAV_QSH => NULL ()
  PSAV_UDAL => NULL ()
  PSAV_UDGRO => NULL ()
  PSAV_UDOM => NULL ()
  PSAV_UNEBH => NULL ()
  PUAL_T0 => NULL ()
  PUEN_T0 => NULL ()
  PUNEBH_T0 => NULL ()
  PUOM_T0 => NULL ()
  IF (LHOOK) CALL DR_HOOK ('MF_PHYS_SAVE_PHSURF_PART1_PARALLEL&
  &:PART1:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN&
  &','MF_PHYS_SAVE_PHSURF_PART1_PARALLEL:PART1')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('MF_PHYS_SAVE_PHSURF_PART1_PARALLEL&
  &:PART1:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  PDAL_T0 => GET_DEVICE_DATA_RDONLY (YD_PDAL_T0)
  PDOM_T0 => GET_DEVICE_DATA_RDONLY (YD_PDOM_T0)
  PGSD_VF_PZ0F => GET_DEVICE_DATA_RDONLY (YD_PGSD_VF_PZ0F)
  PGSD_VH_PPBLH => GET_DEVICE_DATA_RDONLY (YD_PGSD_VH_PPBLH)
  PGSD_VH_PQSH => GET_DEVICE_DATA_RDONLY (YD_PGSD_VH_PQSH)
  PGSD_VH_PSPSH => GET_DEVICE_DATA_RDONLY (YD_PGSD_VH_PSPSH)
  PGSD_VK_PUDGRO => GET_DEVICE_DATA_RDONLY (YD_PGSD_VK_PUDGRO)
  PGSD_VV_PHV => GET_DEVICE_DATA_RDONLY (YD_PGSD_VV_PHV)
  PGSD_VV_PZ0H => GET_DEVICE_DATA_RDONLY (YD_PGSD_VV_PZ0H)
  PSAV_DDAL => GET_DEVICE_DATA_RDWR (YD_PSAV_DDAL)
  PSAV_DDOM => GET_DEVICE_DATA_RDWR (YD_PSAV_DDOM)
  PSAV_ENTCH => GET_DEVICE_DATA_RDWR (YD_PSAV_ENTCH)
  PSAV_FHPS => GET_DEVICE_DATA_RDWR (YD_PSAV_FHPS)
  PSAV_GZ0F => GET_DEVICE_DATA_RDWR (YD_PSAV_GZ0F)
  PSAV_GZ0HF => GET_DEVICE_DATA_RDWR (YD_PSAV_GZ0HF)
  PSAV_HV => GET_DEVICE_DATA_RDWR (YD_PSAV_HV)
  PSAV_PBLH => GET_DEVICE_DATA_RDWR (YD_PSAV_PBLH)
  PSAV_QSH => GET_DEVICE_DATA_RDWR (YD_PSAV_QSH)
  PSAV_UDAL => GET_DEVICE_DATA_RDWR (YD_PSAV_UDAL)
  PSAV_UDGRO => GET_DEVICE_DATA_RDWR (YD_PSAV_UDGRO)
  PSAV_UDOM => GET_DEVICE_DATA_RDWR (YD_PSAV_UDOM)
  PSAV_UNEBH => GET_DEVICE_DATA_RDWR (YD_PSAV_UNEBH)
  PUAL_T0 => GET_DEVICE_DATA_RDONLY (YD_PUAL_T0)
  PUEN_T0 => GET_DEVICE_DATA_RDONLY (YD_PUEN_T0)
  PUNEBH_T0 => GET_DEVICE_DATA_RDONLY (YD_PUNEBH_T0)
  PUOM_T0 => GET_DEVICE_DATA_RDONLY (YD_PUOM_T0)
  IF (LHOOK) CALL DR_HOOK ('MF_PHYS_SAVE_PHSURF_PART1_PARALLEL&
  &:PART1:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('MF_PHYS_SAVE_PHSURF_PART1_PARALLEL:PART1:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  
    !$ACC PARALLEL LOOP GANG &
    !$ACC&PRESENT (PDAL_T0, PDOM_T0, PGSD_VF_PZ0F, PGSD_VH_PPBLH, PGSD_VH_PQSH, &
    !$ACC&         PGSD_VH_PSPSH, PGSD_VK_PUDGRO, PGSD_VV_PHV, PGSD_VV_PZ0H, PSAV_DDAL, &
    !$ACC&         PSAV_DDOM, PSAV_ENTCH, PSAV_FHPS, PSAV_GZ0F, PSAV_GZ0HF, PSAV_HV, &
    !$ACC&         PSAV_PBLH, PSAV_QSH, PSAV_UDAL, PSAV_UDGRO, PSAV_UDOM, PSAV_UNEBH, &
    !$ACC&         PUAL_T0, PUEN_T0, PUNEBH_T0, PUOM_T0, YDCPG_OPTS, YDMODEL, YFXTRAN_ACDC_STACK) &
    !$ACC&PRIVATE (JBLK) &
    !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
    
    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    
    
    
    !$ACC LOOP VECTOR &
    !$ACC&PRIVATE (JLON, YLCPG_BNDS) 

    

    DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JLON
      YLCPG_BNDS%KFDIA = JLON

      

      IF (YDCPG_OPTS%YRSURF_OPTS%YSD_VV%YHV%LSET)  THEN
        PSAV_HV (JLON, JBLK)=PGSD_VV_PHV (JLON, JBLK)
      ENDIF


      IF (YDCPG_OPTS%YRSURF_OPTS%YSD_VF%YZ0F%LSET)  THEN
        PSAV_GZ0F (JLON, JBLK)=PGSD_VF_PZ0F (JLON, JBLK)
      ENDIF


      IF (YDCPG_OPTS%YRSURF_OPTS%YSD_VV%YZ0H%LSET)  THEN
        PSAV_GZ0HF (JLON, JBLK)=PGSD_VV_PZ0H (JLON, JBLK)
      ENDIF


      IF (YDCPG_OPTS%YRSURF_OPTS%YSD_VH%YPBLH%LSET)  THEN
        PSAV_PBLH (JLON, JBLK)=PGSD_VH_PPBLH (JLON, JBLK)
      ENDIF


      IF (YDCPG_OPTS%YRSURF_OPTS%YSD_VH%YSPSH%LSET)  THEN
        PSAV_FHPS (JLON, JBLK)=PGSD_VH_PSPSH (JLON, JBLK)
      ENDIF


      IF (YDCPG_OPTS%YRSURF_OPTS%YSD_VH%YQSH%LSET)  THEN
        PSAV_QSH (JLON, JBLK)=PGSD_VH_PQSH (JLON, JBLK)
      ENDIF


      IF (YDCPG_OPTS%YRSURF_OPTS%YSD_VK%YUDGRO%LSET)  THEN
        PSAV_UDGRO (JLON, JBLK)=PGSD_VK_PUDGRO (JLON, JBLK)
      ENDIF


      IF (YDMODEL%YRML_PHY_MF%YRPHY%LCVPRO.OR.YDMODEL%YRML_PHY_MF%YRPHY%LGPCMT) THEN
        CALL FXTRAN_ACDC_ARRAY_COPY (JLON, PSAV_UDAL (:,:, JBLK), PUAL_T0 (:,:, JBLK))
        CALL FXTRAN_ACDC_ARRAY_COPY (JLON, PSAV_UDOM (:,:, JBLK), PUOM_T0 (:,:, JBLK))

        IF (YDMODEL%YRML_PHY_MF%YRPHY%LCDDPRO) THEN
          CALL FXTRAN_ACDC_ARRAY_COPY (JLON, PSAV_DDAL (:,:, JBLK), PDAL_T0 (:,:, JBLK))
          CALL FXTRAN_ACDC_ARRAY_COPY (JLON, PSAV_DDOM (:,:, JBLK), PDOM_T0 (:,:, JBLK))
        ENDIF

      ENDIF


      IF (YDMODEL%YRML_GCONF%YGFL%YUNEBH%LACTIVE)  THEN
        CALL FXTRAN_ACDC_ARRAY_COPY (JLON, PSAV_UNEBH (:,:, JBLK), PUNEBH_T0 (:,:, JBLK))
      ENDIF


      IF (YDMODEL%YRML_GCONF%YGFL%YUEN%LACTIVE)  THEN
        CALL FXTRAN_ACDC_ARRAY_COPY (JLON, PSAV_ENTCH (:,:, JBLK), PUEN_T0 (:,:, JBLK))
      ENDIF

    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('MF_PHYS_SAVE_PHSURF_PART1_PARALLEL:PART1:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

  IF (FXTRAN_ACDC_LSYNCHOST ('MF_PHYS_SAVE_PHSURF_PART1_PARALLEL:PART1')) THEN
    IF (LHOOK) CALL DR_HOOK ('MF_PHYS_SAVE_PHSURF_PART1_PARALLEL&
    &:PART1:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
    PDAL_T0 => GET_HOST_DATA_RDWR (YD_PDAL_T0)
    PDOM_T0 => GET_HOST_DATA_RDWR (YD_PDOM_T0)
    PGSD_VF_PZ0F => GET_HOST_DATA_RDWR (YD_PGSD_VF_PZ0F)
    PGSD_VH_PPBLH => GET_HOST_DATA_RDWR (YD_PGSD_VH_PPBLH)
    PGSD_VH_PQSH => GET_HOST_DATA_RDWR (YD_PGSD_VH_PQSH)
    PGSD_VH_PSPSH => GET_HOST_DATA_RDWR (YD_PGSD_VH_PSPSH)
    PGSD_VK_PUDGRO => GET_HOST_DATA_RDWR (YD_PGSD_VK_PUDGRO)
    PGSD_VV_PHV => GET_HOST_DATA_RDWR (YD_PGSD_VV_PHV)
    PGSD_VV_PZ0H => GET_HOST_DATA_RDWR (YD_PGSD_VV_PZ0H)
    PSAV_DDAL => GET_HOST_DATA_RDWR (YD_PSAV_DDAL)
    PSAV_DDOM => GET_HOST_DATA_RDWR (YD_PSAV_DDOM)
    PSAV_ENTCH => GET_HOST_DATA_RDWR (YD_PSAV_ENTCH)
    PSAV_FHPS => GET_HOST_DATA_RDWR (YD_PSAV_FHPS)
    PSAV_GZ0F => GET_HOST_DATA_RDWR (YD_PSAV_GZ0F)
    PSAV_GZ0HF => GET_HOST_DATA_RDWR (YD_PSAV_GZ0HF)
    PSAV_HV => GET_HOST_DATA_RDWR (YD_PSAV_HV)
    PSAV_PBLH => GET_HOST_DATA_RDWR (YD_PSAV_PBLH)
    PSAV_QSH => GET_HOST_DATA_RDWR (YD_PSAV_QSH)
    PSAV_UDAL => GET_HOST_DATA_RDWR (YD_PSAV_UDAL)
    PSAV_UDGRO => GET_HOST_DATA_RDWR (YD_PSAV_UDGRO)
    PSAV_UDOM => GET_HOST_DATA_RDWR (YD_PSAV_UDOM)
    PSAV_UNEBH => GET_HOST_DATA_RDWR (YD_PSAV_UNEBH)
    PUAL_T0 => GET_HOST_DATA_RDWR (YD_PUAL_T0)
    PUEN_T0 => GET_HOST_DATA_RDWR (YD_PUEN_T0)
    PUNEBH_T0 => GET_HOST_DATA_RDWR (YD_PUNEBH_T0)
    PUOM_T0 => GET_HOST_DATA_RDWR (YD_PUOM_T0)
    IF (LHOOK) CALL DR_HOOK ('MF_PHYS_SAVE_PHSURF_PART1_PARALLEL&
    &:PART1:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('MF_PHYS_SAVE_PHSURF_PART1_PARALLEL&
  &:PART1:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  PDAL_T0 => NULL ()
  PDOM_T0 => NULL ()
  PGSD_VF_PZ0F => NULL ()
  PGSD_VH_PPBLH => NULL ()
  PGSD_VH_PQSH => NULL ()
  PGSD_VH_PSPSH => NULL ()
  PGSD_VK_PUDGRO => NULL ()
  PGSD_VV_PHV => NULL ()
  PGSD_VV_PZ0H => NULL ()
  PSAV_DDAL => NULL ()
  PSAV_DDOM => NULL ()
  PSAV_ENTCH => NULL ()
  PSAV_FHPS => NULL ()
  PSAV_GZ0F => NULL ()
  PSAV_GZ0HF => NULL ()
  PSAV_HV => NULL ()
  PSAV_PBLH => NULL ()
  PSAV_QSH => NULL ()
  PSAV_UDAL => NULL ()
  PSAV_UDGRO => NULL ()
  PSAV_UDOM => NULL ()
  PSAV_UNEBH => NULL ()
  PUAL_T0 => NULL ()
  PUEN_T0 => NULL ()
  PUNEBH_T0 => NULL ()
  PUOM_T0 => NULL ()
  IF (LHOOK) CALL DR_HOOK ('MF_PHYS_SAVE_PHSURF_PART1_PARALLEL&
  &:PART1:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSE
    CALL ABOR1 ('MF_PHYS_SAVE_PHSURF_PART1_PARALLEL: NOT METHOD WAS FOUND')
ENDIF

IF (LHOOK) CALL DR_HOOK ('MF_PHYS_SAVE_PHSURF_PART1_PARALLEL:PART1',1,ZHOOK_HANDLE_PARALLEL)



CALL FXTRAN_ACDC_GPUMEMSTAT (__FILE__, __LINE__, "END")

IF (LHOOK) CALL DR_HOOK ('DELETE_TEMPORARIES',0,ZHOOK_HANDLE_FIELD_API)
IF (LHOOK) CALL DR_HOOK ('DELETE_TEMPORARIES',1,ZHOOK_HANDLE_FIELD_API)
IF (LHOOK) CALL DR_HOOK ('MF_PHYS_SAVE_PHSURF_PART1_PARALLEL', 1, ZHOOK_HANDLE)
END SUBROUTINE MF_PHYS_SAVE_PHSURF_PART1_PARALLEL
