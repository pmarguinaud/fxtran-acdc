
MODULE MODE_COMPUTE_MF_CLOUD_DIRECT_OPENACC


IMPLICIT NONE


CONTAINS
SUBROUTINE COMPUTE_MF_CLOUD_DIRECT_OPENACC (D, PARAMMF, KKLCL,&
& PFRAC_UP, PRC_UP, PRI_UP, PRC_MF, PRI_MF, PCF_MF, YDSTACK)
!$ACC ROUTINE (COMPUTE_MF_CLOUD_DIRECT_OPENACC) SEQ
USE MODD_DIMPHYEX,ONLY:DIMPHYEX_T
USE MODD_PARAM_MFSHALL_N,ONLY:PARAM_MFSHALL_T

#include "fxtran_acdc_stack.h"
USE FXTRAN_ACDC_STACK_MOD
USE FXTRAN_ACDC_ABORT_MOD

IMPLICIT NONE

TYPE (DIMPHYEX_T), INTENT (IN)::D
TYPE (PARAM_MFSHALL_T), INTENT (IN)::PARAMMF
INTEGER, INTENT (IN)::KKLCL(D%NIJT)
REAL, INTENT (IN)::PFRAC_UP(D%NIJT, D%NKT)
REAL, INTENT (IN)::PRI_UP(D%NIJT, D%NKT)
REAL, INTENT (IN)::PRC_UP(D%NIJT, D%NKT)
REAL, INTENT (OUT)::PRI_MF(D%NIJT, D%NKT)
REAL, INTENT (OUT)::PRC_MF(D%NIJT, D%NKT)
REAL, INTENT (OUT)::PCF_MF(D%NIJT, D%NKT)
TYPE(FXTRAN_ACDC_STACK), INTENT (IN) :: YDSTACK

INTEGER::IIJE
INTEGER::IIJB
INTEGER::IKL
INTEGER::IKE
INTEGER::IKB
INTEGER::JK0
INTEGER::JK
INTEGER::JI

JI = D%NIB


IKB=D%NKB
IKE=D%NKE
IKL=D%NKL
IIJB=D%NIJB
IIJE=D%NIJE
PRC_MF (JI,:)=0.
PRI_MF (JI,:)=0.
PCF_MF (JI,:)=0.

JK0=KKLCL (JI)-IKL
JK0=MAX (JK0, MIN (IKB, IKE))
JK0=MIN (JK0, MAX (IKB, IKE))

DO JK=JK0, IKE-IKL, IKL
  PCF_MF (JI, JK)=MAX (0., MIN (1., PARAMMF%XKCF_MF*0.5*(PFRAC_UP (JI, JK)+PFRAC_UP (JI, JK+IKL))))
  PRC_MF (JI, JK)=0.5*PARAMMF%XKCF_MF*(PFRAC_UP (JI, JK)*PRC_UP&
  & (JI, JK)+PFRAC_UP (JI, JK+IKL)*PRC_UP (JI, JK+IKL))
  PRI_MF (JI, JK)=0.5*PARAMMF%XKCF_MF*(PFRAC_UP (JI, JK)*PRI_UP&
  & (JI, JK)+PFRAC_UP (JI, JK+IKL)*PRI_UP (JI, JK+IKL))
ENDDO



END SUBROUTINE COMPUTE_MF_CLOUD_DIRECT_OPENACC

ENDMODULE MODE_COMPUTE_MF_CLOUD_DIRECT_OPENACC
