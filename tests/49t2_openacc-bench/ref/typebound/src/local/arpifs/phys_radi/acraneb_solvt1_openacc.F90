
SUBROUTINE ACRANEB_SOLVT1_OPENACC (LDNUMX, KIDIA, KFDIA, KLON, KTDIA, KLEV, PEMIS, PNEB&
&, PB1, PB2, PB3, PB4, PA4C, PA5C, PA4N, PA5N, PFDC, PFMC, PFDN, PFMN, YDSTACK)
!$ACC ROUTINE (ACRANEB_SOLVT1_OPENACC) SEQ
USE PARKIND1,ONLY:JPIM, JPRB

#include "fxtran_acdc_stack.h"
USE FXTRAN_ACDC_STACK_MOD
USE FXTRAN_ACDC_ABORT_MOD

IMPLICIT NONE


LOGICAL, INTENT (IN)::LDNUMX
INTEGER (KIND=JPIM), INTENT (IN)::KLON
INTEGER (KIND=JPIM), INTENT (IN)::KLEV
INTEGER (KIND=JPIM), INTENT (IN)::KIDIA
INTEGER (KIND=JPIM), INTENT (IN)::KFDIA
INTEGER (KIND=JPIM), INTENT (IN)::KTDIA
REAL (KIND=JPRB), INTENT (IN)::PEMIS (KLON)
REAL (KIND=JPRB), INTENT (IN)::PNEB (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PB1 (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PB2 (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PB3 (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PB4 (KLON, KLEV)
REAL (KIND=JPRB), INTENT (INOUT)::PA4C (KLON, KLEV)
REAL (KIND=JPRB), INTENT (INOUT)::PA5C (KLON, KLEV)
REAL (KIND=JPRB), INTENT (INOUT)::PA4N (KLON, KLEV)
REAL (KIND=JPRB), INTENT (INOUT)::PA5N (KLON, KLEV)
REAL (KIND=JPRB), INTENT (INOUT)::PFDC (KLON, 0:KLEV)
REAL (KIND=JPRB), INTENT (INOUT)::PFMC (KLON, 0:KLEV)
REAL (KIND=JPRB), INTENT (INOUT)::PFDN (KLON, 0:KLEV)
REAL (KIND=JPRB), INTENT (INOUT)::PFMN (KLON, 0:KLEV)
TYPE(FXTRAN_ACDC_STACK), INTENT (IN) :: YDSTACK
TYPE(FXTRAN_ACDC_STACK) :: YLSTACK
REAL (KIND=JPRB)::ZTUS1
REAL (KIND=JPRB)::ZTDS3
REAL (KIND=JPRB)::ZTDS2
REAL (KIND=JPRB)::ZTDS1
REAL (KIND=JPRB)::ZTD7
REAL (KIND=JPRB)::ZTD6
REAL (KIND=JPRB)::ZTD5
REAL (KIND=JPRB)::ZTD4
REAL (KIND=JPRB)::ZTD3
REAL (KIND=JPRB)::ZTD2
REAL (KIND=JPRB)::ZTD1
REAL (KIND=JPRB)::ZAL
REAL (KIND=JPRB)::ZGA2 
REAL (KIND=JPRB)::ZGA1 
REAL (KIND=JPRB)::ZDE2 
REAL (KIND=JPRB)::ZDE1 
REAL (KIND=JPRB)::ZBE2 
REAL (KIND=JPRB)::ZBE1 
REAL (KIND=JPRB)::ZAL2 
REAL (KIND=JPRB)::ZAL1 
fxtran_acdc_temp (REAL (KIND=JPRB), ZTU9, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZTU8, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZTU7, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZTU6, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZTU5, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZTU4, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZTU3, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZTU2, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZTU1, (KLON, KLEV))
INTEGER (KIND=JPIM)::JLON
INTEGER (KIND=JPIM)::JLEV


YLSTACK = YDSTACK



IF (KIND (ZTU9) == 8) THEN
    fxtran_acdc_alloc8 (ZTU9)
ELSEIF (KIND (ZTU9) == 4) THEN
    fxtran_acdc_alloc4 (ZTU9)
ELSE
    STOP 1
ENDIF


IF (KIND (ZTU8) == 8) THEN
    fxtran_acdc_alloc8 (ZTU8)
ELSEIF (KIND (ZTU8) == 4) THEN
    fxtran_acdc_alloc4 (ZTU8)
ELSE
    STOP 1
ENDIF


IF (KIND (ZTU7) == 8) THEN
    fxtran_acdc_alloc8 (ZTU7)
ELSEIF (KIND (ZTU7) == 4) THEN
    fxtran_acdc_alloc4 (ZTU7)
ELSE
    STOP 1
ENDIF


IF (KIND (ZTU6) == 8) THEN
    fxtran_acdc_alloc8 (ZTU6)
ELSEIF (KIND (ZTU6) == 4) THEN
    fxtran_acdc_alloc4 (ZTU6)
ELSE
    STOP 1
ENDIF


IF (KIND (ZTU5) == 8) THEN
    fxtran_acdc_alloc8 (ZTU5)
ELSEIF (KIND (ZTU5) == 4) THEN
    fxtran_acdc_alloc4 (ZTU5)
ELSE
    STOP 1
ENDIF


IF (KIND (ZTU4) == 8) THEN
    fxtran_acdc_alloc8 (ZTU4)
ELSEIF (KIND (ZTU4) == 4) THEN
    fxtran_acdc_alloc4 (ZTU4)
ELSE
    STOP 1
ENDIF


IF (KIND (ZTU3) == 8) THEN
    fxtran_acdc_alloc8 (ZTU3)
ELSEIF (KIND (ZTU3) == 4) THEN
    fxtran_acdc_alloc4 (ZTU3)
ELSE
    STOP 1
ENDIF


IF (KIND (ZTU2) == 8) THEN
    fxtran_acdc_alloc8 (ZTU2)
ELSEIF (KIND (ZTU2) == 4) THEN
    fxtran_acdc_alloc4 (ZTU2)
ELSE
    STOP 1
ENDIF


IF (KIND (ZTU1) == 8) THEN
    fxtran_acdc_alloc8 (ZTU1)
ELSEIF (KIND (ZTU1) == 4) THEN
    fxtran_acdc_alloc4 (ZTU1)
ELSE
    STOP 1
ENDIF


JLON = KIDIA




IF (LDNUMX) THEN
  ZAL1 =PB2 (JLON, KTDIA)
  ZAL2 =PB1 (JLON, KTDIA)
  ZBE1 =1._JPRB-PB2 (JLON, KTDIA)
  ZBE2 =1._JPRB-PB1 (JLON, KTDIA)
  ZGA1 =1._JPRB-PB4 (JLON, KTDIA)
  ZGA2 =1._JPRB-PB3 (JLON, KTDIA)
  ZDE1 =PB4 (JLON, KTDIA)
  ZDE2 =PB3 (JLON, KTDIA)
ELSE
  PA4C (JLON, KTDIA)=PA4C (JLON, KTDIA)*PB1 (JLON, KTDIA)+PA4N (JLON, KTDIA)*PNEB (JLON, KTDIA)
  PA5C (JLON, KTDIA)=PA5C (JLON, KTDIA)*PB1 (JLON, KTDIA)+PA5N (JLON, KTDIA)*PNEB (JLON, KTDIA)
ENDIF




IF (LDNUMX) THEN
  PFMC (JLON, KTDIA-1)=PA5C (JLON, KTDIA)*(ZAL2 *PFDC (JLON, KTDIA-1))+PFMC (JLON, KTDIA-1)
  PFDC (JLON, KTDIA)=PA4C (JLON, KTDIA)*(ZAL2 *PFDC (JLON, KTDIA-1))+PFDC (JLON, KTDIA)
  PFMN (JLON, KTDIA-1)=PA5N (JLON, KTDIA)*(ZBE2 *PFDC (JLON, KTDIA-1))+PFMN (JLON, KTDIA-1)
  PFDN (JLON, KTDIA)=PA4N (JLON, KTDIA)*(ZBE2 *PFDC (JLON, KTDIA-1))+PFDN (JLON, KTDIA)
  ZTU1 (JLON, KTDIA)=0._JPRB
  ZTU2 (JLON, KTDIA)=ZAL1 *PA4C (JLON, KTDIA)
  ZTU3 (JLON, KTDIA)=ZGA1 *PA4C (JLON, KTDIA)
  ZTU4 (JLON, KTDIA)=ZBE1 *PA4N (JLON, KTDIA)
  ZTU5 (JLON, KTDIA)=ZDE1 *PA4N (JLON, KTDIA)
  ZTU6 (JLON, KTDIA)=ZAL1 *PA5C (JLON, KTDIA)
  ZTU7 (JLON, KTDIA)=ZGA1 *PA5C (JLON, KTDIA)
  ZTU8 (JLON, KTDIA)=ZBE1 *PA5N (JLON, KTDIA)
  ZTU9 (JLON, KTDIA)=ZDE1 *PA5N (JLON, KTDIA)
ELSE
  PFMC (JLON, KTDIA-1)=PA5C (JLON, KTDIA)*PFDC (JLON, KTDIA-1)+PFMC (JLON, KTDIA-1)
  PFDC (JLON, KTDIA)=PA4C (JLON, KTDIA)*PFDC (JLON, KTDIA-1)+PFDC (JLON, KTDIA)
  ZTU2 (JLON, KTDIA)=PA4C (JLON, KTDIA)
  ZTU6 (JLON, KTDIA)=PA5C (JLON, KTDIA)
ENDIF



DO JLEV=KTDIA+1, KLEV

  

  IF (LDNUMX) THEN
    ZAL1 =PB2 (JLON, JLEV)
    ZAL2 =PB1 (JLON, JLEV)
    ZBE1 =1._JPRB-PB2 (JLON, JLEV)
    ZBE2 =1._JPRB-PB1 (JLON, JLEV)
    ZGA1 =1._JPRB-PB4 (JLON, JLEV)
    ZGA2 =1._JPRB-PB3 (JLON, JLEV)
    ZDE1 =PB4 (JLON, JLEV)
    ZDE2 =PB3 (JLON, JLEV)
  ELSE
    PA4C (JLON, JLEV)=PA4C (JLON, JLEV)*PB1 (JLON, JLEV)+PA4N (JLON, JLEV)*PNEB (JLON, JLEV)
    PA5C (JLON, JLEV)=PA5C (JLON, JLEV)*PB1 (JLON, JLEV)+PA5N (JLON, JLEV)*PNEB (JLON, JLEV)
  ENDIF


  

  

  IF (LDNUMX) THEN
    ZTD1=1._JPRB/(1._JPRB-PA5C (JLON, JLEV)*(ZAL2 *ZTU6 (JLON, JLEV-1)+ZGA2 *ZTU8 (JLON, JLEV-1)))
    PFMC (JLON, JLEV-1)=(ZTD1*PA5C (JLON, JLEV))*(ZAL2 *PFDC (JLON,&
    & JLEV-1)+ZGA2 *PFDN (JLON, JLEV-1))+ZTD1*PFMC (JLON, JLEV-1)
    ZTU1 (JLON, JLEV)=(ZTD1*PA5C (JLON, JLEV))*(ZAL2 *ZTU7 (JLON, JLEV-1)+ZGA2 *ZTU9 (JLON, JLEV-1))
    ZTU2 (JLON, JLEV)=(ZTD1*PA4C (JLON, JLEV))*ZAL1 
    ZTU3 (JLON, JLEV)=(ZTD1*PA4C (JLON, JLEV))*ZGA1 
    ZTD2=PA5N (JLON, JLEV)*(ZBE2 *ZTU6 (JLON, JLEV-1)+ZDE2 *ZTU8 (JLON, JLEV-1))
    ZTD3=1._JPRB/(1._JPRB-PA5N (JLON, JLEV)*(ZBE2 *ZTU7 (JLON, JLEV&
    &-1)+ZDE2 *ZTU9 (JLON, JLEV-1))-ZTD2*ZTU1 (JLON, JLEV))
    PFMN (JLON, JLEV-1)=ZTD3*(PA5N (JLON, JLEV)*(ZBE2 *PFDC (JLON, JLEV-1)+ZDE2 &
    &*PFDN (JLON, JLEV-1))+ZTD2*PFMC (JLON, JLEV-1))+ZTD3*PFMN (JLON, JLEV-1)
    ZTU4 (JLON, JLEV)=ZTD3*(PA4N (JLON, JLEV)*ZBE1 +ZTD2*ZTU2 (JLON, JLEV))
    ZTU5 (JLON, JLEV)=ZTD3*(PA4N (JLON, JLEV)*ZDE1 +ZTD2*ZTU3 (JLON, JLEV))
    ZTD4=PA4C (JLON, JLEV)*(ZAL2 *ZTU6 (JLON, JLEV-1)+ZGA2 *ZTU8 (JLON, JLEV-1))
    ZTD5=PA4C (JLON, JLEV)*(ZAL2 *ZTU7 (JLON, JLEV-1)+ZGA2 *ZTU9 (JLON, JLEV-1))
    PFDC (JLON, JLEV)=PA4C (JLON, JLEV)*(ZAL2 *PFDC (JLON, JLEV-1)+ZGA2 *PFDN (JLON,&
    & JLEV-1))+ZTD4*PFMC (JLON, JLEV-1)+ZTD5*PFMN (JLON, JLEV-1)+PFDC (JLON, JLEV)
    ZTU6 (JLON, JLEV)=PA5C (JLON, JLEV)*ZAL1 +ZTD4*ZTU2 (JLON, JLEV)+ZTD5*ZTU4 (JLON, JLEV)
    ZTU7 (JLON, JLEV)=PA5C (JLON, JLEV)*ZGA1 +ZTD4*ZTU3 (JLON, JLEV)+ZTD5*ZTU5 (JLON, JLEV)
    ZTD6=PA4N (JLON, JLEV)*(ZBE2 *ZTU6 (JLON, JLEV-1)+ZDE2 *ZTU8 (JLON, JLEV-1))
    ZTD7=PA4N (JLON, JLEV)*(ZBE2 *ZTU7 (JLON, JLEV-1)+ZDE2 *ZTU9 (JLON, JLEV-1))
    PFDN (JLON, JLEV)=PA4N (JLON, JLEV)*(ZBE2 *PFDC (JLON, JLEV-1)+ZDE2 *PFDN (JLON,&
    & JLEV-1))+ZTD6*PFMC (JLON, JLEV-1)+ZTD7*PFMN (JLON, JLEV-1)+PFDN (JLON, JLEV)
    ZTU8 (JLON, JLEV)=PA5N (JLON, JLEV)*ZBE1 +ZTD6*ZTU2 (JLON, JLEV)+ZTD7*ZTU4 (JLON, JLEV)
    ZTU9 (JLON, JLEV)=PA5N (JLON, JLEV)*ZDE1 +ZTD6*ZTU3 (JLON, JLEV)+ZTD7*ZTU5 (JLON, JLEV)
  ELSE
    ZTD1=1._JPRB/(1._JPRB-PA5C (JLON, JLEV)*ZTU6 (JLON, JLEV-1))
    PFMC (JLON, JLEV-1)=ZTD1*PA5C (JLON, JLEV)*PFDC (JLON, JLEV-1)+ZTD1*PFMC (JLON, JLEV-1)
    ZTU2 (JLON, JLEV)=ZTD1*PA4C (JLON, JLEV)
    ZTD4=PA4C (JLON, JLEV)*ZTU6 (JLON, JLEV-1)
    PFDC (JLON, JLEV)=PA4C (JLON, JLEV)*PFDC (JLON, JLEV-1)+ZTD4*PFMC (JLON, JLEV-1)+PFDC (JLON, JLEV)
    ZTU6 (JLON, JLEV)=PA5C (JLON, JLEV)+ZTD4*ZTU2 (JLON, JLEV)
  ENDIF

  
ENDDO


ZAL=1._JPRB-PEMIS (JLON)

IF (LDNUMX) THEN
  ZTDS1=1._JPRB/(1._JPRB-ZAL*ZTU6 (JLON, KLEV))
  PFMC (JLON, KLEV)=ZTDS1*(ZAL*PFDC (JLON, KLEV)+PFMC (JLON, KLEV))
  ZTUS1=(ZTDS1*ZAL)*ZTU7 (JLON, KLEV)
  ZTDS2=ZAL*ZTU8 (JLON, KLEV)
  ZTDS3=1._JPRB/(1._JPRB-ZAL*ZTU9 (JLON, KLEV)-ZTDS2*ZTUS1)
  PFMN (JLON, KLEV)=ZTDS3*(ZAL*PFDN (JLON, KLEV)+ZTDS2*PFMC (JLON, KLEV)+PFMN (JLON, KLEV))
  PFMC (JLON, KLEV)=PFMC (JLON, KLEV)+ZTUS1*PFMN (JLON, KLEV)
ELSE
  ZTDS1=1._JPRB/(1._JPRB-ZAL*ZTU6 (JLON, KLEV))
  PFMC (JLON, KLEV)=ZTDS1*(ZAL*PFDC (JLON, KLEV)+PFMC (JLON, KLEV))
ENDIF



DO JLEV=KLEV, KTDIA,-1

  

  IF (LDNUMX) THEN
    PFDN (JLON, JLEV)=PFDN (JLON, JLEV)+ZTU8 (JLON, JLEV)*PFMC&
    & (JLON, JLEV)+ZTU9 (JLON, JLEV)*PFMN (JLON, JLEV)
    PFDC (JLON, JLEV)=PFDC (JLON, JLEV)+ZTU6 (JLON, JLEV)*PFMC&
    & (JLON, JLEV)+ZTU7 (JLON, JLEV)*PFMN (JLON, JLEV)
    PFMN (JLON, JLEV-1)=PFMN (JLON, JLEV-1)+ZTU4 (JLON, JLEV)&
    &*PFMC (JLON, JLEV)+ZTU5 (JLON, JLEV)*PFMN (JLON, JLEV)
    PFMC (JLON, JLEV-1)=PFMC (JLON, JLEV-1)+ZTU2 (JLON, JLEV)*PFMC (JLON, JLEV)+ZTU3&
    & (JLON, JLEV)*PFMN (JLON, JLEV)+ZTU1 (JLON, JLEV)*PFMN (JLON, JLEV-1)
  ELSE
    PFDC (JLON, JLEV)=PFDC (JLON, JLEV)+ZTU6 (JLON, JLEV)*PFMC (JLON, JLEV)
    PFMC (JLON, JLEV-1)=PFMC (JLON, JLEV-1)+ZTU2 (JLON, JLEV)*PFMC (JLON, JLEV)
  ENDIF

  
ENDDO


END SUBROUTINE ACRANEB_SOLVT1_OPENACC
