SUBROUTINE LAIDDI_OPENACC (KSLB1, KPROMA, KST, KEND, KFLEV, KFLDN&
&, KFLDX, KQM, PCLA, PDLO, PCLO, KL0, PXSL, PXF, YDSTACK)
!$ACC ROUTINE (LAIDDI_OPENACC) SEQ
USE PARKIND1,ONLY:JPIM, JPRB

#include "fxtran_acdc_stack.h"
USE FXTRAN_ACDC_STACK_MOD
USE FXTRAN_ACDC_ABORT_MOD

IMPLICIT NONE


INTEGER (KIND=JPIM), INTENT (IN)::KSLB1
INTEGER (KIND=JPIM), INTENT (IN)::KPROMA
INTEGER (KIND=JPIM), INTENT (IN)::KFLEV
INTEGER (KIND=JPIM), INTENT (IN)::KFLDN
INTEGER (KIND=JPIM), INTENT (IN)::KFLDX
INTEGER (KIND=JPIM), INTENT (IN)::KST
INTEGER (KIND=JPIM), INTENT (IN)::KEND
INTEGER (KIND=JPIM), INTENT (IN)::KQM
REAL (KIND=JPRB), INTENT (IN)::PCLA (KPROMA, KFLEV, 3)
REAL (KIND=JPRB), INTENT (IN)::PDLO (KPROMA, KFLEV, 0:3)
REAL (KIND=JPRB), INTENT (IN)::PCLO (KPROMA, KFLEV, 3, 2)
INTEGER (KIND=JPIM), INTENT (IN)::KL0 (KPROMA, KFLEV, 0:3)
REAL (KIND=JPRB), INTENT (IN)::PXSL (KSLB1*(KFLDX-KFLDN+1))
REAL (KIND=JPRB), INTENT (OUT)::PXF (KPROMA, KFLEV)
TYPE(FXTRAN_ACDC_STACK), INTENT (IN) :: YDSTACK
INTEGER (KIND=JPIM)::JROF
INTEGER (KIND=JPIM)::JLEV
LOGICAL::LQM
REAL (KIND=JPRB)::Z31
REAL (KIND=JPRB)::Z22
REAL (KIND=JPRB)::Z21
REAL (KIND=JPRB)::Z20
REAL (KIND=JPRB)::Z12
REAL (KIND=JPRB)::Z11
REAL (KIND=JPRB)::Z10
REAL (KIND=JPRB)::Z01
REAL (KIND=JPRB)::ZZ
#include "interp.func.h"


JROF = KST


LQM=KQM==1

DO JLEV=1, KFLEV
  
  Z01=PXSL (KL0 (JROF, JLEV, 0)+1)
  Z01=FDWEIGHT (PDLO (JROF, JLEV, 0), Z01, PXSL (KL0 (JROF, JLEV, 0)+2))
  Z10=PXSL (KL0 (JROF, JLEV, 1))
  Z11=PXSL (KL0 (JROF, JLEV, 1)+1)
  Z12=PXSL (KL0 (JROF, JLEV, 1)+2)
  Z10=FCWEIGHT (PCLO (JROF, JLEV, 1, 1), PCLO (JROF, JLEV, 2, 1), PCLO&
  & (JROF, JLEV, 3, 1), Z10, Z11, Z12, PXSL (KL0 (JROF, JLEV, 1)+3))
  Z20=PXSL (KL0 (JROF, JLEV, 2))
  Z21=PXSL (KL0 (JROF, JLEV, 2)+1)
  Z22=PXSL (KL0 (JROF, JLEV, 2)+2)
  Z20=FCWEIGHT (PCLO (JROF, JLEV, 1, 2), PCLO (JROF, JLEV, 2, 2), PCLO&
  & (JROF, JLEV, 3, 2), Z20, Z21, Z22, PXSL (KL0 (JROF, JLEV, 2)+3))

  IF (LQM) THEN
    Z10=FCLIPHIGH (Z10, Z11, Z12)
    Z10=FCLIPLOW (Z10, Z11, Z12)
    Z20=FCLIPHIGH (Z20, Z21, Z22)
    Z20=FCLIPLOW (Z20, Z21, Z22)
  ENDIF

  Z31=PXSL (KL0 (JROF, JLEV, 3)+1)
  Z31=FDWEIGHT (PDLO (JROF, JLEV, 3), Z31, PXSL (KL0 (JROF, JLEV, 3)+2))
  PXF (JROF, JLEV)=FCWEIGHT (PCLA (JROF, JLEV, 1), PCLA (JROF&
  &, JLEV, 2), PCLA (JROF, JLEV, 3), Z01, Z10, Z20, Z31)

  IF (LQM) THEN
    ZZ=FCLIPHIGH (PXF (JROF, JLEV), Z10, Z20)
    PXF (JROF, JLEV)=FCLIPLOW (ZZ, Z10, Z20)
  ENDIF

  
ENDDO


END SUBROUTINE LAIDDI_OPENACC
