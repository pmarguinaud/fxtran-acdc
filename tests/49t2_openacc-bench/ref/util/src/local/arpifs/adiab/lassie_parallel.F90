SUBROUTINE LASSIE_PARALLEL (YDCST, YDGEOMETRY, YDVARS, YDCPG_BNDS, YDCPG_OPTS, YDDYN, YDDYNA, YD_PRCORI&
&, YD_PSDIV0, YD_PSDIV9, YD_PTOD0, YD_PTOD9, YD_PGAGT0L, YD_PGAGT0M, YD_PGAGT9L, YD_PGAGT9M)
USE GEOMETRY_MOD,ONLY:GEOMETRY

USE YOMHOOK,ONLY:DR_HOOK, JPHOOK, LHOOK
USE YOMCST,ONLY:TCST
USE YOMDYN,ONLY:TDYN
USE YOMDYNA,ONLY:TDYNA
USE FIELD_VARIABLES_MOD,ONLY:FIELD_VARIABLES
USE CPG_OPTS_TYPE_MOD,ONLY:CPG_BNDS_TYPE, CPG_OPTS_TYPE
USE FIELD_MODULE
USE FIELD_FACTORY_MODULE
USE FIELD_ACCESS_MODULE
USE FXTRAN_ACDC_PARALLELMETHOD_MOD
USE FXTRAN_ACDC_STACK_MOD
USE PARKIND1
USE FXTRAN_ACDC_ARRAY_COPY_MOD
USE FXTRAN_ACDC_GPUMEM_MOD
#include "fxtran_acdc_stack.h"

IMPLICIT NONE


TYPE (TCST), INTENT (IN)::YDCST
TYPE (GEOMETRY), INTENT (IN)::YDGEOMETRY
TYPE (FIELD_VARIABLES), INTENT (INOUT)::YDVARS
TYPE (CPG_BNDS_TYPE), INTENT (IN)::YDCPG_BNDS
TYPE (CPG_OPTS_TYPE), INTENT (IN)::YDCPG_OPTS
TYPE (TDYN), INTENT (IN)::YDDYN
TYPE (TDYNA), INTENT (IN)::YDDYNA
CLASS (FIELD_2RB), POINTER :: YD_PRCORI
REAL (KIND=JPRB), POINTER::PRCORI (:,:)
CLASS (FIELD_2RB), POINTER :: YD_PSDIV0
REAL (KIND=JPRB), POINTER::PSDIV0 (:,:)
CLASS (FIELD_2RB), POINTER :: YD_PSDIV9
REAL (KIND=JPRB), POINTER::PSDIV9 (:,:)
CLASS (FIELD_3RB), POINTER :: YD_PTOD0
REAL (KIND=JPRB), POINTER::PTOD0 (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PTOD9
REAL (KIND=JPRB), POINTER::PTOD9 (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PGAGT0L
REAL (KIND=JPRB), POINTER::PGAGT0L (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PGAGT0M
REAL (KIND=JPRB), POINTER::PGAGT0M (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PGAGT9L
REAL (KIND=JPRB), POINTER::PGAGT9L (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PGAGT9M
REAL (KIND=JPRB), POINTER::PGAGT9M (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZR9
REAL (KIND=JPRB), POINTER::ZR9 (:,:,:)
INTEGER (KIND=JPIM)::JROF
INTEGER (KIND=JPIM)::JLEV
REAL (KIND=JPHOOK)::ZHOOK_HANDLE
#include "gprcp_expl_parallel.intfb.h"
#include "abor1.intfb.h"
#include "sigam_gp.intfb.h"
#include "sigam_gp_openacc.intfb.h"
#include "sitnu_gp.intfb.h"
#include "sitnu_gp_openacc.intfb.h"
INTEGER(KIND=JPIM) :: JBLK
TYPE(CPG_BNDS_TYPE) :: YLCPG_BNDS
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_FIELD_API
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_PARALLEL
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_COMPUTE
TYPE(FXTRAN_ACDC_STACK) :: YLSTACK
TYPE(FXTRAN_ACDC_STACK) :: YLOFFSET
REAL(KIND=JPRB), POINTER :: Z_YDVARS_DIV_T0(:,:,:)
REAL(KIND=JPRB), POINTER :: Z_YDVARS_SP_DL(:,:)
REAL(KIND=JPRB), POINTER :: Z_YDVARS_SP_DM(:,:)
REAL(KIND=JPRB), POINTER :: Z_YDVARS_T_DL(:,:,:)
REAL(KIND=JPRB), POINTER :: Z_YDVARS_T_DM(:,:,:)
IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL', 0, ZHOOK_HANDLE)

CALL FXTRAN_ACDC_GPUMEMSTAT (__FILE__, __LINE__, "BEGIN")


IF (LHOOK) CALL DR_HOOK ('CREATE_TEMPORARIES',0,ZHOOK_HANDLE_FIELD_API)
CALL FIELD_NEW (YL_ZR9, UBOUNDS=[YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG&
&, YDCPG_OPTS%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
IF (LHOOK) CALL DR_HOOK ('CREATE_TEMPORARIES',1,ZHOOK_HANDLE_FIELD_API)


IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:SITNU',0,ZHOOK_HANDLE_PARALLEL)

IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','LASSIE_PARALLEL:SITNU')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:SITNU:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  PGAGT0L => GET_HOST_DATA_RDWR (YD_PGAGT0L)
  PGAGT0M => GET_HOST_DATA_RDWR (YD_PGAGT0M)
  PSDIV0 => GET_HOST_DATA_RDWR (YD_PSDIV0)
  PTOD0 => GET_HOST_DATA_RDWR (YD_PTOD0)
  Z_YDVARS_DIV_T0 => GET_HOST_DATA_RDONLY (YDVARS%DIV%FT0)
  Z_YDVARS_SP_DL => GET_HOST_DATA_RDONLY (YDVARS%SP%FDL)
  Z_YDVARS_SP_DM => GET_HOST_DATA_RDONLY (YDVARS%SP%FDM)
  Z_YDVARS_T_DL => GET_HOST_DATA_RDONLY (YDVARS%T%FDL)
  Z_YDVARS_T_DM => GET_HOST_DATA_RDONLY (YDVARS%T%FDM)
  IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:SITNU:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:SITNU:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
  !$OMP PARALLEL DO PRIVATE (JBLK) FIRSTPRIVATE (YLCPG_BNDS)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    CALL YLCPG_BNDS%UPDATE (JBLK)
    
    CALL SITNU_GP (YDCST, YDGEOMETRY, YDDYN, YDCPG_OPTS%KLON, YDGEOMETRY%YRDIMV%NFLEVG, YLCPG_BNDS&
    &%KIDIA, YLCPG_BNDS%KFDIA, Z_YDVARS_DIV_T0(:,:, JBLK), PTOD0(:,:, JBLK), PSDIV0(:, JBLK))
    CALL SIGAM_GP (YDCST, YDGEOMETRY, YDDYN, YDCPG_OPTS%KLON, YDGEOMETRY%YRDIMV%NFLEVG, YLCPG_BNDS%KIDIA&
    &, YLCPG_BNDS%KFDIA, PGAGT0L(:,:, JBLK), Z_YDVARS_T_DL(:,:, JBLK), Z_YDVARS_SP_DL(:, JBLK))
    CALL SIGAM_GP (YDCST, YDGEOMETRY, YDDYN, YDCPG_OPTS%KLON, YDGEOMETRY%YRDIMV%NFLEVG, YLCPG_BNDS%KIDIA&
    &, YLCPG_BNDS%KFDIA, PGAGT0M(:,:, JBLK), Z_YDVARS_T_DM(:,:, JBLK), Z_YDVARS_SP_DM(:, JBLK))
  ENDDO

  IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:SITNU:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

  IF (FXTRAN_ACDC_LSYNCHOST ('LASSIE_PARALLEL:SITNU')) THEN
    IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:SITNU:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
    PGAGT0L => GET_HOST_DATA_RDWR (YD_PGAGT0L)
    PGAGT0M => GET_HOST_DATA_RDWR (YD_PGAGT0M)
    PSDIV0 => GET_HOST_DATA_RDWR (YD_PSDIV0)
    PTOD0 => GET_HOST_DATA_RDWR (YD_PTOD0)
    Z_YDVARS_DIV_T0 => GET_HOST_DATA_RDWR (YDVARS%DIV%FT0)
    Z_YDVARS_SP_DL => GET_HOST_DATA_RDWR (YDVARS%SP%FDL)
    Z_YDVARS_SP_DM => GET_HOST_DATA_RDWR (YDVARS%SP%FDM)
    Z_YDVARS_T_DL => GET_HOST_DATA_RDWR (YDVARS%T%FDL)
    Z_YDVARS_T_DM => GET_HOST_DATA_RDWR (YDVARS%T%FDM)
    IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:SITNU:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:SITNU:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  PGAGT0L => NULL ()
  PGAGT0M => NULL ()
  PSDIV0 => NULL ()
  PTOD0 => NULL ()
  Z_YDVARS_DIV_T0 => NULL ()
  Z_YDVARS_SP_DL => NULL ()
  Z_YDVARS_SP_DM => NULL ()
  Z_YDVARS_T_DL => NULL ()
  Z_YDVARS_T_DM => NULL ()
  IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:SITNU:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMPSINGLECOLUMN','LASSIE_PARALLEL:SITNU')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:SITNU:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  PGAGT0L => GET_HOST_DATA_RDWR (YD_PGAGT0L)
  PGAGT0M => GET_HOST_DATA_RDWR (YD_PGAGT0M)
  PSDIV0 => GET_HOST_DATA_RDWR (YD_PSDIV0)
  PTOD0 => GET_HOST_DATA_RDWR (YD_PTOD0)
  Z_YDVARS_DIV_T0 => GET_HOST_DATA_RDONLY (YDVARS%DIV%FT0)
  Z_YDVARS_SP_DL => GET_HOST_DATA_RDONLY (YDVARS%SP%FDL)
  Z_YDVARS_SP_DM => GET_HOST_DATA_RDONLY (YDVARS%SP%FDM)
  Z_YDVARS_T_DL => GET_HOST_DATA_RDONLY (YDVARS%T%FDL)
  Z_YDVARS_T_DM => GET_HOST_DATA_RDONLY (YDVARS%T%FDM)
  IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:SITNU:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:SITNU:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  !$OMP PARALLEL DO PRIVATE (JBLK, JROF, YLCPG_BNDS, YLSTACK)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX

    

    

    DO JROF = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JROF
      YLCPG_BNDS%KFDIA = JROF
      YLSTACK%L8 = fxtran_acdc_stack_l8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%U8 = fxtran_acdc_stack_u8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%L4 = fxtran_acdc_stack_l4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%U4 = fxtran_acdc_stack_u4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      
      CALL SITNU_GP_OPENACC (YDCST, YDGEOMETRY, YDDYN, YDCPG_OPTS%KLON, YDGEOMETRY&
      &%YRDIMV%NFLEVG, YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA, Z_YDVARS_DIV_T0(:&
      &,:, JBLK), PTOD0(:,:, JBLK), PSDIV0(:, JBLK),YDSTACK=YLSTACK)
      CALL SIGAM_GP_OPENACC (YDCST, YDGEOMETRY, YDDYN, YDCPG_OPTS%KLON, YDGEOMETRY&
      &%YRDIMV%NFLEVG, YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA, PGAGT0L(:,:, JBLK), Z_YDVARS_T_DL&
      &(:,:, JBLK), Z_YDVARS_SP_DL(:, JBLK),YDSTACK=YLSTACK)
      CALL SIGAM_GP_OPENACC (YDCST, YDGEOMETRY, YDDYN, YDCPG_OPTS%KLON, YDGEOMETRY&
      &%YRDIMV%NFLEVG, YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA, PGAGT0M(:,:, JBLK), Z_YDVARS_T_DM&
      &(:,:, JBLK), Z_YDVARS_SP_DM(:, JBLK),YDSTACK=YLSTACK)
    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:SITNU:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

  IF (FXTRAN_ACDC_LSYNCHOST ('LASSIE_PARALLEL:SITNU')) THEN
    IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:SITNU:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
    PGAGT0L => GET_HOST_DATA_RDWR (YD_PGAGT0L)
    PGAGT0M => GET_HOST_DATA_RDWR (YD_PGAGT0M)
    PSDIV0 => GET_HOST_DATA_RDWR (YD_PSDIV0)
    PTOD0 => GET_HOST_DATA_RDWR (YD_PTOD0)
    Z_YDVARS_DIV_T0 => GET_HOST_DATA_RDWR (YDVARS%DIV%FT0)
    Z_YDVARS_SP_DL => GET_HOST_DATA_RDWR (YDVARS%SP%FDL)
    Z_YDVARS_SP_DM => GET_HOST_DATA_RDWR (YDVARS%SP%FDM)
    Z_YDVARS_T_DL => GET_HOST_DATA_RDWR (YDVARS%T%FDL)
    Z_YDVARS_T_DM => GET_HOST_DATA_RDWR (YDVARS%T%FDM)
    IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:SITNU:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:SITNU:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  PGAGT0L => NULL ()
  PGAGT0M => NULL ()
  PSDIV0 => NULL ()
  PTOD0 => NULL ()
  Z_YDVARS_DIV_T0 => NULL ()
  Z_YDVARS_SP_DL => NULL ()
  Z_YDVARS_SP_DM => NULL ()
  Z_YDVARS_T_DL => NULL ()
  Z_YDVARS_T_DM => NULL ()
  IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:SITNU:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN','LASSIE_PARALLEL:SITNU')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:SITNU:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  PGAGT0L => GET_DEVICE_DATA_RDWR (YD_PGAGT0L)
  PGAGT0M => GET_DEVICE_DATA_RDWR (YD_PGAGT0M)
  PSDIV0 => GET_DEVICE_DATA_RDWR (YD_PSDIV0)
  PTOD0 => GET_DEVICE_DATA_RDWR (YD_PTOD0)
  Z_YDVARS_DIV_T0 => GET_DEVICE_DATA_RDONLY (YDVARS%DIV%FT0)
  Z_YDVARS_SP_DL => GET_DEVICE_DATA_RDONLY (YDVARS%SP%FDL)
  Z_YDVARS_SP_DM => GET_DEVICE_DATA_RDONLY (YDVARS%SP%FDM)
  Z_YDVARS_T_DL => GET_DEVICE_DATA_RDONLY (YDVARS%T%FDL)
  Z_YDVARS_T_DM => GET_DEVICE_DATA_RDONLY (YDVARS%T%FDM)
  IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:SITNU:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:SITNU:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  
    !$ACC PARALLEL LOOP GANG &
    !$ACC&PRESENT (PGAGT0L, PGAGT0M, PSDIV0, PTOD0, YDCPG_OPTS, YDCST, YDDYN, YDGEOMETRY, &
    !$ACC&         YFXTRAN_ACDC_STACK, Z_YDVARS_DIV_T0, Z_YDVARS_SP_DL, Z_YDVARS_SP_DM, &
    !$ACC&         Z_YDVARS_T_DL, Z_YDVARS_T_DM) &
    !$ACC&PRIVATE (JBLK) &
    !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
    
    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    
    
    
    !$ACC LOOP VECTOR &
    !$ACC&PRIVATE (JROF, YLCPG_BNDS, YLSTACK) 

    

    DO JROF = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JROF
      YLCPG_BNDS%KFDIA = JROF
      YLSTACK%L8 = fxtran_acdc_stack_l8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%U8 = fxtran_acdc_stack_u8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%L4 = fxtran_acdc_stack_l4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%U4 = fxtran_acdc_stack_u4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      
      CALL SITNU_GP_OPENACC (YDCST, YDGEOMETRY, YDDYN, YDCPG_OPTS%KLON, YDGEOMETRY&
      &%YRDIMV%NFLEVG, YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA, Z_YDVARS_DIV_T0(:&
      &,:, JBLK), PTOD0(:,:, JBLK), PSDIV0(:, JBLK),YDSTACK=YLSTACK)
      CALL SIGAM_GP_OPENACC (YDCST, YDGEOMETRY, YDDYN, YDCPG_OPTS%KLON, YDGEOMETRY&
      &%YRDIMV%NFLEVG, YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA, PGAGT0L(:,:, JBLK), Z_YDVARS_T_DL&
      &(:,:, JBLK), Z_YDVARS_SP_DL(:, JBLK),YDSTACK=YLSTACK)
      CALL SIGAM_GP_OPENACC (YDCST, YDGEOMETRY, YDDYN, YDCPG_OPTS%KLON, YDGEOMETRY&
      &%YRDIMV%NFLEVG, YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA, PGAGT0M(:,:, JBLK), Z_YDVARS_T_DM&
      &(:,:, JBLK), Z_YDVARS_SP_DM(:, JBLK),YDSTACK=YLSTACK)
    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:SITNU:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

  IF (FXTRAN_ACDC_LSYNCHOST ('LASSIE_PARALLEL:SITNU')) THEN
    IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:SITNU:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
    PGAGT0L => GET_HOST_DATA_RDWR (YD_PGAGT0L)
    PGAGT0M => GET_HOST_DATA_RDWR (YD_PGAGT0M)
    PSDIV0 => GET_HOST_DATA_RDWR (YD_PSDIV0)
    PTOD0 => GET_HOST_DATA_RDWR (YD_PTOD0)
    Z_YDVARS_DIV_T0 => GET_HOST_DATA_RDWR (YDVARS%DIV%FT0)
    Z_YDVARS_SP_DL => GET_HOST_DATA_RDWR (YDVARS%SP%FDL)
    Z_YDVARS_SP_DM => GET_HOST_DATA_RDWR (YDVARS%SP%FDM)
    Z_YDVARS_T_DL => GET_HOST_DATA_RDWR (YDVARS%T%FDL)
    Z_YDVARS_T_DM => GET_HOST_DATA_RDWR (YDVARS%T%FDM)
    IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:SITNU:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:SITNU:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  PGAGT0L => NULL ()
  PGAGT0M => NULL ()
  PSDIV0 => NULL ()
  PTOD0 => NULL ()
  Z_YDVARS_DIV_T0 => NULL ()
  Z_YDVARS_SP_DL => NULL ()
  Z_YDVARS_SP_DM => NULL ()
  Z_YDVARS_T_DL => NULL ()
  Z_YDVARS_T_DM => NULL ()
  IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:SITNU:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSE
    CALL ABOR1 ('LASSIE_PARALLEL: NOT METHOD WAS FOUND')
ENDIF

IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:SITNU',1,ZHOOK_HANDLE_PARALLEL)

IF (.NOT.YDDYNA%LTWOTL) THEN
  
  
  
  
  CALL ABOR1 ("ERROR: WRONG SETTINGS")
  
ENDIF


IF (YDDYNA%LSPRT) THEN

  IF (YDDYNA%LTWOTL) THEN
    CALL GPRCP_EXPL_PARALLEL (YDCST, YDCPG_BNDS, YDCPG_OPTS, YDVARS=YDVARS, YD_PR=YL_ZR9)
    IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:GPRCP',0,ZHOOK_HANDLE_PARALLEL)

    IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','LASSIE_PARALLEL:GPRCP')) THEN
      
      IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:GPRCP:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
      PTOD0 => GET_HOST_DATA_RDWR (YD_PTOD0)
      ZR9 => GET_HOST_DATA_RDONLY (YL_ZR9)
      IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:GPRCP:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
      IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:GPRCP:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
      
      CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
      !$OMP PARALLEL DO PRIVATE (JBLK, JLEV, JROF) FIRSTPRIVATE (YLCPG_BNDS)

      DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
        CALL YLCPG_BNDS%UPDATE (JBLK)

        

        DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG

          DO JROF=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
            PTOD0 (JROF, JLEV, JBLK)=YDCST%RD*PTOD0 (JROF, JLEV, JBLK)/ZR9 (JROF, JLEV, JBLK)
          ENDDO

        ENDDO

      ENDDO

      IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:GPRCP:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

      IF (FXTRAN_ACDC_LSYNCHOST ('LASSIE_PARALLEL:GPRCP')) THEN
        IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:GPRCP:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
        PTOD0 => GET_HOST_DATA_RDWR (YD_PTOD0)
        ZR9 => GET_HOST_DATA_RDWR (YL_ZR9)
        IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:GPRCP:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
        
        
      ENDIF

      IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:GPRCP:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
      PTOD0 => NULL ()
      ZR9 => NULL ()
      IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:GPRCP:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
      
      
    ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMPSINGLECOLUMN','LASSIE_PARALLEL:GPRCP')) THEN
      
      IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:GPRCP:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
      PTOD0 => GET_HOST_DATA_RDWR (YD_PTOD0)
      ZR9 => GET_HOST_DATA_RDONLY (YL_ZR9)
      IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:GPRCP:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
      IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:GPRCP:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
      
      !$OMP PARALLEL DO PRIVATE (JBLK, JLEV, JROF, YLCPG_BNDS)

      DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX

        

        

        DO JROF = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
          YLCPG_BNDS%KIDIA = JROF
          YLCPG_BNDS%KFDIA = JROF

          

          DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
            
            PTOD0 (JROF, JLEV, JBLK)=YDCST%RD*PTOD0 (JROF, JLEV, JBLK)/ZR9 (JROF, JLEV, JBLK)
          
          ENDDO

        ENDDO

      ENDDO

      IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:GPRCP:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

      IF (FXTRAN_ACDC_LSYNCHOST ('LASSIE_PARALLEL:GPRCP')) THEN
        IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:GPRCP:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
        PTOD0 => GET_HOST_DATA_RDWR (YD_PTOD0)
        ZR9 => GET_HOST_DATA_RDWR (YL_ZR9)
        IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:GPRCP:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
        
        
      ENDIF

      IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:GPRCP:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
      PTOD0 => NULL ()
      ZR9 => NULL ()
      IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:GPRCP:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
      
      
    ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN','LASSIE_PARALLEL:GPRCP')) THEN
      
      IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:GPRCP:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
      PTOD0 => GET_DEVICE_DATA_RDWR (YD_PTOD0)
      ZR9 => GET_DEVICE_DATA_RDONLY (YL_ZR9)
      IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:GPRCP:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
      IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:GPRCP:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
      
      
        !$ACC PARALLEL LOOP GANG &
        !$ACC&PRESENT (PTOD0, YDCPG_OPTS, YDCST, YDGEOMETRY, YFXTRAN_ACDC_STACK, ZR9) &
        !$ACC&PRIVATE (JBLK) &
        !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
        
        DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
        
        
        
        !$ACC LOOP VECTOR &
        !$ACC&PRIVATE (JLEV, JROF, YLCPG_BNDS) 

        

        DO JROF = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
          YLCPG_BNDS%KIDIA = JROF
          YLCPG_BNDS%KFDIA = JROF

          

          DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
            
            PTOD0 (JROF, JLEV, JBLK)=YDCST%RD*PTOD0 (JROF, JLEV, JBLK)/ZR9 (JROF, JLEV, JBLK)
          
          ENDDO

        ENDDO

      ENDDO

      IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:GPRCP:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

      IF (FXTRAN_ACDC_LSYNCHOST ('LASSIE_PARALLEL:GPRCP')) THEN
        IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:GPRCP:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
        PTOD0 => GET_HOST_DATA_RDWR (YD_PTOD0)
        ZR9 => GET_HOST_DATA_RDWR (YL_ZR9)
        IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:GPRCP:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
        
        
      ENDIF

      IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:GPRCP:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
      PTOD0 => NULL ()
      ZR9 => NULL ()
      IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:GPRCP:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
      
      
    ELSE
        CALL ABOR1 ('LASSIE_PARALLEL: NOT METHOD WAS FOUND')
    ENDIF

    IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL:GPRCP',1,ZHOOK_HANDLE_PARALLEL)
  ELSE
    
    
    
    CALL ABOR1 ("ERROR: WRONG SETTINGS")
    
  ENDIF

ENDIF


IF (YDDYN%LIMPF) THEN
  
  
  
  CALL ABOR1 ("ERROR: WRONG SETTINGS")
  
ENDIF




CALL FXTRAN_ACDC_GPUMEMSTAT (__FILE__, __LINE__, "END")

IF (LHOOK) CALL DR_HOOK ('DELETE_TEMPORARIES',0,ZHOOK_HANDLE_FIELD_API)
IF (ASSOCIATED (YL_ZR9)) CALL FIELD_DELETE (YL_ZR9)
IF (LHOOK) CALL DR_HOOK ('DELETE_TEMPORARIES',1,ZHOOK_HANDLE_FIELD_API)
IF (LHOOK) CALL DR_HOOK ('LASSIE_PARALLEL', 1, ZHOOK_HANDLE)
END SUBROUTINE LASSIE_PARALLEL
