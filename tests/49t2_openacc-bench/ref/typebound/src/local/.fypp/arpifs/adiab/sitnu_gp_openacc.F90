SUBROUTINE SITNU_GP_OPENACC (YDCST, YDGEOMETRY, YDDYN&
&, KLON, KLEV, KIDIA, KFDIA, PD, PT, PSP, YDSTACK)
!$ACC ROUTINE (SITNU_GP_OPENACC) SEQ
USE GEOMETRY_MOD,ONLY:GEOMETRY
USE PARKIND1,ONLY:JPIM, JPRB

USE YOMCST,ONLY:TCST
USE YOMDYN,ONLY:TDYN
#include "fxtran_acdc_stack.h"
USE FXTRAN_ACDC_STACK_MOD
USE FXTRAN_ACDC_ABORT_MOD

IMPLICIT NONE


TYPE (TCST), INTENT (IN)::YDCST
TYPE (GEOMETRY), INTENT (IN)::YDGEOMETRY
TYPE (TDYN), INTENT (IN)::YDDYN
INTEGER (KIND=JPIM), INTENT (IN)::KLEV
INTEGER (KIND=JPIM), INTENT (IN)::KLON
INTEGER (KIND=JPIM), INTENT (IN)::KIDIA
INTEGER (KIND=JPIM), INTENT (IN)::KFDIA
REAL (KIND=JPRB), INTENT (IN)::PD (KLON, KLEV)
REAL (KIND=JPRB), INTENT (OUT)::PT (KLON, KLEV)
REAL (KIND=JPRB), INTENT (OUT)::PSP (KLON)
TYPE(FXTRAN_ACDC_STACK), INTENT (IN) :: YDSTACK
TYPE(FXTRAN_ACDC_STACK) :: YLSTACK
fxtran_acdc_temp (REAL (KIND=JPRB), ZSDIV, (KLON, 0:KLEV+1))
fxtran_acdc_temp (REAL (KIND=JPRB), ZOUT, (KLON, KLEV+1))
REAL (KIND=JPRB)::ZSDIVX 
INTEGER (KIND=JPIM)::JLON
INTEGER (KIND=JPIM)::JLEV
REAL (KIND=JPRB)::ZREC

#include "verdisint_openacc.intfb.h"

YLSTACK = YDSTACK



IF (KIND (ZSDIV) == 8) THEN
    fxtran_acdc_alloc8 (ZSDIV)
ELSEIF (KIND (ZSDIV) == 4) THEN
    fxtran_acdc_alloc4 (ZSDIV)
ELSE
    STOP 1
ENDIF


IF (KIND (ZOUT) == 8) THEN
    fxtran_acdc_alloc8 (ZOUT)
ELSEIF (KIND (ZOUT) == 4) THEN
    fxtran_acdc_alloc4 (ZOUT)
ELSE
    STOP 1
ENDIF


JLON = KIDIA







IF (YDGEOMETRY%YRVERT_GEOM%YRCVER%LVERTFE) THEN

  DO JLEV=1, KLEV
    
    ZSDIV (JLON, JLEV)=PD (JLON, JLEV)*YDDYN%SIDELP(JLEV&
    &)*YDGEOMETRY%YRVERT_GEOM%YRVETA%VFE_RDETAH (JLEV)
  
  ENDDO


  IF (KLON>=1) THEN
    ZSDIV (JLON, 0)=0.0_JPRB
    ZSDIV (JLON, KLEV+1)=0.0_JPRB
    CALL VERDISINT_OPENACC (YDGEOMETRY%YRVERT_GEOM%YRVFE, YDGEOMETRY%YRVERT_GEOM%YRCVER,'ITOP','11&
    &', KLON, KIDIA, KFDIA, KLEV, ZSDIV, ZOUT, KCHUNK=YDGEOMETRY%YRDIM%NPROMA, YDSTACK=YLSTACK)
  ENDIF


  DO JLEV=1, KLEV
    
    ZREC=1.0_JPRB/YDDYN%SITLAF(JLEV)
    PT (JLON, JLEV)=YDCST%RKAPPA*YDDYN%SITR*ZOUT (JLON, JLEV)*ZREC
  
  ENDDO

  
  PSP (JLON)=ZOUT (JLON, KLEV+1)*YDDYN%SIRPRN
  
ELSE
  ZSDIVX =0.0_JPRB

  DO JLEV=1, KLEV
    
    PT (JLON, JLEV)=YDCST%RKAPPA*YDDYN%SITR*(YDDYN%SIRDEL(JLEV)*YDDYN&
    &%SILNPR(JLEV)*ZSDIVX +YDDYN%SIALPH(JLEV)*PD (JLON, JLEV))
    ZSDIVX =ZSDIVX +PD (JLON, JLEV)*YDDYN%SIDELP(JLEV)
  
  ENDDO

  
  PSP (JLON)=ZSDIVX *YDDYN%SIRPRN
  
ENDIF




END SUBROUTINE SITNU_GP_OPENACC
