
MODULE MODE_COMPUTE_MF_CLOUD_OPENACC


IMPLICIT NONE


CONTAINS
SUBROUTINE COMPUTE_MF_CLOUD_OPENACC (D, CST, TURBN, PARAMMF, OSTATNW, KRR, KRRL&
&, KRRI, PFRAC_ICE, PRC_UP, PRI_UP, PEMF, PTHL_UP, PRT_UP, PFRAC_UP, PTHV_UP,&
& PFRAC_ICE_UP, PRSAT_UP, PEXNM, PTHLM, PRTM, PTHM, PTHVM, PRM, PDZZ, PZZ, KKLCL&
&, PPABSM, PRHODREF, PRC_MF, PRI_MF, PCF_MF, PSIGMF, PDEPTH, YDSTACK)
!$ACC ROUTINE (COMPUTE_MF_CLOUD_OPENACC) SEQ
USE MODD_DIMPHYEX,ONLY:DIMPHYEX_T
USE MODD_CST,ONLY:CST_T
USE MODD_TURB_N,ONLY:TURB_T
USE MODD_PARAM_MFSHALL_N,ONLY:PARAM_MFSHALL_T
USE MODE_MSG
USE MODE_COMPUTE_MF_CLOUD_DIRECT,ONLY:COMPUTE_MF_CLOUD_DIRECT
USE MODE_COMPUTE_MF_CLOUD_DIRECT_OPENACC,ONLY:COMPUTE_MF_CLOUD_DIRECT_OPENACC
USE MODE_COMPUTE_MF_CLOUD_STAT,ONLY:COMPUTE_MF_CLOUD_STAT
USE MODE_COMPUTE_MF_CLOUD_STAT_OPENACC,ONLY:COMPUTE_MF_CLOUD_STAT_OPENACC
USE MODE_COMPUTE_MF_CLOUD_BIGAUS,ONLY:COMPUTE_MF_CLOUD_BIGAUS
USE MODE_COMPUTE_MF_CLOUD_BIGAUS_OPENACC,ONLY:COMPUTE_MF_CLOUD_BIGAUS_OPENACC

#include "fxtran_acdc_stack.h"
USE FXTRAN_ACDC_STACK_MOD
USE FXTRAN_ACDC_ABORT_MOD

IMPLICIT NONE

TYPE (DIMPHYEX_T), INTENT (IN)::D
TYPE (CST_T), INTENT (IN)::CST
TYPE (TURB_T), INTENT (IN)::TURBN
TYPE (PARAM_MFSHALL_T), INTENT (IN)::PARAMMF
INTEGER, INTENT (IN)::KRR
INTEGER, INTENT (IN)::KRRL
INTEGER, INTENT (IN)::KRRI
LOGICAL, INTENT (IN)::OSTATNW
REAL, INTENT (IN)::PFRAC_ICE(D%NIJT, D%NKT)
REAL, INTENT (IN)::PEMF(D%NIJT, D%NKT)
REAL, INTENT (IN)::PRI_UP(D%NIJT, D%NKT)
REAL, INTENT (IN)::PRC_UP(D%NIJT, D%NKT)
REAL, INTENT (IN)::PRT_UP(D%NIJT, D%NKT)
REAL, INTENT (IN)::PTHL_UP(D%NIJT, D%NKT)
REAL, INTENT (IN)::PFRAC_UP(D%NIJT, D%NKT)
REAL, INTENT (IN)::PTHV_UP(D%NIJT, D%NKT)
REAL, INTENT (IN)::PFRAC_ICE_UP(D%NIJT, D%NKT)
REAL, INTENT (IN)::PRSAT_UP(D%NIJT, D%NKT)
REAL, INTENT (IN)::PEXNM(D%NIJT, D%NKT)
REAL, INTENT (IN)::PRTM(D%NIJT, D%NKT)
REAL, INTENT (IN)::PTHLM(D%NIJT, D%NKT)
REAL, INTENT (IN)::PTHVM(D%NIJT, D%NKT)
REAL, INTENT (IN)::PTHM(D%NIJT, D%NKT)
REAL, INTENT (IN)::PRM(D%NIJT, D%NKT, KRR)
REAL, INTENT (IN)::PZZ(D%NIJT, D%NKT)
REAL, INTENT (IN)::PDZZ(D%NIJT, D%NKT)
INTEGER, INTENT (IN)::KKLCL(D%NIJT)
REAL, INTENT (IN)::PRHODREF(D%NIJT, D%NKT)
REAL, INTENT (IN)::PPABSM(D%NIJT, D%NKT)
REAL, INTENT (OUT)::PRI_MF(D%NIJT, D%NKT)
REAL, INTENT (OUT)::PRC_MF(D%NIJT, D%NKT)
REAL, INTENT (OUT)::PCF_MF(D%NIJT, D%NKT)
REAL, INTENT (OUT)::PSIGMF(D%NIJT, D%NKT)
REAL, INTENT (IN)::PDEPTH(D%NIJT)
TYPE(FXTRAN_ACDC_STACK), INTENT (IN) :: YDSTACK
TYPE(FXTRAN_ACDC_STACK) :: YLSTACK

INTEGER :: JI

YLSTACK = YDSTACK



JI = D%NIB


PRC_MF(JI,:)=0.
PRI_MF(JI,:)=0.
PCF_MF(JI,:)=0.
PSIGMF(JI,:)=0.

IF (PARAMMF%CMF_CLOUD=='DIRE') THEN
  CALL COMPUTE_MF_CLOUD_DIRECT_OPENACC (D, PARAMMF, KKLCL (:), PFRAC_UP (:,:), PRC_UP&
  & (:,:), PRI_UP (:,:), PRC_MF (:,:), PRI_MF (:,:), PCF_MF (:,:), YDSTACK=YLSTACK)
ELSEIF (PARAMMF%CMF_CLOUD=='STAT') THEN
  CALL COMPUTE_MF_CLOUD_STAT_OPENACC (D, CST, TURBN, PARAMMF, KRR, KRRL, KRRI, OSTATNW, PFRAC_ICE,&
  & PTHLM, PRTM, PPABSM, PRM, PDZZ, PTHM, PEXNM, PEMF, PTHL_UP, PRT_UP, PSIGMF, YDSTACK=YLSTACK)
ELSEIF (PARAMMF%CMF_CLOUD=='BIGA') THEN
  CALL COMPUTE_MF_CLOUD_BIGAUS_OPENACC (D, CST, PARAMMF, PEMF, PDEPTH, PRT_UP, PTHV_UP, PFRAC_ICE_UP&
  &, PRSAT_UP, PRTM, PTHM, PTHVM, PDZZ, PZZ, PRHODREF, PRC_MF, PRI_MF, PCF_MF, YDSTACK=YLSTACK)
ELSEIF (PARAMMF%CMF_CLOUD=='NONE') THEN
ELSE
  CALL FXTRAN_ACDC_ABORT ('Shallow convection cloud scheme&
  & not valid: PARAMMF%CMF_CLOUD='//PARAMMF%CMF_CLOUD)
ENDIF



END SUBROUTINE COMPUTE_MF_CLOUD_OPENACC

ENDMODULE MODE_COMPUTE_MF_CLOUD_OPENACC
