
SUBROUTINE ACRANEB_SOLVS_OPENACC (YDPHY, LDNUMX, KLON, KTDIA, KLEV, KJN, KIDIA, KFDIA&
&, KAUCR, PALB, PALBDIR, PCLCT, PFRSODIRT, PFRSODIRS_C, PFRSODIRS_CUN, PNEB, PB1, PB2&
&, PB3, PB4, PA1C, PA1CUN, PA2C, PA3C, PA4C, PA5C, PA1N, PA1NUN, PA2N, PA3N, PA4N, PA5N&
&, PFRSO, PFRSODIFS, PFRSODIRS, PFRSODIRS_UN, PFRSODIRS_TRUE, YDSTACK)
!$ACC ROUTINE (ACRANEB_SOLVS_OPENACC) SEQ
USE PARKIND1,ONLY:JPIM, JPRB
USE YOMPHY,ONLY:TPHY

#include "fxtran_acdc_stack.h"
USE FXTRAN_ACDC_STACK_MOD
USE FXTRAN_ACDC_ABORT_MOD

IMPLICIT NONE


TYPE (TPHY), INTENT (IN)::YDPHY
LOGICAL, INTENT (IN)::LDNUMX
INTEGER (KIND=JPIM), INTENT (IN)::KLON
INTEGER (KIND=JPIM), INTENT (IN)::KLEV
INTEGER (KIND=JPIM), INTENT (IN)::KTDIA
INTEGER (KIND=JPIM), INTENT (IN)::KJN
INTEGER (KIND=JPIM), INTENT (IN)::KIDIA 
INTEGER (KIND=JPIM), INTENT (IN)::KFDIA 
INTEGER (KIND=JPIM), INTENT (IN)::KAUCR
REAL (KIND=JPRB), INTENT (IN)::PALB (KLON)
REAL (KIND=JPRB), INTENT (IN)::PALBDIR (KLON)
REAL (KIND=JPRB), INTENT (IN)::PCLCT (KLON)
REAL (KIND=JPRB), INTENT (IN)::PFRSODIRT (KLON)
REAL (KIND=JPRB), INTENT (IN)::PFRSODIRS_C (KLON)
REAL (KIND=JPRB), INTENT (IN)::PFRSODIRS_CUN (KLON)
REAL (KIND=JPRB), INTENT (IN)::PNEB (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PB1 (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PB2 (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PB3 (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PB4 (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PA1C (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PA1CUN (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PA2C (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PA3C (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PA4C (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PA5C (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PA1N (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PA1NUN (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PA2N (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PA3N (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PA4N (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PA5N (KLON, KLEV)
REAL (KIND=JPRB), INTENT (OUT)::PFRSO (KLON, 0:KLEV)
REAL (KIND=JPRB), INTENT (OUT)::PFRSODIFS (KLON)
REAL (KIND=JPRB), INTENT (OUT)::PFRSODIRS (KLON)
REAL (KIND=JPRB), INTENT (OUT)::PFRSODIRS_UN (KLON)
REAL (KIND=JPRB), INTENT (OUT)::PFRSODIRS_TRUE (KLON)
TYPE(FXTRAN_ACDC_STACK), INTENT (IN) :: YDSTACK
TYPE(FXTRAN_ACDC_STACK) :: YLSTACK
REAL (KIND=JPRB)::ZFPC_TRUE
REAL (KIND=JPRB)::ZTUS1
REAL (KIND=JPRB)::ZTDS3
REAL (KIND=JPRB)::ZTDS2
REAL (KIND=JPRB)::ZTDS1
REAL (KIND=JPRB)::ZTD7
REAL (KIND=JPRB)::ZTD6
REAL (KIND=JPRB)::ZTD5
REAL (KIND=JPRB)::ZTD4
REAL (KIND=JPRB)::ZTD3
REAL (KIND=JPRB)::ZTD2
REAL (KIND=JPRB)::ZTD1
REAL (KIND=JPRB)::ZALP
REAL (KIND=JPRB)::ZAL
REAL (KIND=JPRB)::ZGA2 
REAL (KIND=JPRB)::ZGA1 
REAL (KIND=JPRB)::ZDE2 
REAL (KIND=JPRB)::ZDE1 
REAL (KIND=JPRB)::ZBE2 
REAL (KIND=JPRB)::ZBE1 
REAL (KIND=JPRB)::ZAL2 
REAL (KIND=JPRB)::ZAL1 
fxtran_acdc_temp (REAL (KIND=JPRB), ZA1C, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZA1CUN, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZA2C, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZA3C, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZA4C, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZA5C, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZTU1, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZTU2, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZTU3, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZTU4, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZTU5, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZTU6, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZTU7, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZTU8, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZTU9, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZFDC, (KLON, 0:KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZFMC, (KLON, 0:KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZFPC, (KLON, 0:KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZFPCUN, (KLON, 0:KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZFDN, (KLON, 0:KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZFMN, (KLON, 0:KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZFPN, (KLON, 0:KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZFPNUN, (KLON, 0:KLEV))
INTEGER (KIND=JPIM)::JN
INTEGER (KIND=JPIM)::JLON
INTEGER (KIND=JPIM)::JLEV


YLSTACK = YDSTACK



IF (KIND (ZA1C) == 8) THEN
    fxtran_acdc_alloc8 (ZA1C)
ELSEIF (KIND (ZA1C) == 4) THEN
    fxtran_acdc_alloc4 (ZA1C)
ELSE
    STOP 1
ENDIF


IF (KIND (ZA1CUN) == 8) THEN
    fxtran_acdc_alloc8 (ZA1CUN)
ELSEIF (KIND (ZA1CUN) == 4) THEN
    fxtran_acdc_alloc4 (ZA1CUN)
ELSE
    STOP 1
ENDIF


IF (KIND (ZA2C) == 8) THEN
    fxtran_acdc_alloc8 (ZA2C)
ELSEIF (KIND (ZA2C) == 4) THEN
    fxtran_acdc_alloc4 (ZA2C)
ELSE
    STOP 1
ENDIF


IF (KIND (ZA3C) == 8) THEN
    fxtran_acdc_alloc8 (ZA3C)
ELSEIF (KIND (ZA3C) == 4) THEN
    fxtran_acdc_alloc4 (ZA3C)
ELSE
    STOP 1
ENDIF


IF (KIND (ZA4C) == 8) THEN
    fxtran_acdc_alloc8 (ZA4C)
ELSEIF (KIND (ZA4C) == 4) THEN
    fxtran_acdc_alloc4 (ZA4C)
ELSE
    STOP 1
ENDIF


IF (KIND (ZA5C) == 8) THEN
    fxtran_acdc_alloc8 (ZA5C)
ELSEIF (KIND (ZA5C) == 4) THEN
    fxtran_acdc_alloc4 (ZA5C)
ELSE
    STOP 1
ENDIF


IF (KIND (ZTU1) == 8) THEN
    fxtran_acdc_alloc8 (ZTU1)
ELSEIF (KIND (ZTU1) == 4) THEN
    fxtran_acdc_alloc4 (ZTU1)
ELSE
    STOP 1
ENDIF


IF (KIND (ZTU2) == 8) THEN
    fxtran_acdc_alloc8 (ZTU2)
ELSEIF (KIND (ZTU2) == 4) THEN
    fxtran_acdc_alloc4 (ZTU2)
ELSE
    STOP 1
ENDIF


IF (KIND (ZTU3) == 8) THEN
    fxtran_acdc_alloc8 (ZTU3)
ELSEIF (KIND (ZTU3) == 4) THEN
    fxtran_acdc_alloc4 (ZTU3)
ELSE
    STOP 1
ENDIF


IF (KIND (ZTU4) == 8) THEN
    fxtran_acdc_alloc8 (ZTU4)
ELSEIF (KIND (ZTU4) == 4) THEN
    fxtran_acdc_alloc4 (ZTU4)
ELSE
    STOP 1
ENDIF


IF (KIND (ZTU5) == 8) THEN
    fxtran_acdc_alloc8 (ZTU5)
ELSEIF (KIND (ZTU5) == 4) THEN
    fxtran_acdc_alloc4 (ZTU5)
ELSE
    STOP 1
ENDIF


IF (KIND (ZTU6) == 8) THEN
    fxtran_acdc_alloc8 (ZTU6)
ELSEIF (KIND (ZTU6) == 4) THEN
    fxtran_acdc_alloc4 (ZTU6)
ELSE
    STOP 1
ENDIF


IF (KIND (ZTU7) == 8) THEN
    fxtran_acdc_alloc8 (ZTU7)
ELSEIF (KIND (ZTU7) == 4) THEN
    fxtran_acdc_alloc4 (ZTU7)
ELSE
    STOP 1
ENDIF


IF (KIND (ZTU8) == 8) THEN
    fxtran_acdc_alloc8 (ZTU8)
ELSEIF (KIND (ZTU8) == 4) THEN
    fxtran_acdc_alloc4 (ZTU8)
ELSE
    STOP 1
ENDIF


IF (KIND (ZTU9) == 8) THEN
    fxtran_acdc_alloc8 (ZTU9)
ELSEIF (KIND (ZTU9) == 4) THEN
    fxtran_acdc_alloc4 (ZTU9)
ELSE
    STOP 1
ENDIF


IF (KIND (ZFDC) == 8) THEN
    fxtran_acdc_alloc8 (ZFDC)
ELSEIF (KIND (ZFDC) == 4) THEN
    fxtran_acdc_alloc4 (ZFDC)
ELSE
    STOP 1
ENDIF


IF (KIND (ZFMC) == 8) THEN
    fxtran_acdc_alloc8 (ZFMC)
ELSEIF (KIND (ZFMC) == 4) THEN
    fxtran_acdc_alloc4 (ZFMC)
ELSE
    STOP 1
ENDIF


IF (KIND (ZFPC) == 8) THEN
    fxtran_acdc_alloc8 (ZFPC)
ELSEIF (KIND (ZFPC) == 4) THEN
    fxtran_acdc_alloc4 (ZFPC)
ELSE
    STOP 1
ENDIF


IF (KIND (ZFPCUN) == 8) THEN
    fxtran_acdc_alloc8 (ZFPCUN)
ELSEIF (KIND (ZFPCUN) == 4) THEN
    fxtran_acdc_alloc4 (ZFPCUN)
ELSE
    STOP 1
ENDIF


IF (KIND (ZFDN) == 8) THEN
    fxtran_acdc_alloc8 (ZFDN)
ELSEIF (KIND (ZFDN) == 4) THEN
    fxtran_acdc_alloc4 (ZFDN)
ELSE
    STOP 1
ENDIF


IF (KIND (ZFMN) == 8) THEN
    fxtran_acdc_alloc8 (ZFMN)
ELSEIF (KIND (ZFMN) == 4) THEN
    fxtran_acdc_alloc4 (ZFMN)
ELSE
    STOP 1
ENDIF


IF (KIND (ZFPN) == 8) THEN
    fxtran_acdc_alloc8 (ZFPN)
ELSEIF (KIND (ZFPN) == 4) THEN
    fxtran_acdc_alloc4 (ZFPN)
ELSE
    STOP 1
ENDIF


IF (KIND (ZFPNUN) == 8) THEN
    fxtran_acdc_alloc8 (ZFPNUN)
ELSEIF (KIND (ZFPNUN) == 4) THEN
    fxtran_acdc_alloc4 (ZFPNUN)
ELSE
    STOP 1
ENDIF


JLON = KIDIA



ZFDC (JLON,:)=0._JPRB
ZFPC (JLON,:)=0._JPRB
ZFPCUN (JLON,:)=0._JPRB

IF (LDNUMX) THEN
  ZFDN (JLON,:)=0._JPRB
  ZFPN (JLON,:)=0._JPRB
  ZFPNUN (JLON,:)=0._JPRB
ENDIF


ZFPC (JLON, KTDIA-1)=PFRSODIRT (JLON)
ZFPCUN (JLON, KTDIA-1)=PFRSODIRT (JLON)



IF (LDNUMX) THEN
  ZAL1 =PB2 (JLON, KTDIA)
  ZAL2 =PB1 (JLON, KTDIA)
  ZBE1 =1._JPRB-PB2 (JLON, KTDIA)
  ZBE2 =1._JPRB-PB1 (JLON, KTDIA)
  ZGA1 =1._JPRB-PB4 (JLON, KTDIA)
  ZGA2 =1._JPRB-PB3 (JLON, KTDIA)
  ZDE1 =PB4 (JLON, KTDIA)
  ZDE2 =PB3 (JLON, KTDIA)
ELSE
  ZA1C (JLON, KTDIA)=PA1C (JLON, KTDIA)*PB1 (JLON, KTDIA)+PA1N (JLON, KTDIA)*PNEB (JLON, KTDIA)
  ZA1CUN (JLON, KTDIA)=PA1CUN (JLON, KTDIA)*PB1 (JLON, KTDIA)+PA1NUN (JLON, KTDIA)*PNEB (JLON, KTDIA)
  ZA2C (JLON, KTDIA)=PA2C (JLON, KTDIA)*PB1 (JLON, KTDIA)+PA2N (JLON, KTDIA)*PNEB (JLON, KTDIA)
  ZA3C (JLON, KTDIA)=PA3C (JLON, KTDIA)*PB1 (JLON, KTDIA)+PA3N (JLON, KTDIA)*PNEB (JLON, KTDIA)
  ZA4C (JLON, KTDIA)=PA4C (JLON, KTDIA)*PB1 (JLON, KTDIA)+PA4N (JLON, KTDIA)*PNEB (JLON, KTDIA)
  ZA5C (JLON, KTDIA)=PA5C (JLON, KTDIA)*PB1 (JLON, KTDIA)+PA5N (JLON, KTDIA)*PNEB (JLON, KTDIA)
ENDIF


IF (LDNUMX) THEN
  ZFMC (JLON, KTDIA-1)=PA3C (JLON, KTDIA)*ZAL2 *ZFPC (JLON, KTDIA-1)
  ZFPC (JLON, KTDIA)=PA1C (JLON, KTDIA)*ZAL2 *ZFPC (JLON, KTDIA-1)
  ZFPCUN (JLON, KTDIA)=PA1CUN (JLON, KTDIA)*ZAL2 *ZFPCUN (JLON, KTDIA-1)
  ZFDC (JLON, KTDIA)=PA2C (JLON, KTDIA)*ZAL2 *ZFPC (JLON, KTDIA-1)
  ZFMN (JLON, KTDIA-1)=PA3N (JLON, KTDIA)*ZBE2 *ZFPC (JLON, KTDIA-1)
  ZFPN (JLON, KTDIA)=PA1N (JLON, KTDIA)*ZBE2 *ZFPC (JLON, KTDIA-1)
  ZFPNUN (JLON, KTDIA)=PA1NUN (JLON, KTDIA)*ZBE2 *ZFPCUN (JLON, KTDIA-1)
  ZFDN (JLON, KTDIA)=PA2N (JLON, KTDIA)*ZBE2 *ZFPC (JLON, KTDIA-1)
  ZTU1 (JLON, KTDIA)=0._JPRB
  ZTU2 (JLON, KTDIA)=ZAL1 *PA4C (JLON, KTDIA)
  ZTU3 (JLON, KTDIA)=ZGA1 *PA4C (JLON, KTDIA)
  ZTU4 (JLON, KTDIA)=ZBE1 *PA4N (JLON, KTDIA)
  ZTU5 (JLON, KTDIA)=ZDE1 *PA4N (JLON, KTDIA)
  ZTU6 (JLON, KTDIA)=ZAL1 *PA5C (JLON, KTDIA)
  ZTU7 (JLON, KTDIA)=ZGA1 *PA5C (JLON, KTDIA)
  ZTU8 (JLON, KTDIA)=ZBE1 *PA5N (JLON, KTDIA)
  ZTU9 (JLON, KTDIA)=ZDE1 *PA5N (JLON, KTDIA)
ELSE
  ZFMC (JLON, KTDIA-1)=ZA3C (JLON, KTDIA)*ZFPC (JLON, KTDIA-1)
  ZFPC (JLON, KTDIA)=ZA1C (JLON, KTDIA)*ZFPC (JLON, KTDIA-1)
  ZFPCUN (JLON, KTDIA)=ZA1CUN (JLON, KTDIA)*ZFPCUN (JLON, KTDIA-1)
  ZFDC (JLON, KTDIA)=ZA2C (JLON, KTDIA)*ZFPC (JLON, KTDIA-1)
  ZTU2 (JLON, KTDIA)=ZA4C (JLON, KTDIA)
  ZTU6 (JLON, KTDIA)=ZA5C (JLON, KTDIA)
ENDIF



DO JLEV=KTDIA+1, KLEV

  

  IF (LDNUMX) THEN
    ZAL1 =PB2 (JLON, JLEV)
    ZAL2 =PB1 (JLON, JLEV)
    ZBE1 =1._JPRB-PB2 (JLON, JLEV)
    ZBE2 =1._JPRB-PB1 (JLON, JLEV)
    ZGA1 =1._JPRB-PB4 (JLON, JLEV)
    ZGA2 =1._JPRB-PB3 (JLON, JLEV)
    ZDE1 =PB4 (JLON, JLEV)
    ZDE2 =PB3 (JLON, JLEV)
  ELSE
    ZA1C (JLON, JLEV)=PA1C (JLON, JLEV)*PB1 (JLON, JLEV)+PA1N (JLON, JLEV)*PNEB (JLON, JLEV)
    ZA1CUN (JLON, JLEV)=PA1CUN (JLON, JLEV)*PB1 (JLON, JLEV)+PA1NUN (JLON, JLEV)*PNEB (JLON, JLEV)
    ZA2C (JLON, JLEV)=PA2C (JLON, JLEV)*PB1 (JLON, JLEV)+PA2N (JLON, JLEV)*PNEB (JLON, JLEV)
    ZA3C (JLON, JLEV)=PA3C (JLON, JLEV)*PB1 (JLON, JLEV)+PA3N (JLON, JLEV)*PNEB (JLON, JLEV)
    ZA4C (JLON, JLEV)=PA4C (JLON, JLEV)*PB1 (JLON, JLEV)+PA4N (JLON, JLEV)*PNEB (JLON, JLEV)
    ZA5C (JLON, JLEV)=PA5C (JLON, JLEV)*PB1 (JLON, JLEV)+PA5N (JLON, JLEV)*PNEB (JLON, JLEV)
  ENDIF


  

  

  IF (LDNUMX) THEN
    ZTD1=1._JPRB/(1._JPRB-PA5C (JLON, JLEV)*(ZAL2 *ZTU6 (JLON, JLEV-1)+ZGA2 *ZTU8 (JLON, JLEV-1)))
    ZFMC (JLON, JLEV-1)=ZTD1*(PA5C (JLON, JLEV)*(ZAL2 *ZFDC (JLON, JLEV-1)+ZGA2 *ZFDN (JLON&
    &, JLEV-1))+PA3C (JLON, JLEV)*(ZAL2 *ZFPC (JLON, JLEV-1)+ZGA2 *ZFPN (JLON, JLEV-1)))
    ZTU1 (JLON, JLEV)=ZTD1*PA5C (JLON, JLEV)*(ZAL2 *ZTU7 (JLON, JLEV-1)+ZGA2 *ZTU9 (JLON, JLEV-1))
    ZTU2 (JLON, JLEV)=(ZTD1*PA4C (JLON, JLEV))*ZAL1 
    ZTU3 (JLON, JLEV)=(ZTD1*PA4C (JLON, JLEV))*ZGA1 
    ZTD2=PA5N (JLON, JLEV)*(ZBE2 *ZTU6 (JLON, JLEV-1)+ZDE2 *ZTU8 (JLON, JLEV-1))
    ZTD3=1._JPRB/(1._JPRB-PA5N (JLON, JLEV)*(ZBE2 *ZTU7 (JLON, JLEV&
    &-1)+ZDE2 *ZTU9 (JLON, JLEV-1))-ZTD2*ZTU1 (JLON, JLEV))
    ZFMN (JLON, JLEV-1)=ZTD3*(PA5N (JLON, JLEV)*(ZBE2 *ZFDC (JLON, JLEV-1)+ZDE2 *ZFDN (JLON, JLEV-1))+ZTD2&
    &*ZFMC (JLON, JLEV-1)+PA3N (JLON, JLEV)*(ZBE2 *ZFPC (JLON, JLEV-1)+ZDE2 *ZFPN (JLON, JLEV-1)))
    ZTU4 (JLON, JLEV)=ZTD3*(PA4N (JLON, JLEV)*ZBE1 +ZTD2*ZTU2 (JLON, JLEV))
    ZTU5 (JLON, JLEV)=ZTD3*(PA4N (JLON, JLEV)*ZDE1 +ZTD2*ZTU3 (JLON, JLEV))
    ZFPC (JLON, JLEV)=PA1C (JLON, JLEV)*(ZAL2 *ZFPC (JLON, JLEV-1)+ZGA2 *ZFPN (JLON, JLEV-1))
    ZFPCUN (JLON, JLEV)=PA1CUN (JLON, JLEV)*(ZAL2 *ZFPCUN (JLON, JLEV-1)+ZGA2 *ZFPNUN (JLON, JLEV-1))
    ZFPN (JLON, JLEV)=PA1N (JLON, JLEV)*(ZBE2 *ZFPC (JLON, JLEV-1)+ZDE2 *ZFPN (JLON, JLEV-1))
    ZFPNUN (JLON, JLEV)=PA1NUN (JLON, JLEV)*(ZBE2 *ZFPCUN (JLON, JLEV-1)+ZDE2 *ZFPNUN (JLON, JLEV-1))
    ZTD4=PA4C (JLON, JLEV)*(ZAL2 *ZTU6 (JLON, JLEV-1)+ZGA2 *ZTU8 (JLON, JLEV-1))
    ZTD5=PA4C (JLON, JLEV)*(ZAL2 *ZTU7 (JLON, JLEV-1)+ZGA2 *ZTU9 (JLON, JLEV-1))
    ZFDC (JLON, JLEV)=PA4C (JLON, JLEV)*(ZAL2 *ZFDC (JLON, JLEV-1)+ZGA2 *ZFDN&
    & (JLON, JLEV-1))+ZTD4*ZFMC (JLON, JLEV-1)+ZTD5*ZFMN (JLON, JLEV-1)+PA2C&
    & (JLON, JLEV)*(ZAL2 *ZFPC (JLON, JLEV-1)+ZGA2 *ZFPN (JLON, JLEV-1))
    ZTU6 (JLON, JLEV)=PA5C (JLON, JLEV)*ZAL1 +ZTD4*ZTU2 (JLON, JLEV)+ZTD5*ZTU4 (JLON, JLEV)
    ZTU7 (JLON, JLEV)=PA5C (JLON, JLEV)*ZGA1 +ZTD4*ZTU3 (JLON, JLEV)+ZTD5*ZTU5 (JLON, JLEV)
    ZTD6=PA4N (JLON, JLEV)*(ZBE2 *ZTU6 (JLON, JLEV-1)+ZDE2 *ZTU8 (JLON, JLEV-1))
    ZTD7=PA4N (JLON, JLEV)*(ZBE2 *ZTU7 (JLON, JLEV-1)+ZDE2 *ZTU9 (JLON, JLEV-1))
    ZFDN (JLON, JLEV)=PA4N (JLON, JLEV)*(ZBE2 *ZFDC (JLON, JLEV-1)+ZDE2 *ZFDN&
    & (JLON, JLEV-1))+ZTD6*ZFMC (JLON, JLEV-1)+ZTD7*ZFMN (JLON, JLEV-1)+PA2N&
    & (JLON, JLEV)*(ZBE2 *ZFPC (JLON, JLEV-1)+ZDE2 *ZFPN (JLON, JLEV-1))
    ZTU8 (JLON, JLEV)=PA5N (JLON, JLEV)*ZBE1 +ZTD6*ZTU2 (JLON, JLEV)+ZTD7*ZTU4 (JLON, JLEV)
    ZTU9 (JLON, JLEV)=PA5N (JLON, JLEV)*ZDE1 +ZTD6*ZTU3 (JLON, JLEV)+ZTD7*ZTU5 (JLON, JLEV)
  ELSE
    ZTD1=1._JPRB/(1._JPRB-ZA5C (JLON, JLEV)*ZTU6 (JLON, JLEV-1))
    ZFMC (JLON, JLEV-1)=ZTD1*(ZA5C (JLON, JLEV)*ZFDC (JLON&
    &, JLEV-1)+ZA3C (JLON, JLEV)*ZFPC (JLON, JLEV-1))
    ZTU2 (JLON, JLEV)=ZTD1*ZA4C (JLON, JLEV)
    ZFPC (JLON, JLEV)=ZA1C (JLON, JLEV)*ZFPC (JLON, JLEV-1)
    ZFPCUN (JLON, JLEV)=ZA1CUN (JLON, JLEV)*ZFPCUN (JLON, JLEV-1)
    ZTD4=ZA4C (JLON, JLEV)*ZTU6 (JLON, JLEV-1)
    ZFDC (JLON, JLEV)=ZA4C (JLON, JLEV)*ZFDC (JLON, JLEV-1)+ZTD4*ZFMC&
    & (JLON, JLEV-1)+ZA2C (JLON, JLEV)*ZFPC (JLON, JLEV-1)
    ZTU6 (JLON, JLEV)=ZA5C (JLON, JLEV)+ZTD4*ZTU2 (JLON, JLEV)
  ENDIF

  
ENDDO


IF (YDPHY%LRTRUEBBC) THEN
  
  ZAL=PALB (JLON)
  ZALP=PALBDIR (JLON)
  ZTDS1=1._JPRB/(1._JPRB-ZAL*ZTU6 (JLON, KLEV))
  ZFPC_TRUE=ZFPCUN (JLON, KLEV)+(1._JPRB-PCLCT (JLON))*(PFRSODIRS_C (JLON)-PFRSODIRS_CUN (JLON))
  ZFMC (JLON, KLEV)=ZTDS1*(ZAL*(ZFDC (JLON, KLEV)+ZFPC (JLON, KLEV)-ZFPC_TRUE)+ZALP*ZFPC_TRUE)

  IF (LDNUMX) THEN
    ZTUS1=ZTDS1*ZAL*ZTU7 (JLON, KLEV)
    ZTDS2=ZAL*ZTU8 (JLON, KLEV)
    ZTDS3=1._JPRB/(1._JPRB-ZAL*ZTU9 (JLON, KLEV)-ZTDS2*ZTUS1)
    ZFMN (JLON, KLEV)=ZTDS3*(ZAL*(ZFDN (JLON, KLEV)+ZFPN (JLON, KLEV)-ZFPNUN&
    & (JLON, KLEV))+ZTDS2*ZFMC (JLON, KLEV)+ZALP*ZFPNUN (JLON, KLEV))
    ZFMC (JLON, KLEV)=ZFMC (JLON, KLEV)+ZTUS1*ZFMN (JLON, KLEV)
  ENDIF

  
ELSE
  
  ZAL=PALB (JLON)
  ZALP=PALBDIR (JLON)
  ZTDS1=1._JPRB/(1._JPRB-ZAL*ZTU6 (JLON, KLEV))
  ZFMC (JLON, KLEV)=ZTDS1*(ZAL*ZFDC (JLON, KLEV)+ZALP*ZFPC (JLON, KLEV))

  IF (LDNUMX) THEN
    ZTUS1=ZTDS1*ZAL*ZTU7 (JLON, KLEV)
    ZTDS2=ZAL*ZTU8 (JLON, KLEV)
    ZTDS3=1._JPRB/(1._JPRB-ZAL*ZTU9 (JLON, KLEV)-ZTDS2*ZTUS1)
    ZFMN (JLON, KLEV)=ZTDS3*(ZAL*ZFDN (JLON, KLEV)+ZTDS2*ZFMC (JLON, KLEV)+ZALP*ZFPN (JLON, KLEV))
    ZFMC (JLON, KLEV)=ZFMC (JLON, KLEV)+ZTUS1*ZFMN (JLON, KLEV)
  ENDIF

  
ENDIF


DO JLEV=KLEV, KTDIA,-1

  

  IF (LDNUMX) THEN
    ZFDN (JLON, JLEV)=ZFDN (JLON, JLEV)+ZTU8 (JLON, JLEV)*ZFMC&
    & (JLON, JLEV)+ZTU9 (JLON, JLEV)*ZFMN (JLON, JLEV)
    ZFDC (JLON, JLEV)=ZFDC (JLON, JLEV)+ZTU6 (JLON, JLEV)*ZFMC&
    & (JLON, JLEV)+ZTU7 (JLON, JLEV)*ZFMN (JLON, JLEV)
    ZFMN (JLON, JLEV-1)=ZFMN (JLON, JLEV-1)+ZTU4 (JLON, JLEV)&
    &*ZFMC (JLON, JLEV)+ZTU5 (JLON, JLEV)*ZFMN (JLON, JLEV)
    ZFMC (JLON, JLEV-1)=ZFMC (JLON, JLEV-1)+ZTU2 (JLON, JLEV)*ZFMC (JLON, JLEV)+ZTU3&
    & (JLON, JLEV)*ZFMN (JLON, JLEV)+ZTU1 (JLON, JLEV)*ZFMN (JLON, JLEV-1)
  ELSE
    ZFDC (JLON, JLEV)=ZFDC (JLON, JLEV)+ZTU6 (JLON, JLEV)*ZFMC (JLON, JLEV)
    ZFMC (JLON, JLEV-1)=ZFMC (JLON, JLEV-1)+ZTU2 (JLON, JLEV)*ZFMC (JLON, JLEV)
  ENDIF

  
ENDDO

PFRSO (JLON,:)=0._JPRB
PFRSODIFS (JLON)=0._JPRB
PFRSODIRS (JLON)=0._JPRB
PFRSODIRS_UN (JLON)=0._JPRB
PFRSODIRS_TRUE (JLON)=0._JPRB

DO JLEV=KTDIA-1, KLEV
  
  PFRSO (JLON, JLEV)=ZFPC (JLON, JLEV)+ZFDC (JLON, JLEV)-ZFMC (JLON, JLEV)

  IF (LDNUMX) THEN
    PFRSO (JLON, JLEV)=PFRSO (JLON, JLEV)+ZFPN (JLON, JLEV)+ZFDN (JLON, JLEV)-ZFMN (JLON, JLEV)
  ENDIF

  
ENDDO


DO JLEV=0, KTDIA-2
  
  PFRSO (JLON, JLEV)=PFRSO (JLON, KTDIA-1)
  
ENDDO


PFRSODIRS_UN (JLON)=ZFPCUN (JLON, KLEV)

IF (LDNUMX) THEN
  PFRSODIRS_UN (JLON)=PFRSODIRS_UN (JLON)+ZFPNUN (JLON, KLEV)
ENDIF

PFRSODIRS_TRUE (JLON)=PFRSODIRS_UN (JLON)+(1._JPRB-PCLCT&
& (JLON))*(PFRSODIRS_C (JLON)-PFRSODIRS_CUN (JLON))


PFRSODIFS (JLON)=ZFDC (JLON, KLEV)
PFRSODIRS (JLON)=ZFPC (JLON, KLEV)

IF (LDNUMX) THEN
  PFRSODIFS (JLON)=PFRSODIFS (JLON)+ZFDN (JLON, KLEV)
  PFRSODIRS (JLON)=PFRSODIRS (JLON)+ZFPN (JLON, KLEV)
ENDIF



IF (YDPHY%LRTRUEDIR) THEN
  
  PFRSODIFS (JLON)=PFRSODIFS (JLON)+PFRSODIRS (JLON)-PFRSODIRS_TRUE (JLON)
  PFRSODIRS (JLON)=PFRSODIRS_TRUE (JLON)
  
ENDIF



END SUBROUTINE ACRANEB_SOLVS_OPENACC
