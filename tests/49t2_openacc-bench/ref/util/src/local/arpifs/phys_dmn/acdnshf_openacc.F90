SUBROUTINE ACDNSHF_OPENACC (YDCST, YDPHY, YDPHY1, KIDIA, KFDIA, KLON, KTDIA, KLEV&
&, PEMIS, PLSM, PNEIJ, PQ, PQS, PTS, PCHROV, PDQSTS, PDERNSHF, YDSTACK)
!$ACC ROUTINE (ACDNSHF_OPENACC) SEQ
USE PARKIND1,ONLY:JPIM, JPRB

USE YOMPHY,ONLY:TPHY
USE YOMCST,ONLY:TCST
USE YOMPHY1,ONLY:TPHY1
#include "fxtran_acdc_stack.h"
USE FXTRAN_ACDC_STACK_MOD
USE FXTRAN_ACDC_ABORT_MOD

IMPLICIT NONE


TYPE (TCST), INTENT (IN)::YDCST
TYPE (TPHY), INTENT (IN)::YDPHY
TYPE (TPHY1), INTENT (IN)::YDPHY1
INTEGER (KIND=JPIM), INTENT (IN)::KLON
INTEGER (KIND=JPIM), INTENT (IN)::KLEV
INTEGER (KIND=JPIM), INTENT (IN)::KIDIA
INTEGER (KIND=JPIM), INTENT (IN)::KFDIA
INTEGER (KIND=JPIM), INTENT (IN)::KTDIA
REAL (KIND=JPRB), INTENT (IN)::PEMIS (KLON)
REAL (KIND=JPRB), INTENT (IN)::PLSM (KLON)
REAL (KIND=JPRB), INTENT (IN)::PNEIJ (KLON)
REAL (KIND=JPRB), INTENT (IN)::PQ (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PQS (KLON)
REAL (KIND=JPRB), INTENT (IN)::PTS (KLON)
REAL (KIND=JPRB), INTENT (IN)::PCHROV (KLON)
REAL (KIND=JPRB), INTENT (IN)::PDQSTS (KLON)
REAL (KIND=JPRB), INTENT (OUT)::PDERNSHF (KLON)
TYPE(FXTRAN_ACDC_STACK), INTENT (IN) :: YDSTACK
REAL (KIND=JPRB)::ZZPN 
REAL (KIND=JPRB)::ZZDRCN 
REAL (KIND=JPRB)::ZZDLLS 
REAL (KIND=JPRB)::ZZDLLW 
REAL (KIND=JPRB)::ZZDLS 
INTEGER (KIND=JPIM)::JLON
INTEGER (KIND=JPIM)::JLEV
REAL (KIND=JPRB)::ZCPVMW
REAL (KIND=JPRB)::ZCPVMS
REAL (KIND=JPRB)::ZCPVMD

#include "fcttrm.func.h"

JLON = KIDIA



ZCPVMD=YDCST%RCPV-YDCST%RCPD
ZCPVMW=YDCST%RCPV-YDCST%RCW
ZCPVMS=YDCST%RCPV-YDCST%RCS

DO JLEV=KTDIA, KLEV

  

  IF (YDPHY%LNEIGE) THEN
    ZZPN =PLSM (JLON)*PNEIJ (JLON)+(1.0_JPRB-PLSM (JLON))*MAX&
    & (0.0_JPRB, SIGN (1.0_JPRB, YDPHY1%TMERGL-PTS (JLON)))
  ELSE
    ZZPN =0.0_JPRB
  ENDIF

  
  
  ZZDLS =PCHROV (JLON)*(YDCST%RCPD+ZCPVMD*PQS (JLON)+ZCPVMD*PDQSTS (JLON)*PTS (JLON))
  ZZDLLW =(1.0_JPRB-ZZPN )*PCHROV (JLON)*((PQS (JLON)-PQ (JLON,&
  & KLEV))*ZCPVMW+FOLH (PTS (JLON), 0.0_JPRB)*PDQSTS (JLON))
  ZZDLLS =PCHROV (JLON)*ZZPN *((PQS (JLON)-PQ (JLON, KLEV&
  &))*ZCPVMS+FOLH (PTS (JLON), 1.0_JPRB)*PDQSTS (JLON))
  ZZDRCN =PEMIS (JLON)*4._JPRB*YDCST%RSIGMA*PTS (JLON)*PTS (JLON)*PTS (JLON)
  PDERNSHF (JLON)=-(ZZDLS +ZZDLLW +ZZDLLS +ZZDRCN )
  
ENDDO



END SUBROUTINE ACDNSHF_OPENACC
