MODULE CPG_TYPE_MOD

!$ACDC methods --methods-list=host,wipe,copy --skip-components cpg --field-api --field-api-class cpg


USE FIELD_MODULE
USE FIELD_ARRAY_MODULE
USE FIELD_FACTORY_MODULE
USE FIELD_REGISTRY_MOD
USE PARKIND1, ONLY : JPRB, JPIM, JPIB
USE YOM_YGFL, ONLY : TYPE_GFL_COMP

IMPLICIT NONE

TYPE CPG_XYBDER_TYPE
  LOGICAL :: LOWNED = .FALSE.
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ZVIEW (:,:,:) => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ZDATA (:,:,:,:) => NULL ()
  CLASS (FIELD_4RB), POINTER :: F_DATA => NULL ()
  INTEGER (KIND=JPIM) :: IP_LNPRL = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: LNPRL (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: LNPRL (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_LNPRL => NULL ()
  INTEGER (KIND=JPIM) :: IP_LNPRM = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: LNPRM (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: LNPRM (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_LNPRM => NULL ()
  INTEGER (KIND=JPIM) :: IP_ALPHL = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ALPHL (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: ALPHL (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_ALPHL => NULL ()
  INTEGER (KIND=JPIM) :: IP_ALPHM = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ALPHM (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: ALPHM (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_ALPHM => NULL ()
  INTEGER (KIND=JPIM) :: IP_ALPHPLL = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ALPHPLL (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: ALPHPLL (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_ALPHPLL => NULL ()
  INTEGER (KIND=JPIM) :: IP_ALPHPLM = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ALPHPLM (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: ALPHPLM (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_ALPHPLM => NULL ()
  INTEGER (KIND=JPIM) :: IP_COEFD = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: COEFD (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: COEFD (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_COEFD => NULL ()
  INTEGER (KIND=JPIM) :: IP_COEFA = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: COEFA (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: COEFA (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_COEFA => NULL ()
  INTEGER (KIND=JPIM) :: IP_COEFAPL = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: COEFAPL (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: COEFAPL (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_COEFAPL => NULL ()

CONTAINS
  PROCEDURE :: INIT => CPG_XYBDER_TYPE_INIT
  PROCEDURE :: CONFORM => CPG_XYBDER_TYPE_CONFORM
  PROCEDURE :: RESIZE => CPG_XYBDER_TYPE_RESIZE
  PROCEDURE :: UPDATE_VIEW => CPG_XYBDER_TYPE_UPDATE_VIEW
  PROCEDURE :: FINAL => CPG_XYBDER_TYPE_FINAL
PROCEDURE :: ACDC_COPY => ACDC_COPY_CPG_XYBDER_TYPE
PROCEDURE :: ACDC_HOST => ACDC_HOST_CPG_XYBDER_TYPE
PROCEDURE :: ACDC_WIPE => ACDC_WIPE_CPG_XYBDER_TYPE
END TYPE CPG_XYBDER_TYPE

TYPE CPG_XYB_TYPE
  LOGICAL :: LOWNED = .FALSE.
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ZVIEW (:,:,:) => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ZDATA (:,:,:,:) => NULL ()
  CLASS (FIELD_4RB), POINTER :: F_DATA => NULL ()
  INTEGER (KIND=JPIM) :: IP_DELP = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DELP (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DELP (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_DELP => NULL ()
  INTEGER (KIND=JPIM) :: IP_RDELP = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: RDELP (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: RDELP (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_RDELP => NULL ()
  INTEGER (KIND=JPIM) :: IP_LNPR = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: LNPR (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: LNPR (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_LNPR => NULL ()
  INTEGER (KIND=JPIM) :: IP_ALPH = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ALPH (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: ALPH (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_ALPH => NULL ()
  INTEGER (KIND=JPIM) :: IP_RTGR = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: RTGR (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: RTGR (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_RTGR => NULL ()
  INTEGER (KIND=JPIM) :: IP_RPRE = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: RPRE (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: RPRE (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_RPRE => NULL ()
  INTEGER (KIND=JPIM) :: IP_RPP = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: RPP (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: RPP (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_RPP => NULL ()

CONTAINS
  PROCEDURE :: INIT => CPG_XYB_TYPE_INIT
  PROCEDURE :: CONFORM => CPG_XYB_TYPE_CONFORM
  PROCEDURE :: RESIZE => CPG_XYB_TYPE_RESIZE
  PROCEDURE :: UPDATE_VIEW => CPG_XYB_TYPE_UPDATE_VIEW
  PROCEDURE :: FINAL => CPG_XYB_TYPE_FINAL
PROCEDURE :: ACDC_COPY => ACDC_COPY_CPG_XYB_TYPE
PROCEDURE :: ACDC_HOST => ACDC_HOST_CPG_XYB_TYPE
PROCEDURE :: ACDC_WIPE => ACDC_WIPE_CPG_XYB_TYPE
END TYPE CPG_XYB_TYPE

TYPE CPG_HWIND_TYPE
  LOGICAL :: LOWNED = .FALSE.
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ZVIEW (:,:,:) => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ZDATA (:,:,:,:) => NULL ()
  CLASS (FIELD_4RB), POINTER :: F_DATA => NULL ()
  INTEGER (KIND=JPIM) :: IP_UH = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: UH (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: UH (NPROMA, 0:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_UH => NULL ()
  INTEGER (KIND=JPIM) :: IP_VH = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: VH (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: VH (NPROMA, 0:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_VH => NULL ()
  INTEGER (KIND=JPIM) :: IP_WWI = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: WWI (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: WWI (NPROMA, 0:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_WWI => NULL ()

CONTAINS
  PROCEDURE :: INIT => CPG_HWIND_TYPE_INIT
  PROCEDURE :: CONFORM => CPG_HWIND_TYPE_CONFORM
  PROCEDURE :: RESIZE => CPG_HWIND_TYPE_RESIZE
  PROCEDURE :: UPDATE_VIEW => CPG_HWIND_TYPE_UPDATE_VIEW
  PROCEDURE :: FINAL => CPG_HWIND_TYPE_FINAL
PROCEDURE :: ACDC_COPY => ACDC_COPY_CPG_HWIND_TYPE
PROCEDURE :: ACDC_HOST => ACDC_HOST_CPG_HWIND_TYPE
PROCEDURE :: ACDC_WIPE => ACDC_WIPE_CPG_HWIND_TYPE
END TYPE CPG_HWIND_TYPE

TYPE CPG_RCP_TYPE
  LOGICAL :: LOWNED = .FALSE.
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ZVIEW (:,:,:) => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ZDATA (:,:,:,:) => NULL ()
  CLASS (FIELD_4RB), POINTER :: F_DATA => NULL ()
  INTEGER (KIND=JPIM) :: IP_CP = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: CP (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: CP (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_CP => NULL ()
  INTEGER (KIND=JPIM) :: IP_R = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: R (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: R (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_R => NULL ()
  INTEGER (KIND=JPIM) :: IP_KAP = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: KAP (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: KAP (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_KAP => NULL ()

CONTAINS
  PROCEDURE :: INIT => CPG_RCP_TYPE_INIT
  PROCEDURE :: CONFORM => CPG_RCP_TYPE_CONFORM
  PROCEDURE :: RESIZE => CPG_RCP_TYPE_RESIZE
  PROCEDURE :: UPDATE_VIEW => CPG_RCP_TYPE_UPDATE_VIEW
  PROCEDURE :: FINAL => CPG_RCP_TYPE_FINAL
PROCEDURE :: ACDC_COPY => ACDC_COPY_CPG_RCP_TYPE
PROCEDURE :: ACDC_HOST => ACDC_HOST_CPG_RCP_TYPE
PROCEDURE :: ACDC_WIPE => ACDC_WIPE_CPG_RCP_TYPE
END TYPE CPG_RCP_TYPE

TYPE CPG_CTY_TYPE
  LOGICAL :: LOWNED = .FALSE.
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ZVIEW (:,:,:) => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ZDATA (:,:,:,:) => NULL ()
  CLASS (FIELD_4RB), POINTER :: F_DATA => NULL ()
  INTEGER (KIND=JPIM) :: IP_EVEL = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: EVEL (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: EVEL (NPROMA, 0:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_EVEL => NULL ()
  INTEGER (KIND=JPIM) :: IP_VVEL = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: VVEL (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: VVEL (NPROMA, 0:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_VVEL => NULL ()
  INTEGER (KIND=JPIM) :: IP_PSDIV = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PSDIV (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: PSDIV (NPROMA, 0:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_PSDIV => NULL ()
  INTEGER (KIND=JPIM) :: IP_PSDVBC = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PSDVBC (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: PSDVBC (NPROMA, 0:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_PSDVBC => NULL ()
  INTEGER (KIND=JPIM) :: IP_DIVDP = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DIVDP (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DIVDP (NPROMA, 0:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_DIVDP => NULL ()

CONTAINS
  PROCEDURE :: INIT => CPG_CTY_TYPE_INIT
  PROCEDURE :: CONFORM => CPG_CTY_TYPE_CONFORM
  PROCEDURE :: RESIZE => CPG_CTY_TYPE_RESIZE
  PROCEDURE :: UPDATE_VIEW => CPG_CTY_TYPE_UPDATE_VIEW
  PROCEDURE :: FINAL => CPG_CTY_TYPE_FINAL
PROCEDURE :: ACDC_COPY => ACDC_COPY_CPG_CTY_TYPE
PROCEDURE :: ACDC_HOST => ACDC_HOST_CPG_CTY_TYPE
PROCEDURE :: ACDC_WIPE => ACDC_WIPE_CPG_CTY_TYPE
END TYPE CPG_CTY_TYPE

TYPE CPG_TND_TYPE
  LOGICAL :: LOWNED = .FALSE.
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ZVIEW (:,:,:) => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ZDATA (:,:,:,:) => NULL ()
  CLASS (FIELD_4RB), POINTER :: F_DATA => NULL ()
  INTEGER (KIND=JPIM) :: IP_TNDU = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: TNDU (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: TNDU (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_TNDU => NULL ()
  INTEGER (KIND=JPIM) :: IP_TNDV = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: TNDV (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: TNDV (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_TNDV => NULL ()
  INTEGER (KIND=JPIM) :: IP_TNDU_NOC = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: TNDU_NOC (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: TNDU_NOC (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_TNDU_NOC => NULL ()
  INTEGER (KIND=JPIM) :: IP_TNDV_NOC = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: TNDV_NOC (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: TNDV_NOC (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_TNDV_NOC => NULL ()
  INTEGER (KIND=JPIM) :: IP_TNDT = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: TNDT (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: TNDT (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_TNDT => NULL ()
  INTEGER (KIND=JPIM) :: IP_TNDPD = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: TNDPD (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: TNDPD (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_TNDPD => NULL ()
  INTEGER (KIND=JPIM) :: IP_TNDVD = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: TNDVD (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: TNDVD (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_TNDVD => NULL ()
  INTEGER (KIND=JPIM) :: IP_TNDGW = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: TNDGW (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: TNDGW (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_TNDGW => NULL ()

CONTAINS
  PROCEDURE :: INIT => CPG_TND_TYPE_INIT
  PROCEDURE :: CONFORM => CPG_TND_TYPE_CONFORM
  PROCEDURE :: RESIZE => CPG_TND_TYPE_RESIZE
  PROCEDURE :: UPDATE_VIEW => CPG_TND_TYPE_UPDATE_VIEW
  PROCEDURE :: FINAL => CPG_TND_TYPE_FINAL
PROCEDURE :: ACDC_COPY => ACDC_COPY_CPG_TND_TYPE
PROCEDURE :: ACDC_HOST => ACDC_HOST_CPG_TND_TYPE
PROCEDURE :: ACDC_WIPE => ACDC_WIPE_CPG_TND_TYPE
END TYPE CPG_TND_TYPE

TYPE CPG_GPAR_TYPE
  LOGICAL :: LOWNED = .FALSE.
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ZVIEW (:,:) => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ZDATA (:,:,:) => NULL ()
  CLASS (FIELD_3RB), POINTER :: F_DATA => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: INPRR (:) => NULL ()
!>REAL (KIND=JPRB)                      :: INPRR (NPROMA)
  CLASS (FIELD_2RB), POINTER :: F_INPRR => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: INPRS (:) => NULL ()
!>REAL (KIND=JPRB)                      :: INPRS (NPROMA)
  CLASS (FIELD_2RB), POINTER :: F_INPRS => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: INPRG (:) => NULL ()
!>REAL (KIND=JPRB)                      :: INPRG (NPROMA)
  CLASS (FIELD_2RB), POINTER :: F_INPRG => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ACPRR (:) => NULL ()
!>REAL (KIND=JPRB)                      :: ACPRR (NPROMA)
  CLASS (FIELD_2RB), POINTER :: F_ACPRR => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ACPRS (:) => NULL ()
!>REAL (KIND=JPRB)                      :: ACPRS (NPROMA)
  CLASS (FIELD_2RB), POINTER :: F_ACPRS => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ACPRG (:) => NULL ()
!>REAL (KIND=JPRB)                      :: ACPRG (NPROMA)
  CLASS (FIELD_2RB), POINTER :: F_ACPRG => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ALBDIR (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: ALBDIR (NPROMA, 1:YDCPG_OPTS%KSW)
  CLASS (FIELD_3RB), POINTER :: F_ALBDIR => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ALBSCA (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: ALBSCA (NPROMA, 1:YDCPG_OPTS%KSW)
  CLASS (FIELD_3RB), POINTER :: F_ALBSCA => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: RAIN (:) => NULL ()
!>REAL (KIND=JPRB)                      :: RAIN (NPROMA)
  CLASS (FIELD_2RB), POINTER :: F_RAIN => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: SNOW (:) => NULL ()
!>REAL (KIND=JPRB)                      :: SNOW (NPROMA)
  CLASS (FIELD_2RB), POINTER :: F_SNOW => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: GZ0 (:) => NULL ()
!>REAL (KIND=JPRB)                      :: GZ0 (NPROMA)
  CLASS (FIELD_2RB), POINTER :: F_GZ0 => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: GZ0H (:) => NULL ()
!>REAL (KIND=JPRB)                      :: GZ0H (NPROMA)
  CLASS (FIELD_2RB), POINTER :: F_GZ0H => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: VQS (:) => NULL ()
!>REAL (KIND=JPRB)                      :: VQS (NPROMA)
  CLASS (FIELD_2RB), POINTER :: F_VQS => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: VTS (:) => NULL ()
!>REAL (KIND=JPRB)                      :: VTS (NPROMA)
  CLASS (FIELD_2RB), POINTER :: F_VTS => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: VEMIS (:) => NULL ()
!>REAL (KIND=JPRB)                      :: VEMIS (NPROMA)
  CLASS (FIELD_2RB), POINTER :: F_VEMIS => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: SWDIR (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: SWDIR (NPROMA, 1:YDCPG_OPTS%KSW)
  CLASS (FIELD_3RB), POINTER :: F_SWDIR => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: SWDIF (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: SWDIF (NPROMA, 1:YDCPG_OPTS%KSW)
  CLASS (FIELD_3RB), POINTER :: F_SWDIF => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: LSM (:) => NULL ()
!>REAL (KIND=JPRB)                      :: LSM (NPROMA)
  CLASS (FIELD_2RB), POINTER :: F_LSM => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: CD (:) => NULL ()
!>REAL (KIND=JPRB)                      :: CD (NPROMA)
  CLASS (FIELD_2RB), POINTER :: F_CD => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: CH (:) => NULL ()
!>REAL (KIND=JPRB)                      :: CH (NPROMA)
  CLASS (FIELD_2RB), POINTER :: F_CH => NULL ()

CONTAINS
  PROCEDURE :: INIT => CPG_GPAR_TYPE_INIT
  PROCEDURE :: UPDATE_VIEW => CPG_GPAR_TYPE_UPDATE_VIEW
  PROCEDURE :: FINAL => CPG_GPAR_TYPE_FINAL
PROCEDURE :: ACDC_COPY => ACDC_COPY_CPG_GPAR_TYPE
PROCEDURE :: ACDC_HOST => ACDC_HOST_CPG_GPAR_TYPE
PROCEDURE :: ACDC_WIPE => ACDC_WIPE_CPG_GPAR_TYPE
END TYPE CPG_GPAR_TYPE

TYPE CPG_DYN_TYPE

  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: OROGL (:) => NULL ()
!>REAL (KIND=JPRB)                      :: OROGL (NPROMA)
  CLASS (FIELD_2RB), POINTER :: F_OROGL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: OROGM (:) => NULL ()
!>REAL (KIND=JPRB)                      :: OROGM (NPROMA)
  CLASS (FIELD_2RB), POINTER :: F_OROGM => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: OROGLL (:) => NULL ()
!>REAL (KIND=JPRB)                      :: OROGLL (NPROMA)
  CLASS (FIELD_2RB), POINTER :: F_OROGLL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: OROGLM (:) => NULL ()
!>REAL (KIND=JPRB)                      :: OROGLM (NPROMA)
  CLASS (FIELD_2RB), POINTER :: F_OROGLM => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: OROGMM (:) => NULL ()
!>REAL (KIND=JPRB)                      :: OROGMM (NPROMA)
  CLASS (FIELD_2RB), POINTER :: F_OROGMM => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PHI (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: PHI (NPROMA, 0:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_PHI => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PRE (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: PRE (NPROMA, 0:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_PRE => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PHIF (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: PHIF (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_PHIF => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PREF (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: PREF (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_PREF => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PREL (:) => NULL ()
!>REAL (KIND=JPRB)                      :: PREL (NPROMA)
  CLASS (FIELD_2RB), POINTER :: F_PREL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PREM (:) => NULL ()
!>REAL (KIND=JPRB)                      :: PREM (NPROMA)
  CLASS (FIELD_2RB), POINTER :: F_PREM => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: NHY (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: NHY (NPROMA, 0:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_NHY => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: GWFT (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: GWFT (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_GWFT => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: KENE (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: KENE (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_KENE => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: NHX (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: NHX (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_NHX => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PHIFL (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: PHIFL (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_PHIFL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PHIFM (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: PHIFM (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_PHIFM => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: RTL (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: RTL (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_RTL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: RTM (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: RTM (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_RTM => NULL ()
  TYPE (CPG_RCP_TYPE) :: RCP
  TYPE (CPG_CTY_TYPE) :: CTY
  TYPE (CPG_HWIND_TYPE) :: UVH
  TYPE (CPG_XYB_TYPE) :: XYB
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DBBC (:) => NULL ()
!>REAL (KIND=JPRB)                      :: DBBC (NPROMA)
  CLASS (FIELD_2RB), POINTER :: F_DBBC => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: GWS (:) => NULL ()
!>REAL (KIND=JPRB)                      :: GWS (NPROMA)
  CLASS (FIELD_2RB), POINTER :: F_GWS => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: GWFL (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: GWFL (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_GWFL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: GWFM (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: GWFM (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_GWFM => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: GWT (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: GWT (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_GWT => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: NHPREF (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: NHPREF (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_NHPREF => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: NHPREH (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: NHPREH (NPROMA, 0:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_NHPREH => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: QCHAL (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: QCHAL (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_QCHAL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: QCHAM (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: QCHAM (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_QCHAM => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: RDPHI (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: RDPHI (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_RDPHI => NULL ()

CONTAINS
  PROCEDURE :: INIT => CPG_DYN_TYPE_INIT
  PROCEDURE :: UPDATE_VIEW => CPG_DYN_TYPE_UPDATE_VIEW
  PROCEDURE :: FINAL => CPG_DYN_TYPE_FINAL
PROCEDURE :: ACDC_COPY => ACDC_COPY_CPG_DYN_TYPE
PROCEDURE :: ACDC_HOST => ACDC_HOST_CPG_DYN_TYPE
PROCEDURE :: ACDC_WIPE => ACDC_WIPE_CPG_DYN_TYPE
END TYPE CPG_DYN_TYPE

TYPE CPG_PHY_TYPE

  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PRE (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: PRE (NPROMA, 0:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_PRE => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PREF (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: PREF (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_PREF => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PREHYD (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: PREHYD (NPROMA, 0:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_PREHYD => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PREHYDF (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: PREHYDF (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_PREHYDF => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: WL (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: WL (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_WL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: WM (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: WM (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_WM => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: W (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: W (NPROMA, 1:NLEV)
  CLASS (FIELD_3RB), POINTER :: F_W => NULL ()
  TYPE (CPG_XYB_TYPE) :: XYB

CONTAINS
  PROCEDURE :: INIT => CPG_PHY_TYPE_INIT
  PROCEDURE :: UPDATE_VIEW => CPG_PHY_TYPE_UPDATE_VIEW
  PROCEDURE :: FINAL => CPG_PHY_TYPE_FINAL
PROCEDURE :: ACDC_COPY => ACDC_COPY_CPG_PHY_TYPE
PROCEDURE :: ACDC_HOST => ACDC_HOST_CPG_PHY_TYPE
PROCEDURE :: ACDC_WIPE => ACDC_WIPE_CPG_PHY_TYPE
END TYPE CPG_PHY_TYPE

TYPE CPG_MISC_TYPE

  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: NEB (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: NEB (NPROMA, 1:YDCPG_OPTS%KFLEVG)
  CLASS (FIELD_3RB), POINTER :: F_NEB => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: QLI (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: QLI (NPROMA, 1:YDCPG_OPTS%KFLEVG)
  CLASS (FIELD_3RB), POINTER :: F_QLI => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: QICE (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: QICE (NPROMA, 1:YDCPG_OPTS%KFLEVG)
  CLASS (FIELD_3RB), POINTER :: F_QICE => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: QRAIN (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: QRAIN (NPROMA, 1:YDCPG_OPTS%KFLEVG)
  CLASS (FIELD_3RB), POINTER :: F_QRAIN => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: QSNOW (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: QSNOW (NPROMA, 1:YDCPG_OPTS%KFLEVG)
  CLASS (FIELD_3RB), POINTER :: F_QSNOW => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: QGRAUPEL (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: QGRAUPEL (NPROMA, 1:YDCPG_OPTS%KFLEVG)
  CLASS (FIELD_3RB), POINTER :: F_QGRAUPEL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: RH (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: RH (NPROMA, 1:YDCPG_OPTS%KFLEVG)
  CLASS (FIELD_3RB), POINTER :: F_RH => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: QS (:) => NULL ()
!>REAL (KIND=JPRB)                      :: QS (NPROMA)
  CLASS (FIELD_2RB), POINTER :: F_QS => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: QSOL (:) => NULL ()
!>REAL (KIND=JPRB)                      :: QSOL (NPROMA)
  CLASS (FIELD_2RB), POINTER :: F_QSOL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DHSF (:) => NULL ()
!>REAL (KIND=JPRB)                      :: DHSF (NPROMA)
  CLASS (FIELD_2RB), POINTER :: F_DHSF => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: CLCT (:) => NULL ()
!>REAL (KIND=JPRB)                      :: CLCT (NPROMA)
  CLASS (FIELD_2RB), POINTER :: F_CLCT => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: LSM (:) => NULL ()
!>REAL (KIND=JPRB)                      :: LSM (NPROMA)
  CLASS (FIELD_2RB), POINTER :: F_LSM => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: TSOL (:) => NULL ()
!>REAL (KIND=JPRB)                      :: TSOL (NPROMA)
  CLASS (FIELD_2RB), POINTER :: F_TSOL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: FTCNS (:, :, :) => NULL ()
!>REAL (KIND=JPRB)                      :: FTCNS (NPROMA, 0:YDCPG_OPTS%KFLEVG, 1:6)
  CLASS (FIELD_4RB), POINTER :: F_FTCNS => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: KOZO (:, :, :) => NULL ()
!>REAL (KIND=JPRB)                      :: KOZO (NPROMA, 1:YDCPG_OPTS%KFLEVG, 1:YDCPG_OPTS%KVCLIS)
  CLASS (FIELD_4RB), POINTER :: F_KOZO => NULL ()

CONTAINS
  PROCEDURE :: INIT => CPG_MISC_TYPE_INIT
  PROCEDURE :: UPDATE_VIEW => CPG_MISC_TYPE_UPDATE_VIEW
  PROCEDURE :: FINAL => CPG_MISC_TYPE_FINAL
PROCEDURE :: ACDC_COPY => ACDC_COPY_CPG_MISC_TYPE
PROCEDURE :: ACDC_HOST => ACDC_HOST_CPG_MISC_TYPE
PROCEDURE :: ACDC_WIPE => ACDC_WIPE_CPG_MISC_TYPE
END TYPE CPG_MISC_TYPE

TYPE CPG_DDH_TYPE
  REAL(KIND=JPRB), POINTER, CONTIGUOUS :: AUX3D (:,:,:) => NULL ()
  CLASS (FIELD_4RB), POINTER :: F_AUX3D => NULL ()
  
  REAL(KIND=JPRB), POINTER, CONTIGUOUS :: AUX2D (:,:) => NULL ()
  CLASS (FIELD_3RB), POINTER :: F_AUX2D => NULL ()

  REAL(KIND=JPRB), POINTER, CONTIGUOUS :: DHCV  (:,:,:) => NULL ()
  CLASS (FIELD_4RB), POINTER :: F_DHCV => NULL ()
  REAL(KIND=JPRB), POINTER, CONTIGUOUS :: AUXSM (:,:,:,:) => NULL ()
  CLASS (FIELD_5RB), POINTER :: F_AUXSM => NULL ()
  INTEGER(KIND=JPIM), POINTER, CONTIGUOUS :: DDHI (:) => NULL ()
  CLASS (FIELD_2IM), POINTER :: F_DDHI => NULL ()
CONTAINS
  PROCEDURE :: INIT => CPG_DDH_TYPE_INIT
  PROCEDURE :: UPDATE_VIEW => CPG_DDH_TYPE_UPDATE_VIEW
  PROCEDURE :: FINAL => CPG_DDH_TYPE_FINAL
PROCEDURE :: ACDC_COPY => ACDC_COPY_CPG_DDH_TYPE
PROCEDURE :: ACDC_HOST => ACDC_HOST_CPG_DDH_TYPE
PROCEDURE :: ACDC_WIPE => ACDC_WIPE_CPG_DDH_TYPE
END TYPE CPG_DDH_TYPE

REAL(KIND=JPRB),    PRIVATE, SAVE, TARGET :: ZDUM1 (1), ZDUM2 (1, 1), ZDUM3 (1,1,1)
INTEGER(KIND=JPIM), PRIVATE, SAVE, TARGET :: IDUM1 (1), IDUM2 (1, 1), IDUM3 (1,1,1)

INTERFACE

MODULE SUBROUTINE ACDC_COPY_CPG_XYBDER_TYPE (SELF, LDCREATED, LDFIELDAPI)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (CPG_XYBDER_TYPE), INTENT (IN), TARGET :: SELF
LOGICAL, OPTIONAL, INTENT (IN) :: LDCREATED, LDFIELDAPI
END SUBROUTINE

MODULE SUBROUTINE ACDC_HOST_CPG_XYBDER_TYPE (SELF)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (CPG_XYBDER_TYPE), TARGET :: SELF
END SUBROUTINE

MODULE SUBROUTINE ACDC_WIPE_CPG_XYBDER_TYPE (SELF, LDDELETED, LDFIELDAPI)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (CPG_XYBDER_TYPE), INTENT (IN), TARGET :: SELF
LOGICAL, OPTIONAL, INTENT (IN) :: LDDELETED, LDFIELDAPI
END SUBROUTINE

MODULE SUBROUTINE ACDC_COPY_CPG_XYB_TYPE (SELF, LDCREATED, LDFIELDAPI)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (CPG_XYB_TYPE), INTENT (IN), TARGET :: SELF
LOGICAL, OPTIONAL, INTENT (IN) :: LDCREATED, LDFIELDAPI
END SUBROUTINE

MODULE SUBROUTINE ACDC_HOST_CPG_XYB_TYPE (SELF)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (CPG_XYB_TYPE), TARGET :: SELF
END SUBROUTINE

MODULE SUBROUTINE ACDC_WIPE_CPG_XYB_TYPE (SELF, LDDELETED, LDFIELDAPI)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (CPG_XYB_TYPE), INTENT (IN), TARGET :: SELF
LOGICAL, OPTIONAL, INTENT (IN) :: LDDELETED, LDFIELDAPI
END SUBROUTINE

MODULE SUBROUTINE ACDC_COPY_CPG_HWIND_TYPE (SELF, LDCREATED, LDFIELDAPI)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (CPG_HWIND_TYPE), INTENT (IN), TARGET :: SELF
LOGICAL, OPTIONAL, INTENT (IN) :: LDCREATED, LDFIELDAPI
END SUBROUTINE

MODULE SUBROUTINE ACDC_HOST_CPG_HWIND_TYPE (SELF)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (CPG_HWIND_TYPE), TARGET :: SELF
END SUBROUTINE

MODULE SUBROUTINE ACDC_WIPE_CPG_HWIND_TYPE (SELF, LDDELETED, LDFIELDAPI)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (CPG_HWIND_TYPE), INTENT (IN), TARGET :: SELF
LOGICAL, OPTIONAL, INTENT (IN) :: LDDELETED, LDFIELDAPI
END SUBROUTINE

MODULE SUBROUTINE ACDC_COPY_CPG_RCP_TYPE (SELF, LDCREATED, LDFIELDAPI)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (CPG_RCP_TYPE), INTENT (IN), TARGET :: SELF
LOGICAL, OPTIONAL, INTENT (IN) :: LDCREATED, LDFIELDAPI
END SUBROUTINE

MODULE SUBROUTINE ACDC_HOST_CPG_RCP_TYPE (SELF)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (CPG_RCP_TYPE), TARGET :: SELF
END SUBROUTINE

MODULE SUBROUTINE ACDC_WIPE_CPG_RCP_TYPE (SELF, LDDELETED, LDFIELDAPI)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (CPG_RCP_TYPE), INTENT (IN), TARGET :: SELF
LOGICAL, OPTIONAL, INTENT (IN) :: LDDELETED, LDFIELDAPI
END SUBROUTINE

MODULE SUBROUTINE ACDC_COPY_CPG_CTY_TYPE (SELF, LDCREATED, LDFIELDAPI)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (CPG_CTY_TYPE), INTENT (IN), TARGET :: SELF
LOGICAL, OPTIONAL, INTENT (IN) :: LDCREATED, LDFIELDAPI
END SUBROUTINE

MODULE SUBROUTINE ACDC_HOST_CPG_CTY_TYPE (SELF)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (CPG_CTY_TYPE), TARGET :: SELF
END SUBROUTINE

MODULE SUBROUTINE ACDC_WIPE_CPG_CTY_TYPE (SELF, LDDELETED, LDFIELDAPI)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (CPG_CTY_TYPE), INTENT (IN), TARGET :: SELF
LOGICAL, OPTIONAL, INTENT (IN) :: LDDELETED, LDFIELDAPI
END SUBROUTINE

MODULE SUBROUTINE ACDC_COPY_CPG_TND_TYPE (SELF, LDCREATED, LDFIELDAPI)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (CPG_TND_TYPE), INTENT (IN), TARGET :: SELF
LOGICAL, OPTIONAL, INTENT (IN) :: LDCREATED, LDFIELDAPI
END SUBROUTINE

MODULE SUBROUTINE ACDC_HOST_CPG_TND_TYPE (SELF)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (CPG_TND_TYPE), TARGET :: SELF
END SUBROUTINE

MODULE SUBROUTINE ACDC_WIPE_CPG_TND_TYPE (SELF, LDDELETED, LDFIELDAPI)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (CPG_TND_TYPE), INTENT (IN), TARGET :: SELF
LOGICAL, OPTIONAL, INTENT (IN) :: LDDELETED, LDFIELDAPI
END SUBROUTINE

MODULE SUBROUTINE ACDC_COPY_CPG_GPAR_TYPE (SELF, LDCREATED, LDFIELDAPI)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (CPG_GPAR_TYPE), INTENT (IN), TARGET :: SELF
LOGICAL, OPTIONAL, INTENT (IN) :: LDCREATED, LDFIELDAPI
END SUBROUTINE

MODULE SUBROUTINE ACDC_HOST_CPG_GPAR_TYPE (SELF)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (CPG_GPAR_TYPE), TARGET :: SELF
END SUBROUTINE

MODULE SUBROUTINE ACDC_WIPE_CPG_GPAR_TYPE (SELF, LDDELETED, LDFIELDAPI)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (CPG_GPAR_TYPE), INTENT (IN), TARGET :: SELF
LOGICAL, OPTIONAL, INTENT (IN) :: LDDELETED, LDFIELDAPI
END SUBROUTINE

MODULE SUBROUTINE ACDC_COPY_CPG_DYN_TYPE (SELF, LDCREATED, LDFIELDAPI)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (CPG_DYN_TYPE), INTENT (IN), TARGET :: SELF
LOGICAL, OPTIONAL, INTENT (IN) :: LDCREATED, LDFIELDAPI
END SUBROUTINE

MODULE SUBROUTINE ACDC_HOST_CPG_DYN_TYPE (SELF)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (CPG_DYN_TYPE), TARGET :: SELF
END SUBROUTINE

MODULE SUBROUTINE ACDC_WIPE_CPG_DYN_TYPE (SELF, LDDELETED, LDFIELDAPI)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (CPG_DYN_TYPE), INTENT (IN), TARGET :: SELF
LOGICAL, OPTIONAL, INTENT (IN) :: LDDELETED, LDFIELDAPI
END SUBROUTINE

MODULE SUBROUTINE ACDC_COPY_CPG_PHY_TYPE (SELF, LDCREATED, LDFIELDAPI)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (CPG_PHY_TYPE), INTENT (IN), TARGET :: SELF
LOGICAL, OPTIONAL, INTENT (IN) :: LDCREATED, LDFIELDAPI
END SUBROUTINE

MODULE SUBROUTINE ACDC_HOST_CPG_PHY_TYPE (SELF)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (CPG_PHY_TYPE), TARGET :: SELF
END SUBROUTINE

MODULE SUBROUTINE ACDC_WIPE_CPG_PHY_TYPE (SELF, LDDELETED, LDFIELDAPI)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (CPG_PHY_TYPE), INTENT (IN), TARGET :: SELF
LOGICAL, OPTIONAL, INTENT (IN) :: LDDELETED, LDFIELDAPI
END SUBROUTINE

MODULE SUBROUTINE ACDC_COPY_CPG_MISC_TYPE (SELF, LDCREATED, LDFIELDAPI)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (CPG_MISC_TYPE), INTENT (IN), TARGET :: SELF
LOGICAL, OPTIONAL, INTENT (IN) :: LDCREATED, LDFIELDAPI
END SUBROUTINE

MODULE SUBROUTINE ACDC_HOST_CPG_MISC_TYPE (SELF)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (CPG_MISC_TYPE), TARGET :: SELF
END SUBROUTINE

MODULE SUBROUTINE ACDC_WIPE_CPG_MISC_TYPE (SELF, LDDELETED, LDFIELDAPI)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (CPG_MISC_TYPE), INTENT (IN), TARGET :: SELF
LOGICAL, OPTIONAL, INTENT (IN) :: LDDELETED, LDFIELDAPI
END SUBROUTINE

MODULE SUBROUTINE ACDC_COPY_CPG_DDH_TYPE (SELF, LDCREATED, LDFIELDAPI)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (CPG_DDH_TYPE), INTENT (IN), TARGET :: SELF
LOGICAL, OPTIONAL, INTENT (IN) :: LDCREATED, LDFIELDAPI
END SUBROUTINE

MODULE SUBROUTINE ACDC_HOST_CPG_DDH_TYPE (SELF)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (CPG_DDH_TYPE), TARGET :: SELF
END SUBROUTINE

MODULE SUBROUTINE ACDC_WIPE_CPG_DDH_TYPE (SELF, LDDELETED, LDFIELDAPI)
USE FIELD_UTIL_MODULE
IMPLICIT NONE
CLASS (CPG_DDH_TYPE), INTENT (IN), TARGET :: SELF
LOGICAL, OPTIONAL, INTENT (IN) :: LDDELETED, LDFIELDAPI
END SUBROUTINE


END INTERFACE

CONTAINS

SUBROUTINE CPG_XYBDER_TYPE_INIT (&
                        &   SELF &
                        & , REGISTRY &
                        & , NLEV &
                        & , YDTXYBDER &
                        & , PERSISTENT &
                        & , PTXYBDER &
                        & , KBLKMIN  &
                        & , KBLKMAX  &
                        & )

USE INTDYN_MOD, ONLY : TXYBDER
USE OML_MOD, ONLY: OML_MAX_THREADS

USE FIELD_DEFAULTS_MODULE

CLASS (CPG_XYBDER_TYPE)                          :: SELF
TYPE (FIELD_REGISTRY),              INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),                INTENT (IN)    :: NLEV
TYPE (TXYBDER),                    INTENT (IN)    :: YDTXYBDER
LOGICAL, OPTIONAL,                  INTENT (IN)    :: PERSISTENT
REAL (KIND=JPRB), OPTIONAL, TARGET, INTENT (IN)    :: PTXYBDER (:, :, :, :)
INTEGER (KIND=JPIM), OPTIONAL,      INTENT (IN)    :: KBLKMIN, KBLKMAX

LOGICAL :: LLPERSISTENT
LOGICAL :: LLINITIALIZED
INTEGER (KIND=JPIM) :: IBLKMIN, IBLKMAX

LLPERSISTENT = .FALSE.
IF (PRESENT (PERSISTENT)) LLPERSISTENT = PERSISTENT

IBLKMIN = 1
IF (PRESENT (KBLKMIN)) IBLKMIN = KBLKMIN
IBLKMAX = REGISTRY%GEOM%YRDIM%NGPBLKS
IF (PRESENT (KBLKMAX)) IBLKMAX = KBLKMAX


LLINITIALIZED = .FALSE.

IF (PRESENT (PTXYBDER)) THEN
  SELF%ZDATA => PTXYBDER (:, :, :, IBLKMIN:IBLKMAX)
  SELF%LOWNED = .FALSE.
  LLPERSISTENT = .TRUE.
  LLINITIALIZED = .TRUE.
ELSEIF (LLPERSISTENT) THEN
  ALLOCATE (SELF%ZDATA (REGISTRY%GEOM%YRDIM%NPROMA, NLEV, YDTXYBDER%NDIM, IBLKMIN:IBLKMAX))
  IF (USE_INIT_DEBUG_VALUE) THEN
    SELF%ZDATA = INIT_DEBUG_VALUE_JPRB
    LLINITIALIZED = .TRUE.
  ENDIF
  SELF%LOWNED = .TRUE.
ELSE
  ALLOCATE (SELF%ZDATA (REGISTRY%GEOM%YRDIM%NPROMA, NLEV, YDTXYBDER%NDIM, OML_MAX_THREADS ()))
  IF (USE_INIT_DEBUG_VALUE) THEN
    SELF%ZDATA = INIT_DEBUG_VALUE_JPRB
    LLINITIALIZED = .TRUE.
  ENDIF
  SELF%LOWNED = .TRUE.
ENDIF

CALL FIELD_NEW (SELF%F_DATA, DATA=SELF%ZDATA, PERSISTENT=LLPERSISTENT)

CALL FIELD_NEW (SELF%F_LNPRL, DATA=SELF%ZDATA (:, :, YDTXYBDER%M_LNPRL, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_LNPRM, DATA=SELF%ZDATA (:, :, YDTXYBDER%M_LNPRM, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_ALPHL, DATA=SELF%ZDATA (:, :, YDTXYBDER%M_ALPHL, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_ALPHM, DATA=SELF%ZDATA (:, :, YDTXYBDER%M_ALPHM, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_ALPHPLL, DATA=SELF%ZDATA (:, :, YDTXYBDER%M_ALPHPLL, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_ALPHPLM, DATA=SELF%ZDATA (:, :, YDTXYBDER%M_ALPHPLM, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_COEFD, DATA=SELF%ZDATA (:, :, YDTXYBDER%M_COEFD, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_COEFA, DATA=SELF%ZDATA (:, :, YDTXYBDER%M_COEFA, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_COEFAPL, DATA=SELF%ZDATA (:, :, YDTXYBDER%M_COEFAPL, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)

END SUBROUTINE CPG_XYBDER_TYPE_INIT

SUBROUTINE CPG_XYBDER_TYPE_RESIZE (SELF, REGISTRY, NLEV, &
                        & YDTXYBDER, PERSISTENT)

USE INTDYN_MOD, ONLY : TXYBDER

CLASS (CPG_XYBDER_TYPE)                          :: SELF
TYPE (FIELD_REGISTRY),              INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),                INTENT (IN)    :: NLEV
TYPE (TXYBDER),                    INTENT (IN)    :: YDTXYBDER
LOGICAL, OPTIONAL,                  INTENT (IN)    :: PERSISTENT

IF (.NOT. SELF%CONFORM (REGISTRY, NLEV, &
                      & YDTXYBDER, PERSISTENT)) &
THEN
  CALL SELF%FINAL
  CALL SELF%INIT (REGISTRY, NLEV, &
                & YDTXYBDER, PERSISTENT)

ENDIF

END SUBROUTINE CPG_XYBDER_TYPE_RESIZE

LOGICAL FUNCTION CPG_XYBDER_TYPE_CONFORM (SELF, REGISTRY, NLEV, &
                        & YDTXYBDER, PERSISTENT) RESULT (LLCONFORM)

USE INTDYN_MOD, ONLY : TXYBDER
USE OML_MOD, ONLY: OML_MAX_THREADS

CLASS (CPG_XYBDER_TYPE)                          :: SELF
TYPE (FIELD_REGISTRY),              INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),                INTENT (IN)    :: NLEV
TYPE (TXYBDER),                    INTENT (IN)    :: YDTXYBDER
LOGICAL, OPTIONAL,                  INTENT (IN)    :: PERSISTENT

LOGICAL :: LLPERSISTENT

LLCONFORM = .FALSE.

LLPERSISTENT = .FALSE.
IF (PRESENT (PERSISTENT)) LLPERSISTENT = PERSISTENT

IF (.NOT. ASSOCIATED (SELF%ZDATA)) RETURN


IF (SIZE (SELF%ZDATA, 1) /= REGISTRY%GEOM%YRDIM%NPROMA) RETURN

IF (SIZE (SELF%ZDATA, 2) /= NLEV) RETURN

IF (SIZE (SELF%ZDATA, 3) /= YDTXYBDER%NDIM) RETURN

IF (LLPERSISTENT) THEN
  IF (SIZE (SELF%ZDATA, 4) /= REGISTRY%GEOM%YRDIM%NGPBLKS) RETURN
ELSE
  IF (SIZE (SELF%ZDATA, 4) /= OML_MAX_THREADS ()) RETURN
ENDIF

LLCONFORM = .TRUE.

END FUNCTION CPG_XYBDER_TYPE_CONFORM

SUBROUTINE CPG_XYBDER_TYPE_UPDATE_VIEW (SELF, BLOCK_INDEX)

CLASS (CPG_XYBDER_TYPE)         :: SELF
INTEGER(KIND=JPIM), INTENT (IN)   :: BLOCK_INDEX

IF (ASSOCIATED (SELF%F_DATA)) THEN

  SELF%ZVIEW => SELF%F_DATA%GET_VIEW (BLOCK_INDEX)

  IF (ASSOCIATED (SELF%F_LNPRL)) THEN
    IF ((.NOT. SELF%F_LNPRL%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%LNPRL))) THEN
      SELF%LNPRL => SELF%F_LNPRL%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%LNPRL)) THEN
    SELF%LNPRL => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_LNPRM)) THEN
    IF ((.NOT. SELF%F_LNPRM%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%LNPRM))) THEN
      SELF%LNPRM => SELF%F_LNPRM%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%LNPRM)) THEN
    SELF%LNPRM => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_ALPHL)) THEN
    IF ((.NOT. SELF%F_ALPHL%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%ALPHL))) THEN
      SELF%ALPHL => SELF%F_ALPHL%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%ALPHL)) THEN
    SELF%ALPHL => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_ALPHM)) THEN
    IF ((.NOT. SELF%F_ALPHM%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%ALPHM))) THEN
      SELF%ALPHM => SELF%F_ALPHM%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%ALPHM)) THEN
    SELF%ALPHM => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_ALPHPLL)) THEN
    IF ((.NOT. SELF%F_ALPHPLL%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%ALPHPLL))) THEN
      SELF%ALPHPLL => SELF%F_ALPHPLL%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%ALPHPLL)) THEN
    SELF%ALPHPLL => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_ALPHPLM)) THEN
    IF ((.NOT. SELF%F_ALPHPLM%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%ALPHPLM))) THEN
      SELF%ALPHPLM => SELF%F_ALPHPLM%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%ALPHPLM)) THEN
    SELF%ALPHPLM => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_COEFD)) THEN
    IF ((.NOT. SELF%F_COEFD%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%COEFD))) THEN
      SELF%COEFD => SELF%F_COEFD%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%COEFD)) THEN
    SELF%COEFD => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_COEFA)) THEN
    IF ((.NOT. SELF%F_COEFA%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%COEFA))) THEN
      SELF%COEFA => SELF%F_COEFA%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%COEFA)) THEN
    SELF%COEFA => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_COEFAPL)) THEN
    IF ((.NOT. SELF%F_COEFAPL%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%COEFAPL))) THEN
      SELF%COEFAPL => SELF%F_COEFAPL%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%COEFAPL)) THEN
    SELF%COEFAPL => ZDUM2
  ENDIF

ELSE

  SELF%ZVIEW => ZDUM3

  IF (.NOT. ASSOCIATED (SELF%LNPRL)) SELF%LNPRL => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%LNPRM)) SELF%LNPRM => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%ALPHL)) SELF%ALPHL => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%ALPHM)) SELF%ALPHM => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%ALPHPLL)) SELF%ALPHPLL => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%ALPHPLM)) SELF%ALPHPLM => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%COEFD)) SELF%COEFD => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%COEFA)) SELF%COEFA => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%COEFAPL)) SELF%COEFAPL => ZDUM2

ENDIF

END SUBROUTINE CPG_XYBDER_TYPE_UPDATE_VIEW

SUBROUTINE CPG_XYBDER_TYPE_FINAL (SELF)
CLASS (CPG_XYBDER_TYPE)          :: SELF

IF (ASSOCIATED (SELF%F_COEFAPL)) THEN
  CALL FIELD_DELETE (SELF%F_COEFAPL) 
  SELF%F_COEFAPL => NULL ()
  SELF%COEFAPL => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_COEFA)) THEN
  CALL FIELD_DELETE (SELF%F_COEFA) 
  SELF%F_COEFA => NULL ()
  SELF%COEFA => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_COEFD)) THEN
  CALL FIELD_DELETE (SELF%F_COEFD) 
  SELF%F_COEFD => NULL ()
  SELF%COEFD => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_ALPHPLM)) THEN
  CALL FIELD_DELETE (SELF%F_ALPHPLM) 
  SELF%F_ALPHPLM => NULL ()
  SELF%ALPHPLM => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_ALPHPLL)) THEN
  CALL FIELD_DELETE (SELF%F_ALPHPLL) 
  SELF%F_ALPHPLL => NULL ()
  SELF%ALPHPLL => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_ALPHM)) THEN
  CALL FIELD_DELETE (SELF%F_ALPHM) 
  SELF%F_ALPHM => NULL ()
  SELF%ALPHM => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_ALPHL)) THEN
  CALL FIELD_DELETE (SELF%F_ALPHL) 
  SELF%F_ALPHL => NULL ()
  SELF%ALPHL => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_LNPRM)) THEN
  CALL FIELD_DELETE (SELF%F_LNPRM) 
  SELF%F_LNPRM => NULL ()
  SELF%LNPRM => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_LNPRL)) THEN
  CALL FIELD_DELETE (SELF%F_LNPRL) 
  SELF%F_LNPRL => NULL ()
  SELF%LNPRL => NULL ()
ENDIF

IF (ASSOCIATED (SELF%F_DATA)) CALL FIELD_DELETE (SELF%F_DATA)
SELF%F_DATA => NULL ()

IF (SELF%LOWNED) THEN
  IF (ASSOCIATED (SELF%ZDATA)) DEALLOCATE (SELF%ZDATA)
ENDIF

SELF%ZDATA => NULL ()
SELF%ZVIEW => NULL ()

END SUBROUTINE CPG_XYBDER_TYPE_FINAL

SUBROUTINE CPG_XYB_TYPE_INIT (&
                        &   SELF &
                        & , REGISTRY &
                        & , NLEV &
                        & , YDTXYB &
                        & , PERSISTENT &
                        & , PTXYB &
                        & , KBLKMIN  &
                        & , KBLKMAX  &
                        & )

USE INTDYN_MOD, ONLY : TXYB
USE OML_MOD, ONLY: OML_MAX_THREADS

USE FIELD_DEFAULTS_MODULE

CLASS (CPG_XYB_TYPE)                          :: SELF
TYPE (FIELD_REGISTRY),              INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),                INTENT (IN)    :: NLEV
TYPE (TXYB),                    INTENT (IN)    :: YDTXYB
LOGICAL, OPTIONAL,                  INTENT (IN)    :: PERSISTENT
REAL (KIND=JPRB), OPTIONAL, TARGET, INTENT (IN)    :: PTXYB (:, :, :, :)
INTEGER (KIND=JPIM), OPTIONAL,      INTENT (IN)    :: KBLKMIN, KBLKMAX

LOGICAL :: LLPERSISTENT
LOGICAL :: LLINITIALIZED
INTEGER (KIND=JPIM) :: IBLKMIN, IBLKMAX

LLPERSISTENT = .FALSE.
IF (PRESENT (PERSISTENT)) LLPERSISTENT = PERSISTENT

IBLKMIN = 1
IF (PRESENT (KBLKMIN)) IBLKMIN = KBLKMIN
IBLKMAX = REGISTRY%GEOM%YRDIM%NGPBLKS
IF (PRESENT (KBLKMAX)) IBLKMAX = KBLKMAX


LLINITIALIZED = .FALSE.

IF (PRESENT (PTXYB)) THEN
  SELF%ZDATA => PTXYB (:, :, :, IBLKMIN:IBLKMAX)
  SELF%LOWNED = .FALSE.
  LLPERSISTENT = .TRUE.
  LLINITIALIZED = .TRUE.
ELSEIF (LLPERSISTENT) THEN
  ALLOCATE (SELF%ZDATA (REGISTRY%GEOM%YRDIM%NPROMA, NLEV, YDTXYB%NDIM, IBLKMIN:IBLKMAX))
  IF (USE_INIT_DEBUG_VALUE) THEN
    SELF%ZDATA = INIT_DEBUG_VALUE_JPRB
    LLINITIALIZED = .TRUE.
  ENDIF
  SELF%LOWNED = .TRUE.
ELSE
  ALLOCATE (SELF%ZDATA (REGISTRY%GEOM%YRDIM%NPROMA, NLEV, YDTXYB%NDIM, OML_MAX_THREADS ()))
  IF (USE_INIT_DEBUG_VALUE) THEN
    SELF%ZDATA = INIT_DEBUG_VALUE_JPRB
    LLINITIALIZED = .TRUE.
  ENDIF
  SELF%LOWNED = .TRUE.
ENDIF

CALL FIELD_NEW (SELF%F_DATA, DATA=SELF%ZDATA, PERSISTENT=LLPERSISTENT)

CALL FIELD_NEW (SELF%F_DELP, DATA=SELF%ZDATA (:, :, YDTXYB%M_DELP, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_RDELP, DATA=SELF%ZDATA (:, :, YDTXYB%M_RDELP, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_LNPR, DATA=SELF%ZDATA (:, :, YDTXYB%M_LNPR, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_ALPH, DATA=SELF%ZDATA (:, :, YDTXYB%M_ALPH, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_RTGR, DATA=SELF%ZDATA (:, :, YDTXYB%M_RTGR, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_RPRE, DATA=SELF%ZDATA (:, :, YDTXYB%M_RPRE, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_RPP, DATA=SELF%ZDATA (:, :, YDTXYB%M_RPP, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)

END SUBROUTINE CPG_XYB_TYPE_INIT

SUBROUTINE CPG_XYB_TYPE_RESIZE (SELF, REGISTRY, NLEV, &
                        & YDTXYB, PERSISTENT)

USE INTDYN_MOD, ONLY : TXYB

CLASS (CPG_XYB_TYPE)                          :: SELF
TYPE (FIELD_REGISTRY),              INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),                INTENT (IN)    :: NLEV
TYPE (TXYB),                    INTENT (IN)    :: YDTXYB
LOGICAL, OPTIONAL,                  INTENT (IN)    :: PERSISTENT

IF (.NOT. SELF%CONFORM (REGISTRY, NLEV, &
                      & YDTXYB, PERSISTENT)) &
THEN
  CALL SELF%FINAL
  CALL SELF%INIT (REGISTRY, NLEV, &
                & YDTXYB, PERSISTENT)

ENDIF

END SUBROUTINE CPG_XYB_TYPE_RESIZE

LOGICAL FUNCTION CPG_XYB_TYPE_CONFORM (SELF, REGISTRY, NLEV, &
                        & YDTXYB, PERSISTENT) RESULT (LLCONFORM)

USE INTDYN_MOD, ONLY : TXYB
USE OML_MOD, ONLY: OML_MAX_THREADS

CLASS (CPG_XYB_TYPE)                          :: SELF
TYPE (FIELD_REGISTRY),              INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),                INTENT (IN)    :: NLEV
TYPE (TXYB),                    INTENT (IN)    :: YDTXYB
LOGICAL, OPTIONAL,                  INTENT (IN)    :: PERSISTENT

LOGICAL :: LLPERSISTENT

LLCONFORM = .FALSE.

LLPERSISTENT = .FALSE.
IF (PRESENT (PERSISTENT)) LLPERSISTENT = PERSISTENT

IF (.NOT. ASSOCIATED (SELF%ZDATA)) RETURN


IF (SIZE (SELF%ZDATA, 1) /= REGISTRY%GEOM%YRDIM%NPROMA) RETURN

IF (SIZE (SELF%ZDATA, 2) /= NLEV) RETURN

IF (SIZE (SELF%ZDATA, 3) /= YDTXYB%NDIM) RETURN

IF (LLPERSISTENT) THEN
  IF (SIZE (SELF%ZDATA, 4) /= REGISTRY%GEOM%YRDIM%NGPBLKS) RETURN
ELSE
  IF (SIZE (SELF%ZDATA, 4) /= OML_MAX_THREADS ()) RETURN
ENDIF

LLCONFORM = .TRUE.

END FUNCTION CPG_XYB_TYPE_CONFORM

SUBROUTINE CPG_XYB_TYPE_UPDATE_VIEW (SELF, BLOCK_INDEX)

CLASS (CPG_XYB_TYPE)         :: SELF
INTEGER(KIND=JPIM), INTENT (IN)   :: BLOCK_INDEX

IF (ASSOCIATED (SELF%F_DATA)) THEN

  SELF%ZVIEW => SELF%F_DATA%GET_VIEW (BLOCK_INDEX)

  IF (ASSOCIATED (SELF%F_DELP)) THEN
    IF ((.NOT. SELF%F_DELP%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DELP))) THEN
      SELF%DELP => SELF%F_DELP%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DELP)) THEN
    SELF%DELP => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_RDELP)) THEN
    IF ((.NOT. SELF%F_RDELP%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%RDELP))) THEN
      SELF%RDELP => SELF%F_RDELP%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%RDELP)) THEN
    SELF%RDELP => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_LNPR)) THEN
    IF ((.NOT. SELF%F_LNPR%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%LNPR))) THEN
      SELF%LNPR => SELF%F_LNPR%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%LNPR)) THEN
    SELF%LNPR => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_ALPH)) THEN
    IF ((.NOT. SELF%F_ALPH%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%ALPH))) THEN
      SELF%ALPH => SELF%F_ALPH%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%ALPH)) THEN
    SELF%ALPH => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_RTGR)) THEN
    IF ((.NOT. SELF%F_RTGR%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%RTGR))) THEN
      SELF%RTGR => SELF%F_RTGR%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%RTGR)) THEN
    SELF%RTGR => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_RPRE)) THEN
    IF ((.NOT. SELF%F_RPRE%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%RPRE))) THEN
      SELF%RPRE => SELF%F_RPRE%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%RPRE)) THEN
    SELF%RPRE => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_RPP)) THEN
    IF ((.NOT. SELF%F_RPP%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%RPP))) THEN
      SELF%RPP => SELF%F_RPP%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%RPP)) THEN
    SELF%RPP => ZDUM2
  ENDIF

ELSE

  SELF%ZVIEW => ZDUM3

  IF (.NOT. ASSOCIATED (SELF%DELP)) SELF%DELP => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%RDELP)) SELF%RDELP => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%LNPR)) SELF%LNPR => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%ALPH)) SELF%ALPH => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%RTGR)) SELF%RTGR => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%RPRE)) SELF%RPRE => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%RPP)) SELF%RPP => ZDUM2

ENDIF

END SUBROUTINE CPG_XYB_TYPE_UPDATE_VIEW

SUBROUTINE CPG_XYB_TYPE_FINAL (SELF)
CLASS (CPG_XYB_TYPE)          :: SELF

IF (ASSOCIATED (SELF%F_RPP)) THEN
  CALL FIELD_DELETE (SELF%F_RPP) 
  SELF%F_RPP => NULL ()
  SELF%RPP => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_RPRE)) THEN
  CALL FIELD_DELETE (SELF%F_RPRE) 
  SELF%F_RPRE => NULL ()
  SELF%RPRE => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_RTGR)) THEN
  CALL FIELD_DELETE (SELF%F_RTGR) 
  SELF%F_RTGR => NULL ()
  SELF%RTGR => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_ALPH)) THEN
  CALL FIELD_DELETE (SELF%F_ALPH) 
  SELF%F_ALPH => NULL ()
  SELF%ALPH => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_LNPR)) THEN
  CALL FIELD_DELETE (SELF%F_LNPR) 
  SELF%F_LNPR => NULL ()
  SELF%LNPR => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_RDELP)) THEN
  CALL FIELD_DELETE (SELF%F_RDELP) 
  SELF%F_RDELP => NULL ()
  SELF%RDELP => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_DELP)) THEN
  CALL FIELD_DELETE (SELF%F_DELP) 
  SELF%F_DELP => NULL ()
  SELF%DELP => NULL ()
ENDIF

IF (ASSOCIATED (SELF%F_DATA)) CALL FIELD_DELETE (SELF%F_DATA)
SELF%F_DATA => NULL ()

IF (SELF%LOWNED) THEN
  IF (ASSOCIATED (SELF%ZDATA)) DEALLOCATE (SELF%ZDATA)
ENDIF

SELF%ZDATA => NULL ()
SELF%ZVIEW => NULL ()

END SUBROUTINE CPG_XYB_TYPE_FINAL

SUBROUTINE CPG_HWIND_TYPE_INIT (&
                        &   SELF &
                        & , REGISTRY &
                        & , NLEV &
                        & , YDTHWIND &
                        & , PERSISTENT &
                        & , PTHWIND &
                        & , KBLKMIN  &
                        & , KBLKMAX  &
                        & )

USE INTDYN_MOD, ONLY : THWIND
USE OML_MOD, ONLY: OML_MAX_THREADS

USE FIELD_DEFAULTS_MODULE

CLASS (CPG_HWIND_TYPE)                          :: SELF
TYPE (FIELD_REGISTRY),              INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),                INTENT (IN)    :: NLEV
TYPE (THWIND),                    INTENT (IN)    :: YDTHWIND
LOGICAL, OPTIONAL,                  INTENT (IN)    :: PERSISTENT
REAL (KIND=JPRB), OPTIONAL, TARGET, INTENT (IN)    :: PTHWIND (:, :, :, :)
INTEGER (KIND=JPIM), OPTIONAL,      INTENT (IN)    :: KBLKMIN, KBLKMAX

LOGICAL :: LLPERSISTENT
LOGICAL :: LLINITIALIZED
INTEGER (KIND=JPIM) :: IBLKMIN, IBLKMAX

LLPERSISTENT = .FALSE.
IF (PRESENT (PERSISTENT)) LLPERSISTENT = PERSISTENT

IBLKMIN = 1
IF (PRESENT (KBLKMIN)) IBLKMIN = KBLKMIN
IBLKMAX = REGISTRY%GEOM%YRDIM%NGPBLKS
IF (PRESENT (KBLKMAX)) IBLKMAX = KBLKMAX


LLINITIALIZED = .FALSE.

IF (PRESENT (PTHWIND)) THEN
  SELF%ZDATA => PTHWIND (:, :, :, IBLKMIN:IBLKMAX)
  SELF%LOWNED = .FALSE.
  LLPERSISTENT = .TRUE.
  LLINITIALIZED = .TRUE.
ELSEIF (LLPERSISTENT) THEN
  ALLOCATE (SELF%ZDATA (REGISTRY%GEOM%YRDIM%NPROMA, NLEV+1, YDTHWIND%NDIM, IBLKMIN:IBLKMAX))
  IF (USE_INIT_DEBUG_VALUE) THEN
    SELF%ZDATA = INIT_DEBUG_VALUE_JPRB
    LLINITIALIZED = .TRUE.
  ENDIF
  SELF%LOWNED = .TRUE.
ELSE
  ALLOCATE (SELF%ZDATA (REGISTRY%GEOM%YRDIM%NPROMA, NLEV+1, YDTHWIND%NDIM, OML_MAX_THREADS ()))
  IF (USE_INIT_DEBUG_VALUE) THEN
    SELF%ZDATA = INIT_DEBUG_VALUE_JPRB
    LLINITIALIZED = .TRUE.
  ENDIF
  SELF%LOWNED = .TRUE.
ENDIF

CALL FIELD_NEW (SELF%F_DATA, DATA=SELF%ZDATA, PERSISTENT=LLPERSISTENT)

CALL FIELD_NEW (SELF%F_UH, DATA=SELF%ZDATA (:, :, YDTHWIND%M_UH, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 0, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_VH, DATA=SELF%ZDATA (:, :, YDTHWIND%M_VH, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 0, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_WWI, DATA=SELF%ZDATA (:, :, YDTHWIND%M_WWI, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 0, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)

END SUBROUTINE CPG_HWIND_TYPE_INIT

SUBROUTINE CPG_HWIND_TYPE_RESIZE (SELF, REGISTRY, NLEV, &
                        & YDTHWIND, PERSISTENT)

USE INTDYN_MOD, ONLY : THWIND

CLASS (CPG_HWIND_TYPE)                          :: SELF
TYPE (FIELD_REGISTRY),              INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),                INTENT (IN)    :: NLEV
TYPE (THWIND),                    INTENT (IN)    :: YDTHWIND
LOGICAL, OPTIONAL,                  INTENT (IN)    :: PERSISTENT

IF (.NOT. SELF%CONFORM (REGISTRY, NLEV, &
                      & YDTHWIND, PERSISTENT)) &
THEN
  CALL SELF%FINAL
  CALL SELF%INIT (REGISTRY, NLEV, &
                & YDTHWIND, PERSISTENT)

ENDIF

END SUBROUTINE CPG_HWIND_TYPE_RESIZE

LOGICAL FUNCTION CPG_HWIND_TYPE_CONFORM (SELF, REGISTRY, NLEV, &
                        & YDTHWIND, PERSISTENT) RESULT (LLCONFORM)

USE INTDYN_MOD, ONLY : THWIND
USE OML_MOD, ONLY: OML_MAX_THREADS

CLASS (CPG_HWIND_TYPE)                          :: SELF
TYPE (FIELD_REGISTRY),              INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),                INTENT (IN)    :: NLEV
TYPE (THWIND),                    INTENT (IN)    :: YDTHWIND
LOGICAL, OPTIONAL,                  INTENT (IN)    :: PERSISTENT

LOGICAL :: LLPERSISTENT

LLCONFORM = .FALSE.

LLPERSISTENT = .FALSE.
IF (PRESENT (PERSISTENT)) LLPERSISTENT = PERSISTENT

IF (.NOT. ASSOCIATED (SELF%ZDATA)) RETURN


IF (SIZE (SELF%ZDATA, 1) /= REGISTRY%GEOM%YRDIM%NPROMA) RETURN

IF (SIZE (SELF%ZDATA, 2) /= NLEV+1) RETURN

IF (SIZE (SELF%ZDATA, 3) /= YDTHWIND%NDIM) RETURN

IF (LLPERSISTENT) THEN
  IF (SIZE (SELF%ZDATA, 4) /= REGISTRY%GEOM%YRDIM%NGPBLKS) RETURN
ELSE
  IF (SIZE (SELF%ZDATA, 4) /= OML_MAX_THREADS ()) RETURN
ENDIF

LLCONFORM = .TRUE.

END FUNCTION CPG_HWIND_TYPE_CONFORM

SUBROUTINE CPG_HWIND_TYPE_UPDATE_VIEW (SELF, BLOCK_INDEX)

CLASS (CPG_HWIND_TYPE)         :: SELF
INTEGER(KIND=JPIM), INTENT (IN)   :: BLOCK_INDEX

IF (ASSOCIATED (SELF%F_DATA)) THEN

  SELF%ZVIEW => SELF%F_DATA%GET_VIEW (BLOCK_INDEX)

  IF (ASSOCIATED (SELF%F_UH)) THEN
    IF ((.NOT. SELF%F_UH%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%UH))) THEN
      SELF%UH => SELF%F_UH%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%UH)) THEN
    SELF%UH => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_VH)) THEN
    IF ((.NOT. SELF%F_VH%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%VH))) THEN
      SELF%VH => SELF%F_VH%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%VH)) THEN
    SELF%VH => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_WWI)) THEN
    IF ((.NOT. SELF%F_WWI%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%WWI))) THEN
      SELF%WWI => SELF%F_WWI%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%WWI)) THEN
    SELF%WWI => ZDUM2
  ENDIF

ELSE

  SELF%ZVIEW => ZDUM3

  IF (.NOT. ASSOCIATED (SELF%UH)) SELF%UH => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%VH)) SELF%VH => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%WWI)) SELF%WWI => ZDUM2

ENDIF

END SUBROUTINE CPG_HWIND_TYPE_UPDATE_VIEW

SUBROUTINE CPG_HWIND_TYPE_FINAL (SELF)
CLASS (CPG_HWIND_TYPE)          :: SELF

IF (ASSOCIATED (SELF%F_WWI)) THEN
  CALL FIELD_DELETE (SELF%F_WWI) 
  SELF%F_WWI => NULL ()
  SELF%WWI => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_VH)) THEN
  CALL FIELD_DELETE (SELF%F_VH) 
  SELF%F_VH => NULL ()
  SELF%VH => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_UH)) THEN
  CALL FIELD_DELETE (SELF%F_UH) 
  SELF%F_UH => NULL ()
  SELF%UH => NULL ()
ENDIF

IF (ASSOCIATED (SELF%F_DATA)) CALL FIELD_DELETE (SELF%F_DATA)
SELF%F_DATA => NULL ()

IF (SELF%LOWNED) THEN
  IF (ASSOCIATED (SELF%ZDATA)) DEALLOCATE (SELF%ZDATA)
ENDIF

SELF%ZDATA => NULL ()
SELF%ZVIEW => NULL ()

END SUBROUTINE CPG_HWIND_TYPE_FINAL

SUBROUTINE CPG_RCP_TYPE_INIT (&
                        &   SELF &
                        & , REGISTRY &
                        & , NLEV &
                        & , YDTRCP &
                        & , PERSISTENT &
                        & , PTRCP &
                        & , KBLKMIN  &
                        & , KBLKMAX  &
                        & )

USE INTDYN_MOD, ONLY : TRCP
USE OML_MOD, ONLY: OML_MAX_THREADS

USE FIELD_DEFAULTS_MODULE

CLASS (CPG_RCP_TYPE)                          :: SELF
TYPE (FIELD_REGISTRY),              INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),                INTENT (IN)    :: NLEV
TYPE (TRCP),                    INTENT (IN)    :: YDTRCP
LOGICAL, OPTIONAL,                  INTENT (IN)    :: PERSISTENT
REAL (KIND=JPRB), OPTIONAL, TARGET, INTENT (IN)    :: PTRCP (:, :, :, :)
INTEGER (KIND=JPIM), OPTIONAL,      INTENT (IN)    :: KBLKMIN, KBLKMAX

LOGICAL :: LLPERSISTENT
LOGICAL :: LLINITIALIZED
INTEGER (KIND=JPIM) :: IBLKMIN, IBLKMAX

LLPERSISTENT = .FALSE.
IF (PRESENT (PERSISTENT)) LLPERSISTENT = PERSISTENT

IBLKMIN = 1
IF (PRESENT (KBLKMIN)) IBLKMIN = KBLKMIN
IBLKMAX = REGISTRY%GEOM%YRDIM%NGPBLKS
IF (PRESENT (KBLKMAX)) IBLKMAX = KBLKMAX


LLINITIALIZED = .FALSE.

IF (PRESENT (PTRCP)) THEN
  SELF%ZDATA => PTRCP (:, :, :, IBLKMIN:IBLKMAX)
  SELF%LOWNED = .FALSE.
  LLPERSISTENT = .TRUE.
  LLINITIALIZED = .TRUE.
ELSEIF (LLPERSISTENT) THEN
  ALLOCATE (SELF%ZDATA (REGISTRY%GEOM%YRDIM%NPROMA, NLEV, YDTRCP%NDIM, IBLKMIN:IBLKMAX))
  IF (USE_INIT_DEBUG_VALUE) THEN
    SELF%ZDATA = INIT_DEBUG_VALUE_JPRB
    LLINITIALIZED = .TRUE.
  ENDIF
  SELF%LOWNED = .TRUE.
ELSE
  ALLOCATE (SELF%ZDATA (REGISTRY%GEOM%YRDIM%NPROMA, NLEV, YDTRCP%NDIM, OML_MAX_THREADS ()))
  IF (USE_INIT_DEBUG_VALUE) THEN
    SELF%ZDATA = INIT_DEBUG_VALUE_JPRB
    LLINITIALIZED = .TRUE.
  ENDIF
  SELF%LOWNED = .TRUE.
ENDIF

CALL FIELD_NEW (SELF%F_DATA, DATA=SELF%ZDATA, PERSISTENT=LLPERSISTENT)

CALL FIELD_NEW (SELF%F_CP, DATA=SELF%ZDATA (:, :, YDTRCP%M_CP, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_R, DATA=SELF%ZDATA (:, :, YDTRCP%M_R, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_KAP, DATA=SELF%ZDATA (:, :, YDTRCP%M_KAP, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)

END SUBROUTINE CPG_RCP_TYPE_INIT

SUBROUTINE CPG_RCP_TYPE_RESIZE (SELF, REGISTRY, NLEV, &
                        & YDTRCP, PERSISTENT)

USE INTDYN_MOD, ONLY : TRCP

CLASS (CPG_RCP_TYPE)                          :: SELF
TYPE (FIELD_REGISTRY),              INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),                INTENT (IN)    :: NLEV
TYPE (TRCP),                    INTENT (IN)    :: YDTRCP
LOGICAL, OPTIONAL,                  INTENT (IN)    :: PERSISTENT

IF (.NOT. SELF%CONFORM (REGISTRY, NLEV, &
                      & YDTRCP, PERSISTENT)) &
THEN
  CALL SELF%FINAL
  CALL SELF%INIT (REGISTRY, NLEV, &
                & YDTRCP, PERSISTENT)

ENDIF

END SUBROUTINE CPG_RCP_TYPE_RESIZE

LOGICAL FUNCTION CPG_RCP_TYPE_CONFORM (SELF, REGISTRY, NLEV, &
                        & YDTRCP, PERSISTENT) RESULT (LLCONFORM)

USE INTDYN_MOD, ONLY : TRCP
USE OML_MOD, ONLY: OML_MAX_THREADS

CLASS (CPG_RCP_TYPE)                          :: SELF
TYPE (FIELD_REGISTRY),              INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),                INTENT (IN)    :: NLEV
TYPE (TRCP),                    INTENT (IN)    :: YDTRCP
LOGICAL, OPTIONAL,                  INTENT (IN)    :: PERSISTENT

LOGICAL :: LLPERSISTENT

LLCONFORM = .FALSE.

LLPERSISTENT = .FALSE.
IF (PRESENT (PERSISTENT)) LLPERSISTENT = PERSISTENT

IF (.NOT. ASSOCIATED (SELF%ZDATA)) RETURN


IF (SIZE (SELF%ZDATA, 1) /= REGISTRY%GEOM%YRDIM%NPROMA) RETURN

IF (SIZE (SELF%ZDATA, 2) /= NLEV) RETURN

IF (SIZE (SELF%ZDATA, 3) /= YDTRCP%NDIM) RETURN

IF (LLPERSISTENT) THEN
  IF (SIZE (SELF%ZDATA, 4) /= REGISTRY%GEOM%YRDIM%NGPBLKS) RETURN
ELSE
  IF (SIZE (SELF%ZDATA, 4) /= OML_MAX_THREADS ()) RETURN
ENDIF

LLCONFORM = .TRUE.

END FUNCTION CPG_RCP_TYPE_CONFORM

SUBROUTINE CPG_RCP_TYPE_UPDATE_VIEW (SELF, BLOCK_INDEX)

CLASS (CPG_RCP_TYPE)         :: SELF
INTEGER(KIND=JPIM), INTENT (IN)   :: BLOCK_INDEX

IF (ASSOCIATED (SELF%F_DATA)) THEN

  SELF%ZVIEW => SELF%F_DATA%GET_VIEW (BLOCK_INDEX)

  IF (ASSOCIATED (SELF%F_CP)) THEN
    IF ((.NOT. SELF%F_CP%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%CP))) THEN
      SELF%CP => SELF%F_CP%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%CP)) THEN
    SELF%CP => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_R)) THEN
    IF ((.NOT. SELF%F_R%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%R))) THEN
      SELF%R => SELF%F_R%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%R)) THEN
    SELF%R => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_KAP)) THEN
    IF ((.NOT. SELF%F_KAP%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%KAP))) THEN
      SELF%KAP => SELF%F_KAP%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%KAP)) THEN
    SELF%KAP => ZDUM2
  ENDIF

ELSE

  SELF%ZVIEW => ZDUM3

  IF (.NOT. ASSOCIATED (SELF%CP)) SELF%CP => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%R)) SELF%R => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%KAP)) SELF%KAP => ZDUM2

ENDIF

END SUBROUTINE CPG_RCP_TYPE_UPDATE_VIEW

SUBROUTINE CPG_RCP_TYPE_FINAL (SELF)
CLASS (CPG_RCP_TYPE)          :: SELF

IF (ASSOCIATED (SELF%F_KAP)) THEN
  CALL FIELD_DELETE (SELF%F_KAP) 
  SELF%F_KAP => NULL ()
  SELF%KAP => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_R)) THEN
  CALL FIELD_DELETE (SELF%F_R) 
  SELF%F_R => NULL ()
  SELF%R => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_CP)) THEN
  CALL FIELD_DELETE (SELF%F_CP) 
  SELF%F_CP => NULL ()
  SELF%CP => NULL ()
ENDIF

IF (ASSOCIATED (SELF%F_DATA)) CALL FIELD_DELETE (SELF%F_DATA)
SELF%F_DATA => NULL ()

IF (SELF%LOWNED) THEN
  IF (ASSOCIATED (SELF%ZDATA)) DEALLOCATE (SELF%ZDATA)
ENDIF

SELF%ZDATA => NULL ()
SELF%ZVIEW => NULL ()

END SUBROUTINE CPG_RCP_TYPE_FINAL

SUBROUTINE CPG_CTY_TYPE_INIT (&
                        &   SELF &
                        & , REGISTRY &
                        & , NLEV &
                        & , YDTCTY &
                        & , PERSISTENT &
                        & , PTCTY &
                        & , KBLKMIN  &
                        & , KBLKMAX  &
                        & )

USE INTDYN_MOD, ONLY : TCTY
USE OML_MOD, ONLY: OML_MAX_THREADS

USE FIELD_DEFAULTS_MODULE

CLASS (CPG_CTY_TYPE)                          :: SELF
TYPE (FIELD_REGISTRY),              INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),                INTENT (IN)    :: NLEV
TYPE (TCTY),                    INTENT (IN)    :: YDTCTY
LOGICAL, OPTIONAL,                  INTENT (IN)    :: PERSISTENT
REAL (KIND=JPRB), OPTIONAL, TARGET, INTENT (IN)    :: PTCTY (:, :, :, :)
INTEGER (KIND=JPIM), OPTIONAL,      INTENT (IN)    :: KBLKMIN, KBLKMAX

LOGICAL :: LLPERSISTENT
LOGICAL :: LLINITIALIZED
INTEGER (KIND=JPIM) :: IBLKMIN, IBLKMAX

LLPERSISTENT = .FALSE.
IF (PRESENT (PERSISTENT)) LLPERSISTENT = PERSISTENT

IBLKMIN = 1
IF (PRESENT (KBLKMIN)) IBLKMIN = KBLKMIN
IBLKMAX = REGISTRY%GEOM%YRDIM%NGPBLKS
IF (PRESENT (KBLKMAX)) IBLKMAX = KBLKMAX


LLINITIALIZED = .FALSE.

IF (PRESENT (PTCTY)) THEN
  SELF%ZDATA => PTCTY (:, :, :, IBLKMIN:IBLKMAX)
  SELF%LOWNED = .FALSE.
  LLPERSISTENT = .TRUE.
  LLINITIALIZED = .TRUE.
ELSEIF (LLPERSISTENT) THEN
  ALLOCATE (SELF%ZDATA (REGISTRY%GEOM%YRDIM%NPROMA, NLEV+1, YDTCTY%NDIM, IBLKMIN:IBLKMAX))
  IF (USE_INIT_DEBUG_VALUE) THEN
    SELF%ZDATA = INIT_DEBUG_VALUE_JPRB
    LLINITIALIZED = .TRUE.
  ENDIF
  SELF%LOWNED = .TRUE.
ELSE
  ALLOCATE (SELF%ZDATA (REGISTRY%GEOM%YRDIM%NPROMA, NLEV+1, YDTCTY%NDIM, OML_MAX_THREADS ()))
  IF (USE_INIT_DEBUG_VALUE) THEN
    SELF%ZDATA = INIT_DEBUG_VALUE_JPRB
    LLINITIALIZED = .TRUE.
  ENDIF
  SELF%LOWNED = .TRUE.
ENDIF

CALL FIELD_NEW (SELF%F_DATA, DATA=SELF%ZDATA, PERSISTENT=LLPERSISTENT)

CALL FIELD_NEW (SELF%F_EVEL, DATA=SELF%ZDATA (:, :, YDTCTY%M_EVEL, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 0, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_VVEL, DATA=SELF%ZDATA (:, :, YDTCTY%M_VVEL, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 0, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_PSDIV, DATA=SELF%ZDATA (:, :, YDTCTY%M_PSDIV, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 0, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_PSDVBC, DATA=SELF%ZDATA (:, :, YDTCTY%M_PSDVBC, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 0, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_DIVDP, DATA=SELF%ZDATA (:, :, YDTCTY%M_DIVDP, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 0, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)

END SUBROUTINE CPG_CTY_TYPE_INIT

SUBROUTINE CPG_CTY_TYPE_RESIZE (SELF, REGISTRY, NLEV, &
                        & YDTCTY, PERSISTENT)

USE INTDYN_MOD, ONLY : TCTY

CLASS (CPG_CTY_TYPE)                          :: SELF
TYPE (FIELD_REGISTRY),              INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),                INTENT (IN)    :: NLEV
TYPE (TCTY),                    INTENT (IN)    :: YDTCTY
LOGICAL, OPTIONAL,                  INTENT (IN)    :: PERSISTENT

IF (.NOT. SELF%CONFORM (REGISTRY, NLEV, &
                      & YDTCTY, PERSISTENT)) &
THEN
  CALL SELF%FINAL
  CALL SELF%INIT (REGISTRY, NLEV, &
                & YDTCTY, PERSISTENT)

ENDIF

END SUBROUTINE CPG_CTY_TYPE_RESIZE

LOGICAL FUNCTION CPG_CTY_TYPE_CONFORM (SELF, REGISTRY, NLEV, &
                        & YDTCTY, PERSISTENT) RESULT (LLCONFORM)

USE INTDYN_MOD, ONLY : TCTY
USE OML_MOD, ONLY: OML_MAX_THREADS

CLASS (CPG_CTY_TYPE)                          :: SELF
TYPE (FIELD_REGISTRY),              INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),                INTENT (IN)    :: NLEV
TYPE (TCTY),                    INTENT (IN)    :: YDTCTY
LOGICAL, OPTIONAL,                  INTENT (IN)    :: PERSISTENT

LOGICAL :: LLPERSISTENT

LLCONFORM = .FALSE.

LLPERSISTENT = .FALSE.
IF (PRESENT (PERSISTENT)) LLPERSISTENT = PERSISTENT

IF (.NOT. ASSOCIATED (SELF%ZDATA)) RETURN


IF (SIZE (SELF%ZDATA, 1) /= REGISTRY%GEOM%YRDIM%NPROMA) RETURN

IF (SIZE (SELF%ZDATA, 2) /= NLEV+1) RETURN

IF (SIZE (SELF%ZDATA, 3) /= YDTCTY%NDIM) RETURN

IF (LLPERSISTENT) THEN
  IF (SIZE (SELF%ZDATA, 4) /= REGISTRY%GEOM%YRDIM%NGPBLKS) RETURN
ELSE
  IF (SIZE (SELF%ZDATA, 4) /= OML_MAX_THREADS ()) RETURN
ENDIF

LLCONFORM = .TRUE.

END FUNCTION CPG_CTY_TYPE_CONFORM

SUBROUTINE CPG_CTY_TYPE_UPDATE_VIEW (SELF, BLOCK_INDEX)

CLASS (CPG_CTY_TYPE)         :: SELF
INTEGER(KIND=JPIM), INTENT (IN)   :: BLOCK_INDEX

IF (ASSOCIATED (SELF%F_DATA)) THEN

  SELF%ZVIEW => SELF%F_DATA%GET_VIEW (BLOCK_INDEX)

  IF (ASSOCIATED (SELF%F_EVEL)) THEN
    IF ((.NOT. SELF%F_EVEL%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%EVEL))) THEN
      SELF%EVEL => SELF%F_EVEL%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%EVEL)) THEN
    SELF%EVEL => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_VVEL)) THEN
    IF ((.NOT. SELF%F_VVEL%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%VVEL))) THEN
      SELF%VVEL => SELF%F_VVEL%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%VVEL)) THEN
    SELF%VVEL => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_PSDIV)) THEN
    IF ((.NOT. SELF%F_PSDIV%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%PSDIV))) THEN
      SELF%PSDIV => SELF%F_PSDIV%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%PSDIV)) THEN
    SELF%PSDIV => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_PSDVBC)) THEN
    IF ((.NOT. SELF%F_PSDVBC%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%PSDVBC))) THEN
      SELF%PSDVBC => SELF%F_PSDVBC%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%PSDVBC)) THEN
    SELF%PSDVBC => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_DIVDP)) THEN
    IF ((.NOT. SELF%F_DIVDP%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DIVDP))) THEN
      SELF%DIVDP => SELF%F_DIVDP%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DIVDP)) THEN
    SELF%DIVDP => ZDUM2
  ENDIF

ELSE

  SELF%ZVIEW => ZDUM3

  IF (.NOT. ASSOCIATED (SELF%EVEL)) SELF%EVEL => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%VVEL)) SELF%VVEL => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%PSDIV)) SELF%PSDIV => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%PSDVBC)) SELF%PSDVBC => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DIVDP)) SELF%DIVDP => ZDUM2

ENDIF

END SUBROUTINE CPG_CTY_TYPE_UPDATE_VIEW

SUBROUTINE CPG_CTY_TYPE_FINAL (SELF)
CLASS (CPG_CTY_TYPE)          :: SELF

IF (ASSOCIATED (SELF%F_DIVDP)) THEN
  CALL FIELD_DELETE (SELF%F_DIVDP) 
  SELF%F_DIVDP => NULL ()
  SELF%DIVDP => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_PSDVBC)) THEN
  CALL FIELD_DELETE (SELF%F_PSDVBC) 
  SELF%F_PSDVBC => NULL ()
  SELF%PSDVBC => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_PSDIV)) THEN
  CALL FIELD_DELETE (SELF%F_PSDIV) 
  SELF%F_PSDIV => NULL ()
  SELF%PSDIV => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_VVEL)) THEN
  CALL FIELD_DELETE (SELF%F_VVEL) 
  SELF%F_VVEL => NULL ()
  SELF%VVEL => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_EVEL)) THEN
  CALL FIELD_DELETE (SELF%F_EVEL) 
  SELF%F_EVEL => NULL ()
  SELF%EVEL => NULL ()
ENDIF

IF (ASSOCIATED (SELF%F_DATA)) CALL FIELD_DELETE (SELF%F_DATA)
SELF%F_DATA => NULL ()

IF (SELF%LOWNED) THEN
  IF (ASSOCIATED (SELF%ZDATA)) DEALLOCATE (SELF%ZDATA)
ENDIF

SELF%ZDATA => NULL ()
SELF%ZVIEW => NULL ()

END SUBROUTINE CPG_CTY_TYPE_FINAL

SUBROUTINE CPG_TND_TYPE_INIT (&
                        &   SELF &
                        & , REGISTRY &
                        & , NLEV &
                        & , YDTTND &
                        & , PERSISTENT &
                        & , PTTND &
                        & , KBLKMIN  &
                        & , KBLKMAX  &
                        & )

USE INTDYN_MOD, ONLY : TTND
USE OML_MOD, ONLY: OML_MAX_THREADS

USE FIELD_DEFAULTS_MODULE

CLASS (CPG_TND_TYPE)                          :: SELF
TYPE (FIELD_REGISTRY),              INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),                INTENT (IN)    :: NLEV
TYPE (TTND),                    INTENT (IN)    :: YDTTND
LOGICAL, OPTIONAL,                  INTENT (IN)    :: PERSISTENT
REAL (KIND=JPRB), OPTIONAL, TARGET, INTENT (IN)    :: PTTND (:, :, :, :)
INTEGER (KIND=JPIM), OPTIONAL,      INTENT (IN)    :: KBLKMIN, KBLKMAX

LOGICAL :: LLPERSISTENT
LOGICAL :: LLINITIALIZED
INTEGER (KIND=JPIM) :: IBLKMIN, IBLKMAX

LLPERSISTENT = .FALSE.
IF (PRESENT (PERSISTENT)) LLPERSISTENT = PERSISTENT

IBLKMIN = 1
IF (PRESENT (KBLKMIN)) IBLKMIN = KBLKMIN
IBLKMAX = REGISTRY%GEOM%YRDIM%NGPBLKS
IF (PRESENT (KBLKMAX)) IBLKMAX = KBLKMAX


LLINITIALIZED = .FALSE.

IF (PRESENT (PTTND)) THEN
  SELF%ZDATA => PTTND (:, :, :, IBLKMIN:IBLKMAX)
  SELF%LOWNED = .FALSE.
  LLPERSISTENT = .TRUE.
  LLINITIALIZED = .TRUE.
ELSEIF (LLPERSISTENT) THEN
  ALLOCATE (SELF%ZDATA (REGISTRY%GEOM%YRDIM%NPROMA, NLEV, YDTTND%NDIM, IBLKMIN:IBLKMAX))
  IF (USE_INIT_DEBUG_VALUE) THEN
    SELF%ZDATA = INIT_DEBUG_VALUE_JPRB
    LLINITIALIZED = .TRUE.
  ENDIF
  SELF%LOWNED = .TRUE.
ELSE
  ALLOCATE (SELF%ZDATA (REGISTRY%GEOM%YRDIM%NPROMA, NLEV, YDTTND%NDIM, OML_MAX_THREADS ()))
  IF (USE_INIT_DEBUG_VALUE) THEN
    SELF%ZDATA = INIT_DEBUG_VALUE_JPRB
    LLINITIALIZED = .TRUE.
  ENDIF
  SELF%LOWNED = .TRUE.
ENDIF

CALL FIELD_NEW (SELF%F_DATA, DATA=SELF%ZDATA, PERSISTENT=LLPERSISTENT)

CALL FIELD_NEW (SELF%F_TNDU, DATA=SELF%ZDATA (:, :, YDTTND%M_TNDU, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_TNDV, DATA=SELF%ZDATA (:, :, YDTTND%M_TNDV, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_TNDU_NOC, DATA=SELF%ZDATA (:, :, YDTTND%M_TNDU_NOC, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_TNDV_NOC, DATA=SELF%ZDATA (:, :, YDTTND%M_TNDV_NOC, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_TNDT, DATA=SELF%ZDATA (:, :, YDTTND%M_TNDT, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_TNDPD, DATA=SELF%ZDATA (:, :, YDTTND%M_TNDPD, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_TNDVD, DATA=SELF%ZDATA (:, :, YDTTND%M_TNDVD, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
CALL FIELD_NEW (SELF%F_TNDGW, DATA=SELF%ZDATA (:, :, YDTTND%M_TNDGW, :), PERSISTENT=LLPERSISTENT, &
              & LBOUNDS=[1, 1, IBLKMIN], INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)

END SUBROUTINE CPG_TND_TYPE_INIT

SUBROUTINE CPG_TND_TYPE_RESIZE (SELF, REGISTRY, NLEV, &
                        & YDTTND, PERSISTENT)

USE INTDYN_MOD, ONLY : TTND

CLASS (CPG_TND_TYPE)                          :: SELF
TYPE (FIELD_REGISTRY),              INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),                INTENT (IN)    :: NLEV
TYPE (TTND),                    INTENT (IN)    :: YDTTND
LOGICAL, OPTIONAL,                  INTENT (IN)    :: PERSISTENT

IF (.NOT. SELF%CONFORM (REGISTRY, NLEV, &
                      & YDTTND, PERSISTENT)) &
THEN
  CALL SELF%FINAL
  CALL SELF%INIT (REGISTRY, NLEV, &
                & YDTTND, PERSISTENT)

ENDIF

END SUBROUTINE CPG_TND_TYPE_RESIZE

LOGICAL FUNCTION CPG_TND_TYPE_CONFORM (SELF, REGISTRY, NLEV, &
                        & YDTTND, PERSISTENT) RESULT (LLCONFORM)

USE INTDYN_MOD, ONLY : TTND
USE OML_MOD, ONLY: OML_MAX_THREADS

CLASS (CPG_TND_TYPE)                          :: SELF
TYPE (FIELD_REGISTRY),              INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),                INTENT (IN)    :: NLEV
TYPE (TTND),                    INTENT (IN)    :: YDTTND
LOGICAL, OPTIONAL,                  INTENT (IN)    :: PERSISTENT

LOGICAL :: LLPERSISTENT

LLCONFORM = .FALSE.

LLPERSISTENT = .FALSE.
IF (PRESENT (PERSISTENT)) LLPERSISTENT = PERSISTENT

IF (.NOT. ASSOCIATED (SELF%ZDATA)) RETURN


IF (SIZE (SELF%ZDATA, 1) /= REGISTRY%GEOM%YRDIM%NPROMA) RETURN

IF (SIZE (SELF%ZDATA, 2) /= NLEV) RETURN

IF (SIZE (SELF%ZDATA, 3) /= YDTTND%NDIM) RETURN

IF (LLPERSISTENT) THEN
  IF (SIZE (SELF%ZDATA, 4) /= REGISTRY%GEOM%YRDIM%NGPBLKS) RETURN
ELSE
  IF (SIZE (SELF%ZDATA, 4) /= OML_MAX_THREADS ()) RETURN
ENDIF

LLCONFORM = .TRUE.

END FUNCTION CPG_TND_TYPE_CONFORM

SUBROUTINE CPG_TND_TYPE_UPDATE_VIEW (SELF, BLOCK_INDEX)

CLASS (CPG_TND_TYPE)         :: SELF
INTEGER(KIND=JPIM), INTENT (IN)   :: BLOCK_INDEX

IF (ASSOCIATED (SELF%F_DATA)) THEN

  SELF%ZVIEW => SELF%F_DATA%GET_VIEW (BLOCK_INDEX)

  IF (ASSOCIATED (SELF%F_TNDU)) THEN
    IF ((.NOT. SELF%F_TNDU%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%TNDU))) THEN
      SELF%TNDU => SELF%F_TNDU%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%TNDU)) THEN
    SELF%TNDU => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_TNDV)) THEN
    IF ((.NOT. SELF%F_TNDV%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%TNDV))) THEN
      SELF%TNDV => SELF%F_TNDV%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%TNDV)) THEN
    SELF%TNDV => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_TNDU_NOC)) THEN
    IF ((.NOT. SELF%F_TNDU_NOC%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%TNDU_NOC))) THEN
      SELF%TNDU_NOC => SELF%F_TNDU_NOC%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%TNDU_NOC)) THEN
    SELF%TNDU_NOC => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_TNDV_NOC)) THEN
    IF ((.NOT. SELF%F_TNDV_NOC%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%TNDV_NOC))) THEN
      SELF%TNDV_NOC => SELF%F_TNDV_NOC%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%TNDV_NOC)) THEN
    SELF%TNDV_NOC => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_TNDT)) THEN
    IF ((.NOT. SELF%F_TNDT%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%TNDT))) THEN
      SELF%TNDT => SELF%F_TNDT%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%TNDT)) THEN
    SELF%TNDT => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_TNDPD)) THEN
    IF ((.NOT. SELF%F_TNDPD%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%TNDPD))) THEN
      SELF%TNDPD => SELF%F_TNDPD%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%TNDPD)) THEN
    SELF%TNDPD => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_TNDVD)) THEN
    IF ((.NOT. SELF%F_TNDVD%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%TNDVD))) THEN
      SELF%TNDVD => SELF%F_TNDVD%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%TNDVD)) THEN
    SELF%TNDVD => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_TNDGW)) THEN
    IF ((.NOT. SELF%F_TNDGW%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%TNDGW))) THEN
      SELF%TNDGW => SELF%F_TNDGW%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%TNDGW)) THEN
    SELF%TNDGW => ZDUM2
  ENDIF

ELSE

  SELF%ZVIEW => ZDUM3

  IF (.NOT. ASSOCIATED (SELF%TNDU)) SELF%TNDU => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%TNDV)) SELF%TNDV => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%TNDU_NOC)) SELF%TNDU_NOC => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%TNDV_NOC)) SELF%TNDV_NOC => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%TNDT)) SELF%TNDT => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%TNDPD)) SELF%TNDPD => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%TNDVD)) SELF%TNDVD => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%TNDGW)) SELF%TNDGW => ZDUM2

ENDIF

END SUBROUTINE CPG_TND_TYPE_UPDATE_VIEW

SUBROUTINE CPG_TND_TYPE_FINAL (SELF)
CLASS (CPG_TND_TYPE)          :: SELF

IF (ASSOCIATED (SELF%F_TNDGW)) THEN
  CALL FIELD_DELETE (SELF%F_TNDGW) 
  SELF%F_TNDGW => NULL ()
  SELF%TNDGW => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_TNDVD)) THEN
  CALL FIELD_DELETE (SELF%F_TNDVD) 
  SELF%F_TNDVD => NULL ()
  SELF%TNDVD => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_TNDPD)) THEN
  CALL FIELD_DELETE (SELF%F_TNDPD) 
  SELF%F_TNDPD => NULL ()
  SELF%TNDPD => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_TNDT)) THEN
  CALL FIELD_DELETE (SELF%F_TNDT) 
  SELF%F_TNDT => NULL ()
  SELF%TNDT => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_TNDV_NOC)) THEN
  CALL FIELD_DELETE (SELF%F_TNDV_NOC) 
  SELF%F_TNDV_NOC => NULL ()
  SELF%TNDV_NOC => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_TNDU_NOC)) THEN
  CALL FIELD_DELETE (SELF%F_TNDU_NOC) 
  SELF%F_TNDU_NOC => NULL ()
  SELF%TNDU_NOC => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_TNDV)) THEN
  CALL FIELD_DELETE (SELF%F_TNDV) 
  SELF%F_TNDV => NULL ()
  SELF%TNDV => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_TNDU)) THEN
  CALL FIELD_DELETE (SELF%F_TNDU) 
  SELF%F_TNDU => NULL ()
  SELF%TNDU => NULL ()
ENDIF

IF (ASSOCIATED (SELF%F_DATA)) CALL FIELD_DELETE (SELF%F_DATA)
SELF%F_DATA => NULL ()

IF (SELF%LOWNED) THEN
  IF (ASSOCIATED (SELF%ZDATA)) DEALLOCATE (SELF%ZDATA)
ENDIF

SELF%ZDATA => NULL ()
SELF%ZVIEW => NULL ()

END SUBROUTINE CPG_TND_TYPE_FINAL

SUBROUTINE CPG_GPAR_TYPE_INIT (SELF, REGISTRY, YDCPG_OPTS, YDTPARAR, PERSISTENT, PTPARAR, KBLKMIN, KBLKMAX)

USE YOMPARAR, ONLY : TPARAR
USE OML_MOD, ONLY: OML_MAX_THREADS
USE CPG_OPTS_TYPE_MOD, ONLY : CPG_OPTS_TYPE

USE FIELD_DEFAULTS_MODULE

CLASS (CPG_GPAR_TYPE)                          :: SELF
TYPE (FIELD_REGISTRY),              INTENT (INOUT) :: REGISTRY
TYPE (CPG_OPTS_TYPE),               INTENT (IN)    :: YDCPG_OPTS
TYPE (TPARAR),                    INTENT (IN)    :: YDTPARAR
LOGICAL, OPTIONAL,                  INTENT (IN)    :: PERSISTENT
REAL (KIND=JPRB), OPTIONAL, TARGET, INTENT (IN)    :: PTPARAR (:, :, :)
INTEGER (KIND=JPIM), OPTIONAL,      INTENT (IN)    :: KBLKMIN, KBLKMAX

LOGICAL :: LLPERSISTENT
LOGICAL :: LLINITIALIZED
INTEGER (KIND=JPIM) :: IBLKMIN, IBLKMAX

LLPERSISTENT = .FALSE.
IF (PRESENT (PERSISTENT)) LLPERSISTENT = PERSISTENT

IBLKMIN = 1
IF (PRESENT (KBLKMIN)) IBLKMIN = KBLKMIN
IBLKMAX = REGISTRY%GEOM%YRDIM%NGPBLKS
IF (PRESENT (KBLKMAX)) IBLKMAX = KBLKMAX

LLINITIALIZED = .FALSE.

IF (PRESENT (PTPARAR)) THEN
  SELF%ZDATA (1:,1:,IBLKMIN:) => PTPARAR (:,:,IBLKMIN:IBLKMAX)
  SELF%LOWNED = .FALSE.
  LLPERSISTENT = .TRUE.
  LLINITIALIZED = .TRUE.
ELSEIF (LLPERSISTENT) THEN
  ALLOCATE (SELF%ZDATA (REGISTRY%GEOM%YRDIM%NPROMA, YDTPARAR%NGPAR, IBLKMIN:IBLKMAX))
  IF (USE_INIT_DEBUG_VALUE) THEN
    SELF%ZDATA = INIT_DEBUG_VALUE_JPRB
    LLINITIALIZED = .TRUE.
  ENDIF
  SELF%LOWNED = .TRUE.
ELSE
  ALLOCATE (SELF%ZDATA (REGISTRY%GEOM%YRDIM%NPROMA, YDTPARAR%NGPAR, OML_MAX_THREADS ()))
  IF (USE_INIT_DEBUG_VALUE) THEN
    SELF%ZDATA = INIT_DEBUG_VALUE_JPRB
    LLINITIALIZED = .TRUE.
  ENDIF
  SELF%LOWNED = .TRUE.
ENDIF

CALL FIELD_NEW (SELF%F_DATA, DATA=SELF%ZDATA, PERSISTENT=LLPERSISTENT)

IF (YDTPARAR%MINPRR > 0) THEN
  CALL FIELD_NEW (SELF%F_INPRR, DATA=SELF%ZDATA (:, YDTPARAR%MINPRR, :), LBOUNDS=[1, 1, IBLKMIN], &
                & PERSISTENT=LLPERSISTENT, INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
ELSE
  SELF%F_INPRR => NULL ()
ENDIF
IF (YDTPARAR%MINPRS > 0) THEN
  CALL FIELD_NEW (SELF%F_INPRS, DATA=SELF%ZDATA (:, YDTPARAR%MINPRS, :), LBOUNDS=[1, 1, IBLKMIN], &
                & PERSISTENT=LLPERSISTENT, INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
ELSE
  SELF%F_INPRS => NULL ()
ENDIF
IF (YDTPARAR%MINPRG > 0) THEN
  CALL FIELD_NEW (SELF%F_INPRG, DATA=SELF%ZDATA (:, YDTPARAR%MINPRG, :), LBOUNDS=[1, 1, IBLKMIN], &
                & PERSISTENT=LLPERSISTENT, INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
ELSE
  SELF%F_INPRG => NULL ()
ENDIF
IF (YDTPARAR%MACPRR > 0) THEN
  CALL FIELD_NEW (SELF%F_ACPRR, DATA=SELF%ZDATA (:, YDTPARAR%MACPRR, :), LBOUNDS=[1, 1, IBLKMIN], &
                & PERSISTENT=LLPERSISTENT, INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
ELSE
  SELF%F_ACPRR => NULL ()
ENDIF
IF (YDTPARAR%MACPRS > 0) THEN
  CALL FIELD_NEW (SELF%F_ACPRS, DATA=SELF%ZDATA (:, YDTPARAR%MACPRS, :), LBOUNDS=[1, 1, IBLKMIN], &
                & PERSISTENT=LLPERSISTENT, INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
ELSE
  SELF%F_ACPRS => NULL ()
ENDIF
IF (YDTPARAR%MACPRG > 0) THEN
  CALL FIELD_NEW (SELF%F_ACPRG, DATA=SELF%ZDATA (:, YDTPARAR%MACPRG, :), LBOUNDS=[1, 1, IBLKMIN], &
                & PERSISTENT=LLPERSISTENT, INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
ELSE
  SELF%F_ACPRG => NULL ()
ENDIF
IF (YDTPARAR%MALBDIR > 0) THEN
  CALL FIELD_NEW (SELF%F_ALBDIR, DATA=SELF%ZDATA (:, YDTPARAR%MALBDIR:YDTPARAR%MALBDIR+YDCPG_OPTS%KSW-1,              :),&
      & LBOUNDS=[1, 1, IBLKMIN], &
                & PERSISTENT=LLPERSISTENT, INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
ELSE
  SELF%F_ALBDIR => NULL ()
ENDIF
IF (YDTPARAR%MALBSCA > 0) THEN
  CALL FIELD_NEW (SELF%F_ALBSCA, DATA=SELF%ZDATA (:, YDTPARAR%MALBSCA:YDTPARAR%MALBSCA+YDCPG_OPTS%KSW-1,              :),&
      & LBOUNDS=[1, 1, IBLKMIN], &
                & PERSISTENT=LLPERSISTENT, INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
ELSE
  SELF%F_ALBSCA => NULL ()
ENDIF
IF (YDTPARAR%MRAIN > 0) THEN
  CALL FIELD_NEW (SELF%F_RAIN, DATA=SELF%ZDATA (:, YDTPARAR%MRAIN, :), LBOUNDS=[1, 1, IBLKMIN], &
                & PERSISTENT=LLPERSISTENT, INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
ELSE
  SELF%F_RAIN => NULL ()
ENDIF
IF (YDTPARAR%MSNOW > 0) THEN
  CALL FIELD_NEW (SELF%F_SNOW, DATA=SELF%ZDATA (:, YDTPARAR%MSNOW, :), LBOUNDS=[1, 1, IBLKMIN], &
                & PERSISTENT=LLPERSISTENT, INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
ELSE
  SELF%F_SNOW => NULL ()
ENDIF
IF (YDTPARAR%MGZ0 > 0) THEN
  CALL FIELD_NEW (SELF%F_GZ0, DATA=SELF%ZDATA (:, YDTPARAR%MGZ0, :), LBOUNDS=[1, 1, IBLKMIN], &
                & PERSISTENT=LLPERSISTENT, INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
ELSE
  SELF%F_GZ0 => NULL ()
ENDIF
IF (YDTPARAR%MGZ0H > 0) THEN
  CALL FIELD_NEW (SELF%F_GZ0H, DATA=SELF%ZDATA (:, YDTPARAR%MGZ0H, :), LBOUNDS=[1, 1, IBLKMIN], &
                & PERSISTENT=LLPERSISTENT, INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
ELSE
  SELF%F_GZ0H => NULL ()
ENDIF
IF (YDTPARAR%MVQS > 0) THEN
  CALL FIELD_NEW (SELF%F_VQS, DATA=SELF%ZDATA (:, YDTPARAR%MVQS, :), LBOUNDS=[1, 1, IBLKMIN], &
                & PERSISTENT=LLPERSISTENT, INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
ELSE
  SELF%F_VQS => NULL ()
ENDIF
IF (YDTPARAR%MVTS > 0) THEN
  CALL FIELD_NEW (SELF%F_VTS, DATA=SELF%ZDATA (:, YDTPARAR%MVTS, :), LBOUNDS=[1, 1, IBLKMIN], &
                & PERSISTENT=LLPERSISTENT, INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
ELSE
  SELF%F_VTS => NULL ()
ENDIF
IF (YDTPARAR%MVEMIS > 0) THEN
  CALL FIELD_NEW (SELF%F_VEMIS, DATA=SELF%ZDATA (:, YDTPARAR%MVEMIS, :), LBOUNDS=[1, 1, IBLKMIN], &
                & PERSISTENT=LLPERSISTENT, INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
ELSE
  SELF%F_VEMIS => NULL ()
ENDIF
IF (YDTPARAR%MSWDIR > 0) THEN
  CALL FIELD_NEW (SELF%F_SWDIR, DATA=SELF%ZDATA (:, YDTPARAR%MSWDIR:YDTPARAR%MSWDIR+YDCPG_OPTS%KSW-1,              :), LBOUNDS=[1,&
      & 1, IBLKMIN], &
                & PERSISTENT=LLPERSISTENT, INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
ELSE
  SELF%F_SWDIR => NULL ()
ENDIF
IF (YDTPARAR%MSWDIF > 0) THEN
  CALL FIELD_NEW (SELF%F_SWDIF, DATA=SELF%ZDATA (:, YDTPARAR%MSWDIF:YDTPARAR%MSWDIF+YDCPG_OPTS%KSW-1,              :), LBOUNDS=[1,&
      & 1, IBLKMIN], &
                & PERSISTENT=LLPERSISTENT, INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
ELSE
  SELF%F_SWDIF => NULL ()
ENDIF
IF (YDTPARAR%MLSM > 0) THEN
  CALL FIELD_NEW (SELF%F_LSM, DATA=SELF%ZDATA (:, YDTPARAR%MLSM, :), LBOUNDS=[1, 1, IBLKMIN], &
                & PERSISTENT=LLPERSISTENT, INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
ELSE
  SELF%F_LSM => NULL ()
ENDIF
IF (YDTPARAR%MCD > 0) THEN
  CALL FIELD_NEW (SELF%F_CD, DATA=SELF%ZDATA (:, YDTPARAR%MCD, :), LBOUNDS=[1, 1, IBLKMIN], &
                & PERSISTENT=LLPERSISTENT, INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
ELSE
  SELF%F_CD => NULL ()
ENDIF
IF (YDTPARAR%MCH > 0) THEN
  CALL FIELD_NEW (SELF%F_CH, DATA=SELF%ZDATA (:, YDTPARAR%MCH, :), LBOUNDS=[1, 1, IBLKMIN], &
                & PERSISTENT=LLPERSISTENT, INITIALIZED=LLINITIALIZED, SYNC_ON_FINAL=.FALSE.)
ELSE
  SELF%F_CH => NULL ()
ENDIF

END SUBROUTINE CPG_GPAR_TYPE_INIT

SUBROUTINE CPG_GPAR_TYPE_UPDATE_VIEW (SELF, BLOCK_INDEX)

CLASS (CPG_GPAR_TYPE)         :: SELF
INTEGER(KIND=JPIM), INTENT (IN)   :: BLOCK_INDEX

IF (ASSOCIATED (SELF%F_DATA)) THEN

  SELF%ZVIEW => SELF%F_DATA%GET_VIEW (BLOCK_INDEX)

  IF (ASSOCIATED (SELF%F_INPRR)) THEN
    IF ((.NOT. SELF%F_INPRR%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%INPRR))) THEN
      SELF%INPRR  => SELF%F_INPRR%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%INPRR)) THEN
    SELF%INPRR  => ZDUM1
  ENDIF
  IF (ASSOCIATED (SELF%F_INPRS)) THEN
    IF ((.NOT. SELF%F_INPRS%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%INPRS))) THEN
      SELF%INPRS  => SELF%F_INPRS%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%INPRS)) THEN
    SELF%INPRS  => ZDUM1
  ENDIF
  IF (ASSOCIATED (SELF%F_INPRG)) THEN
    IF ((.NOT. SELF%F_INPRG%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%INPRG))) THEN
      SELF%INPRG  => SELF%F_INPRG%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%INPRG)) THEN
    SELF%INPRG  => ZDUM1
  ENDIF
  IF (ASSOCIATED (SELF%F_ACPRR)) THEN
    IF ((.NOT. SELF%F_ACPRR%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%ACPRR))) THEN
      SELF%ACPRR  => SELF%F_ACPRR%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%ACPRR)) THEN
    SELF%ACPRR  => ZDUM1
  ENDIF
  IF (ASSOCIATED (SELF%F_ACPRS)) THEN
    IF ((.NOT. SELF%F_ACPRS%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%ACPRS))) THEN
      SELF%ACPRS  => SELF%F_ACPRS%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%ACPRS)) THEN
    SELF%ACPRS  => ZDUM1
  ENDIF
  IF (ASSOCIATED (SELF%F_ACPRG)) THEN
    IF ((.NOT. SELF%F_ACPRG%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%ACPRG))) THEN
      SELF%ACPRG  => SELF%F_ACPRG%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%ACPRG)) THEN
    SELF%ACPRG  => ZDUM1
  ENDIF
  IF (ASSOCIATED (SELF%F_ALBDIR)) THEN
    IF ((.NOT. SELF%F_ALBDIR%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%ALBDIR))) THEN
      SELF%ALBDIR  => SELF%F_ALBDIR%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%ALBDIR)) THEN
    SELF%ALBDIR  => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_ALBSCA)) THEN
    IF ((.NOT. SELF%F_ALBSCA%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%ALBSCA))) THEN
      SELF%ALBSCA  => SELF%F_ALBSCA%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%ALBSCA)) THEN
    SELF%ALBSCA  => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_RAIN)) THEN
    IF ((.NOT. SELF%F_RAIN%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%RAIN))) THEN
      SELF%RAIN  => SELF%F_RAIN%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%RAIN)) THEN
    SELF%RAIN  => ZDUM1
  ENDIF
  IF (ASSOCIATED (SELF%F_SNOW)) THEN
    IF ((.NOT. SELF%F_SNOW%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%SNOW))) THEN
      SELF%SNOW  => SELF%F_SNOW%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%SNOW)) THEN
    SELF%SNOW  => ZDUM1
  ENDIF
  IF (ASSOCIATED (SELF%F_GZ0)) THEN
    IF ((.NOT. SELF%F_GZ0%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%GZ0))) THEN
      SELF%GZ0  => SELF%F_GZ0%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%GZ0)) THEN
    SELF%GZ0  => ZDUM1
  ENDIF
  IF (ASSOCIATED (SELF%F_GZ0H)) THEN
    IF ((.NOT. SELF%F_GZ0H%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%GZ0H))) THEN
      SELF%GZ0H  => SELF%F_GZ0H%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%GZ0H)) THEN
    SELF%GZ0H  => ZDUM1
  ENDIF
  IF (ASSOCIATED (SELF%F_VQS)) THEN
    IF ((.NOT. SELF%F_VQS%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%VQS))) THEN
      SELF%VQS  => SELF%F_VQS%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%VQS)) THEN
    SELF%VQS  => ZDUM1
  ENDIF
  IF (ASSOCIATED (SELF%F_VTS)) THEN
    IF ((.NOT. SELF%F_VTS%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%VTS))) THEN
      SELF%VTS  => SELF%F_VTS%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%VTS)) THEN
    SELF%VTS  => ZDUM1
  ENDIF
  IF (ASSOCIATED (SELF%F_VEMIS)) THEN
    IF ((.NOT. SELF%F_VEMIS%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%VEMIS))) THEN
      SELF%VEMIS  => SELF%F_VEMIS%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%VEMIS)) THEN
    SELF%VEMIS  => ZDUM1
  ENDIF
  IF (ASSOCIATED (SELF%F_SWDIR)) THEN
    IF ((.NOT. SELF%F_SWDIR%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%SWDIR))) THEN
      SELF%SWDIR  => SELF%F_SWDIR%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%SWDIR)) THEN
    SELF%SWDIR  => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_SWDIF)) THEN
    IF ((.NOT. SELF%F_SWDIF%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%SWDIF))) THEN
      SELF%SWDIF  => SELF%F_SWDIF%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%SWDIF)) THEN
    SELF%SWDIF  => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_LSM)) THEN
    IF ((.NOT. SELF%F_LSM%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%LSM))) THEN
      SELF%LSM  => SELF%F_LSM%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%LSM)) THEN
    SELF%LSM  => ZDUM1
  ENDIF
  IF (ASSOCIATED (SELF%F_CD)) THEN
    IF ((.NOT. SELF%F_CD%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%CD))) THEN
      SELF%CD  => SELF%F_CD%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%CD)) THEN
    SELF%CD  => ZDUM1
  ENDIF
  IF (ASSOCIATED (SELF%F_CH)) THEN
    IF ((.NOT. SELF%F_CH%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%CH))) THEN
      SELF%CH  => SELF%F_CH%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%CH)) THEN
    SELF%CH  => ZDUM1
  ENDIF

ELSE

  SELF%ZVIEW => ZDUM2

  IF (.NOT. ASSOCIATED (SELF%INPRR)) SELF%INPRR  => ZDUM1
  IF (.NOT. ASSOCIATED (SELF%INPRS)) SELF%INPRS  => ZDUM1
  IF (.NOT. ASSOCIATED (SELF%INPRG)) SELF%INPRG  => ZDUM1
  IF (.NOT. ASSOCIATED (SELF%ACPRR)) SELF%ACPRR  => ZDUM1
  IF (.NOT. ASSOCIATED (SELF%ACPRS)) SELF%ACPRS  => ZDUM1
  IF (.NOT. ASSOCIATED (SELF%ACPRG)) SELF%ACPRG  => ZDUM1
  IF (.NOT. ASSOCIATED (SELF%ALBDIR)) SELF%ALBDIR  => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%ALBSCA)) SELF%ALBSCA  => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%RAIN)) SELF%RAIN  => ZDUM1
  IF (.NOT. ASSOCIATED (SELF%SNOW)) SELF%SNOW  => ZDUM1
  IF (.NOT. ASSOCIATED (SELF%GZ0)) SELF%GZ0  => ZDUM1
  IF (.NOT. ASSOCIATED (SELF%GZ0H)) SELF%GZ0H  => ZDUM1
  IF (.NOT. ASSOCIATED (SELF%VQS)) SELF%VQS  => ZDUM1
  IF (.NOT. ASSOCIATED (SELF%VTS)) SELF%VTS  => ZDUM1
  IF (.NOT. ASSOCIATED (SELF%VEMIS)) SELF%VEMIS  => ZDUM1
  IF (.NOT. ASSOCIATED (SELF%SWDIR)) SELF%SWDIR  => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%SWDIF)) SELF%SWDIF  => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%LSM)) SELF%LSM  => ZDUM1
  IF (.NOT. ASSOCIATED (SELF%CD)) SELF%CD  => ZDUM1
  IF (.NOT. ASSOCIATED (SELF%CH)) SELF%CH  => ZDUM1

ENDIF

END SUBROUTINE CPG_GPAR_TYPE_UPDATE_VIEW

SUBROUTINE CPG_GPAR_TYPE_FINAL (SELF)
CLASS (CPG_GPAR_TYPE)          :: SELF

IF (ASSOCIATED (SELF%F_CH)) THEN
  CALL FIELD_DELETE (SELF%F_CH) 
  SELF%F_CH => NULL ()
  SELF%CH => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_CD)) THEN
  CALL FIELD_DELETE (SELF%F_CD) 
  SELF%F_CD => NULL ()
  SELF%CD => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_LSM)) THEN
  CALL FIELD_DELETE (SELF%F_LSM) 
  SELF%F_LSM => NULL ()
  SELF%LSM => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_SWDIF)) THEN
  CALL FIELD_DELETE (SELF%F_SWDIF) 
  SELF%F_SWDIF => NULL ()
  SELF%SWDIF => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_SWDIR)) THEN
  CALL FIELD_DELETE (SELF%F_SWDIR) 
  SELF%F_SWDIR => NULL ()
  SELF%SWDIR => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_VEMIS)) THEN
  CALL FIELD_DELETE (SELF%F_VEMIS) 
  SELF%F_VEMIS => NULL ()
  SELF%VEMIS => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_VTS)) THEN
  CALL FIELD_DELETE (SELF%F_VTS) 
  SELF%F_VTS => NULL ()
  SELF%VTS => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_VQS)) THEN
  CALL FIELD_DELETE (SELF%F_VQS) 
  SELF%F_VQS => NULL ()
  SELF%VQS => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_GZ0H)) THEN
  CALL FIELD_DELETE (SELF%F_GZ0H) 
  SELF%F_GZ0H => NULL ()
  SELF%GZ0H => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_GZ0)) THEN
  CALL FIELD_DELETE (SELF%F_GZ0) 
  SELF%F_GZ0 => NULL ()
  SELF%GZ0 => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_SNOW)) THEN
  CALL FIELD_DELETE (SELF%F_SNOW) 
  SELF%F_SNOW => NULL ()
  SELF%SNOW => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_RAIN)) THEN
  CALL FIELD_DELETE (SELF%F_RAIN) 
  SELF%F_RAIN => NULL ()
  SELF%RAIN => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_ALBSCA)) THEN
  CALL FIELD_DELETE (SELF%F_ALBSCA) 
  SELF%F_ALBSCA => NULL ()
  SELF%ALBSCA => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_ALBDIR)) THEN
  CALL FIELD_DELETE (SELF%F_ALBDIR) 
  SELF%F_ALBDIR => NULL ()
  SELF%ALBDIR => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_ACPRG)) THEN
  CALL FIELD_DELETE (SELF%F_ACPRG) 
  SELF%F_ACPRG => NULL ()
  SELF%ACPRG => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_ACPRS)) THEN
  CALL FIELD_DELETE (SELF%F_ACPRS) 
  SELF%F_ACPRS => NULL ()
  SELF%ACPRS => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_ACPRR)) THEN
  CALL FIELD_DELETE (SELF%F_ACPRR) 
  SELF%F_ACPRR => NULL ()
  SELF%ACPRR => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_INPRG)) THEN
  CALL FIELD_DELETE (SELF%F_INPRG) 
  SELF%F_INPRG => NULL ()
  SELF%INPRG => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_INPRS)) THEN
  CALL FIELD_DELETE (SELF%F_INPRS) 
  SELF%F_INPRS => NULL ()
  SELF%INPRS => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_INPRR)) THEN
  CALL FIELD_DELETE (SELF%F_INPRR) 
  SELF%F_INPRR => NULL ()
  SELF%INPRR => NULL ()
ENDIF

IF (ASSOCIATED (SELF%F_DATA)) CALL FIELD_DELETE (SELF%F_DATA)
SELF%F_DATA => NULL ()

IF (SELF%LOWNED) THEN
  IF (ASSOCIATED (SELF%ZDATA)) DEALLOCATE (SELF%ZDATA)
ENDIF

SELF%ZDATA => NULL ()
SELF%ZVIEW => NULL ()

END SUBROUTINE CPG_GPAR_TYPE_FINAL




SUBROUTINE CPG_DYN_TYPE_INIT (SELF &
                                & , KT  &
                                & , REGISTRY &
                                & , NLEV &
                                & , PERSISTENT &
                                & , YDDYNA &
                                &, PHIF &
                                &, PREF &
                                &, PRCP &
                                &, PCTY &
                                &, KBLKMIN &
                                &, KBLKMAX &
                        &)

USE INTDYN_MOD, ONLY : YYTCTY0, YYTRCP0, YYTHW0, YYTXYB0, YYTXYB0_PHY, YYTXYBDER0
USE INTDYN_MOD, ONLY :          YYTRCP9, YYTHW9, YYTXYB9, YYTXYB9_PHY
USE INTDYN_MOD, ONLY : TRCP, TCTY, THWIND, TXYB, TXYBDER


USE YOMDYNA, ONLY : TDYNA

CLASS (CPG_DYN_TYPE)                    :: SELF
INTEGER(KIND=JPIM),           INTENT (IN)    :: KT
TYPE (FIELD_REGISTRY),        INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),          INTENT (IN)    :: NLEV
LOGICAL, OPTIONAL,            INTENT (IN)    :: PERSISTENT
TYPE (TDYNA),                 INTENT (IN)    :: YDDYNA

REAL(KIND=JPRB),       INTENT (IN), OPTIONAL, TARGET  :: PHIF(:, :, :)
REAL(KIND=JPRB),       INTENT (IN), OPTIONAL, TARGET  :: PREF(:, :, :)
REAL(KIND=JPRB),       INTENT (IN), OPTIONAL, TARGET  :: PRCP(:, :, :, :)
REAL(KIND=JPRB),       INTENT (IN), OPTIONAL, TARGET  :: PCTY(:, :, :, :)

INTEGER(KIND=JPIM), OPTIONAL, INTENT (IN)    :: KBLKMIN
INTEGER(KIND=JPIM), OPTIONAL, INTENT (IN)    :: KBLKMAX

LOGICAL :: LLT0

INTEGER (KIND=JPIM) :: IBLKMIN, IBLKMAX

TYPE (TRCP)   , POINTER :: YLTRCP     
TYPE (TCTY)   , POINTER :: YLTCTY     
TYPE (THWIND) , POINTER :: YLTHW     
TYPE (TXYB)   , POINTER :: YLTXYB     
TYPE (TXYB)   , POINTER :: YLTXYB_PHY
TYPE (TXYBDER), POINTER :: YLTXYBDER

TYPE (TCTY),   TARGET :: YLTCTY0 
TYPE (THWIND), TARGET :: YLTHW0, YLTHW9 
TYPE (TRCP),   TARGET :: YLTRCP0, YLTRCP9 
TYPE (TXYB),   TARGET :: YLTXYB0, YLTXYB0_PHY, YLTXYB9, YLTXYB9_PHY
TYPE (TXYBDER),TARGET :: YLTXYBDER0

YLTCTY0     = YYTCTY0 
YLTHW0      = YYTHW0 
YLTHW9      = YYTHW9 
YLTRCP0     = YYTRCP0 
YLTRCP9     = YYTRCP9 
YLTXYB0     = YYTXYB0 
YLTXYB0_PHY = YYTXYB0_PHY 
YLTXYB9     = YYTXYB9 
YLTXYB9_PHY = YYTXYB9_PHY
YLTXYBDER0  = YYTXYBDER0

LLT0 = KT == 0

YLTRCP     => NULL ()
YLTCTY     => NULL ()
YLTHW      => NULL ()
YLTXYB     => NULL ()
YLTXYB_PHY => NULL ()
YLTXYBDER  => NULL ()

IF (KT == 0) THEN
  YLTRCP     => YLTRCP0
  YLTCTY     => YLTCTY0
  YLTHW      => YLTHW0
  YLTXYB     => YLTXYB0
  YLTXYB_PHY => YLTXYB0_PHY
  YLTXYBDER  => YLTXYBDER0
ELSEIF (KT == 9) THEN
  YLTRCP     => YLTRCP9
  YLTCTY     => NULL ()
  YLTHW      => YLTHW9
  YLTXYB     => YLTXYB9
  YLTXYB_PHY => YLTXYB9_PHY
ENDIF


IBLKMIN = 1
IF (PRESENT (KBLKMIN)) IBLKMIN = KBLKMIN
IBLKMAX = REGISTRY%GEOM%YRDIM%NGPBLKS
IF (PRESENT (KBLKMAX)) IBLKMAX = KBLKMAX

IF (LLT0) THEN
CALL FIELD_NEW (  SELF%F_OROGL, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA,                               IBLKMAX], LBOUNDS=[1,          &
    &                     IBLKMIN], PERSISTENT=PERSISTENT)
ENDIF

IF (LLT0) THEN
CALL FIELD_NEW (  SELF%F_OROGM, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA,                               IBLKMAX], LBOUNDS=[1,          &
    &                     IBLKMIN], PERSISTENT=PERSISTENT)
ENDIF

IF (LLT0) THEN
CALL FIELD_NEW (  SELF%F_OROGLL, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA,                               IBLKMAX], LBOUNDS=[1,         &
    &                      IBLKMIN], PERSISTENT=PERSISTENT)
ENDIF

IF (LLT0) THEN
CALL FIELD_NEW (  SELF%F_OROGLM, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA,                               IBLKMAX], LBOUNDS=[1,         &
    &                      IBLKMIN], PERSISTENT=PERSISTENT)
ENDIF

IF (LLT0) THEN
CALL FIELD_NEW (  SELF%F_OROGMM, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA,                               IBLKMAX], LBOUNDS=[1,         &
    &                      IBLKMIN], PERSISTENT=PERSISTENT)
ENDIF

CALL FIELD_NEW (SELF%F_PHI, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA, NLEV,                IBLKMAX], LBOUNDS=[1, 0,               &
    & IBLKMIN], PERSISTENT=PERSISTENT)

CALL FIELD_NEW (SELF%F_PRE, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA, NLEV,                IBLKMAX], LBOUNDS=[1, 0,               &
    & IBLKMIN], PERSISTENT=PERSISTENT)

IF (PRESENT (PHIF)) THEN
    CALL FIELD_NEW (SELF%F_PHIF, DATA=PHIF, LBOUNDS=[1, 1, IBLKMIN])
ELSE
CALL FIELD_NEW (  SELF%F_PHIF, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA, NLEV,                IBLKMAX], LBOUNDS=[1, 1,               &
    & IBLKMIN], PERSISTENT=PERSISTENT)
ENDIF

IF (PRESENT (PREF)) THEN
    CALL FIELD_NEW (SELF%F_PREF, DATA=PREF, LBOUNDS=[1, 1, IBLKMIN])
ELSE
CALL FIELD_NEW (  SELF%F_PREF, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA, NLEV,                IBLKMAX], LBOUNDS=[1, 1,               &
    & IBLKMIN], PERSISTENT=PERSISTENT)
ENDIF

CALL FIELD_NEW (SELF%F_PREL, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA,                               IBLKMAX], LBOUNDS=[1,             &
    &                  IBLKMIN], PERSISTENT=PERSISTENT)

CALL FIELD_NEW (SELF%F_PREM, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA,                               IBLKMAX], LBOUNDS=[1,             &
    &                  IBLKMIN], PERSISTENT=PERSISTENT)

CALL FIELD_NEW (SELF%F_NHY, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA, NLEV,                IBLKMAX], LBOUNDS=[1, 0,               &
    & IBLKMIN], PERSISTENT=PERSISTENT)

CALL FIELD_NEW (SELF%F_GWFT, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA, NLEV,                IBLKMAX], LBOUNDS=[1, 1,               &
    & IBLKMIN], PERSISTENT=PERSISTENT)

IF (LLT0) THEN
CALL FIELD_NEW (  SELF%F_KENE, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA, NLEV,                IBLKMAX], LBOUNDS=[1, 1,               &
    & IBLKMIN], PERSISTENT=PERSISTENT)
ENDIF

CALL FIELD_NEW (SELF%F_NHX, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA, NLEV,                IBLKMAX], LBOUNDS=[1, 1,               &
    & IBLKMIN], PERSISTENT=PERSISTENT)

IF (LLT0) THEN
CALL FIELD_NEW (  SELF%F_PHIFL, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA, NLEV,                IBLKMAX], LBOUNDS=[1, 1,               &
    & IBLKMIN], PERSISTENT=PERSISTENT)
ENDIF

IF (LLT0) THEN
CALL FIELD_NEW (  SELF%F_PHIFM, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA, NLEV,                IBLKMAX], LBOUNDS=[1, 1,               &
    & IBLKMIN], PERSISTENT=PERSISTENT)
ENDIF

IF (LLT0) THEN
CALL FIELD_NEW (  SELF%F_RTL, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA, NLEV,                IBLKMAX], LBOUNDS=[1, 1,               &
    & IBLKMIN], PERSISTENT=PERSISTENT)
ENDIF

IF (LLT0) THEN
CALL FIELD_NEW (  SELF%F_RTM, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA, NLEV,                IBLKMAX], LBOUNDS=[1, 1,               &
    & IBLKMIN], PERSISTENT=PERSISTENT)
ENDIF

CALL SELF%RCP%INIT (REGISTRY, NLEV, YLTRCP, PERSISTENT, PRCP, KBLKMIN=KBLKMIN, KBLKMAX=KBLKMAX)

IF (LLT0) THEN
  CALL SELF%CTY%INIT (REGISTRY, NLEV, YLTCTY, PERSISTENT, PCTY, KBLKMIN=KBLKMIN, KBLKMAX=KBLKMAX)
ENDIF

IF (LLT0) THEN
  CALL SELF%UVH%INIT (REGISTRY, NLEV, YLTHW, PERSISTENT, KBLKMIN=KBLKMIN, KBLKMAX=KBLKMAX)
ENDIF

CALL SELF%XYB%INIT (REGISTRY, NLEV, YLTXYB, PERSISTENT, KBLKMIN=KBLKMIN, KBLKMAX=KBLKMAX)

IF (YDDYNA%LNHDYN .AND. LLT0) THEN
CALL FIELD_NEW (  SELF%F_DBBC, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA,                               IBLKMAX], LBOUNDS=[1,           &
    &                    IBLKMIN], PERSISTENT=PERSISTENT)
ENDIF

IF (YDDYNA%LNHDYN .AND. LLT0) THEN
CALL FIELD_NEW (  SELF%F_GWS, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA,                               IBLKMAX], LBOUNDS=[1,            &
    &                   IBLKMIN], PERSISTENT=PERSISTENT)
ENDIF

IF (YDDYNA%LNHDYN .AND. LLT0) THEN
CALL FIELD_NEW (  SELF%F_GWFL, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA, NLEV,                IBLKMAX], LBOUNDS=[1, 1,               &
    & IBLKMIN], PERSISTENT=PERSISTENT)
ENDIF

IF (YDDYNA%LNHDYN .AND. LLT0) THEN
CALL FIELD_NEW (  SELF%F_GWFM, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA, NLEV,                IBLKMAX], LBOUNDS=[1, 1,               &
    & IBLKMIN], PERSISTENT=PERSISTENT)
ENDIF

IF (YDDYNA%LNHDYN) THEN
CALL FIELD_NEW (  SELF%F_GWT, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA, NLEV,                IBLKMAX], LBOUNDS=[1, 1,               &
    & IBLKMIN], PERSISTENT=PERSISTENT)
ENDIF

IF (YDDYNA%LNHDYN) THEN
CALL FIELD_NEW (  SELF%F_NHPREF, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA, NLEV,                IBLKMAX], LBOUNDS=[1, 1,               &
    & IBLKMIN], PERSISTENT=PERSISTENT)
ENDIF

IF (YDDYNA%LNHDYN) THEN
CALL FIELD_NEW (  SELF%F_NHPREH, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA, NLEV,                IBLKMAX], LBOUNDS=[1, 0,               &
    & IBLKMIN], PERSISTENT=PERSISTENT)
ENDIF

IF (YDDYNA%LNHDYN .AND. LLT0) THEN
CALL FIELD_NEW (  SELF%F_QCHAL, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA, NLEV,                IBLKMAX], LBOUNDS=[1, 1,               &
    & IBLKMIN], PERSISTENT=PERSISTENT)
ENDIF

IF (YDDYNA%LNHDYN .AND. LLT0) THEN
CALL FIELD_NEW (  SELF%F_QCHAM, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA, NLEV,                IBLKMAX], LBOUNDS=[1, 1,               &
    & IBLKMIN], PERSISTENT=PERSISTENT)
ENDIF

IF (YDDYNA%LNHDYN .AND. LLT0) THEN
CALL FIELD_NEW (  SELF%F_RDPHI, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA, NLEV,                IBLKMAX], LBOUNDS=[1, 1,               &
    & IBLKMIN], PERSISTENT=PERSISTENT)
ENDIF


END SUBROUTINE CPG_DYN_TYPE_INIT

SUBROUTINE CPG_DYN_TYPE_UPDATE_VIEW (SELF, BLOCK_INDEX)

CLASS (CPG_DYN_TYPE)         :: SELF
INTEGER(KIND=JPIM), INTENT (IN)   :: BLOCK_INDEX

IF (ASSOCIATED (SELF%F_OROGL)) THEN
  IF ((.NOT. SELF%F_OROGL%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%OROGL))) THEN
    SELF%OROGL => SELF%F_OROGL%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%OROGL)) THEN
  SELF%OROGL => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_OROGM)) THEN
  IF ((.NOT. SELF%F_OROGM%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%OROGM))) THEN
    SELF%OROGM => SELF%F_OROGM%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%OROGM)) THEN
  SELF%OROGM => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_OROGLL)) THEN
  IF ((.NOT. SELF%F_OROGLL%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%OROGLL))) THEN
    SELF%OROGLL => SELF%F_OROGLL%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%OROGLL)) THEN
  SELF%OROGLL => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_OROGLM)) THEN
  IF ((.NOT. SELF%F_OROGLM%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%OROGLM))) THEN
    SELF%OROGLM => SELF%F_OROGLM%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%OROGLM)) THEN
  SELF%OROGLM => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_OROGMM)) THEN
  IF ((.NOT. SELF%F_OROGMM%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%OROGMM))) THEN
    SELF%OROGMM => SELF%F_OROGMM%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%OROGMM)) THEN
  SELF%OROGMM => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_PHI)) THEN
  IF ((.NOT. SELF%F_PHI%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%PHI))) THEN
    SELF%PHI => SELF%F_PHI%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%PHI)) THEN
  SELF%PHI => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_PRE)) THEN
  IF ((.NOT. SELF%F_PRE%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%PRE))) THEN
    SELF%PRE => SELF%F_PRE%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%PRE)) THEN
  SELF%PRE => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_PHIF)) THEN
  IF ((.NOT. SELF%F_PHIF%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%PHIF))) THEN
    SELF%PHIF => SELF%F_PHIF%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%PHIF)) THEN
  SELF%PHIF => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_PREF)) THEN
  IF ((.NOT. SELF%F_PREF%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%PREF))) THEN
    SELF%PREF => SELF%F_PREF%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%PREF)) THEN
  SELF%PREF => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_PREL)) THEN
  IF ((.NOT. SELF%F_PREL%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%PREL))) THEN
    SELF%PREL => SELF%F_PREL%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%PREL)) THEN
  SELF%PREL => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_PREM)) THEN
  IF ((.NOT. SELF%F_PREM%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%PREM))) THEN
    SELF%PREM => SELF%F_PREM%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%PREM)) THEN
  SELF%PREM => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_NHY)) THEN
  IF ((.NOT. SELF%F_NHY%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%NHY))) THEN
    SELF%NHY => SELF%F_NHY%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%NHY)) THEN
  SELF%NHY => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_GWFT)) THEN
  IF ((.NOT. SELF%F_GWFT%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%GWFT))) THEN
    SELF%GWFT => SELF%F_GWFT%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%GWFT)) THEN
  SELF%GWFT => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_KENE)) THEN
  IF ((.NOT. SELF%F_KENE%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%KENE))) THEN
    SELF%KENE => SELF%F_KENE%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%KENE)) THEN
  SELF%KENE => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_NHX)) THEN
  IF ((.NOT. SELF%F_NHX%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%NHX))) THEN
    SELF%NHX => SELF%F_NHX%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%NHX)) THEN
  SELF%NHX => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_PHIFL)) THEN
  IF ((.NOT. SELF%F_PHIFL%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%PHIFL))) THEN
    SELF%PHIFL => SELF%F_PHIFL%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%PHIFL)) THEN
  SELF%PHIFL => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_PHIFM)) THEN
  IF ((.NOT. SELF%F_PHIFM%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%PHIFM))) THEN
    SELF%PHIFM => SELF%F_PHIFM%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%PHIFM)) THEN
  SELF%PHIFM => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_RTL)) THEN
  IF ((.NOT. SELF%F_RTL%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%RTL))) THEN
    SELF%RTL => SELF%F_RTL%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%RTL)) THEN
  SELF%RTL => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_RTM)) THEN
  IF ((.NOT. SELF%F_RTM%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%RTM))) THEN
    SELF%RTM => SELF%F_RTM%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%RTM)) THEN
  SELF%RTM => ZDUM2
ENDIF
CALL SELF%RCP%UPDATE_VIEW (BLOCK_INDEX)
CALL SELF%CTY%UPDATE_VIEW (BLOCK_INDEX)
CALL SELF%UVH%UPDATE_VIEW (BLOCK_INDEX)
CALL SELF%XYB%UPDATE_VIEW (BLOCK_INDEX)
IF (ASSOCIATED (SELF%F_DBBC)) THEN
  IF ((.NOT. SELF%F_DBBC%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DBBC))) THEN
    SELF%DBBC => SELF%F_DBBC%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%DBBC)) THEN
  SELF%DBBC => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_GWS)) THEN
  IF ((.NOT. SELF%F_GWS%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%GWS))) THEN
    SELF%GWS => SELF%F_GWS%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%GWS)) THEN
  SELF%GWS => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_GWFL)) THEN
  IF ((.NOT. SELF%F_GWFL%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%GWFL))) THEN
    SELF%GWFL => SELF%F_GWFL%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%GWFL)) THEN
  SELF%GWFL => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_GWFM)) THEN
  IF ((.NOT. SELF%F_GWFM%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%GWFM))) THEN
    SELF%GWFM => SELF%F_GWFM%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%GWFM)) THEN
  SELF%GWFM => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_GWT)) THEN
  IF ((.NOT. SELF%F_GWT%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%GWT))) THEN
    SELF%GWT => SELF%F_GWT%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%GWT)) THEN
  SELF%GWT => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_NHPREF)) THEN
  IF ((.NOT. SELF%F_NHPREF%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%NHPREF))) THEN
    SELF%NHPREF => SELF%F_NHPREF%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%NHPREF)) THEN
  SELF%NHPREF => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_NHPREH)) THEN
  IF ((.NOT. SELF%F_NHPREH%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%NHPREH))) THEN
    SELF%NHPREH => SELF%F_NHPREH%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%NHPREH)) THEN
  SELF%NHPREH => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_QCHAL)) THEN
  IF ((.NOT. SELF%F_QCHAL%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%QCHAL))) THEN
    SELF%QCHAL => SELF%F_QCHAL%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%QCHAL)) THEN
  SELF%QCHAL => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_QCHAM)) THEN
  IF ((.NOT. SELF%F_QCHAM%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%QCHAM))) THEN
    SELF%QCHAM => SELF%F_QCHAM%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%QCHAM)) THEN
  SELF%QCHAM => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_RDPHI)) THEN
  IF ((.NOT. SELF%F_RDPHI%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%RDPHI))) THEN
    SELF%RDPHI => SELF%F_RDPHI%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%RDPHI)) THEN
  SELF%RDPHI => ZDUM2
ENDIF

END SUBROUTINE CPG_DYN_TYPE_UPDATE_VIEW

SUBROUTINE CPG_DYN_TYPE_FINAL (SELF)
CLASS (CPG_DYN_TYPE)         :: SELF

IF (ASSOCIATED (SELF%F_RDPHI)) CALL FIELD_DELETE (SELF%F_RDPHI) 
IF (ASSOCIATED (SELF%F_QCHAM)) CALL FIELD_DELETE (SELF%F_QCHAM) 
IF (ASSOCIATED (SELF%F_QCHAL)) CALL FIELD_DELETE (SELF%F_QCHAL) 
IF (ASSOCIATED (SELF%F_NHPREH)) CALL FIELD_DELETE (SELF%F_NHPREH) 
IF (ASSOCIATED (SELF%F_NHPREF)) CALL FIELD_DELETE (SELF%F_NHPREF) 
IF (ASSOCIATED (SELF%F_GWT)) CALL FIELD_DELETE (SELF%F_GWT) 
IF (ASSOCIATED (SELF%F_GWFM)) CALL FIELD_DELETE (SELF%F_GWFM) 
IF (ASSOCIATED (SELF%F_GWFL)) CALL FIELD_DELETE (SELF%F_GWFL) 
IF (ASSOCIATED (SELF%F_GWS)) CALL FIELD_DELETE (SELF%F_GWS) 
IF (ASSOCIATED (SELF%F_DBBC)) CALL FIELD_DELETE (SELF%F_DBBC) 
CALL SELF%XYB%FINAL ()
CALL SELF%UVH%FINAL ()
CALL SELF%CTY%FINAL ()
CALL SELF%RCP%FINAL ()
IF (ASSOCIATED (SELF%F_RTM)) CALL FIELD_DELETE (SELF%F_RTM) 
IF (ASSOCIATED (SELF%F_RTL)) CALL FIELD_DELETE (SELF%F_RTL) 
IF (ASSOCIATED (SELF%F_PHIFM)) CALL FIELD_DELETE (SELF%F_PHIFM) 
IF (ASSOCIATED (SELF%F_PHIFL)) CALL FIELD_DELETE (SELF%F_PHIFL) 
IF (ASSOCIATED (SELF%F_NHX)) CALL FIELD_DELETE (SELF%F_NHX) 
IF (ASSOCIATED (SELF%F_KENE)) CALL FIELD_DELETE (SELF%F_KENE) 
IF (ASSOCIATED (SELF%F_GWFT)) CALL FIELD_DELETE (SELF%F_GWFT) 
IF (ASSOCIATED (SELF%F_NHY)) CALL FIELD_DELETE (SELF%F_NHY) 
IF (ASSOCIATED (SELF%F_PREM)) CALL FIELD_DELETE (SELF%F_PREM) 
IF (ASSOCIATED (SELF%F_PREL)) CALL FIELD_DELETE (SELF%F_PREL) 
IF (ASSOCIATED (SELF%F_PREF)) CALL FIELD_DELETE (SELF%F_PREF) 
IF (ASSOCIATED (SELF%F_PHIF)) CALL FIELD_DELETE (SELF%F_PHIF) 
IF (ASSOCIATED (SELF%F_PRE)) CALL FIELD_DELETE (SELF%F_PRE) 
IF (ASSOCIATED (SELF%F_PHI)) CALL FIELD_DELETE (SELF%F_PHI) 
IF (ASSOCIATED (SELF%F_OROGMM)) CALL FIELD_DELETE (SELF%F_OROGMM) 
IF (ASSOCIATED (SELF%F_OROGLM)) CALL FIELD_DELETE (SELF%F_OROGLM) 
IF (ASSOCIATED (SELF%F_OROGLL)) CALL FIELD_DELETE (SELF%F_OROGLL) 
IF (ASSOCIATED (SELF%F_OROGM)) CALL FIELD_DELETE (SELF%F_OROGM) 
IF (ASSOCIATED (SELF%F_OROGL)) CALL FIELD_DELETE (SELF%F_OROGL) 

END SUBROUTINE CPG_DYN_TYPE_FINAL




SUBROUTINE CPG_PHY_TYPE_INIT (SELF &
                                & , KT  &
                                & , REGISTRY &
                                & , NLEV &
                                & , PERSISTENT &
                                & , LDMF_PHYS &
                                &, KBLKMIN &
                                &, KBLKMAX &
                        &)

USE INTDYN_MOD, ONLY : YYTCTY0, YYTRCP0, YYTHW0, YYTXYB0, YYTXYB0_PHY, YYTXYBDER0
USE INTDYN_MOD, ONLY :          YYTRCP9, YYTHW9, YYTXYB9, YYTXYB9_PHY
USE INTDYN_MOD, ONLY : TRCP, TCTY, THWIND, TXYB, TXYBDER



CLASS (CPG_PHY_TYPE)                    :: SELF
INTEGER(KIND=JPIM),           INTENT (IN)    :: KT
TYPE (FIELD_REGISTRY),        INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),          INTENT (IN)    :: NLEV
LOGICAL, OPTIONAL,            INTENT (IN)    :: PERSISTENT
LOGICAL, OPTIONAL,            INTENT (IN)    :: LDMF_PHYS


INTEGER(KIND=JPIM), OPTIONAL, INTENT (IN)    :: KBLKMIN
INTEGER(KIND=JPIM), OPTIONAL, INTENT (IN)    :: KBLKMAX

LOGICAL :: LLT0
LOGICAL :: LLMF_PHYS

INTEGER (KIND=JPIM) :: IBLKMIN, IBLKMAX

TYPE (TRCP)   , POINTER :: YLTRCP     
TYPE (TCTY)   , POINTER :: YLTCTY     
TYPE (THWIND) , POINTER :: YLTHW     
TYPE (TXYB)   , POINTER :: YLTXYB     
TYPE (TXYB)   , POINTER :: YLTXYB_PHY
TYPE (TXYBDER), POINTER :: YLTXYBDER

TYPE (TCTY),   TARGET :: YLTCTY0 
TYPE (THWIND), TARGET :: YLTHW0, YLTHW9 
TYPE (TRCP),   TARGET :: YLTRCP0, YLTRCP9 
TYPE (TXYB),   TARGET :: YLTXYB0, YLTXYB0_PHY, YLTXYB9, YLTXYB9_PHY
TYPE (TXYBDER),TARGET :: YLTXYBDER0

YLTCTY0     = YYTCTY0 
YLTHW0      = YYTHW0 
YLTHW9      = YYTHW9 
YLTRCP0     = YYTRCP0 
YLTRCP9     = YYTRCP9 
YLTXYB0     = YYTXYB0 
YLTXYB0_PHY = YYTXYB0_PHY 
YLTXYB9     = YYTXYB9 
YLTXYB9_PHY = YYTXYB9_PHY
YLTXYBDER0  = YYTXYBDER0

LLT0 = KT == 0

YLTRCP     => NULL ()
YLTCTY     => NULL ()
YLTHW      => NULL ()
YLTXYB     => NULL ()
YLTXYB_PHY => NULL ()
YLTXYBDER  => NULL ()

IF (KT == 0) THEN
  YLTRCP     => YLTRCP0
  YLTCTY     => YLTCTY0
  YLTHW      => YLTHW0
  YLTXYB     => YLTXYB0
  YLTXYB_PHY => YLTXYB0_PHY
  YLTXYBDER  => YLTXYBDER0
ELSEIF (KT == 9) THEN
  YLTRCP     => YLTRCP9
  YLTCTY     => NULL ()
  YLTHW      => YLTHW9
  YLTXYB     => YLTXYB9
  YLTXYB_PHY => YLTXYB9_PHY
ENDIF

LLMF_PHYS = .FALSE.
IF (PRESENT (LDMF_PHYS)) THEN
  LLMF_PHYS = LDMF_PHYS
ENDIF

IBLKMIN = 1
IF (PRESENT (KBLKMIN)) IBLKMIN = KBLKMIN
IBLKMAX = REGISTRY%GEOM%YRDIM%NGPBLKS
IF (PRESENT (KBLKMAX)) IBLKMAX = KBLKMAX

IF (LLMF_PHYS) THEN
CALL FIELD_NEW (  SELF%F_PRE, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA, NLEV,                IBLKMAX], LBOUNDS=[1, 0,               &
    & IBLKMIN], PERSISTENT=PERSISTENT)
ENDIF

IF (LLMF_PHYS) THEN
CALL FIELD_NEW (  SELF%F_PREF, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA, NLEV,                IBLKMAX], LBOUNDS=[1, 1,               &
    & IBLKMIN], PERSISTENT=PERSISTENT)
ENDIF

IF (LLMF_PHYS) THEN
CALL FIELD_NEW (  SELF%F_PREHYD, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA, NLEV,                IBLKMAX], LBOUNDS=[1, 0,               &
    & IBLKMIN], PERSISTENT=PERSISTENT)
ENDIF

IF (LLMF_PHYS) THEN
CALL FIELD_NEW (  SELF%F_PREHYDF, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA, NLEV,                IBLKMAX], LBOUNDS=[1, 1,              &
    &  IBLKMIN], PERSISTENT=PERSISTENT)
ENDIF

IF (LLMF_PHYS) THEN
CALL FIELD_NEW (  SELF%F_WL, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA, NLEV,                IBLKMAX], LBOUNDS=[1, 1,               &
    & IBLKMIN], PERSISTENT=PERSISTENT)
ENDIF

IF (LLMF_PHYS) THEN
CALL FIELD_NEW (  SELF%F_WM, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA, NLEV,                IBLKMAX], LBOUNDS=[1, 1,               &
    & IBLKMIN], PERSISTENT=PERSISTENT)
ENDIF

IF (LLMF_PHYS) THEN
CALL FIELD_NEW (  SELF%F_W, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA, NLEV,                IBLKMAX], LBOUNDS=[1, 1,               &
    & IBLKMIN], PERSISTENT=PERSISTENT)
ENDIF

IF (LLMF_PHYS) THEN
  CALL SELF%XYB%INIT (REGISTRY, NLEV, YLTXYB_PHY, PERSISTENT, KBLKMIN=KBLKMIN, KBLKMAX=KBLKMAX)
ENDIF


END SUBROUTINE CPG_PHY_TYPE_INIT

SUBROUTINE CPG_PHY_TYPE_UPDATE_VIEW (SELF, BLOCK_INDEX)

CLASS (CPG_PHY_TYPE)         :: SELF
INTEGER(KIND=JPIM), INTENT (IN)   :: BLOCK_INDEX

IF (ASSOCIATED (SELF%F_PRE)) THEN
  IF ((.NOT. SELF%F_PRE%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%PRE))) THEN
    SELF%PRE => SELF%F_PRE%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%PRE)) THEN
  SELF%PRE => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_PREF)) THEN
  IF ((.NOT. SELF%F_PREF%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%PREF))) THEN
    SELF%PREF => SELF%F_PREF%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%PREF)) THEN
  SELF%PREF => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_PREHYD)) THEN
  IF ((.NOT. SELF%F_PREHYD%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%PREHYD))) THEN
    SELF%PREHYD => SELF%F_PREHYD%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%PREHYD)) THEN
  SELF%PREHYD => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_PREHYDF)) THEN
  IF ((.NOT. SELF%F_PREHYDF%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%PREHYDF))) THEN
    SELF%PREHYDF => SELF%F_PREHYDF%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%PREHYDF)) THEN
  SELF%PREHYDF => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_WL)) THEN
  IF ((.NOT. SELF%F_WL%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%WL))) THEN
    SELF%WL => SELF%F_WL%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%WL)) THEN
  SELF%WL => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_WM)) THEN
  IF ((.NOT. SELF%F_WM%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%WM))) THEN
    SELF%WM => SELF%F_WM%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%WM)) THEN
  SELF%WM => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_W)) THEN
  IF ((.NOT. SELF%F_W%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%W))) THEN
    SELF%W => SELF%F_W%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%W)) THEN
  SELF%W => ZDUM2
ENDIF
CALL SELF%XYB%UPDATE_VIEW (BLOCK_INDEX)

END SUBROUTINE CPG_PHY_TYPE_UPDATE_VIEW

SUBROUTINE CPG_PHY_TYPE_FINAL (SELF)
CLASS (CPG_PHY_TYPE)         :: SELF

CALL SELF%XYB%FINAL ()
IF (ASSOCIATED (SELF%F_W)) CALL FIELD_DELETE (SELF%F_W) 
IF (ASSOCIATED (SELF%F_WM)) CALL FIELD_DELETE (SELF%F_WM) 
IF (ASSOCIATED (SELF%F_WL)) CALL FIELD_DELETE (SELF%F_WL) 
IF (ASSOCIATED (SELF%F_PREHYDF)) CALL FIELD_DELETE (SELF%F_PREHYDF) 
IF (ASSOCIATED (SELF%F_PREHYD)) CALL FIELD_DELETE (SELF%F_PREHYD) 
IF (ASSOCIATED (SELF%F_PREF)) CALL FIELD_DELETE (SELF%F_PREF) 
IF (ASSOCIATED (SELF%F_PRE)) CALL FIELD_DELETE (SELF%F_PRE) 

END SUBROUTINE CPG_PHY_TYPE_FINAL




SUBROUTINE CPG_MISC_TYPE_INIT (SELF &
                                & , REGISTRY &
                                & , YDCPG_OPTS &
                                & , PERSISTENT &
                                &, KBLKMIN &
                                &, KBLKMAX &
                        &)


USE CPG_OPTS_TYPE_MOD, ONLY : CPG_OPTS_TYPE


CLASS (CPG_MISC_TYPE)                    :: SELF
TYPE (FIELD_REGISTRY),        INTENT (INOUT) :: REGISTRY
TYPE (CPG_OPTS_TYPE),         INTENT (IN)    :: YDCPG_OPTS
LOGICAL, OPTIONAL,            INTENT (IN)    :: PERSISTENT


INTEGER(KIND=JPIM), OPTIONAL, INTENT (IN)    :: KBLKMIN
INTEGER(KIND=JPIM), OPTIONAL, INTENT (IN)    :: KBLKMAX


INTEGER (KIND=JPIM) :: IBLKMIN, IBLKMAX





IBLKMIN = 1
IF (PRESENT (KBLKMIN)) IBLKMIN = KBLKMIN
IBLKMAX = REGISTRY%GEOM%YRDIM%NGPBLKS
IF (PRESENT (KBLKMAX)) IBLKMAX = KBLKMAX

CALL FIELD_NEW (SELF%F_NEB, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA, YDCPG_OPTS%KFLEVG,                IBLKMAX], LBOUNDS=[1, 1,       &
    &         IBLKMIN], PERSISTENT=PERSISTENT)

CALL FIELD_NEW (SELF%F_QLI, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA, YDCPG_OPTS%KFLEVG,                IBLKMAX], LBOUNDS=[1, 1,       &
    &         IBLKMIN], PERSISTENT=PERSISTENT)

CALL FIELD_NEW (SELF%F_QICE, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA, YDCPG_OPTS%KFLEVG,                IBLKMAX], LBOUNDS=[1, 1,      &
    &          IBLKMIN], PERSISTENT=PERSISTENT)

CALL FIELD_NEW (SELF%F_QRAIN, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA, YDCPG_OPTS%KFLEVG,                IBLKMAX], LBOUNDS=[1, 1,     &
    &           IBLKMIN], PERSISTENT=PERSISTENT)

CALL FIELD_NEW (SELF%F_QSNOW, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA, YDCPG_OPTS%KFLEVG,                IBLKMAX], LBOUNDS=[1, 1,     &
    &           IBLKMIN], PERSISTENT=PERSISTENT)

CALL FIELD_NEW (SELF%F_QGRAUPEL, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA, YDCPG_OPTS%KFLEVG,                IBLKMAX], LBOUNDS=[1, 1,  &
    &              IBLKMIN], PERSISTENT=PERSISTENT)

CALL FIELD_NEW (SELF%F_RH, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA, YDCPG_OPTS%KFLEVG,                IBLKMAX], LBOUNDS=[1, 1,        &
    &        IBLKMIN], PERSISTENT=PERSISTENT)

CALL FIELD_NEW (SELF%F_QS, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA,                               IBLKMAX], LBOUNDS=[1,               &
    &                IBLKMIN], PERSISTENT=PERSISTENT)

CALL FIELD_NEW (SELF%F_QSOL, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA,                               IBLKMAX], LBOUNDS=[1,             &
    &                  IBLKMIN], PERSISTENT=PERSISTENT)

CALL FIELD_NEW (SELF%F_DHSF, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA,                               IBLKMAX], LBOUNDS=[1,             &
    &                  IBLKMIN], PERSISTENT=PERSISTENT)

CALL FIELD_NEW (SELF%F_CLCT, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA,                               IBLKMAX], LBOUNDS=[1,             &
    &                  IBLKMIN], PERSISTENT=PERSISTENT)

CALL FIELD_NEW (SELF%F_LSM, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA,                               IBLKMAX], LBOUNDS=[1,              &
    &                 IBLKMIN], PERSISTENT=PERSISTENT)

CALL FIELD_NEW (SELF%F_TSOL, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA,                               IBLKMAX], LBOUNDS=[1,             &
    &                  IBLKMIN], PERSISTENT=PERSISTENT)

CALL FIELD_NEW (SELF%F_FTCNS, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA, YDCPG_OPTS%KFLEVG, 6, IBLKMAX], LBOUNDS=[1, 0, 1, IBLKMIN],&
    & PERSISTENT=PERSISTENT)

CALL FIELD_NEW (SELF%F_KOZO, UBOUNDS=[REGISTRY%GEOM%YRDIM%NPROMA, YDCPG_OPTS%KFLEVG, YDCPG_OPTS%KVCLIS, IBLKMAX], LBOUNDS=[1, 1,&
    & 1, IBLKMIN], PERSISTENT=PERSISTENT)


END SUBROUTINE CPG_MISC_TYPE_INIT

SUBROUTINE CPG_MISC_TYPE_UPDATE_VIEW (SELF, BLOCK_INDEX)

CLASS (CPG_MISC_TYPE)         :: SELF
INTEGER(KIND=JPIM), INTENT (IN)   :: BLOCK_INDEX

IF (ASSOCIATED (SELF%F_NEB)) THEN
  IF ((.NOT. SELF%F_NEB%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%NEB))) THEN
    SELF%NEB => SELF%F_NEB%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%NEB)) THEN
  SELF%NEB => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_QLI)) THEN
  IF ((.NOT. SELF%F_QLI%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%QLI))) THEN
    SELF%QLI => SELF%F_QLI%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%QLI)) THEN
  SELF%QLI => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_QICE)) THEN
  IF ((.NOT. SELF%F_QICE%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%QICE))) THEN
    SELF%QICE => SELF%F_QICE%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%QICE)) THEN
  SELF%QICE => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_QRAIN)) THEN
  IF ((.NOT. SELF%F_QRAIN%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%QRAIN))) THEN
    SELF%QRAIN => SELF%F_QRAIN%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%QRAIN)) THEN
  SELF%QRAIN => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_QSNOW)) THEN
  IF ((.NOT. SELF%F_QSNOW%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%QSNOW))) THEN
    SELF%QSNOW => SELF%F_QSNOW%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%QSNOW)) THEN
  SELF%QSNOW => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_QGRAUPEL)) THEN
  IF ((.NOT. SELF%F_QGRAUPEL%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%QGRAUPEL))) THEN
    SELF%QGRAUPEL => SELF%F_QGRAUPEL%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%QGRAUPEL)) THEN
  SELF%QGRAUPEL => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_RH)) THEN
  IF ((.NOT. SELF%F_RH%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%RH))) THEN
    SELF%RH => SELF%F_RH%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%RH)) THEN
  SELF%RH => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_QS)) THEN
  IF ((.NOT. SELF%F_QS%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%QS))) THEN
    SELF%QS => SELF%F_QS%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%QS)) THEN
  SELF%QS => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_QSOL)) THEN
  IF ((.NOT. SELF%F_QSOL%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%QSOL))) THEN
    SELF%QSOL => SELF%F_QSOL%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%QSOL)) THEN
  SELF%QSOL => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_DHSF)) THEN
  IF ((.NOT. SELF%F_DHSF%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DHSF))) THEN
    SELF%DHSF => SELF%F_DHSF%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%DHSF)) THEN
  SELF%DHSF => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_CLCT)) THEN
  IF ((.NOT. SELF%F_CLCT%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%CLCT))) THEN
    SELF%CLCT => SELF%F_CLCT%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%CLCT)) THEN
  SELF%CLCT => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_LSM)) THEN
  IF ((.NOT. SELF%F_LSM%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%LSM))) THEN
    SELF%LSM => SELF%F_LSM%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%LSM)) THEN
  SELF%LSM => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_TSOL)) THEN
  IF ((.NOT. SELF%F_TSOL%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%TSOL))) THEN
    SELF%TSOL => SELF%F_TSOL%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%TSOL)) THEN
  SELF%TSOL => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_FTCNS)) THEN
  IF ((.NOT. SELF%F_FTCNS%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%FTCNS))) THEN
    SELF%FTCNS => SELF%F_FTCNS%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%FTCNS)) THEN
  SELF%FTCNS => ZDUM3
ENDIF
IF (ASSOCIATED (SELF%F_KOZO)) THEN
  IF ((.NOT. SELF%F_KOZO%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%KOZO))) THEN
    SELF%KOZO => SELF%F_KOZO%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%KOZO)) THEN
  SELF%KOZO => ZDUM3
ENDIF

END SUBROUTINE CPG_MISC_TYPE_UPDATE_VIEW

SUBROUTINE CPG_MISC_TYPE_FINAL (SELF)
CLASS (CPG_MISC_TYPE)         :: SELF

IF (ASSOCIATED (SELF%F_KOZO)) CALL FIELD_DELETE (SELF%F_KOZO) 
IF (ASSOCIATED (SELF%F_FTCNS)) CALL FIELD_DELETE (SELF%F_FTCNS) 
IF (ASSOCIATED (SELF%F_TSOL)) CALL FIELD_DELETE (SELF%F_TSOL) 
IF (ASSOCIATED (SELF%F_LSM)) CALL FIELD_DELETE (SELF%F_LSM) 
IF (ASSOCIATED (SELF%F_CLCT)) CALL FIELD_DELETE (SELF%F_CLCT) 
IF (ASSOCIATED (SELF%F_DHSF)) CALL FIELD_DELETE (SELF%F_DHSF) 
IF (ASSOCIATED (SELF%F_QSOL)) CALL FIELD_DELETE (SELF%F_QSOL) 
IF (ASSOCIATED (SELF%F_QS)) CALL FIELD_DELETE (SELF%F_QS) 
IF (ASSOCIATED (SELF%F_RH)) CALL FIELD_DELETE (SELF%F_RH) 
IF (ASSOCIATED (SELF%F_QGRAUPEL)) CALL FIELD_DELETE (SELF%F_QGRAUPEL) 
IF (ASSOCIATED (SELF%F_QSNOW)) CALL FIELD_DELETE (SELF%F_QSNOW) 
IF (ASSOCIATED (SELF%F_QRAIN)) CALL FIELD_DELETE (SELF%F_QRAIN) 
IF (ASSOCIATED (SELF%F_QICE)) CALL FIELD_DELETE (SELF%F_QICE) 
IF (ASSOCIATED (SELF%F_QLI)) CALL FIELD_DELETE (SELF%F_QLI) 
IF (ASSOCIATED (SELF%F_NEB)) CALL FIELD_DELETE (SELF%F_NEB) 

END SUBROUTINE CPG_MISC_TYPE_FINAL

SUBROUTINE CPG_DDH_TYPE_INIT (SELF, REGISTRY, NLEV, PERSISTENT, YDMODEL, YDDDH, KBLKMIN, KBLKMAX)

USE TYPE_MODEL, ONLY : MODEL
USE DDH_MIX, ONLY : TYP_DDH

CLASS (CPG_DDH_TYPE)                             :: SELF
TYPE (FIELD_REGISTRY),            INTENT (IN)    :: REGISTRY
INTEGER (KIND=JPIM),              INTENT (IN)    :: NLEV
LOGICAL, OPTIONAL,                INTENT (IN)    :: PERSISTENT
TYPE (MODEL),                     INTENT (IN)    :: YDMODEL
TYPE (TYP_DDH),                   INTENT (IN)    :: YDDDH
INTEGER (KIND=JPIM), OPTIONAL,    INTENT (IN)    :: KBLKMIN, KBLKMAX

INTEGER (KIND=JPIM) :: IBLKMIN, IBLKMAX

ASSOCIATE (NPROMA => REGISTRY%GEOM%YRDIM%NPROMA, NGPBLKS => REGISTRY%GEOM%YRDIM%NGPBLKS)

IBLKMIN = 1
IF (PRESENT (KBLKMIN)) IBLKMIN = KBLKMIN
IBLKMAX = NGPBLKS
IF (PRESENT (KBLKMAX)) IBLKMAX = KBLKMAX

CALL FIELD_NEW (SELF%F_AUX3D, UBOUNDS=[NLEV+1, YDMODEL%YRML_DIAG%YRMDDH%NDHIDH, YDDDH%NFIELDS3D_AUTO, IBLKMAX], LBOUNDS=[1, 1, 1,    IBLKMIN], PERSISTENT=PERSISTENT)
CALL FIELD_NEW (SELF%F_AUX2D, UBOUNDS=[YDMODEL%YRML_DIAG%YRMDDH%NDHIDH, YDDDH%NFIELDS2D_AUTO,         IBLKMAX], LBOUNDS=[1, 1,       IBLKMIN], PERSISTENT=PERSISTENT)

CALL FIELD_NEW (SELF%F_DHCV , UBOUNDS=[NPROMA, NLEV+1, YDMODEL%YRML_DIAG%YRMDDH%NDHCVSUN,             IBLKMAX], LBOUNDS=[1, 1, 1,    IBLKMIN], PERSISTENT=PERSISTENT)
CALL FIELD_NEW (SELF%F_AUXSM, UBOUNDS=[NPROMA, 1,      NLEV, 13,                                      IBLKMAX], LBOUNDS=[1, 1, 1, 1, IBLKMIN], PERSISTENT=PERSISTENT)
CALL FIELD_NEW (SELF%F_DDHI , UBOUNDS=[NPROMA,                                                        IBLKMAX], LBOUNDS=[1,          IBLKMIN], PERSISTENT=PERSISTENT)

END ASSOCIATE

END SUBROUTINE CPG_DDH_TYPE_INIT

SUBROUTINE CPG_DDH_TYPE_UPDATE_VIEW (SELF, BLOCK_INDEX)

CLASS (CPG_DDH_TYPE)              :: SELF
INTEGER(KIND=JPIM), INTENT (IN)   :: BLOCK_INDEX

IF (ASSOCIATED (SELF%F_AUX3D)) SELF%AUX3D (0:, 1:, 1:)  => SELF%F_AUX3D%GET_VIEW (BLOCK_INDEX)
IF (ASSOCIATED (SELF%F_AUX2D)) SELF%AUX2D               => SELF%F_AUX2D%GET_VIEW (BLOCK_INDEX)
IF (ASSOCIATED (SELF%F_DHCV )) SELF%DHCV  (1:, 0:, 1:)  => SELF%F_DHCV %GET_VIEW (BLOCK_INDEX)
IF (ASSOCIATED (SELF%F_AUXSM)) SELF%AUXSM               => SELF%F_AUXSM%GET_VIEW (BLOCK_INDEX)
IF (ASSOCIATED (SELF%F_DDHI )) SELF%DDHI                => SELF%F_DDHI %GET_VIEW (BLOCK_INDEX)

END SUBROUTINE CPG_DDH_TYPE_UPDATE_VIEW

SUBROUTINE CPG_DDH_TYPE_FINAL (SELF)

CLASS (CPG_DDH_TYPE)              :: SELF

CALL FIELD_DELETE (SELF%F_AUX3D)
CALL FIELD_DELETE (SELF%F_AUX2D)
CALL FIELD_DELETE (SELF%F_DHCV)
CALL FIELD_DELETE (SELF%F_AUXSM)
CALL FIELD_DELETE (SELF%F_DDHI)

SELF%AUX3D => NULL ()
SELF%AUX2D => NULL ()
SELF%DHCV  => NULL ()
SELF%AUXSM => NULL ()
SELF%DDHI  => NULL ()

END SUBROUTINE CPG_DDH_TYPE_FINAL

END MODULE CPG_TYPE_MOD

