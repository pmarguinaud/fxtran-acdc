SUBROUTINE CUMASTRN_PARALLEL (PPLDARE, PPLRG, YDTHF, YDCST, YDML_PHY_SLIN, YDML_PHY_EC, YGFL, YDCHEM&
&, YDSPP_CONFIG, YDPERTPAR, YDCPG_OPTS, YDCPG_BNDS, KLON, KLEV, YD_PDX, LDTDKMF, LDMCAPEA, YD_LDLAND&
&, PTSPHY, YD_PTEN, YD_PQEN, YD_PUEN, YD_PVEN, YD_PLITOT, YD_PVERVEL, YD_PQSEN, YD_PQHFL, YD_PAHFS&
&, YD_PAP, YD_PAPH, YD_PGEO, YD_PGEOH, YD_PGAW, YD_PCUCONVCA, YD_PGP2DSPP, YD_PTENT, YD_PTENQ,&
& YD_PTENU, YD_PTENV, YD_PTENTA, YD_PTENQA, YD_LDCUM, YD_KTYPE, YD_KCBOT, YD_KCTOP, YD_LDCUM_LIG&
&, YD_KCBOT_LIG, YD_KCTOP_LIG, YD_KBOTSC, YD_LDSC, YD_LDSHCV, YD_PLCRIT_AER, YD_PTU, YD_PQU, YD_PLU&
&, YD_PLUDE, YD_PLUDELI, YD_PSNDE, YD_PENTH, YD_PMFLXR, YD_PMFLXS, YD_PRAIN, YD_PLRAIN, YD_PRSUD&
&, YD_PMFU, YD_PMFD, YD_PLGLAC, YD_PMFUDE_RATE, YD_PMFDDE_RATE, YD_PCAPE, YD_PWU, YD_PWMEAN, YD_PVDISCU&
&, YD_PDISS, KTRAC, YD_PCEN, YD_PTENC, PSCAV, PSCAV0)
USE MODEL_PHYSICS_ECMWF_MOD,ONLY:MODEL_PHYSICS_ECMWF_TYPE
USE MODEL_PHYSICS_SIMPLINEAR_MOD,ONLY:MODEL_PHYSICS_SIMPLINEAR_TYPE
USE YOM_YGFL,ONLY:TYPE_GFLD
USE YOMCHEM,ONLY:TCHEM

USE YOMHOOK,ONLY:LHOOK, DR_HOOK, JPHOOK
USE YOMCST,ONLY:TCST
USE YOETHF,ONLY:TTHF
USE SPP_MOD,ONLY:TSPP_CONFIG
USE SPP_GEN_MOD,ONLY:SPP_PERT
USE YOMPERTPAR,ONLY:TPERTPAR
USE CPG_OPTS_TYPE_MOD, ONLY : CPG_OPTS_TYPE, CPG_BNDS_TYPE
USE FIELD_MODULE
USE FIELD_FACTORY_MODULE
USE FIELD_ACCESS_MODULE
USE FXTRAN_ACDC_PARALLELMETHOD_MOD
USE FXTRAN_ACDC_STACK_MOD
USE PARKIND1
USE FXTRAN_ACDC_GPUMEM_MOD
#include "fxtran_acdc_stack.h"

IMPLICIT NONE


REAL (KIND=JPRB), INTENT (IN)::PPLDARE
REAL (KIND=JPRB), INTENT (IN)::PPLRG
TYPE (TTHF), INTENT (IN)::YDTHF
TYPE (TCST), INTENT (IN)::YDCST
TYPE (MODEL_PHYSICS_ECMWF_TYPE), INTENT (IN)::YDML_PHY_EC
TYPE (TCHEM), INTENT (IN)::YDCHEM
TYPE (TSPP_CONFIG), INTENT (IN)::YDSPP_CONFIG
TYPE (TPERTPAR), INTENT (IN)::YDPERTPAR
TYPE (MODEL_PHYSICS_SIMPLINEAR_TYPE), INTENT (IN)::YDML_PHY_SLIN
TYPE (TYPE_GFLD), INTENT (IN)::YGFL
INTEGER (KIND=JPIM), INTENT (IN)::KLON
INTEGER (KIND=JPIM), INTENT (IN)::KLEV
TYPE (CPG_OPTS_TYPE), INTENT (IN) :: YDCPG_OPTS
TYPE (CPG_BNDS_TYPE), INTENT (IN) :: YDCPG_BNDS
INTEGER (KIND=JPIM), INTENT (IN)::KTRAC
LOGICAL, INTENT (IN)::LDMCAPEA
CLASS (FIELD_2LM), POINTER :: YD_LDLAND
LOGICAL, POINTER::LDLAND (:,:)
REAL (KIND=JPRB), INTENT (IN)::PTSPHY
CLASS (FIELD_3RB), POINTER :: YD_PLCRIT_AER
REAL (KIND=JPRB), POINTER::PLCRIT_AER (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PTEN
REAL (KIND=JPRB), POINTER::PTEN (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PQEN
REAL (KIND=JPRB), POINTER::PQEN (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PUEN
REAL (KIND=JPRB), POINTER::PUEN (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PVEN
REAL (KIND=JPRB), POINTER::PVEN (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PLITOT
REAL (KIND=JPRB), POINTER::PLITOT (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PVERVEL
REAL (KIND=JPRB), POINTER::PVERVEL (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PQSEN
REAL (KIND=JPRB), POINTER::PQSEN (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PQHFL
REAL (KIND=JPRB), POINTER::PQHFL (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PAHFS
REAL (KIND=JPRB), POINTER::PAHFS (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PAP
REAL (KIND=JPRB), POINTER::PAP (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PAPH
REAL (KIND=JPRB), POINTER::PAPH (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PGEO
REAL (KIND=JPRB), POINTER::PGEO (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PGEOH
REAL (KIND=JPRB), POINTER::PGEOH (:,:,:)
CLASS (FIELD_2RB), POINTER :: YD_PGAW
REAL (KIND=JPRB), POINTER::PGAW (:,:)
CLASS (FIELD_2RB), POINTER :: YD_PCUCONVCA
REAL (KIND=JPRB), POINTER::PCUCONVCA (:,:)
CLASS (FIELD_3RB), POINTER :: YD_PGP2DSPP
REAL (KIND=JPRB), POINTER::PGP2DSPP (:,:,:)
CLASS (FIELD_4RB), POINTER :: YD_PCEN
REAL (KIND=JPRB), POINTER::PCEN (:,:,:,:)
REAL (KIND=JPRB), INTENT (IN)::PSCAV (KTRAC)
REAL (KIND=JPRB), INTENT (IN)::PSCAV0 (KTRAC)
CLASS (FIELD_2RB), POINTER :: YD_PDX
REAL (KIND=JPRB), POINTER::PDX (:,:)
LOGICAL, INTENT (IN)::LDTDKMF
CLASS (FIELD_3RB), POINTER :: YD_PTENT
REAL (KIND=JPRB), POINTER::PTENT (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PTENQ
REAL (KIND=JPRB), POINTER::PTENQ (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PTENU
REAL (KIND=JPRB), POINTER::PTENU (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PTENV
REAL (KIND=JPRB), POINTER::PTENV (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PTENTA
REAL (KIND=JPRB), POINTER::PTENTA (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PTENQA
REAL (KIND=JPRB), POINTER::PTENQA (:,:,:)
CLASS (FIELD_4RB), POINTER :: YD_PTENC
REAL (KIND=JPRB), POINTER::PTENC (:,:,:,:)
CLASS (FIELD_2LM), POINTER :: YD_LDCUM
LOGICAL, POINTER::LDCUM (:,:)
CLASS (FIELD_2IM), POINTER :: YD_KTYPE
INTEGER (KIND=JPIM), POINTER::KTYPE (:,:)
CLASS (FIELD_2IM), POINTER :: YD_KCBOT
INTEGER (KIND=JPIM), POINTER::KCBOT (:,:)
CLASS (FIELD_2IM), POINTER :: YD_KCTOP
INTEGER (KIND=JPIM), POINTER::KCTOP (:,:)
CLASS (FIELD_2LM), POINTER :: YD_LDCUM_LIG
LOGICAL, POINTER::LDCUM_LIG (:,:)
CLASS (FIELD_2IM), POINTER :: YD_KCBOT_LIG
INTEGER (KIND=JPIM), POINTER::KCBOT_LIG (:,:)
CLASS (FIELD_2IM), POINTER :: YD_KCTOP_LIG
INTEGER (KIND=JPIM), POINTER::KCTOP_LIG (:,:)
CLASS (FIELD_2IM), POINTER :: YD_KBOTSC
INTEGER (KIND=JPIM), POINTER::KBOTSC (:,:)
CLASS (FIELD_2LM), POINTER :: YD_LDSC
LOGICAL, POINTER::LDSC (:,:)
CLASS (FIELD_2LM), POINTER :: YD_LDSHCV
LOGICAL, POINTER::LDSHCV (:,:)
CLASS (FIELD_3RB), POINTER :: YD_PTU
REAL (KIND=JPRB), POINTER::PTU (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PQU
REAL (KIND=JPRB), POINTER::PQU (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PLU
REAL (KIND=JPRB), POINTER::PLU (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PLUDE
REAL (KIND=JPRB), POINTER::PLUDE (:,:,:)
CLASS (FIELD_4RB), POINTER :: YD_PLUDELI
REAL (KIND=JPRB), POINTER::PLUDELI (:,:,:,:)
CLASS (FIELD_4RB), POINTER :: YD_PSNDE
REAL (KIND=JPRB), POINTER::PSNDE (:,:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PENTH
REAL (KIND=JPRB), POINTER::PENTH (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PMFLXR
REAL (KIND=JPRB), POINTER::PMFLXR (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PMFLXS
REAL (KIND=JPRB), POINTER::PMFLXS (:,:,:)
CLASS (FIELD_2RB), POINTER :: YD_PRAIN
REAL (KIND=JPRB), POINTER::PRAIN (:,:)
CLASS (FIELD_3RB), POINTER :: YD_PLRAIN
REAL (KIND=JPRB), POINTER::PLRAIN (:,:,:)
CLASS (FIELD_4RB), POINTER :: YD_PRSUD
REAL (KIND=JPRB), POINTER::PRSUD (:,:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PMFU
REAL (KIND=JPRB), POINTER::PMFU (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PMFD
REAL (KIND=JPRB), POINTER::PMFD (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PLGLAC
REAL (KIND=JPRB), POINTER::PLGLAC (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PMFUDE_RATE
REAL (KIND=JPRB), POINTER::PMFUDE_RATE (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PMFDDE_RATE
REAL (KIND=JPRB), POINTER::PMFDDE_RATE (:,:,:)
CLASS (FIELD_2RB), POINTER :: YD_PCAPE
REAL (KIND=JPRB), POINTER::PCAPE (:,:)
CLASS (FIELD_2RB), POINTER :: YD_PWMEAN
REAL (KIND=JPRB), POINTER::PWMEAN (:,:)
CLASS (FIELD_2RB), POINTER :: YD_PVDISCU
REAL (KIND=JPRB), POINTER::PVDISCU (:,:)
CLASS (FIELD_3RB), POINTER :: YD_PWU
REAL (KIND=JPRB), POINTER::PWU (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PDISS
REAL (KIND=JPRB), POINTER::PDISS (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZKINED
REAL (KIND=JPRB), POINTER::ZKINED (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZKINEU
REAL (KIND=JPRB), POINTER::ZKINEU (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZVD
REAL (KIND=JPRB), POINTER::ZVD (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZUD
REAL (KIND=JPRB), POINTER::ZUD (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZVU
REAL (KIND=JPRB), POINTER::ZVU (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZUU
REAL (KIND=JPRB), POINTER::ZUU (:,:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZRFL
REAL (KIND=JPRB), POINTER::ZRFL (:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZMFUL
REAL (KIND=JPRB), POINTER::ZMFUL (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZDMFDP
REAL (KIND=JPRB), POINTER::ZDMFDP (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZDMFUP
REAL (KIND=JPRB), POINTER::ZDMFUP (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZMFDQ
REAL (KIND=JPRB), POINTER::ZMFDQ (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZMFUQ
REAL (KIND=JPRB), POINTER::ZMFUQ (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZMFDS
REAL (KIND=JPRB), POINTER::ZMFDS (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZMFUS
REAL (KIND=JPRB), POINTER::ZMFUS (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZQD
REAL (KIND=JPRB), POINTER::ZQD (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZTD
REAL (KIND=JPRB), POINTER::ZTD (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZQSENH
REAL (KIND=JPRB), POINTER::ZQSENH (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZQENH2
REAL (KIND=JPRB), POINTER::ZQENH2 (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZTENH2
REAL (KIND=JPRB), POINTER::ZTENH2 (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZQENH
REAL (KIND=JPRB), POINTER::ZQENH (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZTENH
REAL (KIND=JPRB), POINTER::ZTENH (:,:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZSATFR
REAL (KIND=JPRB), POINTER::ZSATFR (:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZMFCFL
REAL (KIND=JPRB), POINTER::ZMFCFL (:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZFACCA
REAL (KIND=JPRB), POINTER::ZFACCA (:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZDQCV
REAL (KIND=JPRB), POINTER::ZDQCV (:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZKHFL
REAL (KIND=JPRB), POINTER::ZKHFL (:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZKHVFL
REAL (KIND=JPRB), POINTER::ZKHVFL (:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZMFUB1
REAL (KIND=JPRB), POINTER::ZMFUB1 (:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZMFUB
REAL (KIND=JPRB), POINTER::ZMFUB (:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZDPMEL
REAL (KIND=JPRB), POINTER::ZDPMEL (:,:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZWUBASE
REAL (KIND=JPRB), POINTER::ZWUBASE (:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZDHPBL
REAL (KIND=JPRB), POINTER::ZDHPBL (:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZDX
REAL (KIND=JPRB), POINTER::ZDX (:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZDMFDE
REAL (KIND=JPRB), POINTER::ZDMFDE (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZDMFEN
REAL (KIND=JPRB), POINTER::ZDMFEN (:,:,:)
CLASS (FIELD_2IM), POINTER :: YL_ICTOP0
INTEGER (KIND=JPIM), POINTER::ICTOP0 (:,:)
CLASS (FIELD_2IM), POINTER :: YL_IDTOP
INTEGER (KIND=JPIM), POINTER::IDTOP (:,:)
CLASS (FIELD_3IM), POINTER :: YL_ILAB
INTEGER (KIND=JPIM), POINTER::ILAB (:,:,:)
CLASS (FIELD_2IM), POINTER :: YL_IDPL
INTEGER (KIND=JPIM), POINTER::IDPL (:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZCAPDCYCLSE
REAL (KIND=JPRB), POINTER::ZCAPDCYCLSE (:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZCAPDCYCLLD
REAL (KIND=JPRB), POINTER::ZCAPDCYCLLD (:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZCAPDCYCL
REAL (KIND=JPRB), POINTER::ZCAPDCYCL (:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZCAPPBL
REAL (KIND=JPRB), POINTER::ZCAPPBL (:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZHEAT
REAL (KIND=JPRB), POINTER::ZHEAT (:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZCAPE2
REAL (KIND=JPRB), POINTER::ZCAPE2 (:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZCAPE
REAL (KIND=JPRB), POINTER::ZCAPE (:,:)
CLASS (FIELD_2LM), POINTER :: YL_LLSCVFLAG
LOGICAL, POINTER::LLSCVFLAG (:,:)
CLASS (FIELD_2LM), POINTER :: YL_LLDCUM
LOGICAL, POINTER::LLDCUM (:,:)
CLASS (FIELD_2LM), POINTER :: YL_LLDDRAF3
LOGICAL, POINTER::LLDDRAF3 (:,:)
CLASS (FIELD_2LM), POINTER :: YL_LLDDRAF
LOGICAL, POINTER::LLDDRAF (:,:)
LOGICAL::LLO3
LOGICAL::LLMIXS
CLASS (FIELD_2LM), POINTER :: YL_LLO2
LOGICAL, POINTER::LLO2 (:,:)
LOGICAL::LLO1
INTEGER (KIND=JPIM) :: JLON
INTEGER (KIND=JPIM)::IK
INTEGER (KIND=JPIM)::JK
INTEGER (KIND=JPIM)::ITOPM2
INTEGER (KIND=JPIM)::IKD
INTEGER (KIND=JPIM)::IKB
REAL (KIND=JPRB)::ZIND
REAL (KIND=JPRB)::ZRG
REAL (KIND=JPRB)::ZAK
REAL (KIND=JPRB)::ZBS
REAL (KIND=JPRB)::ZBR
REAL (KIND=JPRB)::ZAS
REAL (KIND=JPRB)::ZAR
REAL (KIND=JPRB)::ZTAURES
REAL (KIND=JPRB)::ZTDIS
REAL (KIND=JPRB)::ZDVTEN
REAL (KIND=JPRB)::ZDUTEN
REAL (KIND=JPRB)::ZRDOCPD
REAL (KIND=JPRB)::ZORCPD
REAL (KIND=JPRB)::ZDERATE
REAL (KIND=JPRB)::ZERATE
REAL (KIND=JPRB)::ZMFA
REAL (KIND=JPRB)::ZRO
REAL (KIND=JPRB)::ZQUMQE
REAL (KIND=JPRB)::ZPBMPT
REAL (KIND=JPRB)::ZMFMAX
REAL (KIND=JPRB)::ZFAC
REAL (KIND=JPRB)::ZEPS
REAL (KIND=JPRB)::ZDZ
REAL (KIND=JPRB)::ZDQMIN
REAL (KIND=JPRB)::ZDH2
REAL (KIND=JPRB)::ZDH
REAL (KIND=JPRB)::ZCONS
REAL (KIND=JPRB)::ZCONS2
CLASS (FIELD_2RB), POINTER :: YL_ZTAUPBL
REAL (KIND=JPRB), POINTER::ZTAUPBL (:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZTAU
REAL (KIND=JPRB), POINTER::ZTAU (:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZXTAU
REAL (KIND=JPRB), POINTER::ZXTAU (:,:)
LOGICAL::LLPERT_RTAU
INTEGER (KIND=JPIM)::IPRTAU
INTEGER (KIND=JPIM)::IPN
TYPE (SPP_PERT)::PN1
CLASS (FIELD_2RB), POINTER :: YL_ZSUM22
REAL (KIND=JPRB), POINTER::ZSUM22 (:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZSUM12
REAL (KIND=JPRB), POINTER::ZSUM12 (:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZUV2
REAL (KIND=JPRB), POINTER::ZUV2 (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZDMFDPC
REAL (KIND=JPRB), POINTER::ZDMFDPC (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZDMFUPC
REAL (KIND=JPRB), POINTER::ZDMFUPC (:,:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZKMFL
REAL (KIND=JPRB), POINTER::ZKMFL (:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZMF_SHAL
REAL (KIND=JPRB), POINTER::ZMF_SHAL (:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZMFUVB
REAL (KIND=JPRB), POINTER::ZMFUVB (:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZMFUUB
REAL (KIND=JPRB), POINTER::ZMFUUB (:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZTENV
REAL (KIND=JPRB), POINTER::ZTENV (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZTENU
REAL (KIND=JPRB), POINTER::ZTENU (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZMFDDR
REAL (KIND=JPRB), POINTER::ZMFDDR (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZMFUDR
REAL (KIND=JPRB), POINTER::ZMFUDR (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZMFDUS
REAL (KIND=JPRB), POINTER::ZMFDUS (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZMFUUS
REAL (KIND=JPRB), POINTER::ZMFUUS (:,:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZMFS
REAL (KIND=JPRB), POINTER::ZMFS (:,:)
REAL (KIND=JPHOOK)::ZHOOK_HANDLE
#include "cuascn.intfb.h"
#include "abor1.intfb.h"
#include "cubasen.intfb.h"
#include "cuddrafn.intfb.h"
#include "cudlfsn.intfb.h"
#include "cudtdqn.intfb.h"
#include "cududv.intfb.h"
#include "cuflxn.intfb.h"
#include "cuinin.intfb.h"
#include "cuctracer.intfb.h"
#include "fcttre.func.h"
INTEGER(KIND=JPIM) :: JBLK
TYPE(CPG_BNDS_TYPE) :: YLCPG_BNDS
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_FIELD_API
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_PARALLEL
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_COMPUTE
TYPE(FXTRAN_ACDC_STACK) :: YLSTACK
TYPE(FXTRAN_ACDC_STACK) :: YLOFFSET
IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL', 0, ZHOOK_HANDLE)
IF (LHOOK) CALL DR_HOOK ('CREATE_TEMPORARIES',0,ZHOOK_HANDLE_FIELD_API)
CALL FIELD_NEW (YL_ZXTAU, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZWUBASE, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZVU, UBOUNDS=[YDCPG_OPTS%KLON, KLEV, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZVD, UBOUNDS=[YDCPG_OPTS%KLON, KLEV, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZUV2, UBOUNDS=[YDCPG_OPTS%KLON, KLEV, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZUU, UBOUNDS=[YDCPG_OPTS%KLON, KLEV, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZUD, UBOUNDS=[YDCPG_OPTS%KLON, KLEV, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZTENV, UBOUNDS=[YDCPG_OPTS%KLON, KLEV, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZTENU, UBOUNDS=[YDCPG_OPTS%KLON, KLEV, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZTENH2, UBOUNDS=[YDCPG_OPTS%KLON, KLEV, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZTENH, UBOUNDS=[YDCPG_OPTS%KLON, KLEV, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZTD, UBOUNDS=[YDCPG_OPTS%KLON, KLEV, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZTAUPBL, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZTAU, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZSUM22, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZSUM12, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZSATFR, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZRFL, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZQSENH, UBOUNDS=[YDCPG_OPTS%KLON, KLEV, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZQENH2, UBOUNDS=[YDCPG_OPTS%KLON, KLEV, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZQENH, UBOUNDS=[YDCPG_OPTS%KLON, KLEV, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZQD, UBOUNDS=[YDCPG_OPTS%KLON, KLEV, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZMF_SHAL, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZMFUVB, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZMFUUS, UBOUNDS=[YDCPG_OPTS%KLON, KLEV, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZMFUUB, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZMFUS, UBOUNDS=[YDCPG_OPTS%KLON, KLEV, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZMFUQ, UBOUNDS=[YDCPG_OPTS%KLON, KLEV, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZMFUL, UBOUNDS=[YDCPG_OPTS%KLON, KLEV, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZMFUDR, UBOUNDS=[YDCPG_OPTS%KLON, KLEV, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZMFUB1, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZMFUB, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZMFS, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZMFDUS, UBOUNDS=[YDCPG_OPTS%KLON, KLEV, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZMFDS, UBOUNDS=[YDCPG_OPTS%KLON, KLEV, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZMFDQ, UBOUNDS=[YDCPG_OPTS%KLON, KLEV, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZMFDDR, UBOUNDS=[YDCPG_OPTS%KLON, KLEV, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZMFCFL, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZKMFL, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZKINEU, UBOUNDS=[YDCPG_OPTS%KLON, KLEV, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZKINED, UBOUNDS=[YDCPG_OPTS%KLON, KLEV, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZKHVFL, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZKHFL, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZHEAT, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZFACCA, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZDX, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZDQCV, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZDPMEL, UBOUNDS=[YDCPG_OPTS%KLON, KLEV, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZDMFUPC, UBOUNDS=[YDCPG_OPTS%KLON, KLEV, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZDMFUP, UBOUNDS=[YDCPG_OPTS%KLON, KLEV, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZDMFEN, UBOUNDS=[YDCPG_OPTS%KLON, KLEV, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZDMFDPC, UBOUNDS=[YDCPG_OPTS%KLON, KLEV, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZDMFDP, UBOUNDS=[YDCPG_OPTS%KLON, KLEV, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZDMFDE, UBOUNDS=[YDCPG_OPTS%KLON, KLEV, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZDHPBL, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZCAPPBL, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZCAPE2, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZCAPE, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZCAPDCYCLSE, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZCAPDCYCLLD, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZCAPDCYCL, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_LLSCVFLAG, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_LLO2, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_LLDDRAF3, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_LLDDRAF, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_LLDCUM, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ILAB, UBOUNDS=[YDCPG_OPTS%KLON, KLEV, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_IDTOP, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_IDPL, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ICTOP0, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
IF (LHOOK) CALL DR_HOOK ('CREATE_TEMPORARIES',1,ZHOOK_HANDLE_FIELD_API)

ZCONS2=YDML_PHY_EC%YRECUMF%RMFCFL/(YDCST%RG*PTSPHY)
ZCONS=1.0_JPRB/(YDCST%RG*PTSPHY)
ZORCPD=1.0_JPRB/YDCST%RCPD
ZRDOCPD=YDCST%RD*ZORCPD
ZRG=1.0_JPRB/YDCST%RG
IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:0',0,ZHOOK_HANDLE_PARALLEL)

IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','CUMASTRN_PARALLEL:0')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:0:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  ZTAU => GET_HOST_DATA_RDWR (YL_ZTAU)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:0:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:0:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
  !$OMP PARALLEL DO PRIVATE (JBLK) FIRSTPRIVATE (YLCPG_BNDS)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    CALL YLCPG_BNDS%UPDATE (JBLK)
    
    ZTAU (:, JBLK)=0.0
  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:0:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:0:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  ZTAU => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:0:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN','CUMASTRN_PARALLEL:0')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:0:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  ZTAU => GET_DEVICE_DATA_RDWR (YL_ZTAU)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:0:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:0:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  
    !$ACC PARALLEL LOOP GANG &
    !$ACC&PRESENT (YFXTRAN_ACDC_STACK, ZTAU) &
    !$ACC&PRIVATE (JBLK) &
    !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
    
    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    
    
    
    !$ACC LOOP VECTOR &
    !$ACC&PRIVATE (JLON, YLCPG_BNDS) 

    

    DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JLON
      YLCPG_BNDS%KFDIA = JLON
      
      ZTAU (JLON, JBLK)=0.0
    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:0:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:0:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  ZTAU => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:0:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSE
    CALL ABOR1 ('CUMASTRN_PARALLEL: NOT METHOD WAS FOUND')
ENDIF

IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:0',1,ZHOOK_HANDLE_PARALLEL)

LLPERT_RTAU=.FALSE.

IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:1',0,ZHOOK_HANDLE_PARALLEL)

IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','CUMASTRN_PARALLEL:1')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:1:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  ILAB => GET_HOST_DATA_RDWR (YL_ILAB)
  LDCUM => GET_HOST_DATA_RDWR (YD_LDCUM)
  PAPH => GET_HOST_DATA_RDONLY (YD_PAPH)
  PCAPE => GET_HOST_DATA_RDWR (YD_PCAPE)
  PGEO => GET_HOST_DATA_RDONLY (YD_PGEO)
  PGEOH => GET_HOST_DATA_RDONLY (YD_PGEOH)
  PLU => GET_HOST_DATA_RDWR (YD_PLU)
  PQEN => GET_HOST_DATA_RDONLY (YD_PQEN)
  PQSEN => GET_HOST_DATA_RDONLY (YD_PQSEN)
  PQU => GET_HOST_DATA_RDWR (YD_PQU)
  PTEN => GET_HOST_DATA_RDONLY (YD_PTEN)
  PTU => GET_HOST_DATA_RDWR (YD_PTU)
  PUEN => GET_HOST_DATA_RDONLY (YD_PUEN)
  PVDISCU => GET_HOST_DATA_RDWR (YD_PVDISCU)
  PVEN => GET_HOST_DATA_RDONLY (YD_PVEN)
  ZKMFL => GET_HOST_DATA_RDWR (YL_ZKMFL)
  ZQD => GET_HOST_DATA_RDWR (YL_ZQD)
  ZQENH => GET_HOST_DATA_RDWR (YL_ZQENH)
  ZQSENH => GET_HOST_DATA_RDWR (YL_ZQSENH)
  ZTD => GET_HOST_DATA_RDWR (YL_ZTD)
  ZTENH => GET_HOST_DATA_RDWR (YL_ZTENH)
  ZUD => GET_HOST_DATA_RDWR (YL_ZUD)
  ZUU => GET_HOST_DATA_RDWR (YL_ZUU)
  ZVD => GET_HOST_DATA_RDWR (YL_ZVD)
  ZVU => GET_HOST_DATA_RDWR (YL_ZVU)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:1:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:1:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
  !$OMP PARALLEL DO PRIVATE (JBLK, JLON) FIRSTPRIVATE (YLCPG_BNDS)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    CALL YLCPG_BNDS%UPDATE (JBLK)

    

    DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
      PCAPE (JLON, JBLK)=0.0_JPRB
      PVDISCU (JLON, JBLK)=0.0_JPRB
      LDCUM (JLON, JBLK)=.FALSE.
    ENDDO

    CALL CUININ (YDCST, YDTHF, YDML_PHY_SLIN%YREPHLI, YDML_PHY_EC%YRECUMF, YLCPG_BNDS%KIDIA, YLCPG_BNDS&
    &%KFDIA, YDCPG_OPTS%KLON, KLEV, PTEN(:,:, JBLK), PQEN(:,:, JBLK), PQSEN(:,:, JBLK), PUEN(:,:, JBLK&
    &), PVEN(:,:, JBLK), PGEO(:,:, JBLK), PAPH(:,:, JBLK), ILAB(:,:, JBLK), ZTENH(:,:, JBLK), ZQENH(:,&
    &:, JBLK), ZQSENH(:,:, JBLK), PGEOH(:,:, JBLK), PTU(:,:, JBLK), PQU(:,:, JBLK), ZTD(:,:, JBLK), ZQD&
    &(:,:, JBLK), ZUU(:,:, JBLK), ZVU(:,:, JBLK), ZUD(:,:, JBLK), ZVD(:,:, JBLK), PLU(:,:, JBLK))
    ZKMFL (:, JBLK)=0.0_JPRB
  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:1:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:1:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  ILAB => NULL ()
  LDCUM => NULL ()
  PAPH => NULL ()
  PCAPE => NULL ()
  PGEO => NULL ()
  PGEOH => NULL ()
  PLU => NULL ()
  PQEN => NULL ()
  PQSEN => NULL ()
  PQU => NULL ()
  PTEN => NULL ()
  PTU => NULL ()
  PUEN => NULL ()
  PVDISCU => NULL ()
  PVEN => NULL ()
  ZKMFL => NULL ()
  ZQD => NULL ()
  ZQENH => NULL ()
  ZQSENH => NULL ()
  ZTD => NULL ()
  ZTENH => NULL ()
  ZUD => NULL ()
  ZUU => NULL ()
  ZVD => NULL ()
  ZVU => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:1:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN','CUMASTRN_PARALLEL:1')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:1:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  ILAB => GET_DEVICE_DATA_RDWR (YL_ILAB)
  LDCUM => GET_DEVICE_DATA_RDWR (YD_LDCUM)
  PAPH => GET_DEVICE_DATA_RDONLY (YD_PAPH)
  PCAPE => GET_DEVICE_DATA_RDWR (YD_PCAPE)
  PGEO => GET_DEVICE_DATA_RDONLY (YD_PGEO)
  PGEOH => GET_DEVICE_DATA_RDONLY (YD_PGEOH)
  PLU => GET_DEVICE_DATA_RDWR (YD_PLU)
  PQEN => GET_DEVICE_DATA_RDONLY (YD_PQEN)
  PQSEN => GET_DEVICE_DATA_RDONLY (YD_PQSEN)
  PQU => GET_DEVICE_DATA_RDWR (YD_PQU)
  PTEN => GET_DEVICE_DATA_RDONLY (YD_PTEN)
  PTU => GET_DEVICE_DATA_RDWR (YD_PTU)
  PUEN => GET_DEVICE_DATA_RDONLY (YD_PUEN)
  PVDISCU => GET_DEVICE_DATA_RDWR (YD_PVDISCU)
  PVEN => GET_DEVICE_DATA_RDONLY (YD_PVEN)
  ZKMFL => GET_DEVICE_DATA_RDWR (YL_ZKMFL)
  ZQD => GET_DEVICE_DATA_RDWR (YL_ZQD)
  ZQENH => GET_DEVICE_DATA_RDWR (YL_ZQENH)
  ZQSENH => GET_DEVICE_DATA_RDWR (YL_ZQSENH)
  ZTD => GET_DEVICE_DATA_RDWR (YL_ZTD)
  ZTENH => GET_DEVICE_DATA_RDWR (YL_ZTENH)
  ZUD => GET_DEVICE_DATA_RDWR (YL_ZUD)
  ZUU => GET_DEVICE_DATA_RDWR (YL_ZUU)
  ZVD => GET_DEVICE_DATA_RDWR (YL_ZVD)
  ZVU => GET_DEVICE_DATA_RDWR (YL_ZVU)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:1:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:1:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  
    !$ACC PARALLEL LOOP GANG &
    !$ACC&PRESENT (ILAB, LDCUM, PAPH, PCAPE, PGEO, PGEOH, PLU, PQEN, PQSEN, PQU, PTEN, PTU, PUEN, &
    !$ACC&         PVDISCU, PVEN, YFXTRAN_ACDC_STACK, ZKMFL, ZQD, ZQENH, ZQSENH, ZTD, &
    !$ACC&         ZTENH, ZUD, ZUU, ZVD, ZVU) &
    !$ACC&PRIVATE (JBLK) &
    !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
    
    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    
    
    
    !$ACC LOOP VECTOR &
    !$ACC&PRIVATE (JLON, YLCPG_BNDS, YLSTACK) 

    

    DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JLON
      YLCPG_BNDS%KFDIA = JLON
      YLSTACK%L8 = fxtran_acdc_stack_l8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%U8 = fxtran_acdc_stack_u8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%L4 = fxtran_acdc_stack_l4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%U4 = fxtran_acdc_stack_u4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      
      
      PCAPE (JLON, JBLK)=0.0_JPRB
      PVDISCU (JLON, JBLK)=0.0_JPRB
      LDCUM (JLON, JBLK)=.FALSE.
      
      CALL CUININ_OPENACC (YDCST, YDTHF, YDML_PHY_SLIN%YREPHLI, YDML_PHY_EC%YRECUMF, YLCPG_BNDS&
      &%KIDIA, YLCPG_BNDS%KFDIA, YDCPG_OPTS%KLON, KLEV, PTEN(:,:, JBLK), PQEN(:,:, JBLK), PQSEN&
      &(:,:, JBLK), PUEN(:,:, JBLK), PVEN(:,:, JBLK), PGEO(:,:, JBLK), PAPH(:,:, JBLK), ILAB&
      &(:,:, JBLK), ZTENH(:,:, JBLK), ZQENH(:,:, JBLK), ZQSENH(:,:, JBLK), PGEOH(:,:, JBLK),&
      & PTU(:,:, JBLK), PQU(:,:, JBLK), ZTD(:,:, JBLK), ZQD(:,:, JBLK), ZUU(:,:, JBLK), ZVU(&
      &:,:, JBLK), ZUD(:,:, JBLK), ZVD(:,:, JBLK), PLU(:,:, JBLK),YDSTACK=YLSTACK)
      ZKMFL (JLON, JBLK)=0.0_JPRB
    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:1:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:1:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  ILAB => NULL ()
  LDCUM => NULL ()
  PAPH => NULL ()
  PCAPE => NULL ()
  PGEO => NULL ()
  PGEOH => NULL ()
  PLU => NULL ()
  PQEN => NULL ()
  PQSEN => NULL ()
  PQU => NULL ()
  PTEN => NULL ()
  PTU => NULL ()
  PUEN => NULL ()
  PVDISCU => NULL ()
  PVEN => NULL ()
  ZKMFL => NULL ()
  ZQD => NULL ()
  ZQENH => NULL ()
  ZQSENH => NULL ()
  ZTD => NULL ()
  ZTENH => NULL ()
  ZUD => NULL ()
  ZUU => NULL ()
  ZVD => NULL ()
  ZVU => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:1:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSE
    CALL ABOR1 ('CUMASTRN_PARALLEL: NOT METHOD WAS FOUND')
ENDIF

IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:1',1,ZHOOK_HANDLE_PARALLEL)
LLMIXS=LDTDKMF
CALL CUBASEN_PARALLEL (PPLDARE, PPLRG, YDTHF, YDCST, YDML_PHY_SLIN%YREPHLI, YDML_PHY_EC%YRECLDP&
&, YDML_PHY_EC%YRECUMF, YDSPP_CONFIG, YDCPG_OPTS, YDCPG_BNDS, YDCPG_OPTS%KLON, KLEV, YDML_PHY_EC&
&%YRECUMF%NJKT1, LLMIXS, LDTDKMF, YL_ZTENH, YL_ZQENH, YD_PGEOH, YD_PAPH, YD_PQHFL, YD_PAHFS, YD_PGP2DSPP&
&, YL_ZKMFL, YD_PTEN, YD_PQEN, YD_PQSEN, YD_PGEO, YD_PTU, YD_PQU, YD_PLU, YL_ZKINEU, YL_ZWUBASE&
&, YL_ILAB, YD_LDCUM, YD_LDSC, YD_KCBOT, YD_KBOTSC, YL_ICTOP0, YL_IDPL, YD_PCAPE)
IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:2',0,ZHOOK_HANDLE_PARALLEL)

IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','CUMASTRN_PARALLEL:2')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:2:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  IDTOP => GET_HOST_DATA_RDWR (YL_IDTOP)
  KCBOT => GET_HOST_DATA_RDONLY (YD_KCBOT)
  LDCUM => GET_HOST_DATA_RDONLY (YD_LDCUM)
  PAHFS => GET_HOST_DATA_RDONLY (YD_PAHFS)
  PAPH => GET_HOST_DATA_RDONLY (YD_PAPH)
  PQHFL => GET_HOST_DATA_RDONLY (YD_PQHFL)
  PTEN => GET_HOST_DATA_RDONLY (YD_PTEN)
  PTENQ => GET_HOST_DATA_RDONLY (YD_PTENQ)
  PTENT => GET_HOST_DATA_RDONLY (YD_PTENT)
  ZCAPPBL => GET_HOST_DATA_RDWR (YL_ZCAPPBL)
  ZDHPBL => GET_HOST_DATA_RDWR (YL_ZDHPBL)
  ZKHFL => GET_HOST_DATA_RDWR (YL_ZKHFL)
  ZKHVFL => GET_HOST_DATA_RDWR (YL_ZKHVFL)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:2:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:2:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
  !$OMP PARALLEL DO PRIVATE (JBLK, JK, JLON, ZDZ) FIRSTPRIVATE (YLCPG_BNDS)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    CALL YLCPG_BNDS%UPDATE (JBLK)

    

    DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
      ZDHPBL (JLON, JBLK)=0.0_JPRB
      IDTOP (JLON, JBLK)=0
      ZCAPPBL (JLON, JBLK)=0.
      ZKHVFL (JLON, JBLK)=(-PAHFS (JLON, KLEV+1, JBLK)*ZORCPD-YDCST%RETV*PTEN&
      & (JLON, KLEV, JBLK)*PQHFL (JLON, KLEV+1, JBLK))/(PPLRG*PPLDARE)
      ZKHFL (JLON, JBLK)=(-PAHFS (JLON, KLEV+1, JBLK)-YDCST&
      &%RLVTT*PQHFL (JLON, KLEV+1, JBLK))/(PPLRG*PPLDARE)
    ENDDO


    DO JK=YDML_PHY_EC%YRECUMF%NJKT2, KLEV

      DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA

        IF (LDCUM (JLON, JBLK).AND.JK>=KCBOT (JLON, JBLK)) THEN
          ZDZ=(PAPH (JLON, JK+1, JBLK)-PAPH (JLON, JK, JBLK))
          ZDHPBL (JLON, JBLK)=ZDHPBL (JLON, JBLK)+(YDCST%RLVTT*PTENQ &
          &(JLON, JK, JBLK)+YDCST%RCPD*PTENT (JLON, JK, JBLK))*ZDZ
          ZCAPPBL (JLON, JBLK)=ZCAPPBL (JLON, JBLK)+(PTENT (JLON, JK, JBLK)&
          &+YDCST%RETV*PTEN (JLON, JK, JBLK)*PTENQ (JLON, JK, JBLK))*ZDZ
        ENDIF

      ENDDO

    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:2:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:2:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  IDTOP => NULL ()
  KCBOT => NULL ()
  LDCUM => NULL ()
  PAHFS => NULL ()
  PAPH => NULL ()
  PQHFL => NULL ()
  PTEN => NULL ()
  PTENQ => NULL ()
  PTENT => NULL ()
  ZCAPPBL => NULL ()
  ZDHPBL => NULL ()
  ZKHFL => NULL ()
  ZKHVFL => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:2:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN','CUMASTRN_PARALLEL:2')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:2:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  IDTOP => GET_DEVICE_DATA_RDWR (YL_IDTOP)
  KCBOT => GET_DEVICE_DATA_RDONLY (YD_KCBOT)
  LDCUM => GET_DEVICE_DATA_RDONLY (YD_LDCUM)
  PAHFS => GET_DEVICE_DATA_RDONLY (YD_PAHFS)
  PAPH => GET_DEVICE_DATA_RDONLY (YD_PAPH)
  PQHFL => GET_DEVICE_DATA_RDONLY (YD_PQHFL)
  PTEN => GET_DEVICE_DATA_RDONLY (YD_PTEN)
  PTENQ => GET_DEVICE_DATA_RDONLY (YD_PTENQ)
  PTENT => GET_DEVICE_DATA_RDONLY (YD_PTENT)
  ZCAPPBL => GET_DEVICE_DATA_RDWR (YL_ZCAPPBL)
  ZDHPBL => GET_DEVICE_DATA_RDWR (YL_ZDHPBL)
  ZKHFL => GET_DEVICE_DATA_RDWR (YL_ZKHFL)
  ZKHVFL => GET_DEVICE_DATA_RDWR (YL_ZKHVFL)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:2:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:2:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  
    !$ACC PARALLEL LOOP GANG &
    !$ACC&PRESENT (IDTOP, KCBOT, LDCUM, PAHFS, PAPH, PQHFL, PTEN, PTENQ, PTENT, YFXTRAN_ACDC_STACK, &
    !$ACC&         ZCAPPBL, ZDHPBL, ZKHFL, ZKHVFL) &
    !$ACC&PRIVATE (JBLK) &
    !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
    
    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    
    
    
    !$ACC LOOP VECTOR &
    !$ACC&PRIVATE (JK, JLON, YLCPG_BNDS, ZDZ) 

    

    DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JLON
      YLCPG_BNDS%KFDIA = JLON
      
      
      ZDHPBL (JLON, JBLK)=0.0_JPRB
      IDTOP (JLON, JBLK)=0
      ZCAPPBL (JLON, JBLK)=0.
      ZKHVFL (JLON, JBLK)=(-PAHFS (JLON, KLEV+1, JBLK)*ZORCPD-YDCST%RETV*PTEN&
      & (JLON, KLEV, JBLK)*PQHFL (JLON, KLEV+1, JBLK))/(PPLRG*PPLDARE)
      ZKHFL (JLON, JBLK)=(-PAHFS (JLON, KLEV+1, JBLK)-YDCST&
      &%RLVTT*PQHFL (JLON, KLEV+1, JBLK))/(PPLRG*PPLDARE)

      

      DO JK=YDML_PHY_EC%YRECUMF%NJKT2, KLEV

        

        IF (LDCUM (JLON, JBLK).AND.JK>=KCBOT (JLON, JBLK)) THEN
          ZDZ=(PAPH (JLON, JK+1, JBLK)-PAPH (JLON, JK, JBLK))
          ZDHPBL (JLON, JBLK)=ZDHPBL (JLON, JBLK)+(YDCST%RLVTT*PTENQ &
          &(JLON, JK, JBLK)+YDCST%RCPD*PTENT (JLON, JK, JBLK))*ZDZ
          ZCAPPBL (JLON, JBLK)=ZCAPPBL (JLON, JBLK)+(PTENT (JLON, JK, JBLK)&
          &+YDCST%RETV*PTEN (JLON, JK, JBLK)*PTENQ (JLON, JK, JBLK))*ZDZ
        ENDIF

      
      ENDDO

    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:2:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:2:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  IDTOP => NULL ()
  KCBOT => NULL ()
  LDCUM => NULL ()
  PAHFS => NULL ()
  PAPH => NULL ()
  PQHFL => NULL ()
  PTEN => NULL ()
  PTENQ => NULL ()
  PTENT => NULL ()
  ZCAPPBL => NULL ()
  ZDHPBL => NULL ()
  ZKHFL => NULL ()
  ZKHVFL => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:2:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSE
    CALL ABOR1 ('CUMASTRN_PARALLEL: NOT METHOD WAS FOUND')
ENDIF

IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:2',1,ZHOOK_HANDLE_PARALLEL)
IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:3',0,ZHOOK_HANDLE_PARALLEL)

IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','CUMASTRN_PARALLEL:3')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:3:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  ICTOP0 => GET_HOST_DATA_RDONLY (YL_ICTOP0)
  KCBOT => GET_HOST_DATA_RDONLY (YD_KCBOT)
  KTYPE => GET_HOST_DATA_RDWR (YD_KTYPE)
  LDCUM => GET_HOST_DATA_RDWR (YD_LDCUM)
  PAPH => GET_HOST_DATA_RDONLY (YD_PAPH)
  PGEOH => GET_HOST_DATA_RDONLY (YD_PGEOH)
  PLU => GET_HOST_DATA_RDONLY (YD_PLU)
  PQU => GET_HOST_DATA_RDONLY (YD_PQU)
  PTEN => GET_HOST_DATA_RDONLY (YD_PTEN)
  PTU => GET_HOST_DATA_RDONLY (YD_PTU)
  ZDHPBL => GET_HOST_DATA_RDONLY (YL_ZDHPBL)
  ZKHVFL => GET_HOST_DATA_RDONLY (YL_ZKHVFL)
  ZMFUB => GET_HOST_DATA_RDWR (YL_ZMFUB)
  ZMF_SHAL => GET_HOST_DATA_RDWR (YL_ZMF_SHAL)
  ZQENH => GET_HOST_DATA_RDONLY (YL_ZQENH)
  ZTENH => GET_HOST_DATA_RDONLY (YL_ZTENH)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:3:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:3:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
  !$OMP PARALLEL DO PRIVATE (IKB, ITOPM2, JBLK, JLON, ZDH, ZDQMIN, ZDZ, ZMFMAX, ZPBMPT, ZQUMQE) FIRSTPRIVATE (YLCPG_BNDS)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    CALL YLCPG_BNDS%UPDATE (JBLK)

    

    DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA

      IF (LDCUM (JLON, JBLK)) THEN
        IKB=KCBOT (JLON, JBLK)
        ITOPM2=ICTOP0 (JLON, JBLK)
        ZPBMPT=PAPH (JLON, IKB, JBLK)-PAPH (JLON, ITOPM2, JBLK)

        IF (ZPBMPT>=YDML_PHY_EC%YRECUMF%RDEPTHS) THEN
          KTYPE (JLON, JBLK)=1
        ELSE
          KTYPE (JLON, JBLK)=2
        ENDIF

      ELSE
        KTYPE (JLON, JBLK)=0
      ENDIF

    ENDDO


    IF (YDML_PHY_EC%YRECUMF%LMFWSTAR) THEN

      DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA

        IF (LDCUM (JLON, JBLK)) THEN
          IKB=KCBOT (JLON, JBLK)
          ZDZ=MAX (0.0_JPRB, MIN (1.5E3_JPRB,(PGEOH (JLON, IKB, JBLK)-PGEOH (JLON, KLEV+1, JBLK))/YDCST%RG))
          ZMF_SHAL (JLON, JBLK)=0.07_JPRB*(YDCST%RG/PTEN (JLON, KLEV&
          &, JBLK)*ZDZ*MAX (0.0_JPRB, ZKHVFL (JLON, JBLK)))**.3333
          ZMFMAX=(PAPH (JLON, IKB, JBLK)-PAPH (JLON, IKB-1, JBLK))*ZCONS2
          ZMF_SHAL (JLON, JBLK)=MIN (ZMF_SHAL (JLON, JBLK), ZMFMAX)
        ENDIF

      ENDDO

    ENDIF


    DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA

      IF (LDCUM (JLON, JBLK)) THEN
        IKB=KCBOT (JLON, JBLK)
        ZMFMAX=(PAPH (JLON, IKB, JBLK)-PAPH (JLON, IKB-1, JBLK))*ZCONS2

        IF (KTYPE (JLON, JBLK)==1) THEN
          ZMFUB (JLON, JBLK)=ZMFMAX*0.1_JPRB
        ELSEIF (KTYPE (JLON, JBLK)==2) THEN
          ZQUMQE=PQU (JLON, IKB, JBLK)+PLU (JLON, IKB, JBLK)-ZQENH (JLON, IKB, JBLK)
          ZDQMIN=MAX (0.01_JPRB*ZQENH (JLON, IKB, JBLK), 1.E-10_JPRB)
          ZDH=YDCST%RCPD*(PTU (JLON, IKB, JBLK)-ZTENH (JLON, IKB, JBLK))+YDCST%RLVTT*ZQUMQE
          ZDH=YDCST%RG*MAX (ZDH, 1.E5_JPRB*ZDQMIN)

          IF (ZDHPBL (JLON, JBLK)>0.0_JPRB) THEN
            ZMFUB (JLON, JBLK)=ZDHPBL (JLON, JBLK)/ZDH
            ZMFUB (JLON, JBLK)=MIN (ZMFUB (JLON, JBLK), ZMFMAX)
          ELSE
            ZMFUB (JLON, JBLK)=ZMFMAX*0.1_JPRB
            LDCUM (JLON, JBLK)=.FALSE.
          ENDIF


          IF (YDML_PHY_EC%YRECUMF%LMFWSTAR)  THEN
            ZMFUB (JLON, JBLK)=ZMF_SHAL (JLON, JBLK)
          ENDIF

        ENDIF

      ELSE
        ZMFUB (JLON, JBLK)=0.0_JPRB
      ENDIF

    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:3:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:3:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  ICTOP0 => NULL ()
  KCBOT => NULL ()
  KTYPE => NULL ()
  LDCUM => NULL ()
  PAPH => NULL ()
  PGEOH => NULL ()
  PLU => NULL ()
  PQU => NULL ()
  PTEN => NULL ()
  PTU => NULL ()
  ZDHPBL => NULL ()
  ZKHVFL => NULL ()
  ZMFUB => NULL ()
  ZMF_SHAL => NULL ()
  ZQENH => NULL ()
  ZTENH => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:3:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN','CUMASTRN_PARALLEL:3')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:3:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  ICTOP0 => GET_DEVICE_DATA_RDONLY (YL_ICTOP0)
  KCBOT => GET_DEVICE_DATA_RDONLY (YD_KCBOT)
  KTYPE => GET_DEVICE_DATA_RDWR (YD_KTYPE)
  LDCUM => GET_DEVICE_DATA_RDWR (YD_LDCUM)
  PAPH => GET_DEVICE_DATA_RDONLY (YD_PAPH)
  PGEOH => GET_DEVICE_DATA_RDONLY (YD_PGEOH)
  PLU => GET_DEVICE_DATA_RDONLY (YD_PLU)
  PQU => GET_DEVICE_DATA_RDONLY (YD_PQU)
  PTEN => GET_DEVICE_DATA_RDONLY (YD_PTEN)
  PTU => GET_DEVICE_DATA_RDONLY (YD_PTU)
  ZDHPBL => GET_DEVICE_DATA_RDONLY (YL_ZDHPBL)
  ZKHVFL => GET_DEVICE_DATA_RDONLY (YL_ZKHVFL)
  ZMFUB => GET_DEVICE_DATA_RDWR (YL_ZMFUB)
  ZMF_SHAL => GET_DEVICE_DATA_RDWR (YL_ZMF_SHAL)
  ZQENH => GET_DEVICE_DATA_RDONLY (YL_ZQENH)
  ZTENH => GET_DEVICE_DATA_RDONLY (YL_ZTENH)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:3:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:3:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  
    !$ACC PARALLEL LOOP GANG &
    !$ACC&PRESENT (ICTOP0, KCBOT, KTYPE, LDCUM, PAPH, PGEOH, PLU, PQU, PTEN, PTU, YFXTRAN_ACDC_STACK, &
    !$ACC&         ZDHPBL, ZKHVFL, ZMFUB, ZMF_SHAL, ZQENH, ZTENH) &
    !$ACC&PRIVATE (JBLK) &
    !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
    
    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    
    
    
    !$ACC LOOP VECTOR &
    !$ACC&PRIVATE (IKB, ITOPM2, JLON, YLCPG_BNDS, ZDH, ZDQMIN, ZDZ, ZMFMAX, ZPBMPT, ZQUMQE) 

    

    DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JLON
      YLCPG_BNDS%KFDIA = JLON

      

      

      IF (LDCUM (JLON, JBLK)) THEN
        IKB=KCBOT (JLON, JBLK)
        ITOPM2=ICTOP0 (JLON, JBLK)
        ZPBMPT=PAPH (JLON, IKB, JBLK)-PAPH (JLON, ITOPM2, JBLK)

        IF (ZPBMPT>=YDML_PHY_EC%YRECUMF%RDEPTHS) THEN
          KTYPE (JLON, JBLK)=1
        ELSE
          KTYPE (JLON, JBLK)=2
        ENDIF

      ELSE
        KTYPE (JLON, JBLK)=0
      ENDIF


      

      IF (YDML_PHY_EC%YRECUMF%LMFWSTAR) THEN

        

        IF (LDCUM (JLON, JBLK)) THEN
          IKB=KCBOT (JLON, JBLK)
          ZDZ=MAX (0.0_JPRB, MIN (1.5E3_JPRB,(PGEOH (JLON, IKB, JBLK)-PGEOH (JLON, KLEV+1, JBLK))/YDCST%RG))
          ZMF_SHAL (JLON, JBLK)=0.07_JPRB*(YDCST%RG/PTEN (JLON, KLEV&
          &, JBLK)*ZDZ*MAX (0.0_JPRB, ZKHVFL (JLON, JBLK)))**.3333
          ZMFMAX=(PAPH (JLON, IKB, JBLK)-PAPH (JLON, IKB-1, JBLK))*ZCONS2
          ZMF_SHAL (JLON, JBLK)=MIN (ZMF_SHAL (JLON, JBLK), ZMFMAX)
        ENDIF

      
      ENDIF


      

      IF (LDCUM (JLON, JBLK)) THEN
        IKB=KCBOT (JLON, JBLK)
        ZMFMAX=(PAPH (JLON, IKB, JBLK)-PAPH (JLON, IKB-1, JBLK))*ZCONS2

        IF (KTYPE (JLON, JBLK)==1) THEN
          ZMFUB (JLON, JBLK)=ZMFMAX*0.1_JPRB
        ELSEIF (KTYPE (JLON, JBLK)==2) THEN
          ZQUMQE=PQU (JLON, IKB, JBLK)+PLU (JLON, IKB, JBLK)-ZQENH (JLON, IKB, JBLK)
          ZDQMIN=MAX (0.01_JPRB*ZQENH (JLON, IKB, JBLK), 1.E-10_JPRB)
          ZDH=YDCST%RCPD*(PTU (JLON, IKB, JBLK)-ZTENH (JLON, IKB, JBLK))+YDCST%RLVTT*ZQUMQE
          ZDH=YDCST%RG*MAX (ZDH, 1.E5_JPRB*ZDQMIN)

          IF (ZDHPBL (JLON, JBLK)>0.0_JPRB) THEN
            ZMFUB (JLON, JBLK)=ZDHPBL (JLON, JBLK)/ZDH
            ZMFUB (JLON, JBLK)=MIN (ZMFUB (JLON, JBLK), ZMFMAX)
          ELSE
            ZMFUB (JLON, JBLK)=ZMFMAX*0.1_JPRB
            LDCUM (JLON, JBLK)=.FALSE.
          ENDIF


          IF (YDML_PHY_EC%YRECUMF%LMFWSTAR)  THEN
            ZMFUB (JLON, JBLK)=ZMF_SHAL (JLON, JBLK)
          ENDIF

        ENDIF

      ELSE
        ZMFUB (JLON, JBLK)=0.0_JPRB
      ENDIF

    
    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:3:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:3:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  ICTOP0 => NULL ()
  KCBOT => NULL ()
  KTYPE => NULL ()
  LDCUM => NULL ()
  PAPH => NULL ()
  PGEOH => NULL ()
  PLU => NULL ()
  PQU => NULL ()
  PTEN => NULL ()
  PTU => NULL ()
  ZDHPBL => NULL ()
  ZKHVFL => NULL ()
  ZMFUB => NULL ()
  ZMF_SHAL => NULL ()
  ZQENH => NULL ()
  ZTENH => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:3:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSE
    CALL ABOR1 ('CUMASTRN_PARALLEL: NOT METHOD WAS FOUND')
ENDIF

IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:3',1,ZHOOK_HANDLE_PARALLEL)
CALL CUASCN_PARALLEL (YDTHF, YDCST, YDML_PHY_SLIN%YREPHLI, YDML_PHY_EC%YRECLDP, YDML_PHY_EC&
&%YRECUMF, YDSPP_CONFIG, YGFL, YDCPG_OPTS, YDCPG_BNDS, YDCPG_OPTS%KLON, KLEV, LDTDKMF, PTSPHY&
&, YL_ZTENH, YL_ZQENH, YD_PUEN, YD_PVEN, YD_PTEN, YD_PQEN, YD_PQSEN, YD_PLITOT, YD_PGEO, YD_PGEOH&
&, YD_PAP, YD_PAPH, YD_PVERVEL, YL_ZWUBASE, YD_PGP2DSPP, YD_LDLAND, YD_LDCUM, YD_KTYPE, YL_ILAB&
&, YL_LLSCVFLAG, YD_PTU, YD_PQU, YD_PLU, YD_PLRAIN, YD_PMFU, YL_ZMFUB, YD_PLGLAC, YL_ZMFUS,&
& YL_ZMFUQ, YL_ZMFUL, YD_PLUDE, YD_PLUDELI, YL_ZDMFUP, YD_PLCRIT_AER, YL_ZDMFEN, YD_KCBOT, YD_KCTOP&
&, YL_ICTOP0, YL_IDPL, YD_PMFUDE_RATE, YL_ZKINEU, YD_PWU, YD_PWMEAN)
IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:4',0,ZHOOK_HANDLE_PARALLEL)

IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','CUMASTRN_PARALLEL:4')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:4:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  ICTOP0 => GET_HOST_DATA_RDWR (YL_ICTOP0)
  KCBOT => GET_HOST_DATA_RDONLY (YD_KCBOT)
  KCTOP => GET_HOST_DATA_RDONLY (YD_KCTOP)
  KTYPE => GET_HOST_DATA_RDWR (YD_KTYPE)
  LDCUM => GET_HOST_DATA_RDONLY (YD_LDCUM)
  PAPH => GET_HOST_DATA_RDONLY (YD_PAPH)
  PMFD => GET_HOST_DATA_RDWR (YD_PMFD)
  PTENU => GET_HOST_DATA_RDONLY (YD_PTENU)
  PTENV => GET_HOST_DATA_RDONLY (YD_PTENV)
  ZDMFDP => GET_HOST_DATA_RDWR (YL_ZDMFDP)
  ZDMFUP => GET_HOST_DATA_RDONLY (YL_ZDMFUP)
  ZDPMEL => GET_HOST_DATA_RDWR (YL_ZDPMEL)
  ZMFDQ => GET_HOST_DATA_RDWR (YL_ZMFDQ)
  ZMFDS => GET_HOST_DATA_RDWR (YL_ZMFDS)
  ZRFL => GET_HOST_DATA_RDWR (YL_ZRFL)
  ZTENU => GET_HOST_DATA_RDWR (YL_ZTENU)
  ZTENV => GET_HOST_DATA_RDWR (YL_ZTENV)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:4:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:4:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
  !$OMP PARALLEL DO PRIVATE (IKB, ITOPM2, JBLK, JK, JLON, ZPBMPT) FIRSTPRIVATE (YLCPG_BNDS)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    CALL YLCPG_BNDS%UPDATE (JBLK)

    

    DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA

      IF (LDCUM (JLON, JBLK)) THEN
        IKB=KCBOT (JLON, JBLK)
        ITOPM2=KCTOP (JLON, JBLK)
        ZPBMPT=PAPH (JLON, IKB, JBLK)-PAPH (JLON, ITOPM2, JBLK)

        IF (KTYPE (JLON, JBLK)==1.AND.ZPBMPT<YDML_PHY_EC%YRECUMF%RDEPTHS)  THEN
          KTYPE (JLON, JBLK)=2
        ENDIF


        IF (KTYPE (JLON, JBLK)==2.AND.ZPBMPT>=YDML_PHY_EC%YRECUMF%RDEPTHS)  THEN
          KTYPE (JLON, JBLK)=1
        ENDIF

        ICTOP0 (JLON, JBLK)=KCTOP (JLON, JBLK)
      ENDIF

      ZRFL (JLON, JBLK)=ZDMFUP (JLON, 1, JBLK)
    ENDDO


    DO JK=2, KLEV

      DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
        ZRFL (JLON, JBLK)=ZRFL (JLON, JBLK)+ZDMFUP (JLON, JK, JBLK)
      ENDDO

    ENDDO


    DO JK=1, KLEV

      DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
        PMFD (JLON, JK, JBLK)=0.0_JPRB
        ZMFDS (JLON, JK, JBLK)=0.0_JPRB
        ZMFDQ (JLON, JK, JBLK)=0.0_JPRB
        ZDMFDP (JLON, JK, JBLK)=0.0_JPRB
        ZDPMEL (JLON, JK, JBLK)=0.0_JPRB
      ENDDO

    ENDDO


    DO JK=1, KLEV

      DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
        ZTENU (JLON, JK, JBLK)=PTENU (JLON, JK, JBLK)
        ZTENV (JLON, JK, JBLK)=PTENV (JLON, JK, JBLK)
      ENDDO

    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:4:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:4:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  ICTOP0 => NULL ()
  KCBOT => NULL ()
  KCTOP => NULL ()
  KTYPE => NULL ()
  LDCUM => NULL ()
  PAPH => NULL ()
  PMFD => NULL ()
  PTENU => NULL ()
  PTENV => NULL ()
  ZDMFDP => NULL ()
  ZDMFUP => NULL ()
  ZDPMEL => NULL ()
  ZMFDQ => NULL ()
  ZMFDS => NULL ()
  ZRFL => NULL ()
  ZTENU => NULL ()
  ZTENV => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:4:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN','CUMASTRN_PARALLEL:4')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:4:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  ICTOP0 => GET_DEVICE_DATA_RDWR (YL_ICTOP0)
  KCBOT => GET_DEVICE_DATA_RDONLY (YD_KCBOT)
  KCTOP => GET_DEVICE_DATA_RDONLY (YD_KCTOP)
  KTYPE => GET_DEVICE_DATA_RDWR (YD_KTYPE)
  LDCUM => GET_DEVICE_DATA_RDONLY (YD_LDCUM)
  PAPH => GET_DEVICE_DATA_RDONLY (YD_PAPH)
  PMFD => GET_DEVICE_DATA_RDWR (YD_PMFD)
  PTENU => GET_DEVICE_DATA_RDONLY (YD_PTENU)
  PTENV => GET_DEVICE_DATA_RDONLY (YD_PTENV)
  ZDMFDP => GET_DEVICE_DATA_RDWR (YL_ZDMFDP)
  ZDMFUP => GET_DEVICE_DATA_RDONLY (YL_ZDMFUP)
  ZDPMEL => GET_DEVICE_DATA_RDWR (YL_ZDPMEL)
  ZMFDQ => GET_DEVICE_DATA_RDWR (YL_ZMFDQ)
  ZMFDS => GET_DEVICE_DATA_RDWR (YL_ZMFDS)
  ZRFL => GET_DEVICE_DATA_RDWR (YL_ZRFL)
  ZTENU => GET_DEVICE_DATA_RDWR (YL_ZTENU)
  ZTENV => GET_DEVICE_DATA_RDWR (YL_ZTENV)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:4:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:4:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  
    !$ACC PARALLEL LOOP GANG &
    !$ACC&PRESENT (ICTOP0, KCBOT, KCTOP, KTYPE, LDCUM, PAPH, PMFD, PTENU, PTENV, YFXTRAN_ACDC_STACK, &
    !$ACC&         ZDMFDP, ZDMFUP, ZDPMEL, ZMFDQ, ZMFDS, ZRFL, ZTENU, ZTENV) &
    !$ACC&PRIVATE (JBLK) &
    !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
    
    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    
    
    
    !$ACC LOOP VECTOR &
    !$ACC&PRIVATE (IKB, ITOPM2, JK, JLON, YLCPG_BNDS, ZPBMPT) 

    

    DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JLON
      YLCPG_BNDS%KFDIA = JLON

      

      

      IF (LDCUM (JLON, JBLK)) THEN
        IKB=KCBOT (JLON, JBLK)
        ITOPM2=KCTOP (JLON, JBLK)
        ZPBMPT=PAPH (JLON, IKB, JBLK)-PAPH (JLON, ITOPM2, JBLK)

        IF (KTYPE (JLON, JBLK)==1.AND.ZPBMPT<YDML_PHY_EC%YRECUMF%RDEPTHS)  THEN
          KTYPE (JLON, JBLK)=2
        ENDIF


        IF (KTYPE (JLON, JBLK)==2.AND.ZPBMPT>=YDML_PHY_EC%YRECUMF%RDEPTHS)  THEN
          KTYPE (JLON, JBLK)=1
        ENDIF

        ICTOP0 (JLON, JBLK)=KCTOP (JLON, JBLK)
      ENDIF

      ZRFL (JLON, JBLK)=ZDMFUP (JLON, 1, JBLK)

      

      DO JK=2, KLEV
        
        ZRFL (JLON, JBLK)=ZRFL (JLON, JBLK)+ZDMFUP (JLON, JK, JBLK)
      
      ENDDO


      DO JK=1, KLEV
        
        PMFD (JLON, JK, JBLK)=0.0_JPRB
        ZMFDS (JLON, JK, JBLK)=0.0_JPRB
        ZMFDQ (JLON, JK, JBLK)=0.0_JPRB
        ZDMFDP (JLON, JK, JBLK)=0.0_JPRB
        ZDPMEL (JLON, JK, JBLK)=0.0_JPRB
      
      ENDDO


      DO JK=1, KLEV
        
        ZTENU (JLON, JK, JBLK)=PTENU (JLON, JK, JBLK)
        ZTENV (JLON, JK, JBLK)=PTENV (JLON, JK, JBLK)
      
      ENDDO

    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:4:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:4:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  ICTOP0 => NULL ()
  KCBOT => NULL ()
  KCTOP => NULL ()
  KTYPE => NULL ()
  LDCUM => NULL ()
  PAPH => NULL ()
  PMFD => NULL ()
  PTENU => NULL ()
  PTENV => NULL ()
  ZDMFDP => NULL ()
  ZDMFUP => NULL ()
  ZDPMEL => NULL ()
  ZMFDQ => NULL ()
  ZMFDS => NULL ()
  ZRFL => NULL ()
  ZTENU => NULL ()
  ZTENV => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:4:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSE
    CALL ABOR1 ('CUMASTRN_PARALLEL: NOT METHOD WAS FOUND')
ENDIF

IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:4',1,ZHOOK_HANDLE_PARALLEL)
IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:5',0,ZHOOK_HANDLE_PARALLEL)

IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','CUMASTRN_PARALLEL:5')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:5:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  IDTOP => GET_HOST_DATA_RDWR (YL_IDTOP)
  KCBOT => GET_HOST_DATA_RDONLY (YD_KCBOT)
  KCTOP => GET_HOST_DATA_RDONLY (YD_KCTOP)
  LDCUM => GET_HOST_DATA_RDONLY (YD_LDCUM)
  LLDDRAF => GET_HOST_DATA_RDWR (YL_LLDDRAF)
  PAPH => GET_HOST_DATA_RDONLY (YD_PAPH)
  PGEO => GET_HOST_DATA_RDONLY (YD_PGEO)
  PGEOH => GET_HOST_DATA_RDONLY (YD_PGEOH)
  PMFD => GET_HOST_DATA_RDWR (YD_PMFD)
  PMFDDE_RATE => GET_HOST_DATA_RDWR (YD_PMFDDE_RATE)
  PMFU => GET_HOST_DATA_RDONLY (YD_PMFU)
  PQSEN => GET_HOST_DATA_RDONLY (YD_PQSEN)
  PQU => GET_HOST_DATA_RDONLY (YD_PQU)
  PTEN => GET_HOST_DATA_RDONLY (YD_PTEN)
  PTU => GET_HOST_DATA_RDONLY (YD_PTU)
  ZDMFDE => GET_HOST_DATA_RDWR (YL_ZDMFDE)
  ZDMFDP => GET_HOST_DATA_RDWR (YL_ZDMFDP)
  ZKINED => GET_HOST_DATA_RDWR (YL_ZKINED)
  ZMFDQ => GET_HOST_DATA_RDWR (YL_ZMFDQ)
  ZMFDS => GET_HOST_DATA_RDWR (YL_ZMFDS)
  ZMFUB => GET_HOST_DATA_RDONLY (YL_ZMFUB)
  ZQD => GET_HOST_DATA_RDWR (YL_ZQD)
  ZQENH => GET_HOST_DATA_RDONLY (YL_ZQENH)
  ZRFL => GET_HOST_DATA_RDWR (YL_ZRFL)
  ZTD => GET_HOST_DATA_RDWR (YL_ZTD)
  ZTENH => GET_HOST_DATA_RDONLY (YL_ZTENH)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:5:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:5:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
  !$OMP PARALLEL DO PRIVATE (JBLK) FIRSTPRIVATE (YLCPG_BNDS)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    CALL YLCPG_BNDS%UPDATE (JBLK)

    

    IF (YDML_PHY_EC%YRECUMF%LMFDD) THEN
      CALL CUDLFSN (YDTHF, YDCST, YDML_PHY_SLIN%YREPHLI, YDML_PHY_EC%YRECUMF, YLCPG_BNDS%KIDIA&
      &, YLCPG_BNDS%KFDIA, YDCPG_OPTS%KLON, KLEV, KCBOT(:, JBLK), KCTOP(:, JBLK), LDCUM(:, JBLK&
      &), ZTENH(:,:, JBLK), ZQENH(:,:, JBLK), PTEN(:,:, JBLK), PQSEN(:,:, JBLK), PGEO(:,:, JBLK&
      &), PGEOH(:,:, JBLK), PAPH(:,:, JBLK), PTU(:,:, JBLK), PQU(:,:, JBLK), ZMFUB(:, JBLK)&
      &, ZRFL(:, JBLK), ZTD(:,:, JBLK), ZQD(:,:, JBLK), PMFD(:,:, JBLK), ZMFDS(:,:, JBLK), ZMFDQ&
      &(:,:, JBLK), ZDMFDP(:,:, JBLK), IDTOP(:, JBLK), LLDDRAF(:, JBLK))
      CALL CUDDRAFN (YDCST, YDTHF, YDML_PHY_SLIN%YREPHLI, YDML_PHY_EC%YRECUMF, YLCPG_BNDS%KIDIA, YLCPG_BNDS&
      &%KFDIA, YDCPG_OPTS%KLON, KLEV, LLDDRAF(:, JBLK), ZTENH(:,:, JBLK), ZQENH(:,:, JBLK), PQSEN(&
      &:,:, JBLK), PGEO(:,:, JBLK), PGEOH(:,:, JBLK), PAPH(:,:, JBLK), ZRFL(:, JBLK), ZTD(:,:, JBLK&
      &), ZQD(:,:, JBLK), PMFU(:,:, JBLK), PMFD(:,:, JBLK), ZMFDS(:,:, JBLK), ZMFDQ(:,:, JBLK), ZDMFDP&
      &(:,:, JBLK), ZDMFDE(:,:, JBLK), PMFDDE_RATE(:,:, JBLK), ZKINED(:,:, JBLK))
    ENDIF

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:5:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:5:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  IDTOP => NULL ()
  KCBOT => NULL ()
  KCTOP => NULL ()
  LDCUM => NULL ()
  LLDDRAF => NULL ()
  PAPH => NULL ()
  PGEO => NULL ()
  PGEOH => NULL ()
  PMFD => NULL ()
  PMFDDE_RATE => NULL ()
  PMFU => NULL ()
  PQSEN => NULL ()
  PQU => NULL ()
  PTEN => NULL ()
  PTU => NULL ()
  ZDMFDE => NULL ()
  ZDMFDP => NULL ()
  ZKINED => NULL ()
  ZMFDQ => NULL ()
  ZMFDS => NULL ()
  ZMFUB => NULL ()
  ZQD => NULL ()
  ZQENH => NULL ()
  ZRFL => NULL ()
  ZTD => NULL ()
  ZTENH => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:5:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN','CUMASTRN_PARALLEL:5')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:5:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  IDTOP => GET_DEVICE_DATA_RDWR (YL_IDTOP)
  KCBOT => GET_DEVICE_DATA_RDONLY (YD_KCBOT)
  KCTOP => GET_DEVICE_DATA_RDONLY (YD_KCTOP)
  LDCUM => GET_DEVICE_DATA_RDONLY (YD_LDCUM)
  LLDDRAF => GET_DEVICE_DATA_RDWR (YL_LLDDRAF)
  PAPH => GET_DEVICE_DATA_RDONLY (YD_PAPH)
  PGEO => GET_DEVICE_DATA_RDONLY (YD_PGEO)
  PGEOH => GET_DEVICE_DATA_RDONLY (YD_PGEOH)
  PMFD => GET_DEVICE_DATA_RDWR (YD_PMFD)
  PMFDDE_RATE => GET_DEVICE_DATA_RDWR (YD_PMFDDE_RATE)
  PMFU => GET_DEVICE_DATA_RDONLY (YD_PMFU)
  PQSEN => GET_DEVICE_DATA_RDONLY (YD_PQSEN)
  PQU => GET_DEVICE_DATA_RDONLY (YD_PQU)
  PTEN => GET_DEVICE_DATA_RDONLY (YD_PTEN)
  PTU => GET_DEVICE_DATA_RDONLY (YD_PTU)
  ZDMFDE => GET_DEVICE_DATA_RDWR (YL_ZDMFDE)
  ZDMFDP => GET_DEVICE_DATA_RDWR (YL_ZDMFDP)
  ZKINED => GET_DEVICE_DATA_RDWR (YL_ZKINED)
  ZMFDQ => GET_DEVICE_DATA_RDWR (YL_ZMFDQ)
  ZMFDS => GET_DEVICE_DATA_RDWR (YL_ZMFDS)
  ZMFUB => GET_DEVICE_DATA_RDONLY (YL_ZMFUB)
  ZQD => GET_DEVICE_DATA_RDWR (YL_ZQD)
  ZQENH => GET_DEVICE_DATA_RDONLY (YL_ZQENH)
  ZRFL => GET_DEVICE_DATA_RDWR (YL_ZRFL)
  ZTD => GET_DEVICE_DATA_RDWR (YL_ZTD)
  ZTENH => GET_DEVICE_DATA_RDONLY (YL_ZTENH)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:5:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:5:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  
    !$ACC PARALLEL LOOP GANG &
    !$ACC&PRESENT (IDTOP, KCBOT, KCTOP, LDCUM, LLDDRAF, PAPH, PGEO, PGEOH, PMFD, PMFDDE_RATE, &
    !$ACC&         PMFU, PQSEN, PQU, PTEN, PTU, YFXTRAN_ACDC_STACK, ZDMFDE, ZDMFDP, ZKINED, &
    !$ACC&         ZMFDQ, ZMFDS, ZMFUB, ZQD, ZQENH, ZRFL, ZTD, ZTENH) &
    !$ACC&PRIVATE (JBLK) &
    !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
    
    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    
    
    
    !$ACC LOOP VECTOR &
    !$ACC&PRIVATE (JLON, YLCPG_BNDS, YLSTACK) 

    

    DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JLON
      YLCPG_BNDS%KFDIA = JLON
      YLSTACK%L8 = fxtran_acdc_stack_l8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%U8 = fxtran_acdc_stack_u8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%L4 = fxtran_acdc_stack_l4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%U4 = fxtran_acdc_stack_u4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)

      

      IF (YDML_PHY_EC%YRECUMF%LMFDD) THEN
        CALL CUDLFSN_OPENACC (YDTHF, YDCST, YDML_PHY_SLIN%YREPHLI, YDML_PHY_EC%YRECUMF, YLCPG_BNDS&
        &%KIDIA, YLCPG_BNDS%KFDIA, YDCPG_OPTS%KLON, KLEV, KCBOT(:, JBLK), KCTOP(:, JBLK), LDCUM(:&
        &, JBLK), ZTENH(:,:, JBLK), ZQENH(:,:, JBLK), PTEN(:,:, JBLK), PQSEN(:,:, JBLK), PGEO(:,:&
        &, JBLK), PGEOH(:,:, JBLK), PAPH(:,:, JBLK), PTU(:,:, JBLK), PQU(:,:, JBLK), ZMFUB(:, JBLK&
        &), ZRFL(:, JBLK), ZTD(:,:, JBLK), ZQD(:,:, JBLK), PMFD(:,:, JBLK), ZMFDS(:,:, JBLK), ZMFDQ&
        &(:,:, JBLK), ZDMFDP(:,:, JBLK), IDTOP(:, JBLK), LLDDRAF(:, JBLK),YDSTACK=YLSTACK)
        CALL CUDDRAFN_OPENACC (YDCST, YDTHF, YDML_PHY_SLIN%YREPHLI, YDML_PHY_EC%YRECUMF, YLCPG_BNDS%KIDIA&
        &, YLCPG_BNDS%KFDIA, YDCPG_OPTS%KLON, KLEV, LLDDRAF(:, JBLK), ZTENH(:,:, JBLK), ZQENH(:,:, JBLK),&
        & PQSEN(:,:, JBLK), PGEO(:,:, JBLK), PGEOH(:,:, JBLK), PAPH(:,:, JBLK), ZRFL(:, JBLK), ZTD(:,:, JBLK&
        &), ZQD(:,:, JBLK), PMFU(:,:, JBLK), PMFD(:,:, JBLK), ZMFDS(:,:, JBLK), ZMFDQ(:,:, JBLK), ZDMFDP(&
        &:,:, JBLK), ZDMFDE(:,:, JBLK), PMFDDE_RATE(:,:, JBLK), ZKINED(:,:, JBLK),YDSTACK=YLSTACK)
      ENDIF

    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:5:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:5:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  IDTOP => NULL ()
  KCBOT => NULL ()
  KCTOP => NULL ()
  LDCUM => NULL ()
  LLDDRAF => NULL ()
  PAPH => NULL ()
  PGEO => NULL ()
  PGEOH => NULL ()
  PMFD => NULL ()
  PMFDDE_RATE => NULL ()
  PMFU => NULL ()
  PQSEN => NULL ()
  PQU => NULL ()
  PTEN => NULL ()
  PTU => NULL ()
  ZDMFDE => NULL ()
  ZDMFDP => NULL ()
  ZKINED => NULL ()
  ZMFDQ => NULL ()
  ZMFDS => NULL ()
  ZMFUB => NULL ()
  ZQD => NULL ()
  ZQENH => NULL ()
  ZRFL => NULL ()
  ZTD => NULL ()
  ZTENH => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:5:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSE
    CALL ABOR1 ('CUMASTRN_PARALLEL: NOT METHOD WAS FOUND')
ENDIF

IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:5',1,ZHOOK_HANDLE_PARALLEL)
IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:6',0,ZHOOK_HANDLE_PARALLEL)

IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','CUMASTRN_PARALLEL:6')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:6:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  IDPL => GET_HOST_DATA_RDONLY (YL_IDPL)
  KCBOT => GET_HOST_DATA_RDONLY (YD_KCBOT)
  KCTOP => GET_HOST_DATA_RDONLY (YD_KCTOP)
  KTYPE => GET_HOST_DATA_RDONLY (YD_KTYPE)
  LDCUM => GET_HOST_DATA_RDONLY (YD_LDCUM)
  LDLAND => GET_HOST_DATA_RDONLY (YD_LDLAND)
  PAP => GET_HOST_DATA_RDONLY (YD_PAP)
  PAPH => GET_HOST_DATA_RDONLY (YD_PAPH)
  PDX => GET_HOST_DATA_RDONLY (YD_PDX)
  PGAW => GET_HOST_DATA_RDONLY (YD_PGAW)
  PGEO => GET_HOST_DATA_RDONLY (YD_PGEO)
  PGEOH => GET_HOST_DATA_RDONLY (YD_PGEOH)
  PLU => GET_HOST_DATA_RDONLY (YD_PLU)
  PMFD => GET_HOST_DATA_RDONLY (YD_PMFD)
  PMFU => GET_HOST_DATA_RDONLY (YD_PMFU)
  PQEN => GET_HOST_DATA_RDONLY (YD_PQEN)
  PQSEN => GET_HOST_DATA_RDONLY (YD_PQSEN)
  PQU => GET_HOST_DATA_RDONLY (YD_PQU)
  PTEN => GET_HOST_DATA_RDONLY (YD_PTEN)
  PTENQA => GET_HOST_DATA_RDONLY (YD_PTENQA)
  PTENTA => GET_HOST_DATA_RDONLY (YD_PTENTA)
  PTU => GET_HOST_DATA_RDONLY (YD_PTU)
  PUEN => GET_HOST_DATA_RDONLY (YD_PUEN)
  PVEN => GET_HOST_DATA_RDONLY (YD_PVEN)
  PWMEAN => GET_HOST_DATA_RDONLY (YD_PWMEAN)
  ZCAPDCYCL => GET_HOST_DATA_RDWR (YL_ZCAPDCYCL)
  ZCAPDCYCLLD => GET_HOST_DATA_RDWR (YL_ZCAPDCYCLLD)
  ZCAPDCYCLSE => GET_HOST_DATA_RDWR (YL_ZCAPDCYCLSE)
  ZCAPE => GET_HOST_DATA_RDWR (YL_ZCAPE)
  ZCAPE2 => GET_HOST_DATA_RDWR (YL_ZCAPE2)
  ZCAPPBL => GET_HOST_DATA_RDONLY (YL_ZCAPPBL)
  ZDQCV => GET_HOST_DATA_RDWR (YL_ZDQCV)
  ZDX => GET_HOST_DATA_RDWR (YL_ZDX)
  ZHEAT => GET_HOST_DATA_RDWR (YL_ZHEAT)
  ZKHVFL => GET_HOST_DATA_RDONLY (YL_ZKHVFL)
  ZMFUB => GET_HOST_DATA_RDONLY (YL_ZMFUB)
  ZMFUB1 => GET_HOST_DATA_RDWR (YL_ZMFUB1)
  ZQENH => GET_HOST_DATA_RDONLY (YL_ZQENH)
  ZQENH2 => GET_HOST_DATA_RDWR (YL_ZQENH2)
  ZSATFR => GET_HOST_DATA_RDWR (YL_ZSATFR)
  ZTAU => GET_HOST_DATA_RDWR (YL_ZTAU)
  ZTAUPBL => GET_HOST_DATA_RDWR (YL_ZTAUPBL)
  ZTENH => GET_HOST_DATA_RDONLY (YL_ZTENH)
  ZTENH2 => GET_HOST_DATA_RDWR (YL_ZTENH2)
  ZXTAU => GET_HOST_DATA_RDWR (YL_ZXTAU)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:6:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:6:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
  !$OMP PARALLEL DO PRIVATE (IK, IKB, IKD, JBLK, JK, JLON, LLO1, LLO3, ZDUTEN, ZDZ, ZIND, ZTAURES) FIRSTPRIVATE (YLCPG_BNDS)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    CALL YLCPG_BNDS%UPDATE (JBLK)

    

    DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
      ZHEAT (JLON, JBLK)=0.0_JPRB
      ZCAPE (JLON, JBLK)=0.0_JPRB
      ZCAPE2 (JLON, JBLK)=0.0_JPRB
      ZMFUB1 (JLON, JBLK)=ZMFUB (JLON, JBLK)
      ZDQCV (JLON, JBLK)=0.0_JPRB
      ZSATFR (JLON, JBLK)=0.0_JPRB
      ZDX (JLON, JBLK)=2*YDCST%RA*SQRT (YDCST%RPI*PGAW (JLON, JBLK))
      ZDX (JLON, JBLK)=MAX (ZDX (JLON, JBLK), 1.E2_JPRB)
    ENDDO


    DO JK=YDML_PHY_EC%YRECUMF%NJKT2, KLEV

      DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
        LLO1=LDCUM (JLON, JBLK).AND.KTYPE (JLON, JBLK)==1
        LLO3=LLO1.AND.JK<=KCBOT (JLON, JBLK).AND.JK>KCTOP (JLON, JBLK)

        IF (LLO3) THEN
          ZDZ=(PGEO (JLON, JK-1, JBLK)-PGEO (JLON, JK, JBLK))

          IF (LDTDKMF) THEN
            ZHEAT (JLON, JBLK)=ZHEAT (JLON, JBLK)+((PTEN (JLON, JK-1, JBLK)-PTEN (JLON, JK, JBLK&
            &)+ZDZ*ZORCPD)/ZTENH (JLON, JK, JBLK)+YDCST%RETV*(PQEN (JLON, JK-1, JBLK)-PQEN (JLON&
            &, JK, JBLK)))*(YDCST%RG*(PMFU (JLON, JK, JBLK)+PMFD (JLON, JK, JBLK)))
          ELSE
            ZHEAT (JLON, JBLK)=ZHEAT (JLON, JBLK)+MAX (0.0_JPRB,((PTEN (JLON, JK-1, JBLK)-PTEN (JLON&
            &, JK, JBLK)+ZDZ*ZORCPD)/ZTENH (JLON, JK, JBLK)+YDCST%RETV*(PQEN (JLON, JK-1, JBLK)-PQEN&
            & (JLON, JK, JBLK)))*(YDCST%RG*(PMFU (JLON, JK, JBLK)+PMFD (JLON, JK, JBLK))))
          ENDIF

          ZDZ=(PAP (JLON, JK, JBLK)-PAP (JLON, JK-1, JBLK))
          ZCAPE (JLON, JBLK)=ZCAPE (JLON, JBLK)+((PTU (JLON, JK, JBLK)-ZTENH (JLON, JK, JBLK))/ZTENH (JLON,&
          & JK, JBLK)+YDCST%RETV*(PQU (JLON, JK, JBLK)-ZQENH (JLON, JK, JBLK))-PLU (JLON, JK, JBLK))*ZDZ
        ENDIF


        IF (LLO3.AND.YDML_PHY_EC%YRECUMF%RCAPQADV>0.0_JPRB) THEN
          ZTENH2 (JLON, JK, JBLK)=ZTENH (JLON, JK, JBLK)-0.5_JPRB*(PTENTA&
          & (JLON, JK, JBLK)+PTENTA (JLON, JK-1, JBLK))*PTSPHY
          ZQENH2 (JLON, JK, JBLK)=ZQENH (JLON, JK, JBLK)-0.5_JPRB*(PTENQA&
          & (JLON, JK, JBLK)+PTENQA (JLON, JK-1, JBLK))*PTSPHY
          ZCAPE2 (JLON, JBLK)=ZCAPE2 (JLON, JBLK)+((PTU (JLON, JK, JBLK)-ZTENH2 (JLON, JK, JBLK))/ZTENH2 (JLON&
          &, JK, JBLK)+YDCST%RETV*(PQU (JLON, JK, JBLK)-ZQENH2 (JLON, JK, JBLK))-PLU (JLON, JK, JBLK))*ZDZ
        ENDIF


        IF (LLO1) THEN
          ZDZ=(PAPH (JLON, JK+1, JBLK)-PAPH (JLON, JK, JBLK))
          ZDQCV (JLON, JBLK)=ZDQCV (JLON, JBLK)+PTENQA (JLON, JK, JBLK&
          &)*ZDZ*(PQEN (JLON, JK, JBLK)/PQSEN (JLON, JK, JBLK))
        ENDIF


        IF (LLO1.AND.JK>=KCTOP (JLON, JBLK)) THEN
          ZDZ=(PAPH (JLON, JK+1, JBLK)-PAPH (JLON, JK, JBLK))
          ZSATFR (JLON, JBLK)=ZSATFR (JLON, JBLK)+(PQEN (JLON, JK, JBLK)/PQSEN (JLON, JK, JBLK))*ZDZ
        ENDIF

      ENDDO

    ENDDO


    DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
      ZCAPDCYCL (JLON, JBLK)=0.0_JPRB
      ZTAU (JLON, JBLK)=0.0_JPRB

      IF (LDTDKMF) THEN
        ZDX (JLON, JBLK)=PDX (JLON, JBLK)
        ZDX (JLON, JBLK)=MAX (ZDX (JLON, JBLK), 1.E2_JPRB)
      ENDIF


      IF (LDCUM (JLON, JBLK).AND.KTYPE (JLON, JBLK)==1) THEN

        IF (YDML_PHY_EC%YRECUMF%LNEWTAU) THEN
          ZTAURES=YDML_PHY_EC%YRECUMF%RTAULIM*(1._JPRB+YDML_PHY_EC%YRECUMF%RTAUFAC/&
          &((ZDX (JLON, JBLK)/1000._JPRB-YDML_PHY_EC%YRECUMF%RXMIN+1._JPRB)**2))
        ELSE
          ZTAURES=1.0_JPRB+1.60_JPRB*ZDX (JLON, JBLK)/125.E3_JPRB

          IF (ZDX (JLON, JBLK)<8.E3_JPRB) THEN
            ZTAURES=1.0_JPRB+(LOG (8.E3_JPRB/ZDX (JLON, JBLK)))**2
          ENDIF

        ENDIF


        IF (ZDX (JLON, JBLK)>125.E3_JPRB)  THEN
          ZTAURES=MIN (3.0_JPRB, ZTAURES)
        ENDIF

        IKD=IDPL (JLON, JBLK)
        IKB=KCBOT (JLON, JBLK)
        IK=KCTOP (JLON, JBLK)
        ZTAU (JLON, JBLK)=(PGEOH (JLON, IK, JBLK)-PGEOH (JLON, IKB, JBLK))/((2.0_JPRB+MIN&
        & (15.0_JPRB, PWMEAN (JLON, JBLK)))*YDCST%RG)*ZTAURES*YDML_PHY_EC%YRECUMF%RTAUA
        
        ZXTAU (JLON, JBLK)=ZTAU (JLON, JBLK)
        
        LLO1=PAPH (JLON, KLEV+1, JBLK)-PAPH (JLON, IKD, JBLK)<50.E2_JPRB

        IF (LLO1.AND.LDLAND (JLON, JBLK).AND.YDML_PHY_EC%YRECUMF%RCAPDCYCL==1.0_JPRB) THEN
          ZDZ=MIN (1.E4_JPRB, PGEOH (JLON, IKB, JBLK)-PGEOH (JLON, KLEV+1, JBLK))/YDCST%RG
          ZCAPDCYCL (JLON, JBLK)=ZXTAU (JLON, JBLK)*MAX (0.0_JPRB, ZKHVFL (JLON, JBLK))*YDCST%RCPD/ZDZ
        ENDIF


        IF (LLO1.AND.YDML_PHY_EC%YRECUMF%RCAPDCYCL==2.0_JPRB) THEN
          ZIND=MAX (0._JPRB, MIN (1._JPRB,(YDML_PHY_EC%YRECUMF%RDXMAX-ZDX (JLON&
          &, JBLK))/(YDML_PHY_EC%YRECUMF%RDXMAX-YDML_PHY_EC%YRECUMF%RDXMIN)))

          IF (LDLAND (JLON, JBLK))  THEN
            ZIND=1._JPRB
          ENDIF

          ZCAPDCYCLLD (JLON, JBLK)=ZCAPPBL (JLON, JBLK)*ZTAU (JLON, JBLK)/ZTAURES
          ZDUTEN=2.0_JPRB+SQRT (0.5*(PUEN (JLON, IKB, JBLK)**2+PVEN (JLON, IKB, JBLK)**2+PUEN (JLON,&
          & YDML_PHY_EC%YRECUMF%NJKT3, JBLK)**2+PVEN (JLON, YDML_PHY_EC%YRECUMF%NJKT3, JBLK)**2))
          ZTAUPBL (JLON, JBLK)=MIN (1.E4_JPRB, PGEOH (JLON, IKB, JBLK&
          &)-PGEOH (JLON, KLEV+1, JBLK))/(YDCST%RG*ZDUTEN)
          ZCAPDCYCLSE (JLON, JBLK)=ZCAPPBL (JLON, JBLK)*ZTAUPBL (JLON, JBLK)
          ZCAPDCYCL (JLON, JBLK)=ZIND*ZCAPDCYCLLD (JLON, JBLK)+(1._JPRB-ZIND)*ZCAPDCYCLSE (JLON, JBLK)
        ENDIF

        ZDQCV (JLON, JBLK)=ZDQCV (JLON, JBLK)*YDCST%RLVTT/PGEOH (JLON, IK, JBLK)*ZXTAU&
        & (JLON, JBLK)/MAX (1.25_JPRB, ZTAURES)*YDML_PHY_EC%YRECUMF%RCAPQADV
        ZSATFR (JLON, JBLK)=ZSATFR (JLON, JBLK)/(PAPH (JLON, KLEV+1, JBLK)-PAPH (JLON, IK, JBLK))
      ELSE
        ZTAU (JLON, JBLK)=0.0_JPRB
      ENDIF

    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:6:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:6:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  IDPL => NULL ()
  KCBOT => NULL ()
  KCTOP => NULL ()
  KTYPE => NULL ()
  LDCUM => NULL ()
  LDLAND => NULL ()
  PAP => NULL ()
  PAPH => NULL ()
  PDX => NULL ()
  PGAW => NULL ()
  PGEO => NULL ()
  PGEOH => NULL ()
  PLU => NULL ()
  PMFD => NULL ()
  PMFU => NULL ()
  PQEN => NULL ()
  PQSEN => NULL ()
  PQU => NULL ()
  PTEN => NULL ()
  PTENQA => NULL ()
  PTENTA => NULL ()
  PTU => NULL ()
  PUEN => NULL ()
  PVEN => NULL ()
  PWMEAN => NULL ()
  ZCAPDCYCL => NULL ()
  ZCAPDCYCLLD => NULL ()
  ZCAPDCYCLSE => NULL ()
  ZCAPE => NULL ()
  ZCAPE2 => NULL ()
  ZCAPPBL => NULL ()
  ZDQCV => NULL ()
  ZDX => NULL ()
  ZHEAT => NULL ()
  ZKHVFL => NULL ()
  ZMFUB => NULL ()
  ZMFUB1 => NULL ()
  ZQENH => NULL ()
  ZQENH2 => NULL ()
  ZSATFR => NULL ()
  ZTAU => NULL ()
  ZTAUPBL => NULL ()
  ZTENH => NULL ()
  ZTENH2 => NULL ()
  ZXTAU => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:6:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN','CUMASTRN_PARALLEL:6')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:6:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  IDPL => GET_DEVICE_DATA_RDONLY (YL_IDPL)
  KCBOT => GET_DEVICE_DATA_RDONLY (YD_KCBOT)
  KCTOP => GET_DEVICE_DATA_RDONLY (YD_KCTOP)
  KTYPE => GET_DEVICE_DATA_RDONLY (YD_KTYPE)
  LDCUM => GET_DEVICE_DATA_RDONLY (YD_LDCUM)
  LDLAND => GET_DEVICE_DATA_RDONLY (YD_LDLAND)
  PAP => GET_DEVICE_DATA_RDONLY (YD_PAP)
  PAPH => GET_DEVICE_DATA_RDONLY (YD_PAPH)
  PDX => GET_DEVICE_DATA_RDONLY (YD_PDX)
  PGAW => GET_DEVICE_DATA_RDONLY (YD_PGAW)
  PGEO => GET_DEVICE_DATA_RDONLY (YD_PGEO)
  PGEOH => GET_DEVICE_DATA_RDONLY (YD_PGEOH)
  PLU => GET_DEVICE_DATA_RDONLY (YD_PLU)
  PMFD => GET_DEVICE_DATA_RDONLY (YD_PMFD)
  PMFU => GET_DEVICE_DATA_RDONLY (YD_PMFU)
  PQEN => GET_DEVICE_DATA_RDONLY (YD_PQEN)
  PQSEN => GET_DEVICE_DATA_RDONLY (YD_PQSEN)
  PQU => GET_DEVICE_DATA_RDONLY (YD_PQU)
  PTEN => GET_DEVICE_DATA_RDONLY (YD_PTEN)
  PTENQA => GET_DEVICE_DATA_RDONLY (YD_PTENQA)
  PTENTA => GET_DEVICE_DATA_RDONLY (YD_PTENTA)
  PTU => GET_DEVICE_DATA_RDONLY (YD_PTU)
  PUEN => GET_DEVICE_DATA_RDONLY (YD_PUEN)
  PVEN => GET_DEVICE_DATA_RDONLY (YD_PVEN)
  PWMEAN => GET_DEVICE_DATA_RDONLY (YD_PWMEAN)
  ZCAPDCYCL => GET_DEVICE_DATA_RDWR (YL_ZCAPDCYCL)
  ZCAPDCYCLLD => GET_DEVICE_DATA_RDWR (YL_ZCAPDCYCLLD)
  ZCAPDCYCLSE => GET_DEVICE_DATA_RDWR (YL_ZCAPDCYCLSE)
  ZCAPE => GET_DEVICE_DATA_RDWR (YL_ZCAPE)
  ZCAPE2 => GET_DEVICE_DATA_RDWR (YL_ZCAPE2)
  ZCAPPBL => GET_DEVICE_DATA_RDONLY (YL_ZCAPPBL)
  ZDQCV => GET_DEVICE_DATA_RDWR (YL_ZDQCV)
  ZDX => GET_DEVICE_DATA_RDWR (YL_ZDX)
  ZHEAT => GET_DEVICE_DATA_RDWR (YL_ZHEAT)
  ZKHVFL => GET_DEVICE_DATA_RDONLY (YL_ZKHVFL)
  ZMFUB => GET_DEVICE_DATA_RDONLY (YL_ZMFUB)
  ZMFUB1 => GET_DEVICE_DATA_RDWR (YL_ZMFUB1)
  ZQENH => GET_DEVICE_DATA_RDONLY (YL_ZQENH)
  ZQENH2 => GET_DEVICE_DATA_RDWR (YL_ZQENH2)
  ZSATFR => GET_DEVICE_DATA_RDWR (YL_ZSATFR)
  ZTAU => GET_DEVICE_DATA_RDWR (YL_ZTAU)
  ZTAUPBL => GET_DEVICE_DATA_RDWR (YL_ZTAUPBL)
  ZTENH => GET_DEVICE_DATA_RDONLY (YL_ZTENH)
  ZTENH2 => GET_DEVICE_DATA_RDWR (YL_ZTENH2)
  ZXTAU => GET_DEVICE_DATA_RDWR (YL_ZXTAU)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:6:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:6:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  
    !$ACC PARALLEL LOOP GANG &
    !$ACC&PRESENT (IDPL, KCBOT, KCTOP, KTYPE, LDCUM, LDLAND, PAP, PAPH, PDX, PGAW, PGEO, PGEOH, &
    !$ACC&         PLU, PMFD, PMFU, PQEN, PQSEN, PQU, PTEN, PTENQA, PTENTA, PTU, PUEN, PVEN, PWMEAN, &
    !$ACC&         YFXTRAN_ACDC_STACK, ZCAPDCYCL, ZCAPDCYCLLD, ZCAPDCYCLSE, ZCAPE, &
    !$ACC&         ZCAPE2, ZCAPPBL, ZDQCV, ZDX, ZHEAT, ZKHVFL, ZMFUB, ZMFUB1, ZQENH, ZQENH2, &
    !$ACC&         ZSATFR, ZTAU, ZTAUPBL, ZTENH, ZTENH2, ZXTAU) &
    !$ACC&PRIVATE (JBLK) &
    !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
    
    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    
    
    
    !$ACC LOOP VECTOR &
    !$ACC&PRIVATE (IK, IKB, IKD, JK, JLON, LLO1, LLO3, YLCPG_BNDS, ZDUTEN, ZDZ, ZIND, ZTAURES) 

    

    DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JLON
      YLCPG_BNDS%KFDIA = JLON
      
      
      ZHEAT (JLON, JBLK)=0.0_JPRB
      ZCAPE (JLON, JBLK)=0.0_JPRB
      ZCAPE2 (JLON, JBLK)=0.0_JPRB
      ZMFUB1 (JLON, JBLK)=ZMFUB (JLON, JBLK)
      ZDQCV (JLON, JBLK)=0.0_JPRB
      ZSATFR (JLON, JBLK)=0.0_JPRB
      ZDX (JLON, JBLK)=2*YDCST%RA*SQRT (YDCST%RPI*PGAW (JLON, JBLK))
      ZDX (JLON, JBLK)=MAX (ZDX (JLON, JBLK), 1.E2_JPRB)

      

      DO JK=YDML_PHY_EC%YRECUMF%NJKT2, KLEV
        
        LLO1=LDCUM (JLON, JBLK).AND.KTYPE (JLON, JBLK)==1
        LLO3=LLO1.AND.JK<=KCBOT (JLON, JBLK).AND.JK>KCTOP (JLON, JBLK)

        IF (LLO3) THEN
          ZDZ=(PGEO (JLON, JK-1, JBLK)-PGEO (JLON, JK, JBLK))

          IF (LDTDKMF) THEN
            ZHEAT (JLON, JBLK)=ZHEAT (JLON, JBLK)+((PTEN (JLON, JK-1, JBLK)-PTEN (JLON, JK, JBLK&
            &)+ZDZ*ZORCPD)/ZTENH (JLON, JK, JBLK)+YDCST%RETV*(PQEN (JLON, JK-1, JBLK)-PQEN (JLON&
            &, JK, JBLK)))*(YDCST%RG*(PMFU (JLON, JK, JBLK)+PMFD (JLON, JK, JBLK)))
          ELSE
            ZHEAT (JLON, JBLK)=ZHEAT (JLON, JBLK)+MAX (0.0_JPRB,((PTEN (JLON, JK-1, JBLK)-PTEN (JLON&
            &, JK, JBLK)+ZDZ*ZORCPD)/ZTENH (JLON, JK, JBLK)+YDCST%RETV*(PQEN (JLON, JK-1, JBLK)-PQEN&
            & (JLON, JK, JBLK)))*(YDCST%RG*(PMFU (JLON, JK, JBLK)+PMFD (JLON, JK, JBLK))))
          ENDIF

          ZDZ=(PAP (JLON, JK, JBLK)-PAP (JLON, JK-1, JBLK))
          ZCAPE (JLON, JBLK)=ZCAPE (JLON, JBLK)+((PTU (JLON, JK, JBLK)-ZTENH (JLON, JK, JBLK))/ZTENH (JLON,&
          & JK, JBLK)+YDCST%RETV*(PQU (JLON, JK, JBLK)-ZQENH (JLON, JK, JBLK))-PLU (JLON, JK, JBLK))*ZDZ
        ENDIF


        IF (LLO3.AND.YDML_PHY_EC%YRECUMF%RCAPQADV>0.0_JPRB) THEN
          ZTENH2 (JLON, JK, JBLK)=ZTENH (JLON, JK, JBLK)-0.5_JPRB*(PTENTA&
          & (JLON, JK, JBLK)+PTENTA (JLON, JK-1, JBLK))*PTSPHY
          ZQENH2 (JLON, JK, JBLK)=ZQENH (JLON, JK, JBLK)-0.5_JPRB*(PTENQA&
          & (JLON, JK, JBLK)+PTENQA (JLON, JK-1, JBLK))*PTSPHY
          ZCAPE2 (JLON, JBLK)=ZCAPE2 (JLON, JBLK)+((PTU (JLON, JK, JBLK)-ZTENH2 (JLON, JK, JBLK))/ZTENH2 (JLON&
          &, JK, JBLK)+YDCST%RETV*(PQU (JLON, JK, JBLK)-ZQENH2 (JLON, JK, JBLK))-PLU (JLON, JK, JBLK))*ZDZ
        ENDIF


        IF (LLO1) THEN
          ZDZ=(PAPH (JLON, JK+1, JBLK)-PAPH (JLON, JK, JBLK))
          ZDQCV (JLON, JBLK)=ZDQCV (JLON, JBLK)+PTENQA (JLON, JK, JBLK&
          &)*ZDZ*(PQEN (JLON, JK, JBLK)/PQSEN (JLON, JK, JBLK))
        ENDIF


        IF (LLO1.AND.JK>=KCTOP (JLON, JBLK)) THEN
          ZDZ=(PAPH (JLON, JK+1, JBLK)-PAPH (JLON, JK, JBLK))
          ZSATFR (JLON, JBLK)=ZSATFR (JLON, JBLK)+(PQEN (JLON, JK, JBLK)/PQSEN (JLON, JK, JBLK))*ZDZ
        ENDIF

      
      ENDDO

      
      ZCAPDCYCL (JLON, JBLK)=0.0_JPRB
      ZTAU (JLON, JBLK)=0.0_JPRB

      IF (LDTDKMF) THEN
        ZDX (JLON, JBLK)=PDX (JLON, JBLK)
        ZDX (JLON, JBLK)=MAX (ZDX (JLON, JBLK), 1.E2_JPRB)
      ENDIF


      IF (LDCUM (JLON, JBLK).AND.KTYPE (JLON, JBLK)==1) THEN

        IF (YDML_PHY_EC%YRECUMF%LNEWTAU) THEN
          ZTAURES=YDML_PHY_EC%YRECUMF%RTAULIM*(1._JPRB+YDML_PHY_EC%YRECUMF%RTAUFAC/&
          &((ZDX (JLON, JBLK)/1000._JPRB-YDML_PHY_EC%YRECUMF%RXMIN+1._JPRB)**2))
        ELSE
          ZTAURES=1.0_JPRB+1.60_JPRB*ZDX (JLON, JBLK)/125.E3_JPRB

          IF (ZDX (JLON, JBLK)<8.E3_JPRB) THEN
            ZTAURES=1.0_JPRB+(LOG (8.E3_JPRB/ZDX (JLON, JBLK)))**2
          ENDIF

        ENDIF


        IF (ZDX (JLON, JBLK)>125.E3_JPRB)  THEN
          ZTAURES=MIN (3.0_JPRB, ZTAURES)
        ENDIF

        IKD=IDPL (JLON, JBLK)
        IKB=KCBOT (JLON, JBLK)
        IK=KCTOP (JLON, JBLK)
        ZTAU (JLON, JBLK)=(PGEOH (JLON, IK, JBLK)-PGEOH (JLON, IKB, JBLK))/((2.0_JPRB+MIN&
        & (15.0_JPRB, PWMEAN (JLON, JBLK)))*YDCST%RG)*ZTAURES*YDML_PHY_EC%YRECUMF%RTAUA
        
        ZXTAU (JLON, JBLK)=ZTAU (JLON, JBLK)
        
        LLO1=PAPH (JLON, KLEV+1, JBLK)-PAPH (JLON, IKD, JBLK)<50.E2_JPRB

        IF (LLO1.AND.LDLAND (JLON, JBLK).AND.YDML_PHY_EC%YRECUMF%RCAPDCYCL==1.0_JPRB) THEN
          ZDZ=MIN (1.E4_JPRB, PGEOH (JLON, IKB, JBLK)-PGEOH (JLON, KLEV+1, JBLK))/YDCST%RG
          ZCAPDCYCL (JLON, JBLK)=ZXTAU (JLON, JBLK)*MAX (0.0_JPRB, ZKHVFL (JLON, JBLK))*YDCST%RCPD/ZDZ
        ENDIF


        IF (LLO1.AND.YDML_PHY_EC%YRECUMF%RCAPDCYCL==2.0_JPRB) THEN
          ZIND=MAX (0._JPRB, MIN (1._JPRB,(YDML_PHY_EC%YRECUMF%RDXMAX-ZDX (JLON&
          &, JBLK))/(YDML_PHY_EC%YRECUMF%RDXMAX-YDML_PHY_EC%YRECUMF%RDXMIN)))

          IF (LDLAND (JLON, JBLK))  THEN
            ZIND=1._JPRB
          ENDIF

          ZCAPDCYCLLD (JLON, JBLK)=ZCAPPBL (JLON, JBLK)*ZTAU (JLON, JBLK)/ZTAURES
          ZDUTEN=2.0_JPRB+SQRT (0.5*(PUEN (JLON, IKB, JBLK)**2+PVEN (JLON, IKB, JBLK)**2+PUEN (JLON,&
          & YDML_PHY_EC%YRECUMF%NJKT3, JBLK)**2+PVEN (JLON, YDML_PHY_EC%YRECUMF%NJKT3, JBLK)**2))
          ZTAUPBL (JLON, JBLK)=MIN (1.E4_JPRB, PGEOH (JLON, IKB, JBLK&
          &)-PGEOH (JLON, KLEV+1, JBLK))/(YDCST%RG*ZDUTEN)
          ZCAPDCYCLSE (JLON, JBLK)=ZCAPPBL (JLON, JBLK)*ZTAUPBL (JLON, JBLK)
          ZCAPDCYCL (JLON, JBLK)=ZIND*ZCAPDCYCLLD (JLON, JBLK)+(1._JPRB-ZIND)*ZCAPDCYCLSE (JLON, JBLK)
        ENDIF

        ZDQCV (JLON, JBLK)=ZDQCV (JLON, JBLK)*YDCST%RLVTT/PGEOH (JLON, IK, JBLK)*ZXTAU&
        & (JLON, JBLK)/MAX (1.25_JPRB, ZTAURES)*YDML_PHY_EC%YRECUMF%RCAPQADV
        ZSATFR (JLON, JBLK)=ZSATFR (JLON, JBLK)/(PAPH (JLON, KLEV+1, JBLK)-PAPH (JLON, IK, JBLK))
      ELSE
        ZTAU (JLON, JBLK)=0.0_JPRB
      ENDIF

    
    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:6:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:6:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  IDPL => NULL ()
  KCBOT => NULL ()
  KCTOP => NULL ()
  KTYPE => NULL ()
  LDCUM => NULL ()
  LDLAND => NULL ()
  PAP => NULL ()
  PAPH => NULL ()
  PDX => NULL ()
  PGAW => NULL ()
  PGEO => NULL ()
  PGEOH => NULL ()
  PLU => NULL ()
  PMFD => NULL ()
  PMFU => NULL ()
  PQEN => NULL ()
  PQSEN => NULL ()
  PQU => NULL ()
  PTEN => NULL ()
  PTENQA => NULL ()
  PTENTA => NULL ()
  PTU => NULL ()
  PUEN => NULL ()
  PVEN => NULL ()
  PWMEAN => NULL ()
  ZCAPDCYCL => NULL ()
  ZCAPDCYCLLD => NULL ()
  ZCAPDCYCLSE => NULL ()
  ZCAPE => NULL ()
  ZCAPE2 => NULL ()
  ZCAPPBL => NULL ()
  ZDQCV => NULL ()
  ZDX => NULL ()
  ZHEAT => NULL ()
  ZKHVFL => NULL ()
  ZMFUB => NULL ()
  ZMFUB1 => NULL ()
  ZQENH => NULL ()
  ZQENH2 => NULL ()
  ZSATFR => NULL ()
  ZTAU => NULL ()
  ZTAUPBL => NULL ()
  ZTENH => NULL ()
  ZTENH2 => NULL ()
  ZXTAU => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:6:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSE
    CALL ABOR1 ('CUMASTRN_PARALLEL: NOT METHOD WAS FOUND')
ENDIF

IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:6',1,ZHOOK_HANDLE_PARALLEL)
IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:7',0,ZHOOK_HANDLE_PARALLEL)

IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','CUMASTRN_PARALLEL:7')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:7:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  KCBOT => GET_HOST_DATA_RDONLY (YD_KCBOT)
  KTYPE => GET_HOST_DATA_RDONLY (YD_KTYPE)
  LDCUM => GET_HOST_DATA_RDONLY (YD_LDCUM)
  PAPH => GET_HOST_DATA_RDONLY (YD_PAPH)
  PCAPE => GET_HOST_DATA_RDWR (YD_PCAPE)
  PCUCONVCA => GET_HOST_DATA_RDONLY (YD_PCUCONVCA)
  PVERVEL => GET_HOST_DATA_RDONLY (YD_PVERVEL)
  ZCAPDCYCL => GET_HOST_DATA_RDWR (YL_ZCAPDCYCL)
  ZCAPE => GET_HOST_DATA_RDWR (YL_ZCAPE)
  ZCAPE2 => GET_HOST_DATA_RDWR (YL_ZCAPE2)
  ZDQCV => GET_HOST_DATA_RDONLY (YL_ZDQCV)
  ZFACCA => GET_HOST_DATA_RDWR (YL_ZFACCA)
  ZHEAT => GET_HOST_DATA_RDWR (YL_ZHEAT)
  ZMFUB => GET_HOST_DATA_RDONLY (YL_ZMFUB)
  ZMFUB1 => GET_HOST_DATA_RDWR (YL_ZMFUB1)
  ZSATFR => GET_HOST_DATA_RDONLY (YL_ZSATFR)
  ZXTAU => GET_HOST_DATA_RDWR (YL_ZXTAU)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:7:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:7:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
  !$OMP PARALLEL DO PRIVATE (IKB, JBLK, JLON, ZMFMAX) FIRSTPRIVATE (YLCPG_BNDS)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    CALL YLCPG_BNDS%UPDATE (JBLK)

    

    IF (YDML_PHY_EC%YRECUMF%LMFCUCA) THEN

      DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
        ZFACCA (JLON, JBLK)=MAX (0.3_JPRB, MIN (1.8_JPRB, PCUCONVCA (JLON, JBLK)))
      ENDDO

    ELSE
      ZFACCA (:, JBLK)=1.0_JPRB
    ENDIF


    DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA

      IF (LDCUM (JLON, JBLK).AND.KTYPE (JLON, JBLK)==1) THEN
        IKB=KCBOT (JLON, JBLK)
        ZCAPE2 (JLON, JBLK)=YDML_PHY_EC%YRECUMF%RCAPQADV*ZCAPE2 (JLON, JBLK&
        &)+(1.0_JPRB-YDML_PHY_EC%YRECUMF%RCAPQADV)*ZCAPE (JLON, JBLK)
        ZCAPDCYCL (JLON, JBLK)=MAX (ZCAPDCYCL (JLON, JBLK),-2*ZCAPE2 (JLON, JBLK))

        IF (ZSATFR (JLON, JBLK)<=0.94.OR.PVERVEL (JLON, YDML_PHY_EC%YRECUMF%NJKT5, JBLK)<-100._JPRB) THEN
          ZCAPE (JLON, JBLK)=MAX (YDML_PHY_EC%YRECUMF%RMINCAPE*ZCAPE (JLON, JBLK&
          &), ZCAPE2 (JLON, JBLK)-ZCAPDCYCL (JLON, JBLK)+ZDQCV (JLON, JBLK))
        ELSE
          ZCAPE (JLON, JBLK)=MAX (YDML_PHY_EC%YRECUMF%RMINCAPE*ZCAPE &
          &(JLON, JBLK), ZCAPE (JLON, JBLK)-ZCAPDCYCL (JLON, JBLK))
        ENDIF

        ZCAPE (JLON, JBLK)=MIN (ZCAPE (JLON, JBLK), 5000.0_JPRB)
        ZHEAT (JLON, JBLK)=MAX (1.E-4_JPRB, ZHEAT (JLON, JBLK))
        ZXTAU (JLON, JBLK)=MAX (3.6E3_JPRB/(5.0_JPRB*PPLRG*PPLDARE), MIN&
        & (3.0_JPRB*3.6E3_JPRB/(PPLRG*PPLDARE), ZXTAU (JLON, JBLK)))
        ZMFUB1 (JLON, JBLK)=(ZCAPE (JLON, JBLK)*ZMFUB (JLON, JBLK))/(ZHEAT (JLON, JBLK)*ZXTAU (JLON, JBLK))
        ZMFUB1 (JLON, JBLK)=MAX (ZMFUB1 (JLON, JBLK), 0.001_JPRB)*ZFACCA (JLON, JBLK)
        ZMFMAX=(PAPH (JLON, IKB, JBLK)-PAPH (JLON, IKB-1, JBLK))*ZCONS2
        ZMFUB1 (JLON, JBLK)=MIN (ZMFUB1 (JLON, JBLK), ZMFMAX)
      ENDIF

    ENDDO


    IF (LDMCAPEA) THEN

      DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
        PCAPE (JLON, JBLK)=YDCST%RG*ZCAPE (JLON, JBLK)
      ENDDO

    ENDIF

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:7:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:7:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  KCBOT => NULL ()
  KTYPE => NULL ()
  LDCUM => NULL ()
  PAPH => NULL ()
  PCAPE => NULL ()
  PCUCONVCA => NULL ()
  PVERVEL => NULL ()
  ZCAPDCYCL => NULL ()
  ZCAPE => NULL ()
  ZCAPE2 => NULL ()
  ZDQCV => NULL ()
  ZFACCA => NULL ()
  ZHEAT => NULL ()
  ZMFUB => NULL ()
  ZMFUB1 => NULL ()
  ZSATFR => NULL ()
  ZXTAU => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:7:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN','CUMASTRN_PARALLEL:7')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:7:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  KCBOT => GET_DEVICE_DATA_RDONLY (YD_KCBOT)
  KTYPE => GET_DEVICE_DATA_RDONLY (YD_KTYPE)
  LDCUM => GET_DEVICE_DATA_RDONLY (YD_LDCUM)
  PAPH => GET_DEVICE_DATA_RDONLY (YD_PAPH)
  PCAPE => GET_DEVICE_DATA_RDWR (YD_PCAPE)
  PCUCONVCA => GET_DEVICE_DATA_RDONLY (YD_PCUCONVCA)
  PVERVEL => GET_DEVICE_DATA_RDONLY (YD_PVERVEL)
  ZCAPDCYCL => GET_DEVICE_DATA_RDWR (YL_ZCAPDCYCL)
  ZCAPE => GET_DEVICE_DATA_RDWR (YL_ZCAPE)
  ZCAPE2 => GET_DEVICE_DATA_RDWR (YL_ZCAPE2)
  ZDQCV => GET_DEVICE_DATA_RDONLY (YL_ZDQCV)
  ZFACCA => GET_DEVICE_DATA_RDWR (YL_ZFACCA)
  ZHEAT => GET_DEVICE_DATA_RDWR (YL_ZHEAT)
  ZMFUB => GET_DEVICE_DATA_RDONLY (YL_ZMFUB)
  ZMFUB1 => GET_DEVICE_DATA_RDWR (YL_ZMFUB1)
  ZSATFR => GET_DEVICE_DATA_RDONLY (YL_ZSATFR)
  ZXTAU => GET_DEVICE_DATA_RDWR (YL_ZXTAU)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:7:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:7:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  
    !$ACC PARALLEL LOOP GANG &
    !$ACC&PRESENT (KCBOT, KTYPE, LDCUM, PAPH, PCAPE, PCUCONVCA, PVERVEL, YFXTRAN_ACDC_STACK, &
    !$ACC&         ZCAPDCYCL, ZCAPE, ZCAPE2, ZDQCV, ZFACCA, ZHEAT, ZMFUB, ZMFUB1, ZSATFR, &
    !$ACC&         ZXTAU) &
    !$ACC&PRIVATE (JBLK) &
    !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
    
    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    
    
    
    !$ACC LOOP VECTOR &
    !$ACC&PRIVATE (IKB, JLON, YLCPG_BNDS, ZMFMAX) 

    

    DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JLON
      YLCPG_BNDS%KFDIA = JLON

      

      IF (YDML_PHY_EC%YRECUMF%LMFCUCA) THEN
        
        ZFACCA (JLON, JBLK)=MAX (0.3_JPRB, MIN (1.8_JPRB, PCUCONVCA (JLON, JBLK)))
      
      ELSE
        ZFACCA (JLON, JBLK)=1.0_JPRB
      ENDIF


      

      IF (LDCUM (JLON, JBLK).AND.KTYPE (JLON, JBLK)==1) THEN
        IKB=KCBOT (JLON, JBLK)
        ZCAPE2 (JLON, JBLK)=YDML_PHY_EC%YRECUMF%RCAPQADV*ZCAPE2 (JLON, JBLK&
        &)+(1.0_JPRB-YDML_PHY_EC%YRECUMF%RCAPQADV)*ZCAPE (JLON, JBLK)
        ZCAPDCYCL (JLON, JBLK)=MAX (ZCAPDCYCL (JLON, JBLK),-2*ZCAPE2 (JLON, JBLK))

        IF (ZSATFR (JLON, JBLK)<=0.94.OR.PVERVEL (JLON, YDML_PHY_EC%YRECUMF%NJKT5, JBLK)<-100._JPRB) THEN
          ZCAPE (JLON, JBLK)=MAX (YDML_PHY_EC%YRECUMF%RMINCAPE*ZCAPE (JLON, JBLK&
          &), ZCAPE2 (JLON, JBLK)-ZCAPDCYCL (JLON, JBLK)+ZDQCV (JLON, JBLK))
        ELSE
          ZCAPE (JLON, JBLK)=MAX (YDML_PHY_EC%YRECUMF%RMINCAPE*ZCAPE &
          &(JLON, JBLK), ZCAPE (JLON, JBLK)-ZCAPDCYCL (JLON, JBLK))
        ENDIF

        ZCAPE (JLON, JBLK)=MIN (ZCAPE (JLON, JBLK), 5000.0_JPRB)
        ZHEAT (JLON, JBLK)=MAX (1.E-4_JPRB, ZHEAT (JLON, JBLK))
        ZXTAU (JLON, JBLK)=MAX (3.6E3_JPRB/(5.0_JPRB*PPLRG*PPLDARE), MIN&
        & (3.0_JPRB*3.6E3_JPRB/(PPLRG*PPLDARE), ZXTAU (JLON, JBLK)))
        ZMFUB1 (JLON, JBLK)=(ZCAPE (JLON, JBLK)*ZMFUB (JLON, JBLK))/(ZHEAT (JLON, JBLK)*ZXTAU (JLON, JBLK))
        ZMFUB1 (JLON, JBLK)=MAX (ZMFUB1 (JLON, JBLK), 0.001_JPRB)*ZFACCA (JLON, JBLK)
        ZMFMAX=(PAPH (JLON, IKB, JBLK)-PAPH (JLON, IKB-1, JBLK))*ZCONS2
        ZMFUB1 (JLON, JBLK)=MIN (ZMFUB1 (JLON, JBLK), ZMFMAX)
      ENDIF


      

      IF (LDMCAPEA) THEN
        
        PCAPE (JLON, JBLK)=YDCST%RG*ZCAPE (JLON, JBLK)
      
      ENDIF

    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:7:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:7:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  KCBOT => NULL ()
  KTYPE => NULL ()
  LDCUM => NULL ()
  PAPH => NULL ()
  PCAPE => NULL ()
  PCUCONVCA => NULL ()
  PVERVEL => NULL ()
  ZCAPDCYCL => NULL ()
  ZCAPE => NULL ()
  ZCAPE2 => NULL ()
  ZDQCV => NULL ()
  ZFACCA => NULL ()
  ZHEAT => NULL ()
  ZMFUB => NULL ()
  ZMFUB1 => NULL ()
  ZSATFR => NULL ()
  ZXTAU => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:7:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSE
    CALL ABOR1 ('CUMASTRN_PARALLEL: NOT METHOD WAS FOUND')
ENDIF

IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:7',1,ZHOOK_HANDLE_PARALLEL)
IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:8',0,ZHOOK_HANDLE_PARALLEL)

IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','CUMASTRN_PARALLEL:8')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:8:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  KCBOT => GET_HOST_DATA_RDONLY (YD_KCBOT)
  KTYPE => GET_HOST_DATA_RDONLY (YD_KTYPE)
  LDCUM => GET_HOST_DATA_RDONLY (YD_LDCUM)
  PAPH => GET_HOST_DATA_RDONLY (YD_PAPH)
  PGEOH => GET_HOST_DATA_RDONLY (YD_PGEOH)
  PLU => GET_HOST_DATA_RDONLY (YD_PLU)
  PMFD => GET_HOST_DATA_RDONLY (YD_PMFD)
  PQU => GET_HOST_DATA_RDONLY (YD_PQU)
  PTU => GET_HOST_DATA_RDONLY (YD_PTU)
  ZDHPBL => GET_HOST_DATA_RDONLY (YL_ZDHPBL)
  ZKHFL => GET_HOST_DATA_RDONLY (YL_ZKHFL)
  ZMFUB => GET_HOST_DATA_RDONLY (YL_ZMFUB)
  ZMFUB1 => GET_HOST_DATA_RDWR (YL_ZMFUB1)
  ZMF_SHAL => GET_HOST_DATA_RDONLY (YL_ZMF_SHAL)
  ZQD => GET_HOST_DATA_RDONLY (YL_ZQD)
  ZQENH => GET_HOST_DATA_RDONLY (YL_ZQENH)
  ZTD => GET_HOST_DATA_RDONLY (YL_ZTD)
  ZTENH => GET_HOST_DATA_RDONLY (YL_ZTENH)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:8:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:8:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
  !$OMP PARALLEL DO PRIVATE (IKB, JBLK, JLON, ZDH, ZDH2, ZEPS, ZMFMAX, ZQUMQE) FIRSTPRIVATE (YLCPG_BNDS)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    CALL YLCPG_BNDS%UPDATE (JBLK)

    

    DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA

      IF (LDCUM (JLON, JBLK).AND.KTYPE (JLON, JBLK)>=2) THEN
        IKB=KCBOT (JLON, JBLK)

        IF (PMFD (JLON, IKB, JBLK)<0.0_JPRB) THEN
          ZEPS=-PMFD (JLON, IKB, JBLK)/MAX (ZMFUB (JLON, JBLK), 1.E-10_JPRB)
        ELSE
          ZEPS=0.0_JPRB
        ENDIF

        ZMFMAX=(PAPH (JLON, IKB, JBLK)-PAPH (JLON, IKB-1, JBLK))*ZCONS2

        IF (KTYPE (JLON, JBLK)==2) THEN

          IF (ZDHPBL (JLON, JBLK)>0.0_JPRB) THEN
            ZQUMQE=PQU (JLON, IKB, JBLK)+PLU (JLON, IKB, JBLK)-ZEPS*ZQD &
            &(JLON, IKB, JBLK)-(1.0_JPRB-ZEPS)*ZQENH (JLON, IKB, JBLK)
            ZDH=YDCST%RCPD*(PTU (JLON, IKB, JBLK)-ZEPS*ZTD (JLON, IKB, JBLK)&
            &-(1.0_JPRB-ZEPS)*ZTENH (JLON, IKB, JBLK))+YDCST%RLVTT*ZQUMQE
            ZDH2=YDCST%RCPD*(PTU (JLON, IKB-1, JBLK)-ZEPS*ZTD (JLON, IKB-1, JBLK&
            &)-(1.0_JPRB-ZEPS)*ZTENH (JLON, IKB-1, JBLK))+YDCST%RLVTT*ZQUMQE
            ZDH=0.5_JPRB*(ZDH+ZDH2)
            ZDH=YDCST%RG*MAX (ZDH, 0.1_JPRB*YDCST%RCPD)
            ZMFUB1 (JLON, JBLK)=ZDHPBL (JLON, JBLK)/ZDH

            IF (.NOT.LDTDKMF) THEN

              IF (ZMFUB1 (JLON, JBLK)>0.9_JPRB*ZMFMAX/YDML_PHY_EC%YRECUMF&
                &%RMFCFL.AND.ZDH<0.5_JPRB*YDCST%RG*YDCST%RCPD) THEN
                ZDH=0.75_JPRB*YDCST%RCPD*YDCST%RG
                ZMFUB1 (JLON, JBLK)=ZDHPBL (JLON, JBLK)/ZDH
              ENDIF

            ENDIF

          ELSE
            ZMFUB1 (JLON, JBLK)=ZMFUB (JLON, JBLK)
          ENDIF


          IF (YDML_PHY_EC%YRECUMF%LMFWSTAR)  THEN
            ZMFUB1 (JLON, JBLK)=ZMF_SHAL (JLON, JBLK)
          ENDIF

          ZMFUB1 (JLON, JBLK)=MIN (ZMFUB1 (JLON, JBLK), ZMFMAX)
        ENDIF


        IF (KTYPE (JLON, JBLK)==3) THEN

          IF (LDTDKMF) THEN
            ZMFUB1 (JLON, JBLK)=MAX (ZMFUB (JLON, JBLK), ZKHFL (JLON&
            &, JBLK)/PGEOH (JLON, IKB, JBLK))*(1.0_JPRB+ZEPS)
          ELSE
            ZMFUB1 (JLON, JBLK)=MAX (ZMFUB (JLON, JBLK), 5*ZKHFL (JLON&
            &, JBLK)/PGEOH (JLON, IKB, JBLK))*(1.0_JPRB+ZEPS)
          ENDIF


          IF (PGEOH (JLON, IKB, JBLK)<1.5E3_JPRB) THEN
            ZMFUB1 (JLON, JBLK)=MIN (ZMFUB1 (JLON, JBLK), ZMFMAX/(1.05_JPRB*YDML_PHY_EC%YRECUMF%RMFCFL))
          ELSE
            ZMFUB1 (JLON, JBLK)=MIN (ZMFUB1 (JLON, JBLK), ZMFMAX)
          ENDIF

        ENDIF

      ENDIF

    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:8:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:8:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  KCBOT => NULL ()
  KTYPE => NULL ()
  LDCUM => NULL ()
  PAPH => NULL ()
  PGEOH => NULL ()
  PLU => NULL ()
  PMFD => NULL ()
  PQU => NULL ()
  PTU => NULL ()
  ZDHPBL => NULL ()
  ZKHFL => NULL ()
  ZMFUB => NULL ()
  ZMFUB1 => NULL ()
  ZMF_SHAL => NULL ()
  ZQD => NULL ()
  ZQENH => NULL ()
  ZTD => NULL ()
  ZTENH => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:8:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN','CUMASTRN_PARALLEL:8')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:8:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  KCBOT => GET_DEVICE_DATA_RDONLY (YD_KCBOT)
  KTYPE => GET_DEVICE_DATA_RDONLY (YD_KTYPE)
  LDCUM => GET_DEVICE_DATA_RDONLY (YD_LDCUM)
  PAPH => GET_DEVICE_DATA_RDONLY (YD_PAPH)
  PGEOH => GET_DEVICE_DATA_RDONLY (YD_PGEOH)
  PLU => GET_DEVICE_DATA_RDONLY (YD_PLU)
  PMFD => GET_DEVICE_DATA_RDONLY (YD_PMFD)
  PQU => GET_DEVICE_DATA_RDONLY (YD_PQU)
  PTU => GET_DEVICE_DATA_RDONLY (YD_PTU)
  ZDHPBL => GET_DEVICE_DATA_RDONLY (YL_ZDHPBL)
  ZKHFL => GET_DEVICE_DATA_RDONLY (YL_ZKHFL)
  ZMFUB => GET_DEVICE_DATA_RDONLY (YL_ZMFUB)
  ZMFUB1 => GET_DEVICE_DATA_RDWR (YL_ZMFUB1)
  ZMF_SHAL => GET_DEVICE_DATA_RDONLY (YL_ZMF_SHAL)
  ZQD => GET_DEVICE_DATA_RDONLY (YL_ZQD)
  ZQENH => GET_DEVICE_DATA_RDONLY (YL_ZQENH)
  ZTD => GET_DEVICE_DATA_RDONLY (YL_ZTD)
  ZTENH => GET_DEVICE_DATA_RDONLY (YL_ZTENH)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:8:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:8:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  
    !$ACC PARALLEL LOOP GANG &
    !$ACC&PRESENT (KCBOT, KTYPE, LDCUM, PAPH, PGEOH, PLU, PMFD, PQU, PTU, YFXTRAN_ACDC_STACK, &
    !$ACC&         ZDHPBL, ZKHFL, ZMFUB, ZMFUB1, ZMF_SHAL, ZQD, ZQENH, ZTD, ZTENH) &
    !$ACC&PRIVATE (JBLK) &
    !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
    
    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    
    
    
    !$ACC LOOP VECTOR &
    !$ACC&PRIVATE (IKB, JLON, YLCPG_BNDS, ZDH, ZDH2, ZEPS, ZMFMAX, ZQUMQE) 

    

    DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JLON
      YLCPG_BNDS%KFDIA = JLON

      

      

      IF (LDCUM (JLON, JBLK).AND.KTYPE (JLON, JBLK)>=2) THEN
        IKB=KCBOT (JLON, JBLK)

        IF (PMFD (JLON, IKB, JBLK)<0.0_JPRB) THEN
          ZEPS=-PMFD (JLON, IKB, JBLK)/MAX (ZMFUB (JLON, JBLK), 1.E-10_JPRB)
        ELSE
          ZEPS=0.0_JPRB
        ENDIF

        ZMFMAX=(PAPH (JLON, IKB, JBLK)-PAPH (JLON, IKB-1, JBLK))*ZCONS2

        IF (KTYPE (JLON, JBLK)==2) THEN

          IF (ZDHPBL (JLON, JBLK)>0.0_JPRB) THEN
            ZQUMQE=PQU (JLON, IKB, JBLK)+PLU (JLON, IKB, JBLK)-ZEPS*ZQD &
            &(JLON, IKB, JBLK)-(1.0_JPRB-ZEPS)*ZQENH (JLON, IKB, JBLK)
            ZDH=YDCST%RCPD*(PTU (JLON, IKB, JBLK)-ZEPS*ZTD (JLON, IKB, JBLK)&
            &-(1.0_JPRB-ZEPS)*ZTENH (JLON, IKB, JBLK))+YDCST%RLVTT*ZQUMQE
            ZDH2=YDCST%RCPD*(PTU (JLON, IKB-1, JBLK)-ZEPS*ZTD (JLON, IKB-1, JBLK&
            &)-(1.0_JPRB-ZEPS)*ZTENH (JLON, IKB-1, JBLK))+YDCST%RLVTT*ZQUMQE
            ZDH=0.5_JPRB*(ZDH+ZDH2)
            ZDH=YDCST%RG*MAX (ZDH, 0.1_JPRB*YDCST%RCPD)
            ZMFUB1 (JLON, JBLK)=ZDHPBL (JLON, JBLK)/ZDH

            IF (.NOT.LDTDKMF) THEN

              IF (ZMFUB1 (JLON, JBLK)>0.9_JPRB*ZMFMAX/YDML_PHY_EC%YRECUMF&
                &%RMFCFL.AND.ZDH<0.5_JPRB*YDCST%RG*YDCST%RCPD) THEN
                ZDH=0.75_JPRB*YDCST%RCPD*YDCST%RG
                ZMFUB1 (JLON, JBLK)=ZDHPBL (JLON, JBLK)/ZDH
              ENDIF

            ENDIF

          ELSE
            ZMFUB1 (JLON, JBLK)=ZMFUB (JLON, JBLK)
          ENDIF


          IF (YDML_PHY_EC%YRECUMF%LMFWSTAR)  THEN
            ZMFUB1 (JLON, JBLK)=ZMF_SHAL (JLON, JBLK)
          ENDIF

          ZMFUB1 (JLON, JBLK)=MIN (ZMFUB1 (JLON, JBLK), ZMFMAX)
        ENDIF


        IF (KTYPE (JLON, JBLK)==3) THEN

          IF (LDTDKMF) THEN
            ZMFUB1 (JLON, JBLK)=MAX (ZMFUB (JLON, JBLK), ZKHFL (JLON&
            &, JBLK)/PGEOH (JLON, IKB, JBLK))*(1.0_JPRB+ZEPS)
          ELSE
            ZMFUB1 (JLON, JBLK)=MAX (ZMFUB (JLON, JBLK), 5*ZKHFL (JLON&
            &, JBLK)/PGEOH (JLON, IKB, JBLK))*(1.0_JPRB+ZEPS)
          ENDIF


          IF (PGEOH (JLON, IKB, JBLK)<1.5E3_JPRB) THEN
            ZMFUB1 (JLON, JBLK)=MIN (ZMFUB1 (JLON, JBLK), ZMFMAX/(1.05_JPRB*YDML_PHY_EC%YRECUMF%RMFCFL))
          ELSE
            ZMFUB1 (JLON, JBLK)=MIN (ZMFUB1 (JLON, JBLK), ZMFMAX)
          ENDIF

        ENDIF

      ENDIF

    
    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:8:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:8:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  KCBOT => NULL ()
  KTYPE => NULL ()
  LDCUM => NULL ()
  PAPH => NULL ()
  PGEOH => NULL ()
  PLU => NULL ()
  PMFD => NULL ()
  PQU => NULL ()
  PTU => NULL ()
  ZDHPBL => NULL ()
  ZKHFL => NULL ()
  ZMFUB => NULL ()
  ZMFUB1 => NULL ()
  ZMF_SHAL => NULL ()
  ZQD => NULL ()
  ZQENH => NULL ()
  ZTD => NULL ()
  ZTENH => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:8:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSE
    CALL ABOR1 ('CUMASTRN_PARALLEL: NOT METHOD WAS FOUND')
ENDIF

IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:8',1,ZHOOK_HANDLE_PARALLEL)
IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:9',0,ZHOOK_HANDLE_PARALLEL)

IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','CUMASTRN_PARALLEL:9')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:9:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  KCBOT => GET_HOST_DATA_RDONLY (YD_KCBOT)
  KCTOP => GET_HOST_DATA_RDONLY (YD_KCTOP)
  KTYPE => GET_HOST_DATA_RDONLY (YD_KTYPE)
  LDCUM => GET_HOST_DATA_RDONLY (YD_LDCUM)
  LLDDRAF => GET_HOST_DATA_RDONLY (YL_LLDDRAF)
  PAPH => GET_HOST_DATA_RDONLY (YD_PAPH)
  PMFD => GET_HOST_DATA_RDWR (YD_PMFD)
  PMFDDE_RATE => GET_HOST_DATA_RDWR (YD_PMFDDE_RATE)
  PMFU => GET_HOST_DATA_RDWR (YD_PMFU)
  ZDMFDP => GET_HOST_DATA_RDWR (YL_ZDMFDP)
  ZMFDQ => GET_HOST_DATA_RDWR (YL_ZMFDQ)
  ZMFDS => GET_HOST_DATA_RDWR (YL_ZMFDS)
  ZMFS => GET_HOST_DATA_RDWR (YL_ZMFS)
  ZMFUB => GET_HOST_DATA_RDONLY (YL_ZMFUB)
  ZMFUB1 => GET_HOST_DATA_RDONLY (YL_ZMFUB1)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:9:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:9:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
  !$OMP PARALLEL DO PRIVATE (IKB, JBLK, JK, JLON, ZDZ, ZFAC, ZMFMAX) FIRSTPRIVATE (YLCPG_BNDS)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    CALL YLCPG_BNDS%UPDATE (JBLK)

    

    DO JK=1, KLEV

      DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA

        IF (LLDDRAF (JLON, JBLK).AND.(KTYPE (JLON, JBLK)==1.OR.KTYPE (JLON, JBLK)==2)) THEN
          ZFAC=ZMFUB1 (JLON, JBLK)/MAX (ZMFUB (JLON, JBLK), 1.E-10_JPRB)
          PMFD (JLON, JK, JBLK)=PMFD (JLON, JK, JBLK)*ZFAC
          ZMFDS (JLON, JK, JBLK)=ZMFDS (JLON, JK, JBLK)*ZFAC
          ZMFDQ (JLON, JK, JBLK)=ZMFDQ (JLON, JK, JBLK)*ZFAC
          ZDMFDP (JLON, JK, JBLK)=ZDMFDP (JLON, JK, JBLK)*ZFAC
          PMFDDE_RATE (JLON, JK, JBLK)=PMFDDE_RATE (JLON, JK, JBLK)*ZFAC
        ENDIF

      ENDDO

    ENDDO


    DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA

      IF (LDCUM (JLON, JBLK)) THEN
        ZMFS (JLON, JBLK)=ZMFUB1 (JLON, JBLK)/MAX (YDML_PHY_EC%YRECUMF%RMFCMIN, ZMFUB (JLON, JBLK))
      ENDIF

    ENDDO


    DO JK=2, KLEV

      DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA

        IF (LDCUM (JLON, JBLK).AND.JK>=KCTOP (JLON, JBLK)-1) THEN
          IKB=KCBOT (JLON, JBLK)

          IF (JK>IKB) THEN
            ZDZ=((PAPH (JLON, KLEV+1, JBLK)-PAPH (JLON, JK, JBLK))/&
            &(PAPH (JLON, KLEV+1, JBLK)-PAPH (JLON, IKB, JBLK)))
            PMFU (JLON, JK, JBLK)=PMFU (JLON, IKB, JBLK)*ZDZ
          ENDIF

          ZMFMAX=(PAPH (JLON, JK, JBLK)-PAPH (JLON, JK-1, JBLK))*ZCONS2

          IF (.NOT.LDTDKMF)  THEN
            ZMFMAX=MIN (ZMFMAX, YDML_PHY_EC%YRECUMF%RMFLIA)
          ENDIF


          IF (PMFU (JLON, JK, JBLK)*ZMFS (JLON, JBLK)>ZMFMAX) THEN
            ZMFS (JLON, JBLK)=MIN (ZMFS (JLON, JBLK), ZMFMAX/PMFU (JLON, JK, JBLK))
            ZMFS (JLON, JBLK)=MAX (ZMFS (JLON, JBLK), 1.E-10_JPRB)
          ENDIF

        ENDIF

      ENDDO

    ENDDO


    IF (YDML_PHY_EC%YRECUMF%RMFADVW>0.0_JPRB) THEN

      DO JK=2, KLEV-1

        DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA

          IF (KTYPE (JLON, JBLK)==1.AND.JK>=KCTOP (JLON, JBLK)-1) THEN
            ZFAC=ZMFS (JLON, JBLK)*YDCST%RG*YDML_PHY_EC%YRECUMF%RMFADVW*(PMFU (JLON, JK, JBLK)&
            &-PMFU (JLON, JK+1, JBLK)+YDML_PHY_EC%YRECUMF%RMFADVWDD*(PMFD (JLON, JK, JBLK)-PMFD&
            & (JLON, JK+1, JBLK)))/(PAPH (JLON, JK, JBLK)-PAPH (JLON, JK+1, JBLK))*PTSPHY

            IF (ABS (ZFAC)>0.98_JPRB)  THEN
              ZMFS (JLON, JBLK)=ZMFS (JLON, JBLK)/MAX (1.02_JPRB, ABS (ZFAC))
            ENDIF

          ENDIF

        ENDDO

      ENDDO

      JK=KLEV

      DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA

        IF (KTYPE (JLON, JBLK)==1) THEN
          ZFAC=ZMFS (JLON, JBLK)*YDCST%RG*YDML_PHY_EC%YRECUMF%RMFADVW*(PMFU (JLON, JK, JBLK)+YDML_PHY_EC%YRECUMF&
          &%RMFADVWDD*PMFD (JLON, JK, JBLK))/(PAPH (JLON, JK, JBLK)-PAPH (JLON, JK+1, JBLK))*PTSPHY

          IF (ABS (ZFAC)>0.98_JPRB)  THEN
            ZMFS (JLON, JBLK)=ZMFS (JLON, JBLK)/MAX (1.02_JPRB, ABS (ZFAC))
          ENDIF

        ENDIF

      ENDDO

    ENDIF

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:9:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:9:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  KCBOT => NULL ()
  KCTOP => NULL ()
  KTYPE => NULL ()
  LDCUM => NULL ()
  LLDDRAF => NULL ()
  PAPH => NULL ()
  PMFD => NULL ()
  PMFDDE_RATE => NULL ()
  PMFU => NULL ()
  ZDMFDP => NULL ()
  ZMFDQ => NULL ()
  ZMFDS => NULL ()
  ZMFS => NULL ()
  ZMFUB => NULL ()
  ZMFUB1 => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:9:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN','CUMASTRN_PARALLEL:9')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:9:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  KCBOT => GET_DEVICE_DATA_RDONLY (YD_KCBOT)
  KCTOP => GET_DEVICE_DATA_RDONLY (YD_KCTOP)
  KTYPE => GET_DEVICE_DATA_RDONLY (YD_KTYPE)
  LDCUM => GET_DEVICE_DATA_RDONLY (YD_LDCUM)
  LLDDRAF => GET_DEVICE_DATA_RDONLY (YL_LLDDRAF)
  PAPH => GET_DEVICE_DATA_RDONLY (YD_PAPH)
  PMFD => GET_DEVICE_DATA_RDWR (YD_PMFD)
  PMFDDE_RATE => GET_DEVICE_DATA_RDWR (YD_PMFDDE_RATE)
  PMFU => GET_DEVICE_DATA_RDWR (YD_PMFU)
  ZDMFDP => GET_DEVICE_DATA_RDWR (YL_ZDMFDP)
  ZMFDQ => GET_DEVICE_DATA_RDWR (YL_ZMFDQ)
  ZMFDS => GET_DEVICE_DATA_RDWR (YL_ZMFDS)
  ZMFS => GET_DEVICE_DATA_RDWR (YL_ZMFS)
  ZMFUB => GET_DEVICE_DATA_RDONLY (YL_ZMFUB)
  ZMFUB1 => GET_DEVICE_DATA_RDONLY (YL_ZMFUB1)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:9:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:9:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  
    !$ACC PARALLEL LOOP GANG &
    !$ACC&PRESENT (KCBOT, KCTOP, KTYPE, LDCUM, LLDDRAF, PAPH, PMFD, PMFDDE_RATE, PMFU, YFXTRAN_ACDC_STACK, &
    !$ACC&         ZDMFDP, ZMFDQ, ZMFDS, ZMFS, ZMFUB, ZMFUB1) &
    !$ACC&PRIVATE (JBLK) &
    !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
    
    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    
    
    
    !$ACC LOOP VECTOR &
    !$ACC&PRIVATE (IKB, JK, JLON, YLCPG_BNDS, ZDZ, ZFAC, ZMFMAX) 

    

    DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JLON
      YLCPG_BNDS%KFDIA = JLON

      

      DO JK=1, KLEV

        

        IF (LLDDRAF (JLON, JBLK).AND.(KTYPE (JLON, JBLK)==1.OR.KTYPE (JLON, JBLK)==2)) THEN
          ZFAC=ZMFUB1 (JLON, JBLK)/MAX (ZMFUB (JLON, JBLK), 1.E-10_JPRB)
          PMFD (JLON, JK, JBLK)=PMFD (JLON, JK, JBLK)*ZFAC
          ZMFDS (JLON, JK, JBLK)=ZMFDS (JLON, JK, JBLK)*ZFAC
          ZMFDQ (JLON, JK, JBLK)=ZMFDQ (JLON, JK, JBLK)*ZFAC
          ZDMFDP (JLON, JK, JBLK)=ZDMFDP (JLON, JK, JBLK)*ZFAC
          PMFDDE_RATE (JLON, JK, JBLK)=PMFDDE_RATE (JLON, JK, JBLK)*ZFAC
        ENDIF

      
      ENDDO


      

      IF (LDCUM (JLON, JBLK)) THEN
        ZMFS (JLON, JBLK)=ZMFUB1 (JLON, JBLK)/MAX (YDML_PHY_EC%YRECUMF%RMFCMIN, ZMFUB (JLON, JBLK))
      ENDIF


      

      DO JK=2, KLEV

        

        IF (LDCUM (JLON, JBLK).AND.JK>=KCTOP (JLON, JBLK)-1) THEN
          IKB=KCBOT (JLON, JBLK)

          IF (JK>IKB) THEN
            ZDZ=((PAPH (JLON, KLEV+1, JBLK)-PAPH (JLON, JK, JBLK))/&
            &(PAPH (JLON, KLEV+1, JBLK)-PAPH (JLON, IKB, JBLK)))
            PMFU (JLON, JK, JBLK)=PMFU (JLON, IKB, JBLK)*ZDZ
          ENDIF

          ZMFMAX=(PAPH (JLON, JK, JBLK)-PAPH (JLON, JK-1, JBLK))*ZCONS2

          IF (.NOT.LDTDKMF)  THEN
            ZMFMAX=MIN (ZMFMAX, YDML_PHY_EC%YRECUMF%RMFLIA)
          ENDIF


          IF (PMFU (JLON, JK, JBLK)*ZMFS (JLON, JBLK)>ZMFMAX) THEN
            ZMFS (JLON, JBLK)=MIN (ZMFS (JLON, JBLK), ZMFMAX/PMFU (JLON, JK, JBLK))
            ZMFS (JLON, JBLK)=MAX (ZMFS (JLON, JBLK), 1.E-10_JPRB)
          ENDIF

        ENDIF

      
      ENDDO


      IF (YDML_PHY_EC%YRECUMF%RMFADVW>0.0_JPRB) THEN

        DO JK=2, KLEV-1

          

          IF (KTYPE (JLON, JBLK)==1.AND.JK>=KCTOP (JLON, JBLK)-1) THEN
            ZFAC=ZMFS (JLON, JBLK)*YDCST%RG*YDML_PHY_EC%YRECUMF%RMFADVW*(PMFU (JLON, JK, JBLK)&
            &-PMFU (JLON, JK+1, JBLK)+YDML_PHY_EC%YRECUMF%RMFADVWDD*(PMFD (JLON, JK, JBLK)-PMFD&
            & (JLON, JK+1, JBLK)))/(PAPH (JLON, JK, JBLK)-PAPH (JLON, JK+1, JBLK))*PTSPHY

            IF (ABS (ZFAC)>0.98_JPRB)  THEN
              ZMFS (JLON, JBLK)=ZMFS (JLON, JBLK)/MAX (1.02_JPRB, ABS (ZFAC))
            ENDIF

          ENDIF

        
        ENDDO

        JK=KLEV

        

        IF (KTYPE (JLON, JBLK)==1) THEN
          ZFAC=ZMFS (JLON, JBLK)*YDCST%RG*YDML_PHY_EC%YRECUMF%RMFADVW*(PMFU (JLON, JK, JBLK)+YDML_PHY_EC%YRECUMF&
          &%RMFADVWDD*PMFD (JLON, JK, JBLK))/(PAPH (JLON, JK, JBLK)-PAPH (JLON, JK+1, JBLK))*PTSPHY

          IF (ABS (ZFAC)>0.98_JPRB)  THEN
            ZMFS (JLON, JBLK)=ZMFS (JLON, JBLK)/MAX (1.02_JPRB, ABS (ZFAC))
          ENDIF

        ENDIF

      
      ENDIF

    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:9:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:9:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  KCBOT => NULL ()
  KCTOP => NULL ()
  KTYPE => NULL ()
  LDCUM => NULL ()
  LLDDRAF => NULL ()
  PAPH => NULL ()
  PMFD => NULL ()
  PMFDDE_RATE => NULL ()
  PMFU => NULL ()
  ZDMFDP => NULL ()
  ZMFDQ => NULL ()
  ZMFDS => NULL ()
  ZMFS => NULL ()
  ZMFUB => NULL ()
  ZMFUB1 => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:9:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSE
    CALL ABOR1 ('CUMASTRN_PARALLEL: NOT METHOD WAS FOUND')
ENDIF

IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:9',1,ZHOOK_HANDLE_PARALLEL)
IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:10',0,ZHOOK_HANDLE_PARALLEL)

IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','CUMASTRN_PARALLEL:10')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:10:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  KCBOT => GET_HOST_DATA_RDONLY (YD_KCBOT)
  KCBOT_LIG => GET_HOST_DATA_RDWR (YD_KCBOT_LIG)
  KCTOP => GET_HOST_DATA_RDONLY (YD_KCTOP)
  KCTOP_LIG => GET_HOST_DATA_RDWR (YD_KCTOP_LIG)
  KTYPE => GET_HOST_DATA_RDWR (YD_KTYPE)
  LDCUM => GET_HOST_DATA_RDWR (YD_LDCUM)
  LDCUM_LIG => GET_HOST_DATA_RDWR (YD_LDCUM_LIG)
  LDSHCV => GET_HOST_DATA_RDONLY (YD_LDSHCV)
  LLO2 => GET_HOST_DATA_RDWR (YL_LLO2)
  PLUDE => GET_HOST_DATA_RDWR (YD_PLUDE)
  PLUDELI => GET_HOST_DATA_RDWR (YD_PLUDELI)
  PMFU => GET_HOST_DATA_RDWR (YD_PMFU)
  PMFUDE_RATE => GET_HOST_DATA_RDWR (YD_PMFUDE_RATE)
  ZDMFEN => GET_HOST_DATA_RDWR (YL_ZDMFEN)
  ZDMFUP => GET_HOST_DATA_RDWR (YL_ZDMFUP)
  ZMFS => GET_HOST_DATA_RDONLY (YL_ZMFS)
  ZMFUL => GET_HOST_DATA_RDWR (YL_ZMFUL)
  ZMFUQ => GET_HOST_DATA_RDWR (YL_ZMFUQ)
  ZMFUS => GET_HOST_DATA_RDWR (YL_ZMFUS)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:10:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:10:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
  !$OMP PARALLEL DO PRIVATE (JBLK, JK, JLON) FIRSTPRIVATE (YLCPG_BNDS)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    CALL YLCPG_BNDS%UPDATE (JBLK)

    

    DO JK=2, KLEV

      DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA

        IF (LDCUM (JLON, JBLK).AND.JK<=KCBOT (JLON, JBLK).AND.JK>=KCTOP (JLON, JBLK)-1) THEN
          PMFU (JLON, JK, JBLK)=PMFU (JLON, JK, JBLK)*ZMFS (JLON, JBLK)
          ZMFUS (JLON, JK, JBLK)=ZMFUS (JLON, JK, JBLK)*ZMFS (JLON, JBLK)
          ZMFUQ (JLON, JK, JBLK)=ZMFUQ (JLON, JK, JBLK)*ZMFS (JLON, JBLK)
          ZMFUL (JLON, JK, JBLK)=ZMFUL (JLON, JK, JBLK)*ZMFS (JLON, JBLK)
          ZDMFUP (JLON, JK, JBLK)=ZDMFUP (JLON, JK, JBLK)*ZMFS (JLON, JBLK)
          ZDMFEN (JLON, JK, JBLK)=ZDMFEN (JLON, JK, JBLK)*ZMFS (JLON, JBLK)
          PLUDE (JLON, JK, JBLK)=PLUDE (JLON, JK, JBLK)*ZMFS (JLON, JBLK)
          PLUDELI (JLON, JK, 1, JBLK)=PLUDELI (JLON, JK, 1, JBLK)*ZMFS (JLON, JBLK)
          PLUDELI (JLON, JK, 2, JBLK)=PLUDELI (JLON, JK, 2, JBLK)*ZMFS (JLON, JBLK)
          PMFUDE_RATE (JLON, JK, JBLK)=PMFUDE_RATE (JLON, JK, JBLK)*ZMFS (JLON, JBLK)
        ENDIF

      ENDDO

    ENDDO


    DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA

      IF (KTYPE (JLON, JBLK)==2.AND.KCBOT (JLON, JBLK)==KCTOP&
        & (JLON, JBLK).AND.KCBOT (JLON, JBLK)>=KLEV-1) THEN
        LDCUM (JLON, JBLK)=.FALSE.
        KTYPE (JLON, JBLK)=0
      ENDIF

    ENDDO


    DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
      LLO2 (JLON, JBLK)=.FALSE.

      IF ((.NOT.LDSHCV (JLON, JBLK).AND.KTYPE (JLON, JBLK)==2)) THEN
        LLO2 (JLON, JBLK)=.TRUE.
        LDCUM (JLON, JBLK)=.FALSE.
      ENDIF

    ENDDO


    DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
      LDCUM_LIG (JLON, JBLK)=LDCUM (JLON, JBLK)
      KCTOP_LIG (JLON, JBLK)=KCTOP (JLON, JBLK)
      KCBOT_LIG (JLON, JBLK)=KCBOT (JLON, JBLK)
    ENDDO


    IF (.NOT.YDML_PHY_EC%YRECUMF%LMFSCV.OR..NOT.YDML_PHY_EC%YRECUMF%LMFPEN) THEN

      DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA

        IF ((.NOT.YDML_PHY_EC%YRECUMF%LMFSCV.AND.KTYPE (JLON, JBLK)==2).OR.(&
          &.NOT.YDML_PHY_EC%YRECUMF%LMFPEN.AND.KTYPE (JLON, JBLK)==1)) THEN
          LLO2 (JLON, JBLK)=.TRUE.
          LDCUM (JLON, JBLK)=.FALSE.
        ENDIF

      ENDDO

    ENDIF

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:10:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:10:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  KCBOT => NULL ()
  KCBOT_LIG => NULL ()
  KCTOP => NULL ()
  KCTOP_LIG => NULL ()
  KTYPE => NULL ()
  LDCUM => NULL ()
  LDCUM_LIG => NULL ()
  LDSHCV => NULL ()
  LLO2 => NULL ()
  PLUDE => NULL ()
  PLUDELI => NULL ()
  PMFU => NULL ()
  PMFUDE_RATE => NULL ()
  ZDMFEN => NULL ()
  ZDMFUP => NULL ()
  ZMFS => NULL ()
  ZMFUL => NULL ()
  ZMFUQ => NULL ()
  ZMFUS => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:10:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN','CUMASTRN_PARALLEL:10')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:10:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  KCBOT => GET_DEVICE_DATA_RDONLY (YD_KCBOT)
  KCBOT_LIG => GET_DEVICE_DATA_RDWR (YD_KCBOT_LIG)
  KCTOP => GET_DEVICE_DATA_RDONLY (YD_KCTOP)
  KCTOP_LIG => GET_DEVICE_DATA_RDWR (YD_KCTOP_LIG)
  KTYPE => GET_DEVICE_DATA_RDWR (YD_KTYPE)
  LDCUM => GET_DEVICE_DATA_RDWR (YD_LDCUM)
  LDCUM_LIG => GET_DEVICE_DATA_RDWR (YD_LDCUM_LIG)
  LDSHCV => GET_DEVICE_DATA_RDONLY (YD_LDSHCV)
  LLO2 => GET_DEVICE_DATA_RDWR (YL_LLO2)
  PLUDE => GET_DEVICE_DATA_RDWR (YD_PLUDE)
  PLUDELI => GET_DEVICE_DATA_RDWR (YD_PLUDELI)
  PMFU => GET_DEVICE_DATA_RDWR (YD_PMFU)
  PMFUDE_RATE => GET_DEVICE_DATA_RDWR (YD_PMFUDE_RATE)
  ZDMFEN => GET_DEVICE_DATA_RDWR (YL_ZDMFEN)
  ZDMFUP => GET_DEVICE_DATA_RDWR (YL_ZDMFUP)
  ZMFS => GET_DEVICE_DATA_RDONLY (YL_ZMFS)
  ZMFUL => GET_DEVICE_DATA_RDWR (YL_ZMFUL)
  ZMFUQ => GET_DEVICE_DATA_RDWR (YL_ZMFUQ)
  ZMFUS => GET_DEVICE_DATA_RDWR (YL_ZMFUS)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:10:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:10:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  
    !$ACC PARALLEL LOOP GANG &
    !$ACC&PRESENT (KCBOT, KCBOT_LIG, KCTOP, KCTOP_LIG, KTYPE, LDCUM, LDCUM_LIG, LDSHCV, &
    !$ACC&         LLO2, PLUDE, PLUDELI, PMFU, PMFUDE_RATE, YFXTRAN_ACDC_STACK, ZDMFEN, &
    !$ACC&         ZDMFUP, ZMFS, ZMFUL, ZMFUQ, ZMFUS) &
    !$ACC&PRIVATE (JBLK) &
    !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
    
    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    
    
    
    !$ACC LOOP VECTOR &
    !$ACC&PRIVATE (JK, JLON, YLCPG_BNDS) 

    

    DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JLON
      YLCPG_BNDS%KFDIA = JLON

      

      DO JK=2, KLEV

        

        IF (LDCUM (JLON, JBLK).AND.JK<=KCBOT (JLON, JBLK).AND.JK>=KCTOP (JLON, JBLK)-1) THEN
          PMFU (JLON, JK, JBLK)=PMFU (JLON, JK, JBLK)*ZMFS (JLON, JBLK)
          ZMFUS (JLON, JK, JBLK)=ZMFUS (JLON, JK, JBLK)*ZMFS (JLON, JBLK)
          ZMFUQ (JLON, JK, JBLK)=ZMFUQ (JLON, JK, JBLK)*ZMFS (JLON, JBLK)
          ZMFUL (JLON, JK, JBLK)=ZMFUL (JLON, JK, JBLK)*ZMFS (JLON, JBLK)
          ZDMFUP (JLON, JK, JBLK)=ZDMFUP (JLON, JK, JBLK)*ZMFS (JLON, JBLK)
          ZDMFEN (JLON, JK, JBLK)=ZDMFEN (JLON, JK, JBLK)*ZMFS (JLON, JBLK)
          PLUDE (JLON, JK, JBLK)=PLUDE (JLON, JK, JBLK)*ZMFS (JLON, JBLK)
          PLUDELI (JLON, JK, 1, JBLK)=PLUDELI (JLON, JK, 1, JBLK)*ZMFS (JLON, JBLK)
          PLUDELI (JLON, JK, 2, JBLK)=PLUDELI (JLON, JK, 2, JBLK)*ZMFS (JLON, JBLK)
          PMFUDE_RATE (JLON, JK, JBLK)=PMFUDE_RATE (JLON, JK, JBLK)*ZMFS (JLON, JBLK)
        ENDIF

      
      ENDDO


      

      IF (KTYPE (JLON, JBLK)==2.AND.KCBOT (JLON, JBLK)==KCTOP&
        & (JLON, JBLK).AND.KCBOT (JLON, JBLK)>=KLEV-1) THEN
        LDCUM (JLON, JBLK)=.FALSE.
        KTYPE (JLON, JBLK)=0
      ENDIF

      
      
      LLO2 (JLON, JBLK)=.FALSE.

      IF ((.NOT.LDSHCV (JLON, JBLK).AND.KTYPE (JLON, JBLK)==2)) THEN
        LLO2 (JLON, JBLK)=.TRUE.
        LDCUM (JLON, JBLK)=.FALSE.
      ENDIF

      
      
      LDCUM_LIG (JLON, JBLK)=LDCUM (JLON, JBLK)
      KCTOP_LIG (JLON, JBLK)=KCTOP (JLON, JBLK)
      KCBOT_LIG (JLON, JBLK)=KCBOT (JLON, JBLK)

      

      IF (.NOT.YDML_PHY_EC%YRECUMF%LMFSCV.OR..NOT.YDML_PHY_EC%YRECUMF%LMFPEN) THEN

        

        IF ((.NOT.YDML_PHY_EC%YRECUMF%LMFSCV.AND.KTYPE (JLON, JBLK)==2).OR.(&
          &.NOT.YDML_PHY_EC%YRECUMF%LMFPEN.AND.KTYPE (JLON, JBLK)==1)) THEN
          LLO2 (JLON, JBLK)=.TRUE.
          LDCUM (JLON, JBLK)=.FALSE.
        ENDIF

      
      ENDIF

    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:10:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:10:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  KCBOT => NULL ()
  KCBOT_LIG => NULL ()
  KCTOP => NULL ()
  KCTOP_LIG => NULL ()
  KTYPE => NULL ()
  LDCUM => NULL ()
  LDCUM_LIG => NULL ()
  LDSHCV => NULL ()
  LLO2 => NULL ()
  PLUDE => NULL ()
  PLUDELI => NULL ()
  PMFU => NULL ()
  PMFUDE_RATE => NULL ()
  ZDMFEN => NULL ()
  ZDMFUP => NULL ()
  ZMFS => NULL ()
  ZMFUL => NULL ()
  ZMFUQ => NULL ()
  ZMFUS => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:10:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSE
    CALL ABOR1 ('CUMASTRN_PARALLEL: NOT METHOD WAS FOUND')
ENDIF

IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:10',1,ZHOOK_HANDLE_PARALLEL)
ITOPM2=2
IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:11',0,ZHOOK_HANDLE_PARALLEL)

IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','CUMASTRN_PARALLEL:11')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:11:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  IDTOP => GET_HOST_DATA_RDWR (YL_IDTOP)
  KCBOT => GET_HOST_DATA_RDONLY (YD_KCBOT)
  KCTOP => GET_HOST_DATA_RDONLY (YD_KCTOP)
  KTYPE => GET_HOST_DATA_RDWR (YD_KTYPE)
  LDCUM => GET_HOST_DATA_RDONLY (YD_LDCUM)
  LDLAND => GET_HOST_DATA_RDONLY (YD_LDLAND)
  LLDDRAF => GET_HOST_DATA_RDWR (YL_LLDDRAF)
  PAP => GET_HOST_DATA_RDONLY (YD_PAP)
  PAPH => GET_HOST_DATA_RDONLY (YD_PAPH)
  PGEOH => GET_HOST_DATA_RDONLY (YD_PGEOH)
  PLGLAC => GET_HOST_DATA_RDWR (YD_PLGLAC)
  PLRAIN => GET_HOST_DATA_RDONLY (YD_PLRAIN)
  PLUDE => GET_HOST_DATA_RDWR (YD_PLUDE)
  PLUDELI => GET_HOST_DATA_RDWR (YD_PLUDELI)
  PMFD => GET_HOST_DATA_RDWR (YD_PMFD)
  PMFDDE_RATE => GET_HOST_DATA_RDWR (YD_PMFDDE_RATE)
  PMFLXR => GET_HOST_DATA_RDWR (YD_PMFLXR)
  PMFLXS => GET_HOST_DATA_RDWR (YD_PMFLXS)
  PMFU => GET_HOST_DATA_RDWR (YD_PMFU)
  PMFUDE_RATE => GET_HOST_DATA_RDONLY (YD_PMFUDE_RATE)
  PQEN => GET_HOST_DATA_RDONLY (YD_PQEN)
  PQSEN => GET_HOST_DATA_RDWR (YD_PQSEN)
  PRAIN => GET_HOST_DATA_RDWR (YD_PRAIN)
  PSNDE => GET_HOST_DATA_RDWR (YD_PSNDE)
  PTEN => GET_HOST_DATA_RDONLY (YD_PTEN)
  ZDMFDP => GET_HOST_DATA_RDWR (YL_ZDMFDP)
  ZDMFUP => GET_HOST_DATA_RDWR (YL_ZDMFUP)
  ZDPMEL => GET_HOST_DATA_RDWR (YL_ZDPMEL)
  ZMFDQ => GET_HOST_DATA_RDWR (YL_ZMFDQ)
  ZMFDS => GET_HOST_DATA_RDWR (YL_ZMFDS)
  ZMFUL => GET_HOST_DATA_RDWR (YL_ZMFUL)
  ZMFUQ => GET_HOST_DATA_RDWR (YL_ZMFUQ)
  ZMFUS => GET_HOST_DATA_RDWR (YL_ZMFUS)
  ZQENH => GET_HOST_DATA_RDONLY (YL_ZQENH)
  ZTENH => GET_HOST_DATA_RDONLY (YL_ZTENH)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:11:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:11:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
  !$OMP PARALLEL DO PRIVATE (JBLK, JK, JLON) FIRSTPRIVATE (YLCPG_BNDS)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    CALL YLCPG_BNDS%UPDATE (JBLK)

    

    DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA

      IF (LLDDRAF (JLON, JBLK).AND.IDTOP (JLON, JBLK)<=KCTOP (JLON, JBLK)) THEN
        IDTOP (JLON, JBLK)=KCTOP (JLON, JBLK)+1
      ENDIF

    ENDDO


    DO JK=2, KLEV

      DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA

        IF (LLDDRAF (JLON, JBLK)) THEN

          IF (JK<IDTOP (JLON, JBLK)) THEN
            PMFD (JLON, JK, JBLK)=0.0_JPRB
            ZMFDS (JLON, JK, JBLK)=0.0_JPRB
            ZMFDQ (JLON, JK, JBLK)=0.0_JPRB
            PMFDDE_RATE (JLON, JK, JBLK)=0.0_JPRB
            ZDMFDP (JLON, JK, JBLK)=0.0_JPRB
          ELSEIF (JK==IDTOP (JLON, JBLK)) THEN
            PMFDDE_RATE (JLON, JK, JBLK)=0.0_JPRB
          ENDIF

        ENDIF

      ENDDO

    ENDDO

    CALL CUFLXN (YDTHF, YDCST, YDML_PHY_SLIN%YREPHLI, YDML_PHY_EC%YRECUMF, YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA&
    &, YDCPG_OPTS%KLON, KLEV, PTSPHY, PTEN(:,:, JBLK), PQEN(:,:, JBLK), PQSEN(:,:, JBLK), ZTENH(:,:, JBLK&
    &), ZQENH(:,:, JBLK), PAPH(:,:, JBLK), PAP(:,:, JBLK), PGEOH(:,:, JBLK), LDLAND(:, JBLK), LDCUM(:, JBLK&
    &), LDTDKMF, KCBOT(:, JBLK), KCTOP(:, JBLK), IDTOP(:, JBLK), ITOPM2, KTYPE(:, JBLK), LLDDRAF(:, JBLK&
    &), PMFU(:,:, JBLK), PMFD(:,:, JBLK), ZMFUS(:,:, JBLK), ZMFDS(:,:, JBLK), ZMFUQ(:,:, JBLK), ZMFDQ(:,&
    &:, JBLK), ZMFUL(:,:, JBLK), PLUDE(:,:, JBLK), PLUDELI(:,:,:, JBLK), PLRAIN(:,:, JBLK), PSNDE(:,:,:,&
    & JBLK), ZDMFUP(:,:, JBLK), ZDMFDP(:,:, JBLK), ZDPMEL(:,:, JBLK), PLGLAC(:,:, JBLK), PMFLXR(:,:, JBLK&
    &), PMFLXS(:,:, JBLK), PRAIN(:, JBLK), PMFUDE_RATE(:,:, JBLK), PMFDDE_RATE(:,:, JBLK))
  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:11:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:11:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  IDTOP => NULL ()
  KCBOT => NULL ()
  KCTOP => NULL ()
  KTYPE => NULL ()
  LDCUM => NULL ()
  LDLAND => NULL ()
  LLDDRAF => NULL ()
  PAP => NULL ()
  PAPH => NULL ()
  PGEOH => NULL ()
  PLGLAC => NULL ()
  PLRAIN => NULL ()
  PLUDE => NULL ()
  PLUDELI => NULL ()
  PMFD => NULL ()
  PMFDDE_RATE => NULL ()
  PMFLXR => NULL ()
  PMFLXS => NULL ()
  PMFU => NULL ()
  PMFUDE_RATE => NULL ()
  PQEN => NULL ()
  PQSEN => NULL ()
  PRAIN => NULL ()
  PSNDE => NULL ()
  PTEN => NULL ()
  ZDMFDP => NULL ()
  ZDMFUP => NULL ()
  ZDPMEL => NULL ()
  ZMFDQ => NULL ()
  ZMFDS => NULL ()
  ZMFUL => NULL ()
  ZMFUQ => NULL ()
  ZMFUS => NULL ()
  ZQENH => NULL ()
  ZTENH => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:11:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN','CUMASTRN_PARALLEL:11')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:11:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  IDTOP => GET_DEVICE_DATA_RDWR (YL_IDTOP)
  KCBOT => GET_DEVICE_DATA_RDONLY (YD_KCBOT)
  KCTOP => GET_DEVICE_DATA_RDONLY (YD_KCTOP)
  KTYPE => GET_DEVICE_DATA_RDWR (YD_KTYPE)
  LDCUM => GET_DEVICE_DATA_RDONLY (YD_LDCUM)
  LDLAND => GET_DEVICE_DATA_RDONLY (YD_LDLAND)
  LLDDRAF => GET_DEVICE_DATA_RDWR (YL_LLDDRAF)
  PAP => GET_DEVICE_DATA_RDONLY (YD_PAP)
  PAPH => GET_DEVICE_DATA_RDONLY (YD_PAPH)
  PGEOH => GET_DEVICE_DATA_RDONLY (YD_PGEOH)
  PLGLAC => GET_DEVICE_DATA_RDWR (YD_PLGLAC)
  PLRAIN => GET_DEVICE_DATA_RDONLY (YD_PLRAIN)
  PLUDE => GET_DEVICE_DATA_RDWR (YD_PLUDE)
  PLUDELI => GET_DEVICE_DATA_RDWR (YD_PLUDELI)
  PMFD => GET_DEVICE_DATA_RDWR (YD_PMFD)
  PMFDDE_RATE => GET_DEVICE_DATA_RDWR (YD_PMFDDE_RATE)
  PMFLXR => GET_DEVICE_DATA_RDWR (YD_PMFLXR)
  PMFLXS => GET_DEVICE_DATA_RDWR (YD_PMFLXS)
  PMFU => GET_DEVICE_DATA_RDWR (YD_PMFU)
  PMFUDE_RATE => GET_DEVICE_DATA_RDONLY (YD_PMFUDE_RATE)
  PQEN => GET_DEVICE_DATA_RDONLY (YD_PQEN)
  PQSEN => GET_DEVICE_DATA_RDWR (YD_PQSEN)
  PRAIN => GET_DEVICE_DATA_RDWR (YD_PRAIN)
  PSNDE => GET_DEVICE_DATA_RDWR (YD_PSNDE)
  PTEN => GET_DEVICE_DATA_RDONLY (YD_PTEN)
  ZDMFDP => GET_DEVICE_DATA_RDWR (YL_ZDMFDP)
  ZDMFUP => GET_DEVICE_DATA_RDWR (YL_ZDMFUP)
  ZDPMEL => GET_DEVICE_DATA_RDWR (YL_ZDPMEL)
  ZMFDQ => GET_DEVICE_DATA_RDWR (YL_ZMFDQ)
  ZMFDS => GET_DEVICE_DATA_RDWR (YL_ZMFDS)
  ZMFUL => GET_DEVICE_DATA_RDWR (YL_ZMFUL)
  ZMFUQ => GET_DEVICE_DATA_RDWR (YL_ZMFUQ)
  ZMFUS => GET_DEVICE_DATA_RDWR (YL_ZMFUS)
  ZQENH => GET_DEVICE_DATA_RDONLY (YL_ZQENH)
  ZTENH => GET_DEVICE_DATA_RDONLY (YL_ZTENH)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:11:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:11:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  
    !$ACC PARALLEL LOOP GANG &
    !$ACC&PRESENT (IDTOP, KCBOT, KCTOP, KTYPE, LDCUM, LDLAND, LLDDRAF, PAP, PAPH, PGEOH, PLGLAC, &
    !$ACC&         PLRAIN, PLUDE, PLUDELI, PMFD, PMFDDE_RATE, PMFLXR, PMFLXS, PMFU, PMFUDE_RATE, &
    !$ACC&         PQEN, PQSEN, PRAIN, PSNDE, PTEN, YFXTRAN_ACDC_STACK, ZDMFDP, ZDMFUP, &
    !$ACC&         ZDPMEL, ZMFDQ, ZMFDS, ZMFUL, ZMFUQ, ZMFUS, ZQENH, ZTENH) &
    !$ACC&PRIVATE (JBLK) &
    !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
    
    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    
    
    
    !$ACC LOOP VECTOR &
    !$ACC&PRIVATE (JK, JLON, YLCPG_BNDS, YLSTACK) 

    

    DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JLON
      YLCPG_BNDS%KFDIA = JLON
      YLSTACK%L8 = fxtran_acdc_stack_l8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%U8 = fxtran_acdc_stack_u8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%L4 = fxtran_acdc_stack_l4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%U4 = fxtran_acdc_stack_u4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)

      

      

      IF (LLDDRAF (JLON, JBLK).AND.IDTOP (JLON, JBLK)<=KCTOP (JLON, JBLK)) THEN
        IDTOP (JLON, JBLK)=KCTOP (JLON, JBLK)+1
      ENDIF


      

      DO JK=2, KLEV

        

        IF (LLDDRAF (JLON, JBLK)) THEN

          IF (JK<IDTOP (JLON, JBLK)) THEN
            PMFD (JLON, JK, JBLK)=0.0_JPRB
            ZMFDS (JLON, JK, JBLK)=0.0_JPRB
            ZMFDQ (JLON, JK, JBLK)=0.0_JPRB
            PMFDDE_RATE (JLON, JK, JBLK)=0.0_JPRB
            ZDMFDP (JLON, JK, JBLK)=0.0_JPRB
          ELSEIF (JK==IDTOP (JLON, JBLK)) THEN
            PMFDDE_RATE (JLON, JK, JBLK)=0.0_JPRB
          ENDIF

        ENDIF

      
      ENDDO

      CALL CUFLXN_OPENACC (YDTHF, YDCST, YDML_PHY_SLIN%YREPHLI, YDML_PHY_EC%YRECUMF, YLCPG_BNDS%KIDIA&
      &, YLCPG_BNDS%KFDIA, YDCPG_OPTS%KLON, KLEV, PTSPHY, PTEN(:,:, JBLK), PQEN(:,:, JBLK), PQSEN(&
      &:,:, JBLK), ZTENH(:,:, JBLK), ZQENH(:,:, JBLK), PAPH(:,:, JBLK), PAP(:,:, JBLK), PGEOH(:,:,&
      & JBLK), LDLAND(:, JBLK), LDCUM(:, JBLK), LDTDKMF, KCBOT(:, JBLK), KCTOP(:, JBLK), IDTOP(:, JBLK&
      &), ITOPM2, KTYPE(:, JBLK), LLDDRAF(:, JBLK), PMFU(:,:, JBLK), PMFD(:,:, JBLK), ZMFUS(:,:, JBLK&
      &), ZMFDS(:,:, JBLK), ZMFUQ(:,:, JBLK), ZMFDQ(:,:, JBLK), ZMFUL(:,:, JBLK), PLUDE(:,:, JBLK)&
      &, PLUDELI(:,:,:, JBLK), PLRAIN(:,:, JBLK), PSNDE(:,:,:, JBLK), ZDMFUP(:,:, JBLK), ZDMFDP(:,&
      &:, JBLK), ZDPMEL(:,:, JBLK), PLGLAC(:,:, JBLK), PMFLXR(:,:, JBLK), PMFLXS(:,:, JBLK), PRAIN&
      &(:, JBLK), PMFUDE_RATE(:,:, JBLK), PMFDDE_RATE(:,:, JBLK),YDSTACK=YLSTACK)
    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:11:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:11:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  IDTOP => NULL ()
  KCBOT => NULL ()
  KCTOP => NULL ()
  KTYPE => NULL ()
  LDCUM => NULL ()
  LDLAND => NULL ()
  LLDDRAF => NULL ()
  PAP => NULL ()
  PAPH => NULL ()
  PGEOH => NULL ()
  PLGLAC => NULL ()
  PLRAIN => NULL ()
  PLUDE => NULL ()
  PLUDELI => NULL ()
  PMFD => NULL ()
  PMFDDE_RATE => NULL ()
  PMFLXR => NULL ()
  PMFLXS => NULL ()
  PMFU => NULL ()
  PMFUDE_RATE => NULL ()
  PQEN => NULL ()
  PQSEN => NULL ()
  PRAIN => NULL ()
  PSNDE => NULL ()
  PTEN => NULL ()
  ZDMFDP => NULL ()
  ZDMFUP => NULL ()
  ZDPMEL => NULL ()
  ZMFDQ => NULL ()
  ZMFDS => NULL ()
  ZMFUL => NULL ()
  ZMFUQ => NULL ()
  ZMFUS => NULL ()
  ZQENH => NULL ()
  ZTENH => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:11:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSE
    CALL ABOR1 ('CUMASTRN_PARALLEL: NOT METHOD WAS FOUND')
ENDIF

IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:11',1,ZHOOK_HANDLE_PARALLEL)
IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:12',0,ZHOOK_HANDLE_PARALLEL)

IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','CUMASTRN_PARALLEL:12')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:12:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  IDTOP => GET_HOST_DATA_RDONLY (YL_IDTOP)
  KCBOT => GET_HOST_DATA_RDONLY (YD_KCBOT)
  KCTOP => GET_HOST_DATA_RDONLY (YD_KCTOP)
  LDCUM => GET_HOST_DATA_RDONLY (YD_LDCUM)
  LLDDRAF => GET_HOST_DATA_RDONLY (YL_LLDDRAF)
  PAPH => GET_HOST_DATA_RDONLY (YD_PAPH)
  PLUDE => GET_HOST_DATA_RDWR (YD_PLUDE)
  PLUDELI => GET_HOST_DATA_RDWR (YD_PLUDELI)
  PMFD => GET_HOST_DATA_RDWR (YD_PMFD)
  PMFDDE_RATE => GET_HOST_DATA_RDWR (YD_PMFDDE_RATE)
  PMFLXR => GET_HOST_DATA_RDONLY (YD_PMFLXR)
  PMFLXS => GET_HOST_DATA_RDONLY (YD_PMFLXS)
  PMFU => GET_HOST_DATA_RDONLY (YD_PMFU)
  PMFUDE_RATE => GET_HOST_DATA_RDWR (YD_PMFUDE_RATE)
  PQEN => GET_HOST_DATA_RDONLY (YD_PQEN)
  PSNDE => GET_HOST_DATA_RDONLY (YD_PSNDE)
  ZDMFDP => GET_HOST_DATA_RDWR (YL_ZDMFDP)
  ZDMFUP => GET_HOST_DATA_RDWR (YL_ZDMFUP)
  ZMFDQ => GET_HOST_DATA_RDWR (YL_ZMFDQ)
  ZMFUL => GET_HOST_DATA_RDONLY (YL_ZMFUL)
  ZMFUQ => GET_HOST_DATA_RDONLY (YL_ZMFUQ)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:12:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:12:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
  !$OMP PARALLEL DO PRIVATE (IK, JBLK, JK, JLON, ZDZ, ZERATE, ZFAC, ZMFA) FIRSTPRIVATE (YLCPG_BNDS)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    CALL YLCPG_BNDS%UPDATE (JBLK)

    

    DO JK=2, KLEV-1

      DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA

        IF (LLDDRAF (JLON, JBLK).AND.JK>=IDTOP (JLON, JBLK)-1) THEN
          ZERATE=-PMFD (JLON, JK, JBLK)+PMFD (JLON, JK-1, JBLK)+PMFDDE_RATE (JLON, JK, JBLK)

          IF (ZERATE<0.0_JPRB) THEN
            PMFDDE_RATE (JLON, JK, JBLK)=PMFDDE_RATE (JLON, JK, JBLK)-ZERATE
          ENDIF

        ENDIF


        IF (LDCUM (JLON, JBLK).AND.JK>=KCTOP (JLON, JBLK)-1) THEN
          ZERATE=PMFU (JLON, JK, JBLK)-PMFU (JLON, JK+1, JBLK)+PMFUDE_RATE (JLON, JK, JBLK)

          IF (ZERATE<0.0_JPRB) THEN
            PMFUDE_RATE (JLON, JK, JBLK)=PMFUDE_RATE (JLON, JK, JBLK)-ZERATE
          ENDIF

          ZDMFUP (JLON, JK, JBLK)=PMFLXR (JLON, JK+1, JBLK)+PMFLXS (JLON,&
          & JK+1, JBLK)-PMFLXR (JLON, JK, JBLK)-PMFLXS (JLON, JK, JBLK)
          ZDMFDP (JLON, JK, JBLK)=0.0_JPRB
        ENDIF

      ENDDO

    ENDDO


    DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA

      IF (LLDDRAF (JLON, JBLK)) THEN
        JK=IDTOP (JLON, JBLK)
        IK=MIN (JK+1, KLEV)

        IF (ZMFDQ (JLON, JK, JBLK)<0.3_JPRB*ZMFDQ (JLON, IK, JBLK)) THEN

          IF (YDML_PHY_EC%YRECUMF%RMFSOLTQ==0.0_JPRB) THEN
            ZMFDQ (JLON, JK, JBLK)=0.3_JPRB*ZMFDQ (JLON, IK, JBLK)
          ELSE
            PMFD (JLON, JK, JBLK)=0.3_JPRB*PMFD (JLON, IK, JBLK)
          ENDIF

        ENDIF

      ENDIF

    ENDDO


    DO JK=2, KLEV

      DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA

        IF (LDCUM (JLON, JBLK).AND.JK>=KCTOP (JLON, JBLK)-1.AND.JK<KCBOT (JLON, JBLK)) THEN
          ZDZ=PTSPHY*YDCST%RG/(PAPH (JLON, JK+1, JBLK)-PAPH (JLON, JK, JBLK))
          ZMFA=ZMFUQ (JLON, JK+1, JBLK)+ZMFDQ (JLON, JK+1, JBLK)-ZMFUQ (JLON, JK, JBLK&
          &)-ZMFDQ (JLON, JK, JBLK)+ZMFUL (JLON, JK+1, JBLK)-ZMFUL (JLON, JK, JBLK)+ZDMFUP&
          & (JLON, JK, JBLK)-PSNDE (JLON, JK, 1, JBLK)-PSNDE (JLON, JK, 2, JBLK)
          ZMFA=(ZMFA-PLUDE (JLON, JK, JBLK))*ZDZ

          IF (PQEN (JLON, JK, JBLK)+ZMFA<0.0_JPRB.AND.PLUDE (JLON, JK, JBLK)>0.0_JPRB) THEN
            ZFAC=MIN (-(PQEN (JLON, JK, JBLK)+ZMFA)/ZDZ, PLUDE (JLON, JK, JBLK))
            PLUDE (JLON, JK, JBLK)=PLUDE (JLON, JK, JBLK)+ZFAC
            PLUDELI (JLON, JK, 1, JBLK)=PLUDELI (JLON, JK, 1, JBLK)+ZFAC&
            &*PLUDELI (JLON, JK, 1, JBLK)/PLUDE (JLON, JK, JBLK)
            PLUDELI (JLON, JK, 2, JBLK)=PLUDELI (JLON, JK, 2, JBLK)+ZFAC&
            &*PLUDELI (JLON, JK, 2, JBLK)/PLUDE (JLON, JK, JBLK)
          ENDIF


          IF (PLUDE (JLON, JK, JBLK)<0.0_JPRB) THEN
            PLUDE (JLON, JK, JBLK)=0.0_JPRB
            PLUDELI (JLON, JK, 1, JBLK)=0.0_JPRB
            PLUDELI (JLON, JK, 2, JBLK)=0.0_JPRB
          ENDIF

        ENDIF


        IF (.NOT.LDCUM (JLON, JBLK)) THEN
          PMFUDE_RATE (JLON, JK, JBLK)=0.0_JPRB
        ENDIF


        IF (PMFD (JLON, JK-1, JBLK)==0.0_JPRB) THEN
          PMFDDE_RATE (JLON, JK, JBLK)=0.0_JPRB
        ENDIF

      ENDDO

    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:12:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:12:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  IDTOP => NULL ()
  KCBOT => NULL ()
  KCTOP => NULL ()
  LDCUM => NULL ()
  LLDDRAF => NULL ()
  PAPH => NULL ()
  PLUDE => NULL ()
  PLUDELI => NULL ()
  PMFD => NULL ()
  PMFDDE_RATE => NULL ()
  PMFLXR => NULL ()
  PMFLXS => NULL ()
  PMFU => NULL ()
  PMFUDE_RATE => NULL ()
  PQEN => NULL ()
  PSNDE => NULL ()
  ZDMFDP => NULL ()
  ZDMFUP => NULL ()
  ZMFDQ => NULL ()
  ZMFUL => NULL ()
  ZMFUQ => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:12:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN','CUMASTRN_PARALLEL:12')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:12:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  IDTOP => GET_DEVICE_DATA_RDONLY (YL_IDTOP)
  KCBOT => GET_DEVICE_DATA_RDONLY (YD_KCBOT)
  KCTOP => GET_DEVICE_DATA_RDONLY (YD_KCTOP)
  LDCUM => GET_DEVICE_DATA_RDONLY (YD_LDCUM)
  LLDDRAF => GET_DEVICE_DATA_RDONLY (YL_LLDDRAF)
  PAPH => GET_DEVICE_DATA_RDONLY (YD_PAPH)
  PLUDE => GET_DEVICE_DATA_RDWR (YD_PLUDE)
  PLUDELI => GET_DEVICE_DATA_RDWR (YD_PLUDELI)
  PMFD => GET_DEVICE_DATA_RDWR (YD_PMFD)
  PMFDDE_RATE => GET_DEVICE_DATA_RDWR (YD_PMFDDE_RATE)
  PMFLXR => GET_DEVICE_DATA_RDONLY (YD_PMFLXR)
  PMFLXS => GET_DEVICE_DATA_RDONLY (YD_PMFLXS)
  PMFU => GET_DEVICE_DATA_RDONLY (YD_PMFU)
  PMFUDE_RATE => GET_DEVICE_DATA_RDWR (YD_PMFUDE_RATE)
  PQEN => GET_DEVICE_DATA_RDONLY (YD_PQEN)
  PSNDE => GET_DEVICE_DATA_RDONLY (YD_PSNDE)
  ZDMFDP => GET_DEVICE_DATA_RDWR (YL_ZDMFDP)
  ZDMFUP => GET_DEVICE_DATA_RDWR (YL_ZDMFUP)
  ZMFDQ => GET_DEVICE_DATA_RDWR (YL_ZMFDQ)
  ZMFUL => GET_DEVICE_DATA_RDONLY (YL_ZMFUL)
  ZMFUQ => GET_DEVICE_DATA_RDONLY (YL_ZMFUQ)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:12:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:12:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  
    !$ACC PARALLEL LOOP GANG &
    !$ACC&PRESENT (IDTOP, KCBOT, KCTOP, LDCUM, LLDDRAF, PAPH, PLUDE, PLUDELI, PMFD, PMFDDE_RATE, &
    !$ACC&         PMFLXR, PMFLXS, PMFU, PMFUDE_RATE, PQEN, PSNDE, YFXTRAN_ACDC_STACK, &
    !$ACC&         ZDMFDP, ZDMFUP, ZMFDQ, ZMFUL, ZMFUQ) &
    !$ACC&PRIVATE (JBLK) &
    !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
    
    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    
    
    
    !$ACC LOOP VECTOR &
    !$ACC&PRIVATE (IK, JK, JLON, YLCPG_BNDS, ZDZ, ZERATE, ZFAC, ZMFA) 

    

    DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JLON
      YLCPG_BNDS%KFDIA = JLON

      

      DO JK=2, KLEV-1

        

        IF (LLDDRAF (JLON, JBLK).AND.JK>=IDTOP (JLON, JBLK)-1) THEN
          ZERATE=-PMFD (JLON, JK, JBLK)+PMFD (JLON, JK-1, JBLK)+PMFDDE_RATE (JLON, JK, JBLK)

          IF (ZERATE<0.0_JPRB) THEN
            PMFDDE_RATE (JLON, JK, JBLK)=PMFDDE_RATE (JLON, JK, JBLK)-ZERATE
          ENDIF

        ENDIF


        IF (LDCUM (JLON, JBLK).AND.JK>=KCTOP (JLON, JBLK)-1) THEN
          ZERATE=PMFU (JLON, JK, JBLK)-PMFU (JLON, JK+1, JBLK)+PMFUDE_RATE (JLON, JK, JBLK)

          IF (ZERATE<0.0_JPRB) THEN
            PMFUDE_RATE (JLON, JK, JBLK)=PMFUDE_RATE (JLON, JK, JBLK)-ZERATE
          ENDIF

          ZDMFUP (JLON, JK, JBLK)=PMFLXR (JLON, JK+1, JBLK)+PMFLXS (JLON,&
          & JK+1, JBLK)-PMFLXR (JLON, JK, JBLK)-PMFLXS (JLON, JK, JBLK)
          ZDMFDP (JLON, JK, JBLK)=0.0_JPRB
        ENDIF

      
      ENDDO


      

      IF (LLDDRAF (JLON, JBLK)) THEN
        JK=IDTOP (JLON, JBLK)
        IK=MIN (JK+1, KLEV)

        IF (ZMFDQ (JLON, JK, JBLK)<0.3_JPRB*ZMFDQ (JLON, IK, JBLK)) THEN

          IF (YDML_PHY_EC%YRECUMF%RMFSOLTQ==0.0_JPRB) THEN
            ZMFDQ (JLON, JK, JBLK)=0.3_JPRB*ZMFDQ (JLON, IK, JBLK)
          ELSE
            PMFD (JLON, JK, JBLK)=0.3_JPRB*PMFD (JLON, IK, JBLK)
          ENDIF

        ENDIF

      ENDIF


      

      DO JK=2, KLEV

        

        IF (LDCUM (JLON, JBLK).AND.JK>=KCTOP (JLON, JBLK)-1.AND.JK<KCBOT (JLON, JBLK)) THEN
          ZDZ=PTSPHY*YDCST%RG/(PAPH (JLON, JK+1, JBLK)-PAPH (JLON, JK, JBLK))
          ZMFA=ZMFUQ (JLON, JK+1, JBLK)+ZMFDQ (JLON, JK+1, JBLK)-ZMFUQ (JLON, JK, JBLK&
          &)-ZMFDQ (JLON, JK, JBLK)+ZMFUL (JLON, JK+1, JBLK)-ZMFUL (JLON, JK, JBLK)+ZDMFUP&
          & (JLON, JK, JBLK)-PSNDE (JLON, JK, 1, JBLK)-PSNDE (JLON, JK, 2, JBLK)
          ZMFA=(ZMFA-PLUDE (JLON, JK, JBLK))*ZDZ

          IF (PQEN (JLON, JK, JBLK)+ZMFA<0.0_JPRB.AND.PLUDE (JLON, JK, JBLK)>0.0_JPRB) THEN
            ZFAC=MIN (-(PQEN (JLON, JK, JBLK)+ZMFA)/ZDZ, PLUDE (JLON, JK, JBLK))
            PLUDE (JLON, JK, JBLK)=PLUDE (JLON, JK, JBLK)+ZFAC
            PLUDELI (JLON, JK, 1, JBLK)=PLUDELI (JLON, JK, 1, JBLK)+ZFAC&
            &*PLUDELI (JLON, JK, 1, JBLK)/PLUDE (JLON, JK, JBLK)
            PLUDELI (JLON, JK, 2, JBLK)=PLUDELI (JLON, JK, 2, JBLK)+ZFAC&
            &*PLUDELI (JLON, JK, 2, JBLK)/PLUDE (JLON, JK, JBLK)
          ENDIF


          IF (PLUDE (JLON, JK, JBLK)<0.0_JPRB) THEN
            PLUDE (JLON, JK, JBLK)=0.0_JPRB
            PLUDELI (JLON, JK, 1, JBLK)=0.0_JPRB
            PLUDELI (JLON, JK, 2, JBLK)=0.0_JPRB
          ENDIF

        ENDIF


        IF (.NOT.LDCUM (JLON, JBLK)) THEN
          PMFUDE_RATE (JLON, JK, JBLK)=0.0_JPRB
        ENDIF


        IF (PMFD (JLON, JK-1, JBLK)==0.0_JPRB) THEN
          PMFDDE_RATE (JLON, JK, JBLK)=0.0_JPRB
        ENDIF

      
      ENDDO

    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:12:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:12:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  IDTOP => NULL ()
  KCBOT => NULL ()
  KCTOP => NULL ()
  LDCUM => NULL ()
  LLDDRAF => NULL ()
  PAPH => NULL ()
  PLUDE => NULL ()
  PLUDELI => NULL ()
  PMFD => NULL ()
  PMFDDE_RATE => NULL ()
  PMFLXR => NULL ()
  PMFLXS => NULL ()
  PMFU => NULL ()
  PMFUDE_RATE => NULL ()
  PQEN => NULL ()
  PSNDE => NULL ()
  ZDMFDP => NULL ()
  ZDMFUP => NULL ()
  ZMFDQ => NULL ()
  ZMFUL => NULL ()
  ZMFUQ => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:12:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSE
    CALL ABOR1 ('CUMASTRN_PARALLEL: NOT METHOD WAS FOUND')
ENDIF

IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:12',1,ZHOOK_HANDLE_PARALLEL)
IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:13',0,ZHOOK_HANDLE_PARALLEL)

IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','CUMASTRN_PARALLEL:13')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:13:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  IDTOP => GET_HOST_DATA_RDONLY (YL_IDTOP)
  KCBOT => GET_HOST_DATA_RDONLY (YD_KCBOT)
  KCTOP => GET_HOST_DATA_RDONLY (YD_KCTOP)
  KTYPE => GET_HOST_DATA_RDONLY (YD_KTYPE)
  LDCUM => GET_HOST_DATA_RDWR (YD_LDCUM)
  LLDDRAF => GET_HOST_DATA_RDONLY (YL_LLDDRAF)
  LLSCVFLAG => GET_HOST_DATA_RDONLY (YL_LLSCVFLAG)
  PAP => GET_HOST_DATA_RDONLY (YD_PAP)
  PAPH => GET_HOST_DATA_RDONLY (YD_PAPH)
  PENTH => GET_HOST_DATA_RDWR (YD_PENTH)
  PGEO => GET_HOST_DATA_RDONLY (YD_PGEO)
  PGEOH => GET_HOST_DATA_RDONLY (YD_PGEOH)
  PLGLAC => GET_HOST_DATA_RDONLY (YD_PLGLAC)
  PLUDE => GET_HOST_DATA_RDWR (YD_PLUDE)
  PLUDELI => GET_HOST_DATA_RDWR (YD_PLUDELI)
  PMFD => GET_HOST_DATA_RDONLY (YD_PMFD)
  PMFLXR => GET_HOST_DATA_RDONLY (YD_PMFLXR)
  PMFLXS => GET_HOST_DATA_RDONLY (YD_PMFLXS)
  PMFU => GET_HOST_DATA_RDONLY (YD_PMFU)
  PQEN => GET_HOST_DATA_RDONLY (YD_PQEN)
  PQSEN => GET_HOST_DATA_RDONLY (YD_PQSEN)
  PQU => GET_HOST_DATA_RDWR (YD_PQU)
  PSNDE => GET_HOST_DATA_RDWR (YD_PSNDE)
  PTEN => GET_HOST_DATA_RDONLY (YD_PTEN)
  PTENQ => GET_HOST_DATA_RDWR (YD_PTENQ)
  PTENT => GET_HOST_DATA_RDWR (YD_PTENT)
  PTU => GET_HOST_DATA_RDWR (YD_PTU)
  ZDMFUP => GET_HOST_DATA_RDONLY (YL_ZDMFUP)
  ZDPMEL => GET_HOST_DATA_RDONLY (YL_ZDPMEL)
  ZMFDQ => GET_HOST_DATA_RDWR (YL_ZMFDQ)
  ZMFDS => GET_HOST_DATA_RDWR (YL_ZMFDS)
  ZMFUL => GET_HOST_DATA_RDONLY (YL_ZMFUL)
  ZMFUQ => GET_HOST_DATA_RDWR (YL_ZMFUQ)
  ZMFUS => GET_HOST_DATA_RDWR (YL_ZMFUS)
  ZQD => GET_HOST_DATA_RDWR (YL_ZQD)
  ZQENH => GET_HOST_DATA_RDONLY (YL_ZQENH)
  ZTD => GET_HOST_DATA_RDWR (YL_ZTD)
  ZTENH => GET_HOST_DATA_RDONLY (YL_ZTENH)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:13:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:13:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
  !$OMP PARALLEL DO PRIVATE (JBLK, JK, JLON, ZMFA) FIRSTPRIVATE (YLCPG_BNDS)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    CALL YLCPG_BNDS%UPDATE (JBLK)

    

    IF (YDML_PHY_EC%YRECUMF%RMFSOLTQ>0.0_JPRB) THEN

      DO JK=KLEV, 2,-1

        DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA

          IF (LDCUM (JLON, JBLK)) THEN

            IF (JK>KCBOT (JLON, JBLK)) THEN
              ZMFA=1.0_JPRB/MAX (1.E-15_JPRB, PMFU (JLON, JK, JBLK))
              PQU (JLON, JK, JBLK)=ZQENH (JLON, JK, JBLK)+ZMFUQ (JLON, JK, JBLK)*ZMFA
              PTU (JLON, JK, JBLK)=ZTENH (JLON, JK, JBLK)+ZMFUS (JLON, JK, JBLK)*ZMFA*ZORCPD
              ZMFUS (JLON, JK, JBLK)=PMFU (JLON, JK, JBLK)*(YDCST%RCPD&
              &*PTU (JLON, JK, JBLK)+PGEOH (JLON, JK, JBLK))
              ZMFUQ (JLON, JK, JBLK)=PMFU (JLON, JK, JBLK)*PQU (JLON, JK, JBLK)

              IF (LLDDRAF (JLON, JBLK)) THEN
                ZMFA=1.0_JPRB/MIN (-1.E-15_JPRB, PMFD (JLON, JK, JBLK))
                ZQD (JLON, JK, JBLK)=ZQENH (JLON, JK, JBLK)+ZMFDQ (JLON, JK, JBLK)*ZMFA
                ZTD (JLON, JK, JBLK)=ZTENH (JLON, JK, JBLK)+ZMFDS (JLON, JK, JBLK)*ZMFA*ZORCPD
                ZMFDQ (JLON, JK, JBLK)=PMFD (JLON, JK, JBLK)*ZQD (JLON, JK, JBLK)
                ZMFDS (JLON, JK, JBLK)=PMFD (JLON, JK, JBLK)*(YDCST%RCPD&
                &*ZTD (JLON, JK, JBLK)+PGEOH (JLON, JK, JBLK))
              ENDIF

            ELSEIF (JK<=KCBOT (JLON, JBLK).AND.JK>=KCTOP (JLON, JBLK)) THEN
              ZMFUS (JLON, JK, JBLK)=PMFU (JLON, JK, JBLK)*(YDCST%RCPD&
              &*PTU (JLON, JK, JBLK)+PGEOH (JLON, JK, JBLK))
              ZMFUQ (JLON, JK, JBLK)=PMFU (JLON, JK, JBLK)*PQU (JLON, JK, JBLK)
              ZMFDS (JLON, JK, JBLK)=PMFD (JLON, JK, JBLK)*(YDCST%RCPD&
              &*ZTD (JLON, JK, JBLK)+PGEOH (JLON, JK, JBLK))
              ZMFDQ (JLON, JK, JBLK)=PMFD (JLON, JK, JBLK)*ZQD (JLON, JK, JBLK)
            ENDIF

          ENDIF

        ENDDO

      ENDDO

    ENDIF

    CALL CUDTDQN (YDTHF, YDCST, YDML_PHY_SLIN%YREPHLI, YDML_PHY_SLIN%YRPHNC, YDML_PHY_EC%YRECUMF&
    &, YDML_PHY_EC%YREPHY, YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA, YDCPG_OPTS%KLON, KLEV, ITOPM2, KTYPE&
    &(:, JBLK), KCTOP(:, JBLK), KCBOT(:, JBLK), IDTOP(:, JBLK), LDTDKMF, LDCUM(:, JBLK), LLDDRAF&
    &(:, JBLK), LLSCVFLAG(:, JBLK), PTSPHY, PAPH(:,:, JBLK), PAP(:,:, JBLK), PGEOH(:,:, JBLK), PGEO&
    &(:,:, JBLK), PTEN(:,:, JBLK), ZTENH(:,:, JBLK), PQEN(:,:, JBLK), ZQENH(:,:, JBLK), PQSEN(:&
    &,:, JBLK), PLGLAC(:,:, JBLK), PLUDE(:,:, JBLK), PLUDELI(:,:,:, JBLK), PSNDE(:,:,:, JBLK), PMFU&
    &(:,:, JBLK), PMFD(:,:, JBLK), ZMFUS(:,:, JBLK), ZMFDS(:,:, JBLK), ZMFUQ(:,:, JBLK), ZMFDQ(&
    &:,:, JBLK), ZMFUL(:,:, JBLK), ZDMFUP(:,:, JBLK), ZDPMEL(:,:, JBLK), PMFLXR(:,:, JBLK), PMFLXS&
    &(:,:, JBLK), PTENT(:,:, JBLK), PTENQ(:,:, JBLK), PENTH(:,:, JBLK))
  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:13:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:13:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  IDTOP => NULL ()
  KCBOT => NULL ()
  KCTOP => NULL ()
  KTYPE => NULL ()
  LDCUM => NULL ()
  LLDDRAF => NULL ()
  LLSCVFLAG => NULL ()
  PAP => NULL ()
  PAPH => NULL ()
  PENTH => NULL ()
  PGEO => NULL ()
  PGEOH => NULL ()
  PLGLAC => NULL ()
  PLUDE => NULL ()
  PLUDELI => NULL ()
  PMFD => NULL ()
  PMFLXR => NULL ()
  PMFLXS => NULL ()
  PMFU => NULL ()
  PQEN => NULL ()
  PQSEN => NULL ()
  PQU => NULL ()
  PSNDE => NULL ()
  PTEN => NULL ()
  PTENQ => NULL ()
  PTENT => NULL ()
  PTU => NULL ()
  ZDMFUP => NULL ()
  ZDPMEL => NULL ()
  ZMFDQ => NULL ()
  ZMFDS => NULL ()
  ZMFUL => NULL ()
  ZMFUQ => NULL ()
  ZMFUS => NULL ()
  ZQD => NULL ()
  ZQENH => NULL ()
  ZTD => NULL ()
  ZTENH => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:13:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN','CUMASTRN_PARALLEL:13')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:13:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  IDTOP => GET_DEVICE_DATA_RDONLY (YL_IDTOP)
  KCBOT => GET_DEVICE_DATA_RDONLY (YD_KCBOT)
  KCTOP => GET_DEVICE_DATA_RDONLY (YD_KCTOP)
  KTYPE => GET_DEVICE_DATA_RDONLY (YD_KTYPE)
  LDCUM => GET_DEVICE_DATA_RDWR (YD_LDCUM)
  LLDDRAF => GET_DEVICE_DATA_RDONLY (YL_LLDDRAF)
  LLSCVFLAG => GET_DEVICE_DATA_RDONLY (YL_LLSCVFLAG)
  PAP => GET_DEVICE_DATA_RDONLY (YD_PAP)
  PAPH => GET_DEVICE_DATA_RDONLY (YD_PAPH)
  PENTH => GET_DEVICE_DATA_RDWR (YD_PENTH)
  PGEO => GET_DEVICE_DATA_RDONLY (YD_PGEO)
  PGEOH => GET_DEVICE_DATA_RDONLY (YD_PGEOH)
  PLGLAC => GET_DEVICE_DATA_RDONLY (YD_PLGLAC)
  PLUDE => GET_DEVICE_DATA_RDWR (YD_PLUDE)
  PLUDELI => GET_DEVICE_DATA_RDWR (YD_PLUDELI)
  PMFD => GET_DEVICE_DATA_RDONLY (YD_PMFD)
  PMFLXR => GET_DEVICE_DATA_RDONLY (YD_PMFLXR)
  PMFLXS => GET_DEVICE_DATA_RDONLY (YD_PMFLXS)
  PMFU => GET_DEVICE_DATA_RDONLY (YD_PMFU)
  PQEN => GET_DEVICE_DATA_RDONLY (YD_PQEN)
  PQSEN => GET_DEVICE_DATA_RDONLY (YD_PQSEN)
  PQU => GET_DEVICE_DATA_RDWR (YD_PQU)
  PSNDE => GET_DEVICE_DATA_RDWR (YD_PSNDE)
  PTEN => GET_DEVICE_DATA_RDONLY (YD_PTEN)
  PTENQ => GET_DEVICE_DATA_RDWR (YD_PTENQ)
  PTENT => GET_DEVICE_DATA_RDWR (YD_PTENT)
  PTU => GET_DEVICE_DATA_RDWR (YD_PTU)
  ZDMFUP => GET_DEVICE_DATA_RDONLY (YL_ZDMFUP)
  ZDPMEL => GET_DEVICE_DATA_RDONLY (YL_ZDPMEL)
  ZMFDQ => GET_DEVICE_DATA_RDWR (YL_ZMFDQ)
  ZMFDS => GET_DEVICE_DATA_RDWR (YL_ZMFDS)
  ZMFUL => GET_DEVICE_DATA_RDONLY (YL_ZMFUL)
  ZMFUQ => GET_DEVICE_DATA_RDWR (YL_ZMFUQ)
  ZMFUS => GET_DEVICE_DATA_RDWR (YL_ZMFUS)
  ZQD => GET_DEVICE_DATA_RDWR (YL_ZQD)
  ZQENH => GET_DEVICE_DATA_RDONLY (YL_ZQENH)
  ZTD => GET_DEVICE_DATA_RDWR (YL_ZTD)
  ZTENH => GET_DEVICE_DATA_RDONLY (YL_ZTENH)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:13:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:13:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  
    !$ACC PARALLEL LOOP GANG &
    !$ACC&PRESENT (IDTOP, KCBOT, KCTOP, KTYPE, LDCUM, LLDDRAF, LLSCVFLAG, PAP, PAPH, PENTH, &
    !$ACC&         PGEO, PGEOH, PLGLAC, PLUDE, PLUDELI, PMFD, PMFLXR, PMFLXS, PMFU, PQEN, &
    !$ACC&         PQSEN, PQU, PSNDE, PTEN, PTENQ, PTENT, PTU, YFXTRAN_ACDC_STACK, ZDMFUP, &
    !$ACC&         ZDPMEL, ZMFDQ, ZMFDS, ZMFUL, ZMFUQ, ZMFUS, ZQD, ZQENH, ZTD, ZTENH) &
    !$ACC&PRIVATE (JBLK) &
    !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
    
    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    
    
    
    !$ACC LOOP VECTOR &
    !$ACC&PRIVATE (JK, JLON, YLCPG_BNDS, YLSTACK, ZMFA) 

    

    DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JLON
      YLCPG_BNDS%KFDIA = JLON
      YLSTACK%L8 = fxtran_acdc_stack_l8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%U8 = fxtran_acdc_stack_u8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%L4 = fxtran_acdc_stack_l4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%U4 = fxtran_acdc_stack_u4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)

      

      IF (YDML_PHY_EC%YRECUMF%RMFSOLTQ>0.0_JPRB) THEN

        DO JK=KLEV, 2,-1

          

          IF (LDCUM (JLON, JBLK)) THEN

            IF (JK>KCBOT (JLON, JBLK)) THEN
              ZMFA=1.0_JPRB/MAX (1.E-15_JPRB, PMFU (JLON, JK, JBLK))
              PQU (JLON, JK, JBLK)=ZQENH (JLON, JK, JBLK)+ZMFUQ (JLON, JK, JBLK)*ZMFA
              PTU (JLON, JK, JBLK)=ZTENH (JLON, JK, JBLK)+ZMFUS (JLON, JK, JBLK)*ZMFA*ZORCPD
              ZMFUS (JLON, JK, JBLK)=PMFU (JLON, JK, JBLK)*(YDCST%RCPD&
              &*PTU (JLON, JK, JBLK)+PGEOH (JLON, JK, JBLK))
              ZMFUQ (JLON, JK, JBLK)=PMFU (JLON, JK, JBLK)*PQU (JLON, JK, JBLK)

              IF (LLDDRAF (JLON, JBLK)) THEN
                ZMFA=1.0_JPRB/MIN (-1.E-15_JPRB, PMFD (JLON, JK, JBLK))
                ZQD (JLON, JK, JBLK)=ZQENH (JLON, JK, JBLK)+ZMFDQ (JLON, JK, JBLK)*ZMFA
                ZTD (JLON, JK, JBLK)=ZTENH (JLON, JK, JBLK)+ZMFDS (JLON, JK, JBLK)*ZMFA*ZORCPD
                ZMFDQ (JLON, JK, JBLK)=PMFD (JLON, JK, JBLK)*ZQD (JLON, JK, JBLK)
                ZMFDS (JLON, JK, JBLK)=PMFD (JLON, JK, JBLK)*(YDCST%RCPD&
                &*ZTD (JLON, JK, JBLK)+PGEOH (JLON, JK, JBLK))
              ENDIF

            ELSEIF (JK<=KCBOT (JLON, JBLK).AND.JK>=KCTOP (JLON, JBLK)) THEN
              ZMFUS (JLON, JK, JBLK)=PMFU (JLON, JK, JBLK)*(YDCST%RCPD&
              &*PTU (JLON, JK, JBLK)+PGEOH (JLON, JK, JBLK))
              ZMFUQ (JLON, JK, JBLK)=PMFU (JLON, JK, JBLK)*PQU (JLON, JK, JBLK)
              ZMFDS (JLON, JK, JBLK)=PMFD (JLON, JK, JBLK)*(YDCST%RCPD&
              &*ZTD (JLON, JK, JBLK)+PGEOH (JLON, JK, JBLK))
              ZMFDQ (JLON, JK, JBLK)=PMFD (JLON, JK, JBLK)*ZQD (JLON, JK, JBLK)
            ENDIF

          ENDIF

        
        ENDDO

      ENDIF

      CALL CUDTDQN_OPENACC (YDTHF, YDCST, YDML_PHY_SLIN%YREPHLI, YDML_PHY_SLIN%YRPHNC, YDML_PHY_EC%YRECUMF&
      &, YDML_PHY_EC%YREPHY, YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA, YDCPG_OPTS%KLON, KLEV, ITOPM2, KTYPE&
      &(:, JBLK), KCTOP(:, JBLK), KCBOT(:, JBLK), IDTOP(:, JBLK), LDTDKMF, LDCUM(:, JBLK), LLDDRAF(:&
      &, JBLK), LLSCVFLAG(:, JBLK), PTSPHY, PAPH(:,:, JBLK), PAP(:,:, JBLK), PGEOH(:,:, JBLK), PGEO(&
      &:,:, JBLK), PTEN(:,:, JBLK), ZTENH(:,:, JBLK), PQEN(:,:, JBLK), ZQENH(:,:, JBLK), PQSEN(:,:, JBLK&
      &), PLGLAC(:,:, JBLK), PLUDE(:,:, JBLK), PLUDELI(:,:,:, JBLK), PSNDE(:,:,:, JBLK), PMFU(:,:, JBLK&
      &), PMFD(:,:, JBLK), ZMFUS(:,:, JBLK), ZMFDS(:,:, JBLK), ZMFUQ(:,:, JBLK), ZMFDQ(:,:, JBLK), ZMFUL&
      &(:,:, JBLK), ZDMFUP(:,:, JBLK), ZDPMEL(:,:, JBLK), PMFLXR(:,:, JBLK), PMFLXS(:,:, JBLK), PTENT&
      &(:,:, JBLK), PTENQ(:,:, JBLK), PENTH(:,:, JBLK),YDSTACK=YLSTACK)
    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:13:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:13:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  IDTOP => NULL ()
  KCBOT => NULL ()
  KCTOP => NULL ()
  KTYPE => NULL ()
  LDCUM => NULL ()
  LLDDRAF => NULL ()
  LLSCVFLAG => NULL ()
  PAP => NULL ()
  PAPH => NULL ()
  PENTH => NULL ()
  PGEO => NULL ()
  PGEOH => NULL ()
  PLGLAC => NULL ()
  PLUDE => NULL ()
  PLUDELI => NULL ()
  PMFD => NULL ()
  PMFLXR => NULL ()
  PMFLXS => NULL ()
  PMFU => NULL ()
  PQEN => NULL ()
  PQSEN => NULL ()
  PQU => NULL ()
  PSNDE => NULL ()
  PTEN => NULL ()
  PTENQ => NULL ()
  PTENT => NULL ()
  PTU => NULL ()
  ZDMFUP => NULL ()
  ZDPMEL => NULL ()
  ZMFDQ => NULL ()
  ZMFDS => NULL ()
  ZMFUL => NULL ()
  ZMFUQ => NULL ()
  ZMFUS => NULL ()
  ZQD => NULL ()
  ZQENH => NULL ()
  ZTD => NULL ()
  ZTENH => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:13:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSE
    CALL ABOR1 ('CUMASTRN_PARALLEL: NOT METHOD WAS FOUND')
ENDIF

IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:13',1,ZHOOK_HANDLE_PARALLEL)
IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:14',0,ZHOOK_HANDLE_PARALLEL)

IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','CUMASTRN_PARALLEL:14')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:14:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  IDPL => GET_HOST_DATA_RDONLY (YL_IDPL)
  IDTOP => GET_HOST_DATA_RDONLY (YL_IDTOP)
  KCBOT => GET_HOST_DATA_RDONLY (YD_KCBOT)
  KCTOP => GET_HOST_DATA_RDONLY (YD_KCTOP)
  KTYPE => GET_HOST_DATA_RDONLY (YD_KTYPE)
  LDCUM => GET_HOST_DATA_RDONLY (YD_LDCUM)
  PAP => GET_HOST_DATA_RDONLY (YD_PAP)
  PAPH => GET_HOST_DATA_RDONLY (YD_PAPH)
  PGP2DSPP => GET_HOST_DATA_RDONLY (YD_PGP2DSPP)
  PMFD => GET_HOST_DATA_RDONLY (YD_PMFD)
  PMFDDE_RATE => GET_HOST_DATA_RDONLY (YD_PMFDDE_RATE)
  PMFU => GET_HOST_DATA_RDONLY (YD_PMFU)
  PMFUDE_RATE => GET_HOST_DATA_RDONLY (YD_PMFUDE_RATE)
  PTENT => GET_HOST_DATA_RDWR (YD_PTENT)
  PTENU => GET_HOST_DATA_RDWR (YD_PTENU)
  PTENV => GET_HOST_DATA_RDWR (YD_PTENV)
  PUEN => GET_HOST_DATA_RDONLY (YD_PUEN)
  PVDISCU => GET_HOST_DATA_RDWR (YD_PVDISCU)
  PVEN => GET_HOST_DATA_RDONLY (YD_PVEN)
  ZMFDUS => GET_HOST_DATA_RDWR (YL_ZMFDUS)
  ZMFS => GET_HOST_DATA_RDWR (YL_ZMFS)
  ZMFUUB => GET_HOST_DATA_RDWR (YL_ZMFUUB)
  ZMFUUS => GET_HOST_DATA_RDWR (YL_ZMFUUS)
  ZMFUVB => GET_HOST_DATA_RDWR (YL_ZMFUVB)
  ZSUM12 => GET_HOST_DATA_RDWR (YL_ZSUM12)
  ZSUM22 => GET_HOST_DATA_RDWR (YL_ZSUM22)
  ZTENU => GET_HOST_DATA_RDONLY (YL_ZTENU)
  ZTENV => GET_HOST_DATA_RDONLY (YL_ZTENV)
  ZUD => GET_HOST_DATA_RDWR (YL_ZUD)
  ZUU => GET_HOST_DATA_RDWR (YL_ZUU)
  ZUV2 => GET_HOST_DATA_RDWR (YL_ZUV2)
  ZVD => GET_HOST_DATA_RDWR (YL_ZVD)
  ZVU => GET_HOST_DATA_RDWR (YL_ZVU)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:14:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:14:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
  !$OMP PARALLEL DO PRIVATE (IK, IKB, JBLK, JK, JLON, ZDERATE, ZDUTEN, ZDVTEN, ZDZ, ZERATE, ZFAC, ZMFA, ZMFMAX, ZTDIS) FIRSTPRIVATE (YLCPG_BNDS)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    CALL YLCPG_BNDS%UPDATE (JBLK)

    

    IF (YDML_PHY_EC%YRECUMF%LMFDUDV) THEN

      DO JK=KLEV-1, 2,-1
        IK=JK+1

        DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA

          IF (LDCUM (JLON, JBLK)) THEN

            IF (JK==KCBOT (JLON, JBLK).AND.KTYPE (JLON, JBLK)<3) THEN
              IKB=IDPL (JLON, JBLK)
              ZUU (JLON, JK, JBLK)=PUEN (JLON, IKB-1, JBLK)
              ZVU (JLON, JK, JBLK)=PVEN (JLON, IKB-1, JBLK)
            ELSEIF (JK==KCBOT (JLON, JBLK).AND.KTYPE (JLON, JBLK)==3) THEN
              ZUU (JLON, JK, JBLK)=PUEN (JLON, JK-1, JBLK)
              ZVU (JLON, JK, JBLK)=PVEN (JLON, JK-1, JBLK)
            ENDIF


            IF (JK<KCBOT (JLON, JBLK).AND.JK>=KCTOP (JLON, JBLK)) THEN
              ZFAC=0.0_JPRB

              IF (LDTDKMF.AND.(KTYPE (JLON, JBLK)==1.OR.KTYPE (JLON, JBLK)==3))  THEN
                ZFAC=2.0_JPRB
              ENDIF

              ZERATE=PMFU (JLON, JK, JBLK)-PMFU (JLON, IK, JBLK)+(1.0_JPRB+ZFAC)*PMFUDE_RATE (JLON, JK, JBLK)
              ZDERATE=(1.0_JPRB+ZFAC)*PMFUDE_RATE (JLON, JK, JBLK)
              ZMFA=1.0_JPRB/MAX (YDML_PHY_EC%YRECUMF%RMFCMIN, PMFU (JLON, JK, JBLK))
              ZUU (JLON, JK, JBLK)=(ZUU (JLON, IK, JBLK)*PMFU (JLON, IK, JBLK)+ZERATE&
              &*PUEN (JLON, JK, JBLK)-ZDERATE*ZUU (JLON, IK, JBLK))*ZMFA
              ZVU (JLON, JK, JBLK)=(ZVU (JLON, IK, JBLK)*PMFU (JLON, IK, JBLK)+ZERATE&
              &*PVEN (JLON, JK, JBLK)-ZDERATE*ZVU (JLON, IK, JBLK))*ZMFA
            ENDIF

          ENDIF

        ENDDO

      ENDDO


      DO JK=3, KLEV
        IK=JK-1

        DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA

          IF (LDCUM (JLON, JBLK)) THEN

            IF (JK==IDTOP (JLON, JBLK)) THEN
              ZUD (JLON, JK, JBLK)=0.5_JPRB*(ZUU (JLON, JK, JBLK)+PUEN (JLON, IK, JBLK))
              ZVD (JLON, JK, JBLK)=0.5_JPRB*(ZVU (JLON, JK, JBLK)+PVEN (JLON, IK, JBLK))
            ELSEIF (JK>IDTOP (JLON, JBLK)) THEN
              ZERATE=-PMFD (JLON, JK, JBLK)+PMFD (JLON, IK, JBLK)+PMFDDE_RATE (JLON, JK, JBLK)
              ZMFA=1.0_JPRB/MIN (-YDML_PHY_EC%YRECUMF%RMFCMIN, PMFD (JLON, JK, JBLK))
              ZUD (JLON, JK, JBLK)=(ZUD (JLON, IK, JBLK)*PMFD (JLON, IK, JBLK)-ZERATE*PUEN&
              & (JLON, IK, JBLK)+PMFDDE_RATE (JLON, JK, JBLK)*ZUD (JLON, IK, JBLK))*ZMFA
              ZVD (JLON, JK, JBLK)=(ZVD (JLON, IK, JBLK)*PMFD (JLON, IK, JBLK)-ZERATE*PVEN&
              & (JLON, IK, JBLK)+PMFDDE_RATE (JLON, JK, JBLK)*ZVD (JLON, IK, JBLK))*ZMFA
            ENDIF

          ENDIF

        ENDDO

      ENDDO

      ZMFS (:, JBLK)=1.0_JPRB

      IF (YDML_PHY_EC%YRECUMF%RMFSOLUV<=1.0_JPRB) THEN

        DO JK=2, KLEV

          DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA

            IF (LDCUM (JLON, JBLK).AND.JK>=KCTOP (JLON, JBLK)-1) THEN
              ZMFMAX=(PAPH (JLON, JK, JBLK)-PAPH (JLON, JK-1, JBLK))*ZCONS

              IF (PMFU (JLON, JK, JBLK)>ZMFMAX.AND.JK>=KCTOP (JLON, JBLK))  THEN
                ZMFS (JLON, JBLK)=MIN (ZMFS (JLON, JBLK), ZMFMAX/PMFU (JLON, JK, JBLK))
              ENDIF

            ENDIF

          ENDDO

        ENDDO

      ENDIF


      DO JK=1, KLEV

        DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
          ZMFUUS (JLON, JK, JBLK)=PMFU (JLON, JK, JBLK)
          ZMFDUS (JLON, JK, JBLK)=PMFD (JLON, JK, JBLK)

          IF (LDCUM (JLON, JBLK).AND.JK>=KCTOP (JLON, JBLK)-1) THEN
            ZMFUUS (JLON, JK, JBLK)=PMFU (JLON, JK, JBLK)*ZMFS (JLON, JBLK)
            ZMFDUS (JLON, JK, JBLK)=PMFD (JLON, JK, JBLK)*ZMFS (JLON, JBLK)
          ENDIF

        ENDDO

      ENDDO


      IF (YDML_PHY_EC%YRECUMF%RMFSOLUV>0.0_JPRB) THEN

        DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA

          IF (LDCUM (JLON, JBLK)) THEN
            JK=KCBOT (JLON, JBLK)
            IK=JK-1
            ZMFUUB (JLON, JBLK)=ZMFUUS (JLON, JK, JBLK)*(ZUU (JLON, JK, JBLK)-PUEN (JLON, IK, JBLK))
            ZMFUVB (JLON, JBLK)=ZMFUUS (JLON, JK, JBLK)*(ZVU (JLON, JK, JBLK)-PVEN (JLON, IK, JBLK))
          ENDIF

        ENDDO


        DO JK=2, KLEV
          IK=JK-1

          DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA

            IF (LDCUM (JLON, JBLK).AND.JK>KCBOT (JLON, JBLK)) THEN
              IKB=KCBOT (JLON, JBLK)
              ZDZ=((PAPH (JLON, KLEV+1, JBLK)-PAPH (JLON, JK, JBLK))/&
              &(PAPH (JLON, KLEV+1, JBLK)-PAPH (JLON, IKB, JBLK)))

              IF (KTYPE (JLON, JBLK)==3) THEN
                ZDZ=ZDZ*ZDZ
              ENDIF

              ZMFA=1.0_JPRB/MAX (YDML_PHY_EC%YRECUMF%RMFCMIN, ZMFUUS (JLON, JK, JBLK))
              ZUU (JLON, JK, JBLK)=PUEN (JLON, IK, JBLK)+ZMFUUB (JLON, JBLK)*ZDZ*ZMFA
              ZVU (JLON, JK, JBLK)=PVEN (JLON, IK, JBLK)+ZMFUVB (JLON, JBLK)*ZDZ*ZMFA
              ZMFDUS (JLON, JK, JBLK)=ZMFDUS (JLON, IKB, JBLK)*ZDZ
              ZUD (JLON, JK, JBLK)=PUEN (JLON, IK, JBLK)+ZUD (JLON, IKB, JBLK)-PUEN (JLON, IKB-1, JBLK)
              ZVD (JLON, JK, JBLK)=PVEN (JLON, IK, JBLK)+ZVD (JLON, IKB, JBLK)-PVEN (JLON, IKB-1, JBLK)
            ENDIF


            IF (LDCUM (JLON, JBLK).AND.JK>=KCTOP (JLON, JBLK)) THEN

              IF (LDTDKMF) THEN
                ZUU (JLON, JK, JBLK)=ZUU (JLON, JK, JBLK)-YDML_PHY_EC%YRECUMF&
                &%RUVPER*SIGN (1.0_JPRB, ZUU (JLON, JK, JBLK))
                ZVU (JLON, JK, JBLK)=ZVU (JLON, JK, JBLK)-YDML_PHY_EC%YRECUMF&
                &%RUVPER*SIGN (1.0_JPRB, ZVU (JLON, JK, JBLK))
              ELSE
                ZUU (JLON, JK, JBLK)=ZUU (JLON, JK, JBLK)-MIN (ABS (ZUU (JLON, JK, JBLK)&
                &), YDML_PHY_EC%YRECUMF%RUVPER)*SIGN (1.0_JPRB, ZUU (JLON, JK, JBLK))
                ZVU (JLON, JK, JBLK)=ZVU (JLON, JK, JBLK)-MIN (ABS (ZVU (JLON, JK, JBLK)&
                &), YDML_PHY_EC%YRECUMF%RUVPER)*SIGN (1.0_JPRB, ZVU (JLON, JK, JBLK))
              ENDIF

            ENDIF

          ENDDO

        ENDDO

      ENDIF

      CALL CUDUDV (YDCST, YDML_PHY_EC%YRECUMF, YDSPP_CONFIG, YDPERTPAR, YLCPG_BNDS%KIDIA, YLCPG_BNDS&
      &%KFDIA, YDCPG_OPTS%KLON, KLEV, ITOPM2, KTYPE(:, JBLK), KCBOT(:, JBLK), KCTOP(:, JBLK), LDCUM(&
      &:, JBLK), PTSPHY, PAPH(:,:, JBLK), PAP(:,:, JBLK), PUEN(:,:, JBLK), PVEN(:,:, JBLK), ZMFUUS(:&
      &,:, JBLK), ZMFDUS(:,:, JBLK), PMFU(:,:, JBLK), PMFD(:,:, JBLK), ZUU(:,:, JBLK), ZUD(:,:, JBLK&
      &), ZVU(:,:, JBLK), ZVD(:,:, JBLK), PGP2DSPP(:,:, JBLK), PTENU(:,:, JBLK), PTENV(:,:, JBLK))

      IF (YDML_PHY_EC%YRECUMF%LMFUVDIS) THEN

        DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
          ZSUM12 (JLON, JBLK)=0.0_JPRB
          ZSUM22 (JLON, JBLK)=0.0_JPRB
        ENDDO


        DO JK=1, KLEV

          DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
            ZUV2 (JLON, JK, JBLK)=0.0_JPRB

            IF (LDCUM (JLON, JBLK).AND.JK>=KCTOP (JLON, JBLK)-1) THEN
              ZDZ=(PAPH (JLON, JK+1, JBLK)-PAPH (JLON, JK, JBLK))
              ZDUTEN=PTENU (JLON, JK, JBLK)-ZTENU (JLON, JK, JBLK)
              ZDVTEN=PTENV (JLON, JK, JBLK)-ZTENV (JLON, JK, JBLK)
              ZUV2 (JLON, JK, JBLK)=SQRT (ZDUTEN**2+ZDVTEN**2)
              ZSUM22 (JLON, JBLK)=ZSUM22 (JLON, JBLK)+ZUV2 (JLON, JK, JBLK)*ZDZ
              ZSUM12 (JLON, JBLK)=ZSUM12 (JLON, JBLK)-(PUEN (JLON, JK&
              &, JBLK)*ZDUTEN+PVEN (JLON, JK, JBLK)*ZDVTEN)*ZDZ
            ENDIF

          ENDDO

        ENDDO


        DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
          PVDISCU (JLON, JBLK)=ZSUM12 (JLON, JBLK)*ZRG
        ENDDO


        DO JK=1, KLEV

          DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA

            IF (LDCUM (JLON, JBLK).AND.JK>=KCTOP (JLON, JBLK)-1) THEN
              ZTDIS=ZORCPD*ZSUM12 (JLON, JBLK)*ZUV2 (JLON, JK, JBLK)/MAX (1.E-15_JPRB, ZSUM22 (JLON, JBLK))
              PTENT (JLON, JK, JBLK)=PTENT (JLON, JK, JBLK)+ZTDIS
            ENDIF

          ENDDO

        ENDDO

      ENDIF

    ENDIF

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:14:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:14:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  IDPL => NULL ()
  IDTOP => NULL ()
  KCBOT => NULL ()
  KCTOP => NULL ()
  KTYPE => NULL ()
  LDCUM => NULL ()
  PAP => NULL ()
  PAPH => NULL ()
  PGP2DSPP => NULL ()
  PMFD => NULL ()
  PMFDDE_RATE => NULL ()
  PMFU => NULL ()
  PMFUDE_RATE => NULL ()
  PTENT => NULL ()
  PTENU => NULL ()
  PTENV => NULL ()
  PUEN => NULL ()
  PVDISCU => NULL ()
  PVEN => NULL ()
  ZMFDUS => NULL ()
  ZMFS => NULL ()
  ZMFUUB => NULL ()
  ZMFUUS => NULL ()
  ZMFUVB => NULL ()
  ZSUM12 => NULL ()
  ZSUM22 => NULL ()
  ZTENU => NULL ()
  ZTENV => NULL ()
  ZUD => NULL ()
  ZUU => NULL ()
  ZUV2 => NULL ()
  ZVD => NULL ()
  ZVU => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:14:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN','CUMASTRN_PARALLEL:14')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:14:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  IDPL => GET_DEVICE_DATA_RDONLY (YL_IDPL)
  IDTOP => GET_DEVICE_DATA_RDONLY (YL_IDTOP)
  KCBOT => GET_DEVICE_DATA_RDONLY (YD_KCBOT)
  KCTOP => GET_DEVICE_DATA_RDONLY (YD_KCTOP)
  KTYPE => GET_DEVICE_DATA_RDONLY (YD_KTYPE)
  LDCUM => GET_DEVICE_DATA_RDONLY (YD_LDCUM)
  PAP => GET_DEVICE_DATA_RDONLY (YD_PAP)
  PAPH => GET_DEVICE_DATA_RDONLY (YD_PAPH)
  PGP2DSPP => GET_DEVICE_DATA_RDONLY (YD_PGP2DSPP)
  PMFD => GET_DEVICE_DATA_RDONLY (YD_PMFD)
  PMFDDE_RATE => GET_DEVICE_DATA_RDONLY (YD_PMFDDE_RATE)
  PMFU => GET_DEVICE_DATA_RDONLY (YD_PMFU)
  PMFUDE_RATE => GET_DEVICE_DATA_RDONLY (YD_PMFUDE_RATE)
  PTENT => GET_DEVICE_DATA_RDWR (YD_PTENT)
  PTENU => GET_DEVICE_DATA_RDWR (YD_PTENU)
  PTENV => GET_DEVICE_DATA_RDWR (YD_PTENV)
  PUEN => GET_DEVICE_DATA_RDONLY (YD_PUEN)
  PVDISCU => GET_DEVICE_DATA_RDWR (YD_PVDISCU)
  PVEN => GET_DEVICE_DATA_RDONLY (YD_PVEN)
  ZMFDUS => GET_DEVICE_DATA_RDWR (YL_ZMFDUS)
  ZMFS => GET_DEVICE_DATA_RDWR (YL_ZMFS)
  ZMFUUB => GET_DEVICE_DATA_RDWR (YL_ZMFUUB)
  ZMFUUS => GET_DEVICE_DATA_RDWR (YL_ZMFUUS)
  ZMFUVB => GET_DEVICE_DATA_RDWR (YL_ZMFUVB)
  ZSUM12 => GET_DEVICE_DATA_RDWR (YL_ZSUM12)
  ZSUM22 => GET_DEVICE_DATA_RDWR (YL_ZSUM22)
  ZTENU => GET_DEVICE_DATA_RDONLY (YL_ZTENU)
  ZTENV => GET_DEVICE_DATA_RDONLY (YL_ZTENV)
  ZUD => GET_DEVICE_DATA_RDWR (YL_ZUD)
  ZUU => GET_DEVICE_DATA_RDWR (YL_ZUU)
  ZUV2 => GET_DEVICE_DATA_RDWR (YL_ZUV2)
  ZVD => GET_DEVICE_DATA_RDWR (YL_ZVD)
  ZVU => GET_DEVICE_DATA_RDWR (YL_ZVU)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:14:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:14:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  
    !$ACC PARALLEL LOOP GANG &
    !$ACC&PRESENT (IDPL, IDTOP, KCBOT, KCTOP, KTYPE, LDCUM, PAP, PAPH, PGP2DSPP, PMFD, PMFDDE_RATE, &
    !$ACC&         PMFU, PMFUDE_RATE, PTENT, PTENU, PTENV, PUEN, PVDISCU, PVEN, YFXTRAN_ACDC_STACK, &
    !$ACC&         ZMFDUS, ZMFS, ZMFUUB, ZMFUUS, ZMFUVB, ZSUM12, ZSUM22, ZTENU, ZTENV, ZUD, &
    !$ACC&         ZUU, ZUV2, ZVD, ZVU) &
    !$ACC&PRIVATE (JBLK) &
    !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
    
    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    
    
    
    !$ACC LOOP VECTOR &
    !$ACC&PRIVATE (IK, IKB, JK, JLON, YLCPG_BNDS, YLSTACK, ZDERATE, ZDUTEN, ZDVTEN, ZDZ, ZERATE, &
    !$ACC&         ZFAC, ZMFA, ZMFMAX, ZTDIS) 

    

    DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JLON
      YLCPG_BNDS%KFDIA = JLON
      YLSTACK%L8 = fxtran_acdc_stack_l8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%U8 = fxtran_acdc_stack_u8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%L4 = fxtran_acdc_stack_l4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%U4 = fxtran_acdc_stack_u4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)

      

      IF (YDML_PHY_EC%YRECUMF%LMFDUDV) THEN

        DO JK=KLEV-1, 2,-1
          IK=JK+1

          

          IF (LDCUM (JLON, JBLK)) THEN

            IF (JK==KCBOT (JLON, JBLK).AND.KTYPE (JLON, JBLK)<3) THEN
              IKB=IDPL (JLON, JBLK)
              ZUU (JLON, JK, JBLK)=PUEN (JLON, IKB-1, JBLK)
              ZVU (JLON, JK, JBLK)=PVEN (JLON, IKB-1, JBLK)
            ELSEIF (JK==KCBOT (JLON, JBLK).AND.KTYPE (JLON, JBLK)==3) THEN
              ZUU (JLON, JK, JBLK)=PUEN (JLON, JK-1, JBLK)
              ZVU (JLON, JK, JBLK)=PVEN (JLON, JK-1, JBLK)
            ENDIF


            IF (JK<KCBOT (JLON, JBLK).AND.JK>=KCTOP (JLON, JBLK)) THEN
              ZFAC=0.0_JPRB

              IF (LDTDKMF.AND.(KTYPE (JLON, JBLK)==1.OR.KTYPE (JLON, JBLK)==3))  THEN
                ZFAC=2.0_JPRB
              ENDIF

              ZERATE=PMFU (JLON, JK, JBLK)-PMFU (JLON, IK, JBLK)+(1.0_JPRB+ZFAC)*PMFUDE_RATE (JLON, JK, JBLK)
              ZDERATE=(1.0_JPRB+ZFAC)*PMFUDE_RATE (JLON, JK, JBLK)
              ZMFA=1.0_JPRB/MAX (YDML_PHY_EC%YRECUMF%RMFCMIN, PMFU (JLON, JK, JBLK))
              ZUU (JLON, JK, JBLK)=(ZUU (JLON, IK, JBLK)*PMFU (JLON, IK, JBLK)+ZERATE&
              &*PUEN (JLON, JK, JBLK)-ZDERATE*ZUU (JLON, IK, JBLK))*ZMFA
              ZVU (JLON, JK, JBLK)=(ZVU (JLON, IK, JBLK)*PMFU (JLON, IK, JBLK)+ZERATE&
              &*PVEN (JLON, JK, JBLK)-ZDERATE*ZVU (JLON, IK, JBLK))*ZMFA
            ENDIF

          ENDIF

        
        ENDDO


        DO JK=3, KLEV
          IK=JK-1

          

          IF (LDCUM (JLON, JBLK)) THEN

            IF (JK==IDTOP (JLON, JBLK)) THEN
              ZUD (JLON, JK, JBLK)=0.5_JPRB*(ZUU (JLON, JK, JBLK)+PUEN (JLON, IK, JBLK))
              ZVD (JLON, JK, JBLK)=0.5_JPRB*(ZVU (JLON, JK, JBLK)+PVEN (JLON, IK, JBLK))
            ELSEIF (JK>IDTOP (JLON, JBLK)) THEN
              ZERATE=-PMFD (JLON, JK, JBLK)+PMFD (JLON, IK, JBLK)+PMFDDE_RATE (JLON, JK, JBLK)
              ZMFA=1.0_JPRB/MIN (-YDML_PHY_EC%YRECUMF%RMFCMIN, PMFD (JLON, JK, JBLK))
              ZUD (JLON, JK, JBLK)=(ZUD (JLON, IK, JBLK)*PMFD (JLON, IK, JBLK)-ZERATE*PUEN&
              & (JLON, IK, JBLK)+PMFDDE_RATE (JLON, JK, JBLK)*ZUD (JLON, IK, JBLK))*ZMFA
              ZVD (JLON, JK, JBLK)=(ZVD (JLON, IK, JBLK)*PMFD (JLON, IK, JBLK)-ZERATE*PVEN&
              & (JLON, IK, JBLK)+PMFDDE_RATE (JLON, JK, JBLK)*ZVD (JLON, IK, JBLK))*ZMFA
            ENDIF

          ENDIF

        
        ENDDO

        ZMFS (JLON, JBLK)=1.0_JPRB

        IF (YDML_PHY_EC%YRECUMF%RMFSOLUV<=1.0_JPRB) THEN

          DO JK=2, KLEV

            

            IF (LDCUM (JLON, JBLK).AND.JK>=KCTOP (JLON, JBLK)-1) THEN
              ZMFMAX=(PAPH (JLON, JK, JBLK)-PAPH (JLON, JK-1, JBLK))*ZCONS

              IF (PMFU (JLON, JK, JBLK)>ZMFMAX.AND.JK>=KCTOP (JLON, JBLK))  THEN
                ZMFS (JLON, JBLK)=MIN (ZMFS (JLON, JBLK), ZMFMAX/PMFU (JLON, JK, JBLK))
              ENDIF

            ENDIF

          
          ENDDO

        ENDIF


        DO JK=1, KLEV
          
          ZMFUUS (JLON, JK, JBLK)=PMFU (JLON, JK, JBLK)
          ZMFDUS (JLON, JK, JBLK)=PMFD (JLON, JK, JBLK)

          IF (LDCUM (JLON, JBLK).AND.JK>=KCTOP (JLON, JBLK)-1) THEN
            ZMFUUS (JLON, JK, JBLK)=PMFU (JLON, JK, JBLK)*ZMFS (JLON, JBLK)
            ZMFDUS (JLON, JK, JBLK)=PMFD (JLON, JK, JBLK)*ZMFS (JLON, JBLK)
          ENDIF

        
        ENDDO


        IF (YDML_PHY_EC%YRECUMF%RMFSOLUV>0.0_JPRB) THEN

          

          IF (LDCUM (JLON, JBLK)) THEN
            JK=KCBOT (JLON, JBLK)
            IK=JK-1
            ZMFUUB (JLON, JBLK)=ZMFUUS (JLON, JK, JBLK)*(ZUU (JLON, JK, JBLK)-PUEN (JLON, IK, JBLK))
            ZMFUVB (JLON, JBLK)=ZMFUUS (JLON, JK, JBLK)*(ZVU (JLON, JK, JBLK)-PVEN (JLON, IK, JBLK))
          ENDIF


          

          DO JK=2, KLEV
            IK=JK-1

            

            IF (LDCUM (JLON, JBLK).AND.JK>KCBOT (JLON, JBLK)) THEN
              IKB=KCBOT (JLON, JBLK)
              ZDZ=((PAPH (JLON, KLEV+1, JBLK)-PAPH (JLON, JK, JBLK))/&
              &(PAPH (JLON, KLEV+1, JBLK)-PAPH (JLON, IKB, JBLK)))

              IF (KTYPE (JLON, JBLK)==3) THEN
                ZDZ=ZDZ*ZDZ
              ENDIF

              ZMFA=1.0_JPRB/MAX (YDML_PHY_EC%YRECUMF%RMFCMIN, ZMFUUS (JLON, JK, JBLK))
              ZUU (JLON, JK, JBLK)=PUEN (JLON, IK, JBLK)+ZMFUUB (JLON, JBLK)*ZDZ*ZMFA
              ZVU (JLON, JK, JBLK)=PVEN (JLON, IK, JBLK)+ZMFUVB (JLON, JBLK)*ZDZ*ZMFA
              ZMFDUS (JLON, JK, JBLK)=ZMFDUS (JLON, IKB, JBLK)*ZDZ
              ZUD (JLON, JK, JBLK)=PUEN (JLON, IK, JBLK)+ZUD (JLON, IKB, JBLK)-PUEN (JLON, IKB-1, JBLK)
              ZVD (JLON, JK, JBLK)=PVEN (JLON, IK, JBLK)+ZVD (JLON, IKB, JBLK)-PVEN (JLON, IKB-1, JBLK)
            ENDIF


            IF (LDCUM (JLON, JBLK).AND.JK>=KCTOP (JLON, JBLK)) THEN

              IF (LDTDKMF) THEN
                ZUU (JLON, JK, JBLK)=ZUU (JLON, JK, JBLK)-YDML_PHY_EC%YRECUMF&
                &%RUVPER*SIGN (1.0_JPRB, ZUU (JLON, JK, JBLK))
                ZVU (JLON, JK, JBLK)=ZVU (JLON, JK, JBLK)-YDML_PHY_EC%YRECUMF&
                &%RUVPER*SIGN (1.0_JPRB, ZVU (JLON, JK, JBLK))
              ELSE
                ZUU (JLON, JK, JBLK)=ZUU (JLON, JK, JBLK)-MIN (ABS (ZUU (JLON, JK, JBLK)&
                &), YDML_PHY_EC%YRECUMF%RUVPER)*SIGN (1.0_JPRB, ZUU (JLON, JK, JBLK))
                ZVU (JLON, JK, JBLK)=ZVU (JLON, JK, JBLK)-MIN (ABS (ZVU (JLON, JK, JBLK)&
                &), YDML_PHY_EC%YRECUMF%RUVPER)*SIGN (1.0_JPRB, ZVU (JLON, JK, JBLK))
              ENDIF

            ENDIF

          
          ENDDO

        ENDIF

        CALL CUDUDV_OPENACC (YDCST, YDML_PHY_EC%YRECUMF, YDSPP_CONFIG, YDPERTPAR, YLCPG_BNDS%KIDIA, YLCPG_BNDS&
        &%KFDIA, YDCPG_OPTS%KLON, KLEV, ITOPM2, KTYPE(:, JBLK), KCBOT(:, JBLK), KCTOP(:, JBLK), LDCUM(:, JBLK&
        &), PTSPHY, PAPH(:,:, JBLK), PAP(:,:, JBLK), PUEN(:,:, JBLK), PVEN(:,:, JBLK), ZMFUUS(:,:, JBLK), ZMFDUS&
        &(:,:, JBLK), PMFU(:,:, JBLK), PMFD(:,:, JBLK), ZUU(:,:, JBLK), ZUD(:,:, JBLK), ZVU(:,:, JBLK), ZVD&
        &(:,:, JBLK), PGP2DSPP(:,:, JBLK), PTENU(:,:, JBLK), PTENV(:,:, JBLK),YDSTACK=YLSTACK)

        IF (YDML_PHY_EC%YRECUMF%LMFUVDIS) THEN
          
          ZSUM12 (JLON, JBLK)=0.0_JPRB
          ZSUM22 (JLON, JBLK)=0.0_JPRB

          

          DO JK=1, KLEV
            
            ZUV2 (JLON, JK, JBLK)=0.0_JPRB

            IF (LDCUM (JLON, JBLK).AND.JK>=KCTOP (JLON, JBLK)-1) THEN
              ZDZ=(PAPH (JLON, JK+1, JBLK)-PAPH (JLON, JK, JBLK))
              ZDUTEN=PTENU (JLON, JK, JBLK)-ZTENU (JLON, JK, JBLK)
              ZDVTEN=PTENV (JLON, JK, JBLK)-ZTENV (JLON, JK, JBLK)
              ZUV2 (JLON, JK, JBLK)=SQRT (ZDUTEN**2+ZDVTEN**2)
              ZSUM22 (JLON, JBLK)=ZSUM22 (JLON, JBLK)+ZUV2 (JLON, JK, JBLK)*ZDZ
              ZSUM12 (JLON, JBLK)=ZSUM12 (JLON, JBLK)-(PUEN (JLON, JK&
              &, JBLK)*ZDUTEN+PVEN (JLON, JK, JBLK)*ZDVTEN)*ZDZ
            ENDIF

          
          ENDDO

          
          PVDISCU (JLON, JBLK)=ZSUM12 (JLON, JBLK)*ZRG

          

          DO JK=1, KLEV

            

            IF (LDCUM (JLON, JBLK).AND.JK>=KCTOP (JLON, JBLK)-1) THEN
              ZTDIS=ZORCPD*ZSUM12 (JLON, JBLK)*ZUV2 (JLON, JK, JBLK)/MAX (1.E-15_JPRB, ZSUM22 (JLON, JBLK))
              PTENT (JLON, JK, JBLK)=PTENT (JLON, JK, JBLK)+ZTDIS
            ENDIF

          
          ENDDO

        ENDIF

      ENDIF

    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:14:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:14:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  IDPL => NULL ()
  IDTOP => NULL ()
  KCBOT => NULL ()
  KCTOP => NULL ()
  KTYPE => NULL ()
  LDCUM => NULL ()
  PAP => NULL ()
  PAPH => NULL ()
  PGP2DSPP => NULL ()
  PMFD => NULL ()
  PMFDDE_RATE => NULL ()
  PMFU => NULL ()
  PMFUDE_RATE => NULL ()
  PTENT => NULL ()
  PTENU => NULL ()
  PTENV => NULL ()
  PUEN => NULL ()
  PVDISCU => NULL ()
  PVEN => NULL ()
  ZMFDUS => NULL ()
  ZMFS => NULL ()
  ZMFUUB => NULL ()
  ZMFUUS => NULL ()
  ZMFUVB => NULL ()
  ZSUM12 => NULL ()
  ZSUM22 => NULL ()
  ZTENU => NULL ()
  ZTENV => NULL ()
  ZUD => NULL ()
  ZUU => NULL ()
  ZUV2 => NULL ()
  ZVD => NULL ()
  ZVU => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:14:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSE
    CALL ABOR1 ('CUMASTRN_PARALLEL: NOT METHOD WAS FOUND')
ENDIF

IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:14',1,ZHOOK_HANDLE_PARALLEL)
IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:15',0,ZHOOK_HANDLE_PARALLEL)

IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','CUMASTRN_PARALLEL:15')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:15:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  KCBOT => GET_HOST_DATA_RDWR (YD_KCBOT)
  KCTOP => GET_HOST_DATA_RDWR (YD_KCTOP)
  LLO2 => GET_HOST_DATA_RDONLY (YL_LLO2)
  PMFDDE_RATE => GET_HOST_DATA_RDWR (YD_PMFDDE_RATE)
  PMFUDE_RATE => GET_HOST_DATA_RDWR (YD_PMFUDE_RATE)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:15:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:15:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
  !$OMP PARALLEL DO PRIVATE (JBLK, JK, JLON) FIRSTPRIVATE (YLCPG_BNDS)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    CALL YLCPG_BNDS%UPDATE (JBLK)

    

    IF (.NOT.YDML_PHY_EC%YRECUMF%LMFSCV.OR..NOT.YDML_PHY_EC%YRECUMF%LMFPEN) THEN

      DO JK=2, KLEV

        DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA

          IF (LLO2 (JLON, JBLK).AND.JK>=KCTOP (JLON, JBLK)-1) THEN
            PMFUDE_RATE (JLON, JK, JBLK)=0.0_JPRB
            PMFDDE_RATE (JLON, JK, JBLK)=0.0_JPRB
          ENDIF

        ENDDO

      ENDDO


      DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA

        IF (LLO2 (JLON, JBLK)) THEN
          KCTOP (JLON, JBLK)=KLEV-1
          KCBOT (JLON, JBLK)=KLEV-1
        ENDIF

      ENDDO

    ENDIF

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:15:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:15:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  KCBOT => NULL ()
  KCTOP => NULL ()
  LLO2 => NULL ()
  PMFDDE_RATE => NULL ()
  PMFUDE_RATE => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:15:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN','CUMASTRN_PARALLEL:15')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:15:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  KCBOT => GET_DEVICE_DATA_RDWR (YD_KCBOT)
  KCTOP => GET_DEVICE_DATA_RDWR (YD_KCTOP)
  LLO2 => GET_DEVICE_DATA_RDONLY (YL_LLO2)
  PMFDDE_RATE => GET_DEVICE_DATA_RDWR (YD_PMFDDE_RATE)
  PMFUDE_RATE => GET_DEVICE_DATA_RDWR (YD_PMFUDE_RATE)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:15:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:15:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  
    !$ACC PARALLEL LOOP GANG &
    !$ACC&PRESENT (KCBOT, KCTOP, LLO2, PMFDDE_RATE, PMFUDE_RATE, YFXTRAN_ACDC_STACK) &
    !$ACC&PRIVATE (JBLK) &
    !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
    
    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    
    
    
    !$ACC LOOP VECTOR &
    !$ACC&PRIVATE (JK, JLON, YLCPG_BNDS) 

    

    DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JLON
      YLCPG_BNDS%KFDIA = JLON

      

      IF (.NOT.YDML_PHY_EC%YRECUMF%LMFSCV.OR..NOT.YDML_PHY_EC%YRECUMF%LMFPEN) THEN

        DO JK=2, KLEV

          

          IF (LLO2 (JLON, JBLK).AND.JK>=KCTOP (JLON, JBLK)-1) THEN
            PMFUDE_RATE (JLON, JK, JBLK)=0.0_JPRB
            PMFDDE_RATE (JLON, JK, JBLK)=0.0_JPRB
          ENDIF

        
        ENDDO


        

        IF (LLO2 (JLON, JBLK)) THEN
          KCTOP (JLON, JBLK)=KLEV-1
          KCBOT (JLON, JBLK)=KLEV-1
        ENDIF

      
      ENDIF

    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:15:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:15:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  KCBOT => NULL ()
  KCTOP => NULL ()
  LLO2 => NULL ()
  PMFDDE_RATE => NULL ()
  PMFUDE_RATE => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:15:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSE
    CALL ABOR1 ('CUMASTRN_PARALLEL: NOT METHOD WAS FOUND')
ENDIF

IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:15',1,ZHOOK_HANDLE_PARALLEL)

IF (YDML_PHY_EC%YREPHY%LMFTRAC.AND.KTRAC>0) THEN
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:16',0,ZHOOK_HANDLE_PARALLEL)

  IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','CUMASTRN_PARALLEL:16')) THEN
    
    IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:16:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
    IDTOP => GET_HOST_DATA_RDONLY (YL_IDTOP)
    KCBOT => GET_HOST_DATA_RDONLY (YD_KCBOT)
    KCTOP => GET_HOST_DATA_RDONLY (YD_KCTOP)
    KTYPE => GET_HOST_DATA_RDONLY (YD_KTYPE)
    LDCUM => GET_HOST_DATA_RDONLY (YD_LDCUM)
    LLDCUM => GET_HOST_DATA_RDWR (YL_LLDCUM)
    LLDDRAF => GET_HOST_DATA_RDONLY (YL_LLDDRAF)
    LLDDRAF3 => GET_HOST_DATA_RDWR (YL_LLDDRAF3)
    PAP => GET_HOST_DATA_RDONLY (YD_PAP)
    PAPH => GET_HOST_DATA_RDONLY (YD_PAPH)
    PCEN => GET_HOST_DATA_RDONLY (YD_PCEN)
    PMFD => GET_HOST_DATA_RDONLY (YD_PMFD)
    PMFDDE_RATE => GET_HOST_DATA_RDONLY (YD_PMFDDE_RATE)
    PMFLXR => GET_HOST_DATA_RDONLY (YD_PMFLXR)
    PMFLXS => GET_HOST_DATA_RDONLY (YD_PMFLXS)
    PMFU => GET_HOST_DATA_RDONLY (YD_PMFU)
    PMFUDE_RATE => GET_HOST_DATA_RDONLY (YD_PMFUDE_RATE)
    PTENC => GET_HOST_DATA_RDWR (YD_PTENC)
    ZDMFDPC => GET_HOST_DATA_RDWR (YL_ZDMFDPC)
    ZDMFUPC => GET_HOST_DATA_RDWR (YL_ZDMFUPC)
    ZMFDDR => GET_HOST_DATA_RDWR (YL_ZMFDDR)
    ZMFDUS => GET_HOST_DATA_RDWR (YL_ZMFDUS)
    ZMFS => GET_HOST_DATA_RDWR (YL_ZMFS)
    ZMFUDR => GET_HOST_DATA_RDWR (YL_ZMFUDR)
    ZMFUUS => GET_HOST_DATA_RDWR (YL_ZMFUUS)
    IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:16:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
    IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:16:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
    
    CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
    !$OMP PARALLEL DO PRIVATE (IKB, JBLK, JK, JLON, ZERATE, ZMFMAX) FIRSTPRIVATE (YLCPG_BNDS)

    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
      CALL YLCPG_BNDS%UPDATE (JBLK)

      

      DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA

        IF (LDCUM (JLON, JBLK).AND.KTYPE (JLON, JBLK)/=3.AND.KCBOT (JLON, JBLK)-KCTOP (JLON, JBLK)>=1) THEN
          LLDCUM (JLON, JBLK)=.TRUE.
          LLDDRAF3 (JLON, JBLK)=LLDDRAF (JLON, JBLK)
        ELSE
          LLDCUM (JLON, JBLK)=.FALSE.
          LLDDRAF3 (JLON, JBLK)=.FALSE.
        ENDIF

      ENDDO

      ZMFS (:, JBLK)=1.0_JPRB

      IF (YDML_PHY_EC%YRECUMF%RMFSOLCT<=3.0_JPRB) THEN

        DO JK=2, KLEV

          DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA

            IF (LLDCUM (JLON, JBLK).AND.JK>=KCTOP (JLON, JBLK)) THEN
              ZMFMAX=(PAPH (JLON, JK, JBLK)-PAPH (JLON, JK-1, JBLK))*0.8_JPRB*ZCONS

              IF (PMFU (JLON, JK, JBLK)>ZMFMAX)  THEN
                ZMFS (JLON, JBLK)=MIN (ZMFS (JLON, JBLK), ZMFMAX/PMFU (JLON, JK, JBLK))
              ENDIF

            ENDIF

          ENDDO

        ENDDO

      ENDIF


      DO JK=1, KLEV

        DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA

          IF (LLDCUM (JLON, JBLK).AND.JK>=KCTOP (JLON, JBLK)-1) THEN
            ZMFUUS (JLON, JK, JBLK)=PMFU (JLON, JK, JBLK)*ZMFS (JLON, JBLK)
            ZMFUDR (JLON, JK, JBLK)=PMFUDE_RATE (JLON, JK, JBLK)*ZMFS (JLON, JBLK)
            ZDMFUPC (JLON, JK, JBLK)=(PMFLXR (JLON, JK, JBLK)+PMFLXS (JLON, JK, JBLK))*ZMFS (JLON, JBLK)
            IKB=KCBOT (JLON, JBLK)

            IF (JK>IKB) THEN
              ZDMFUPC (JLON, JK, JBLK)=ZDMFUPC (JLON, IKB, JBLK)
            ENDIF

          ELSE
            ZMFUUS (JLON, JK, JBLK)=0._JPRB
            ZMFUDR (JLON, JK, JBLK)=0._JPRB
          ENDIF


          IF (LLDDRAF3 (JLON, JBLK).AND.JK>=IDTOP (JLON, JBLK)-1) THEN
            ZMFDUS (JLON, JK, JBLK)=PMFD (JLON, JK, JBLK)*ZMFS (JLON, JBLK)
            ZMFDDR (JLON, JK, JBLK)=PMFDDE_RATE (JLON, JK, JBLK)*ZMFS (JLON, JBLK)
            ZDMFDPC (JLON, JK, JBLK)=0.0_JPRB
          ELSE
            ZMFDUS (JLON, JK, JBLK)=0._JPRB
            ZMFDDR (JLON, JK, JBLK)=0._JPRB
          ENDIF

        ENDDO

      ENDDO


      IF (YDML_PHY_EC%YRECUMF%LMFSMOOTH) THEN

        DO JK=2, KLEV-1

          DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA

            IF (LLDDRAF3 (JLON, JBLK).AND.ZMFDUS (JLON, JK, JBLK)<0.0_JPRB&
              &.AND.ZMFDUS (JLON, JK+1, JBLK)==0.0_JPRB) THEN
              ZERATE=MIN (0._JPRB, ZMFDUS (JLON, JK, JBLK)-0.5*ZMFDUS (JLON, JK-1, JBLK))
              ZMFDUS (JLON, JK, JBLK)=ZMFDUS (JLON, JK, JBLK)-ZERATE
              ZMFDDR (JLON, JK, JBLK)=ZMFDDR (JLON, JK, JBLK)-ZERATE
              ZMFDDR (JLON, JK+1, JBLK)=-ZMFDUS (JLON, JK, JBLK)
            ENDIF


            IF (LLDCUM (JLON, JBLK).AND.JK==KCTOP (JLON, JBLK)) THEN
              ZERATE=MAX (0.0_JPRB, ZMFUUS (JLON, JK, JBLK)-0.5_JPRB*ZMFUUS (JLON, JK+1, JBLK))
              ZMFUUS (JLON, JK, JBLK)=ZMFUUS (JLON, JK, JBLK)-ZERATE
              ZMFUDR (JLON, JK, JBLK)=ZMFUDR (JLON, JK, JBLK)+ZERATE
              ZMFUDR (JLON, JK-1, JBLK)=ZMFUUS (JLON, JK, JBLK)
            ENDIF

          ENDDO

        ENDDO


        DO JK=KLEV-1, 2,-1

          DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA

            IF (LLDCUM (JLON, JBLK)) THEN

              IF (ZMFUDR (JLON, JK, JBLK)==0.0_JPRB.AND.ZMFUDR (JLON, JK-1, JBLK)>0.0_JPRB) THEN
                ZMFUDR (JLON, JK, JBLK)=0.5_JPRB*ZMFUDR (JLON, JK-1, JBLK)
              ENDIF

            ENDIF

          ENDDO

        ENDDO

      ENDIF


      IF (YDML_PHY_EC%YREPHY%LMFSCAV) THEN
        CALL CUCTRACER (YDCST, YDML_PHY_SLIN%YRCUMFS, YDML_PHY_SLIN%YRECUMF2, YDML_PHY_EC%YRECUMF, YLCPG_BNDS&
        &%KIDIA, YLCPG_BNDS%KFDIA, YDCPG_OPTS%KLON, KLEV, KTRAC, KCTOP(:, JBLK), IDTOP(:, JBLK), KTYPE(:,&
        & JBLK), LLDCUM(:, JBLK), LLDDRAF3(:, JBLK), PTSPHY, PAPH(:,:, JBLK), PAP(:,:, JBLK), ZMFUUS(:,:,&
        & JBLK), ZMFDUS(:,:, JBLK), PMFU(:,:, JBLK), PMFD(:,:, JBLK), ZMFUDR(:,:, JBLK), ZMFDDR(:,:, JBLK&
        &), ZDMFUPC(:,:, JBLK), ZDMFDPC(:,:, JBLK), PCEN(:,:,:, JBLK), PTENC(:,:,:, JBLK), PSCAV)
      ELSE
        ZDMFUPC (:,:, JBLK)=0.0_JPRB
        CALL CUCTRACER (YDCST, YDML_PHY_SLIN%YRCUMFS, YDML_PHY_SLIN%YRECUMF2, YDML_PHY_EC%YRECUMF, YLCPG_BNDS&
        &%KIDIA, YLCPG_BNDS%KFDIA, YDCPG_OPTS%KLON, KLEV, KTRAC, KCTOP(:, JBLK), IDTOP(:, JBLK), KTYPE(:,&
        & JBLK), LLDCUM(:, JBLK), LLDDRAF3(:, JBLK), PTSPHY, PAPH(:,:, JBLK), PAP(:,:, JBLK), ZMFUUS(:,:,&
        & JBLK), ZMFDUS(:,:, JBLK), PMFU(:,:, JBLK), PMFD(:,:, JBLK), ZMFUDR(:,:, JBLK), ZMFDDR(:,:, JBLK&
        &), ZDMFUPC(:,:, JBLK), ZDMFDPC(:,:, JBLK), PCEN(:,:,:, JBLK), PTENC(:,:,:, JBLK), PSCAV0)
      ENDIF

    ENDDO

    IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:16:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)
    
    IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:16:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
    IDTOP => NULL ()
    KCBOT => NULL ()
    KCTOP => NULL ()
    KTYPE => NULL ()
    LDCUM => NULL ()
    LLDCUM => NULL ()
    LLDDRAF => NULL ()
    LLDDRAF3 => NULL ()
    PAP => NULL ()
    PAPH => NULL ()
    PCEN => NULL ()
    PMFD => NULL ()
    PMFDDE_RATE => NULL ()
    PMFLXR => NULL ()
    PMFLXS => NULL ()
    PMFU => NULL ()
    PMFUDE_RATE => NULL ()
    PTENC => NULL ()
    ZDMFDPC => NULL ()
    ZDMFUPC => NULL ()
    ZMFDDR => NULL ()
    ZMFDUS => NULL ()
    ZMFS => NULL ()
    ZMFUDR => NULL ()
    ZMFUUS => NULL ()
    IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:16:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN','CUMASTRN_PARALLEL:16')) THEN
    
    IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:16:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
    IDTOP => GET_DEVICE_DATA_RDONLY (YL_IDTOP)
    KCBOT => GET_DEVICE_DATA_RDONLY (YD_KCBOT)
    KCTOP => GET_DEVICE_DATA_RDONLY (YD_KCTOP)
    KTYPE => GET_DEVICE_DATA_RDONLY (YD_KTYPE)
    LDCUM => GET_DEVICE_DATA_RDONLY (YD_LDCUM)
    LLDCUM => GET_DEVICE_DATA_RDWR (YL_LLDCUM)
    LLDDRAF => GET_DEVICE_DATA_RDONLY (YL_LLDDRAF)
    LLDDRAF3 => GET_DEVICE_DATA_RDWR (YL_LLDDRAF3)
    PAP => GET_DEVICE_DATA_RDONLY (YD_PAP)
    PAPH => GET_DEVICE_DATA_RDONLY (YD_PAPH)
    PCEN => GET_DEVICE_DATA_RDONLY (YD_PCEN)
    PMFD => GET_DEVICE_DATA_RDONLY (YD_PMFD)
    PMFDDE_RATE => GET_DEVICE_DATA_RDONLY (YD_PMFDDE_RATE)
    PMFLXR => GET_DEVICE_DATA_RDONLY (YD_PMFLXR)
    PMFLXS => GET_DEVICE_DATA_RDONLY (YD_PMFLXS)
    PMFU => GET_DEVICE_DATA_RDONLY (YD_PMFU)
    PMFUDE_RATE => GET_DEVICE_DATA_RDONLY (YD_PMFUDE_RATE)
    PTENC => GET_DEVICE_DATA_RDWR (YD_PTENC)
    ZDMFDPC => GET_DEVICE_DATA_RDWR (YL_ZDMFDPC)
    ZDMFUPC => GET_DEVICE_DATA_RDWR (YL_ZDMFUPC)
    ZMFDDR => GET_DEVICE_DATA_RDWR (YL_ZMFDDR)
    ZMFDUS => GET_DEVICE_DATA_RDWR (YL_ZMFDUS)
    ZMFS => GET_DEVICE_DATA_RDWR (YL_ZMFS)
    ZMFUDR => GET_DEVICE_DATA_RDWR (YL_ZMFUDR)
    ZMFUUS => GET_DEVICE_DATA_RDWR (YL_ZMFUUS)
    IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:16:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
    IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:16:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
    
    
      !$ACC PARALLEL LOOP GANG &
      !$ACC&PRESENT (IDTOP, KCBOT, KCTOP, KTYPE, LDCUM, LLDCUM, LLDDRAF, LLDDRAF3, PAP, PAPH, &
      !$ACC&         PCEN, PMFD, PMFDDE_RATE, PMFLXR, PMFLXS, PMFU, PMFUDE_RATE, PTENC, &
      !$ACC&         YFXTRAN_ACDC_STACK, ZDMFDPC, ZDMFUPC, ZMFDDR, ZMFDUS, ZMFS, ZMFUDR, &
      !$ACC&         ZMFUUS) &
      !$ACC&PRIVATE (JBLK) &
      !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
      
      DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
      
      
      
      !$ACC LOOP VECTOR &
      !$ACC&PRIVATE (IKB, JK, JLON, YLCPG_BNDS, YLSTACK, ZERATE, ZMFMAX) 

      

      DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
        YLCPG_BNDS%KIDIA = JLON
        YLCPG_BNDS%KFDIA = JLON
        YLSTACK%L8 = fxtran_acdc_stack_l8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
        YLSTACK%U8 = fxtran_acdc_stack_u8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
        YLSTACK%L4 = fxtran_acdc_stack_l4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
        YLSTACK%U4 = fxtran_acdc_stack_u4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)

        

        

        IF (LDCUM (JLON, JBLK).AND.KTYPE (JLON, JBLK)/=3.AND.KCBOT (JLON, JBLK)-KCTOP (JLON, JBLK)>=1) THEN
          LLDCUM (JLON, JBLK)=.TRUE.
          LLDDRAF3 (JLON, JBLK)=LLDDRAF (JLON, JBLK)
        ELSE
          LLDCUM (JLON, JBLK)=.FALSE.
          LLDDRAF3 (JLON, JBLK)=.FALSE.
        ENDIF

        
        ZMFS (JLON, JBLK)=1.0_JPRB

        IF (YDML_PHY_EC%YRECUMF%RMFSOLCT<=3.0_JPRB) THEN

          DO JK=2, KLEV

            

            IF (LLDCUM (JLON, JBLK).AND.JK>=KCTOP (JLON, JBLK)) THEN
              ZMFMAX=(PAPH (JLON, JK, JBLK)-PAPH (JLON, JK-1, JBLK))*0.8_JPRB*ZCONS

              IF (PMFU (JLON, JK, JBLK)>ZMFMAX)  THEN
                ZMFS (JLON, JBLK)=MIN (ZMFS (JLON, JBLK), ZMFMAX/PMFU (JLON, JK, JBLK))
              ENDIF

            ENDIF

          
          ENDDO

        ENDIF


        DO JK=1, KLEV

          

          IF (LLDCUM (JLON, JBLK).AND.JK>=KCTOP (JLON, JBLK)-1) THEN
            ZMFUUS (JLON, JK, JBLK)=PMFU (JLON, JK, JBLK)*ZMFS (JLON, JBLK)
            ZMFUDR (JLON, JK, JBLK)=PMFUDE_RATE (JLON, JK, JBLK)*ZMFS (JLON, JBLK)
            ZDMFUPC (JLON, JK, JBLK)=(PMFLXR (JLON, JK, JBLK)+PMFLXS (JLON, JK, JBLK))*ZMFS (JLON, JBLK)
            IKB=KCBOT (JLON, JBLK)

            IF (JK>IKB) THEN
              ZDMFUPC (JLON, JK, JBLK)=ZDMFUPC (JLON, IKB, JBLK)
            ENDIF

          ELSE
            ZMFUUS (JLON, JK, JBLK)=0._JPRB
            ZMFUDR (JLON, JK, JBLK)=0._JPRB
          ENDIF


          IF (LLDDRAF3 (JLON, JBLK).AND.JK>=IDTOP (JLON, JBLK)-1) THEN
            ZMFDUS (JLON, JK, JBLK)=PMFD (JLON, JK, JBLK)*ZMFS (JLON, JBLK)
            ZMFDDR (JLON, JK, JBLK)=PMFDDE_RATE (JLON, JK, JBLK)*ZMFS (JLON, JBLK)
            ZDMFDPC (JLON, JK, JBLK)=0.0_JPRB
          ELSE
            ZMFDUS (JLON, JK, JBLK)=0._JPRB
            ZMFDDR (JLON, JK, JBLK)=0._JPRB
          ENDIF

        
        ENDDO


        IF (YDML_PHY_EC%YRECUMF%LMFSMOOTH) THEN

          DO JK=2, KLEV-1

            

            IF (LLDDRAF3 (JLON, JBLK).AND.ZMFDUS (JLON, JK, JBLK)<0.0_JPRB&
              &.AND.ZMFDUS (JLON, JK+1, JBLK)==0.0_JPRB) THEN
              ZERATE=MIN (0._JPRB, ZMFDUS (JLON, JK, JBLK)-0.5*ZMFDUS (JLON, JK-1, JBLK))
              ZMFDUS (JLON, JK, JBLK)=ZMFDUS (JLON, JK, JBLK)-ZERATE
              ZMFDDR (JLON, JK, JBLK)=ZMFDDR (JLON, JK, JBLK)-ZERATE
              ZMFDDR (JLON, JK+1, JBLK)=-ZMFDUS (JLON, JK, JBLK)
            ENDIF


            IF (LLDCUM (JLON, JBLK).AND.JK==KCTOP (JLON, JBLK)) THEN
              ZERATE=MAX (0.0_JPRB, ZMFUUS (JLON, JK, JBLK)-0.5_JPRB*ZMFUUS (JLON, JK+1, JBLK))
              ZMFUUS (JLON, JK, JBLK)=ZMFUUS (JLON, JK, JBLK)-ZERATE
              ZMFUDR (JLON, JK, JBLK)=ZMFUDR (JLON, JK, JBLK)+ZERATE
              ZMFUDR (JLON, JK-1, JBLK)=ZMFUUS (JLON, JK, JBLK)
            ENDIF

          
          ENDDO


          DO JK=KLEV-1, 2,-1

            

            IF (LLDCUM (JLON, JBLK)) THEN

              IF (ZMFUDR (JLON, JK, JBLK)==0.0_JPRB.AND.ZMFUDR (JLON, JK-1, JBLK)>0.0_JPRB) THEN
                ZMFUDR (JLON, JK, JBLK)=0.5_JPRB*ZMFUDR (JLON, JK-1, JBLK)
              ENDIF

            ENDIF

          
          ENDDO

        ENDIF


        IF (YDML_PHY_EC%YREPHY%LMFSCAV) THEN
          CALL CUCTRACER_OPENACC (YDCST, YDML_PHY_SLIN%YRCUMFS, YDML_PHY_SLIN%YRECUMF2, YDML_PHY_EC&
          &%YRECUMF, YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA, YDCPG_OPTS%KLON, KLEV, KTRAC, KCTOP(:,&
          & JBLK), IDTOP(:, JBLK), KTYPE(:, JBLK), LLDCUM(:, JBLK), LLDDRAF3(:, JBLK), PTSPHY, PAPH&
          &(:,:, JBLK), PAP(:,:, JBLK), ZMFUUS(:,:, JBLK), ZMFDUS(:,:, JBLK), PMFU(:,:, JBLK), PMFD&
          &(:,:, JBLK), ZMFUDR(:,:, JBLK), ZMFDDR(:,:, JBLK), ZDMFUPC(:,:, JBLK), ZDMFDPC(:,:, JBLK&
          &), PCEN(:,:,:, JBLK), PTENC(:,:,:, JBLK), PSCAV,YDSTACK=YLSTACK)
        ELSE
          ZDMFUPC (JLON,:, JBLK)=0.0_JPRB
          CALL CUCTRACER_OPENACC (YDCST, YDML_PHY_SLIN%YRCUMFS, YDML_PHY_SLIN%YRECUMF2, YDML_PHY_EC&
          &%YRECUMF, YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA, YDCPG_OPTS%KLON, KLEV, KTRAC, KCTOP(:,&
          & JBLK), IDTOP(:, JBLK), KTYPE(:, JBLK), LLDCUM(:, JBLK), LLDDRAF3(:, JBLK), PTSPHY, PAPH&
          &(:,:, JBLK), PAP(:,:, JBLK), ZMFUUS(:,:, JBLK), ZMFDUS(:,:, JBLK), PMFU(:,:, JBLK), PMFD&
          &(:,:, JBLK), ZMFUDR(:,:, JBLK), ZMFDDR(:,:, JBLK), ZDMFUPC(:,:, JBLK), ZDMFDPC(:,:, JBLK&
          &), PCEN(:,:,:, JBLK), PTENC(:,:,:, JBLK), PSCAV0,YDSTACK=YLSTACK)
        ENDIF

      ENDDO

    ENDDO

    IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:16:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)
    
    IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:16:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
    IDTOP => NULL ()
    KCBOT => NULL ()
    KCTOP => NULL ()
    KTYPE => NULL ()
    LDCUM => NULL ()
    LLDCUM => NULL ()
    LLDDRAF => NULL ()
    LLDDRAF3 => NULL ()
    PAP => NULL ()
    PAPH => NULL ()
    PCEN => NULL ()
    PMFD => NULL ()
    PMFDDE_RATE => NULL ()
    PMFLXR => NULL ()
    PMFLXS => NULL ()
    PMFU => NULL ()
    PMFUDE_RATE => NULL ()
    PTENC => NULL ()
    ZDMFDPC => NULL ()
    ZDMFUPC => NULL ()
    ZMFDDR => NULL ()
    ZMFDUS => NULL ()
    ZMFS => NULL ()
    ZMFUDR => NULL ()
    ZMFUUS => NULL ()
    IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:16:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ELSE
      CALL ABOR1 ('CUMASTRN_PARALLEL: NOT METHOD WAS FOUND')
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:16',1,ZHOOK_HANDLE_PARALLEL)
ENDIF

IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:17',0,ZHOOK_HANDLE_PARALLEL)

IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','CUMASTRN_PARALLEL:17')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:17:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  KCTOP => GET_HOST_DATA_RDONLY (YD_KCTOP)
  LDCUM => GET_HOST_DATA_RDONLY (YD_LDCUM)
  PAP => GET_HOST_DATA_RDONLY (YD_PAP)
  PDISS => GET_HOST_DATA_RDWR (YD_PDISS)
  PENTH => GET_HOST_DATA_RDWR (YD_PENTH)
  PGEOH => GET_HOST_DATA_RDONLY (YD_PGEOH)
  PLU => GET_HOST_DATA_RDWR (YD_PLU)
  PLUDE => GET_HOST_DATA_RDWR (YD_PLUDE)
  PLUDELI => GET_HOST_DATA_RDWR (YD_PLUDELI)
  PMFD => GET_HOST_DATA_RDWR (YD_PMFD)
  PMFDDE_RATE => GET_HOST_DATA_RDWR (YD_PMFDDE_RATE)
  PMFLXR => GET_HOST_DATA_RDONLY (YD_PMFLXR)
  PMFLXS => GET_HOST_DATA_RDONLY (YD_PMFLXS)
  PMFU => GET_HOST_DATA_RDWR (YD_PMFU)
  PMFUDE_RATE => GET_HOST_DATA_RDWR (YD_PMFUDE_RATE)
  PQEN => GET_HOST_DATA_RDONLY (YD_PQEN)
  PQU => GET_HOST_DATA_RDWR (YD_PQU)
  PRSUD => GET_HOST_DATA_RDWR (YD_PRSUD)
  PSNDE => GET_HOST_DATA_RDWR (YD_PSNDE)
  PTEN => GET_HOST_DATA_RDONLY (YD_PTEN)
  PTENU => GET_HOST_DATA_RDONLY (YD_PTENU)
  PTENV => GET_HOST_DATA_RDONLY (YD_PTENV)
  PTU => GET_HOST_DATA_RDWR (YD_PTU)
  PUEN => GET_HOST_DATA_RDONLY (YD_PUEN)
  PVEN => GET_HOST_DATA_RDONLY (YD_PVEN)
  ZQD => GET_HOST_DATA_RDONLY (YL_ZQD)
  ZQENH => GET_HOST_DATA_RDONLY (YL_ZQENH)
  ZTD => GET_HOST_DATA_RDONLY (YL_ZTD)
  ZTENH => GET_HOST_DATA_RDONLY (YL_ZTENH)
  ZTENU => GET_HOST_DATA_RDONLY (YL_ZTENU)
  ZTENV => GET_HOST_DATA_RDONLY (YL_ZTENV)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:17:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:17:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
  !$OMP PARALLEL DO PRIVATE (IK, IKD, JBLK, JK, JLON, ZAK, ZAR, ZAS, ZBR, ZBS, ZDUTEN, ZDVTEN, ZRO) FIRSTPRIVATE (YLCPG_BNDS)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    CALL YLCPG_BNDS%UPDATE (JBLK)
    
    PDISS (:, 1, JBLK)=0.0_JPRB
    ZAR=1.0_JPRB/20.89_JPRB
    ZAS=1.0_JPRB/29.51_JPRB
    ZBR=1.0_JPRB/1.15_JPRB
    ZBS=1.0_JPRB/1.10_JPRB
    ZAK=1.0_JPRB/5.09E-3_JPRB

    DO JK=1, KLEV
      IK=MIN (JK+1, KLEV)
      IKD=MAX (JK-1, 1)

      DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
        PDISS (JLON, JK, JBLK)=0.0_JPRB
        PRSUD (JLON, JK, 1, JBLK)=0.0_JPRB
        PRSUD (JLON, JK, 2, JBLK)=0.0_JPRB

        IF (LDCUM (JLON, JBLK).AND.JK>=KCTOP (JLON, JBLK)-1) THEN
          PLUDELI (JLON, JK, 3, JBLK)=PMFUDE_RATE (JLON, JK, JBLK)*(PQU (JLON, IK, JBLK)-ZQENH (JLON,&
          & IK, JBLK))+PMFDDE_RATE (JLON, JK, JBLK)*(ZQD (JLON, IKD, JBLK)-ZQENH (JLON, IKD, JBLK))
          PLUDELI (JLON, JK, 4, JBLK)=PMFUDE_RATE (JLON, JK, JBLK)*(PTU (JLON, IK, JBLK)-ZTENH (JLON,&
          & IK, JBLK))+PMFDDE_RATE (JLON, JK, JBLK)*(ZTD (JLON, IKD, JBLK)-ZTENH (JLON, IKD, JBLK))
          ZRO=YDCST%RG/(PGEOH (JLON, JK, JBLK)-PGEOH (JLON, JK+1, JBLK))
          PMFUDE_RATE (JLON, JK, JBLK)=PMFUDE_RATE (JLON, JK, JBLK)*ZRO
          PMFDDE_RATE (JLON, JK, JBLK)=PMFDDE_RATE (JLON, JK, JBLK)*ZRO
          ZRO=YDCST%RD*PTEN (JLON, JK, JBLK)*(1.0_JPRB+YDCST%RETV*PQEN (JLON, JK, JBLK))/PAP (JLON, JK, JBLK)
          ZDUTEN=PTENU (JLON, JK, JBLK)-ZTENU (JLON, JK, JBLK)
          ZDVTEN=PTENV (JLON, JK, JBLK)-ZTENV (JLON, JK, JBLK)
          PDISS (JLON, JK, JBLK)=ABS (PUEN (JLON, JK, JBLK)*ZDUTEN+PVEN (JLON, JK, JBLK)*ZDVTEN)**0.3333
          PRSUD (JLON, JK, 1, JBLK)=1.E-3_JPRB*ZRO*(PMFLXR (JLON, JK, JBLK)*3600._JPRB*ZAR)**ZBR
          PRSUD (JLON, JK, 2, JBLK)=0.5*1.E-3_JPRB*ZRO*(10.0_JPRB*PMFLXS (JLON, JK, JBLK)*3600._JPRB*ZAS)**ZBS
        ELSE
          PMFU (JLON, JK, JBLK)=0.0_JPRB
          PMFD (JLON, JK, JBLK)=0.0_JPRB
          PLUDE (JLON, JK, JBLK)=0.0_JPRB
          PLUDELI (JLON, JK, 1, JBLK)=0.0_JPRB
          PLUDELI (JLON, JK, 2, JBLK)=0.0_JPRB
          PLUDELI (JLON, JK, 3, JBLK)=0.0_JPRB
          PLUDELI (JLON, JK, 4, JBLK)=0.0_JPRB
          PSNDE (JLON, JK, 1, JBLK)=0.0_JPRB
          PSNDE (JLON, JK, 2, JBLK)=0.0_JPRB
          PTU (JLON, JK, JBLK)=PTEN (JLON, JK, JBLK)
          PQU (JLON, JK, JBLK)=PQEN (JLON, JK, JBLK)
          PLU (JLON, JK, JBLK)=0.0_JPRB
          PENTH (JLON, JK, JBLK)=0.0_JPRB
          PMFUDE_RATE (JLON, JK, JBLK)=0.0_JPRB
          PMFDDE_RATE (JLON, JK, JBLK)=0.0_JPRB
        ENDIF

      ENDDO

    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:17:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:17:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  KCTOP => NULL ()
  LDCUM => NULL ()
  PAP => NULL ()
  PDISS => NULL ()
  PENTH => NULL ()
  PGEOH => NULL ()
  PLU => NULL ()
  PLUDE => NULL ()
  PLUDELI => NULL ()
  PMFD => NULL ()
  PMFDDE_RATE => NULL ()
  PMFLXR => NULL ()
  PMFLXS => NULL ()
  PMFU => NULL ()
  PMFUDE_RATE => NULL ()
  PQEN => NULL ()
  PQU => NULL ()
  PRSUD => NULL ()
  PSNDE => NULL ()
  PTEN => NULL ()
  PTENU => NULL ()
  PTENV => NULL ()
  PTU => NULL ()
  PUEN => NULL ()
  PVEN => NULL ()
  ZQD => NULL ()
  ZQENH => NULL ()
  ZTD => NULL ()
  ZTENH => NULL ()
  ZTENU => NULL ()
  ZTENV => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:17:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN','CUMASTRN_PARALLEL:17')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:17:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  KCTOP => GET_DEVICE_DATA_RDONLY (YD_KCTOP)
  LDCUM => GET_DEVICE_DATA_RDONLY (YD_LDCUM)
  PAP => GET_DEVICE_DATA_RDONLY (YD_PAP)
  PDISS => GET_DEVICE_DATA_RDWR (YD_PDISS)
  PENTH => GET_DEVICE_DATA_RDWR (YD_PENTH)
  PGEOH => GET_DEVICE_DATA_RDONLY (YD_PGEOH)
  PLU => GET_DEVICE_DATA_RDWR (YD_PLU)
  PLUDE => GET_DEVICE_DATA_RDWR (YD_PLUDE)
  PLUDELI => GET_DEVICE_DATA_RDWR (YD_PLUDELI)
  PMFD => GET_DEVICE_DATA_RDWR (YD_PMFD)
  PMFDDE_RATE => GET_DEVICE_DATA_RDWR (YD_PMFDDE_RATE)
  PMFLXR => GET_DEVICE_DATA_RDONLY (YD_PMFLXR)
  PMFLXS => GET_DEVICE_DATA_RDONLY (YD_PMFLXS)
  PMFU => GET_DEVICE_DATA_RDWR (YD_PMFU)
  PMFUDE_RATE => GET_DEVICE_DATA_RDWR (YD_PMFUDE_RATE)
  PQEN => GET_DEVICE_DATA_RDONLY (YD_PQEN)
  PQU => GET_DEVICE_DATA_RDWR (YD_PQU)
  PRSUD => GET_DEVICE_DATA_RDWR (YD_PRSUD)
  PSNDE => GET_DEVICE_DATA_RDWR (YD_PSNDE)
  PTEN => GET_DEVICE_DATA_RDONLY (YD_PTEN)
  PTENU => GET_DEVICE_DATA_RDONLY (YD_PTENU)
  PTENV => GET_DEVICE_DATA_RDONLY (YD_PTENV)
  PTU => GET_DEVICE_DATA_RDWR (YD_PTU)
  PUEN => GET_DEVICE_DATA_RDONLY (YD_PUEN)
  PVEN => GET_DEVICE_DATA_RDONLY (YD_PVEN)
  ZQD => GET_DEVICE_DATA_RDONLY (YL_ZQD)
  ZQENH => GET_DEVICE_DATA_RDONLY (YL_ZQENH)
  ZTD => GET_DEVICE_DATA_RDONLY (YL_ZTD)
  ZTENH => GET_DEVICE_DATA_RDONLY (YL_ZTENH)
  ZTENU => GET_DEVICE_DATA_RDONLY (YL_ZTENU)
  ZTENV => GET_DEVICE_DATA_RDONLY (YL_ZTENV)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:17:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:17:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  
    !$ACC PARALLEL LOOP GANG &
    !$ACC&PRESENT (KCTOP, LDCUM, PAP, PDISS, PENTH, PGEOH, PLU, PLUDE, PLUDELI, PMFD, PMFDDE_RATE, &
    !$ACC&         PMFLXR, PMFLXS, PMFU, PMFUDE_RATE, PQEN, PQU, PRSUD, PSNDE, PTEN, PTENU, &
    !$ACC&         PTENV, PTU, PUEN, PVEN, YFXTRAN_ACDC_STACK, ZQD, ZQENH, ZTD, ZTENH, ZTENU, &
    !$ACC&         ZTENV) &
    !$ACC&PRIVATE (JBLK) &
    !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
    
    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    
    
    
    !$ACC LOOP VECTOR &
    !$ACC&PRIVATE (IK, IKD, JK, JLON, YLCPG_BNDS, ZAK, ZAR, ZAS, ZBR, ZBS, ZDUTEN, ZDVTEN, ZRO) 

    

    DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JLON
      YLCPG_BNDS%KFDIA = JLON
      
      PDISS (JLON, 1, JBLK)=0.0_JPRB
      ZAR=1.0_JPRB/20.89_JPRB
      ZAS=1.0_JPRB/29.51_JPRB
      ZBR=1.0_JPRB/1.15_JPRB
      ZBS=1.0_JPRB/1.10_JPRB
      ZAK=1.0_JPRB/5.09E-3_JPRB

      DO JK=1, KLEV
        IK=MIN (JK+1, KLEV)
        IKD=MAX (JK-1, 1)
        
        PDISS (JLON, JK, JBLK)=0.0_JPRB
        PRSUD (JLON, JK, 1, JBLK)=0.0_JPRB
        PRSUD (JLON, JK, 2, JBLK)=0.0_JPRB

        IF (LDCUM (JLON, JBLK).AND.JK>=KCTOP (JLON, JBLK)-1) THEN
          PLUDELI (JLON, JK, 3, JBLK)=PMFUDE_RATE (JLON, JK, JBLK)*(PQU (JLON, IK, JBLK)-ZQENH (JLON,&
          & IK, JBLK))+PMFDDE_RATE (JLON, JK, JBLK)*(ZQD (JLON, IKD, JBLK)-ZQENH (JLON, IKD, JBLK))
          PLUDELI (JLON, JK, 4, JBLK)=PMFUDE_RATE (JLON, JK, JBLK)*(PTU (JLON, IK, JBLK)-ZTENH (JLON,&
          & IK, JBLK))+PMFDDE_RATE (JLON, JK, JBLK)*(ZTD (JLON, IKD, JBLK)-ZTENH (JLON, IKD, JBLK))
          ZRO=YDCST%RG/(PGEOH (JLON, JK, JBLK)-PGEOH (JLON, JK+1, JBLK))
          PMFUDE_RATE (JLON, JK, JBLK)=PMFUDE_RATE (JLON, JK, JBLK)*ZRO
          PMFDDE_RATE (JLON, JK, JBLK)=PMFDDE_RATE (JLON, JK, JBLK)*ZRO
          ZRO=YDCST%RD*PTEN (JLON, JK, JBLK)*(1.0_JPRB+YDCST%RETV*PQEN (JLON, JK, JBLK))/PAP (JLON, JK, JBLK)
          ZDUTEN=PTENU (JLON, JK, JBLK)-ZTENU (JLON, JK, JBLK)
          ZDVTEN=PTENV (JLON, JK, JBLK)-ZTENV (JLON, JK, JBLK)
          PDISS (JLON, JK, JBLK)=ABS (PUEN (JLON, JK, JBLK)*ZDUTEN+PVEN (JLON, JK, JBLK)*ZDVTEN)**0.3333
          PRSUD (JLON, JK, 1, JBLK)=1.E-3_JPRB*ZRO*(PMFLXR (JLON, JK, JBLK)*3600._JPRB*ZAR)**ZBR
          PRSUD (JLON, JK, 2, JBLK)=0.5*1.E-3_JPRB*ZRO*(10.0_JPRB*PMFLXS (JLON, JK, JBLK)*3600._JPRB*ZAS)**ZBS
        ELSE
          PMFU (JLON, JK, JBLK)=0.0_JPRB
          PMFD (JLON, JK, JBLK)=0.0_JPRB
          PLUDE (JLON, JK, JBLK)=0.0_JPRB
          PLUDELI (JLON, JK, 1, JBLK)=0.0_JPRB
          PLUDELI (JLON, JK, 2, JBLK)=0.0_JPRB
          PLUDELI (JLON, JK, 3, JBLK)=0.0_JPRB
          PLUDELI (JLON, JK, 4, JBLK)=0.0_JPRB
          PSNDE (JLON, JK, 1, JBLK)=0.0_JPRB
          PSNDE (JLON, JK, 2, JBLK)=0.0_JPRB
          PTU (JLON, JK, JBLK)=PTEN (JLON, JK, JBLK)
          PQU (JLON, JK, JBLK)=PQEN (JLON, JK, JBLK)
          PLU (JLON, JK, JBLK)=0.0_JPRB
          PENTH (JLON, JK, JBLK)=0.0_JPRB
          PMFUDE_RATE (JLON, JK, JBLK)=0.0_JPRB
          PMFDDE_RATE (JLON, JK, JBLK)=0.0_JPRB
        ENDIF

      
      ENDDO

    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:17:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)
  
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:17:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  KCTOP => NULL ()
  LDCUM => NULL ()
  PAP => NULL ()
  PDISS => NULL ()
  PENTH => NULL ()
  PGEOH => NULL ()
  PLU => NULL ()
  PLUDE => NULL ()
  PLUDELI => NULL ()
  PMFD => NULL ()
  PMFDDE_RATE => NULL ()
  PMFLXR => NULL ()
  PMFLXS => NULL ()
  PMFU => NULL ()
  PMFUDE_RATE => NULL ()
  PQEN => NULL ()
  PQU => NULL ()
  PRSUD => NULL ()
  PSNDE => NULL ()
  PTEN => NULL ()
  PTENU => NULL ()
  PTENV => NULL ()
  PTU => NULL ()
  PUEN => NULL ()
  PVEN => NULL ()
  ZQD => NULL ()
  ZQENH => NULL ()
  ZTD => NULL ()
  ZTENH => NULL ()
  ZTENU => NULL ()
  ZTENV => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:17:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSE
    CALL ABOR1 ('CUMASTRN_PARALLEL: NOT METHOD WAS FOUND')
ENDIF

IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL:17',1,ZHOOK_HANDLE_PARALLEL)

IF (LHOOK) CALL DR_HOOK ('DELETE_TEMPORARIES',0,ZHOOK_HANDLE_FIELD_API)
IF (ASSOCIATED (YL_ICTOP0)) CALL FIELD_DELETE (YL_ICTOP0)
IF (ASSOCIATED (YL_IDPL)) CALL FIELD_DELETE (YL_IDPL)
IF (ASSOCIATED (YL_IDTOP)) CALL FIELD_DELETE (YL_IDTOP)
IF (ASSOCIATED (YL_ILAB)) CALL FIELD_DELETE (YL_ILAB)
IF (ASSOCIATED (YL_LLDCUM)) CALL FIELD_DELETE (YL_LLDCUM)
IF (ASSOCIATED (YL_LLDDRAF)) CALL FIELD_DELETE (YL_LLDDRAF)
IF (ASSOCIATED (YL_LLDDRAF3)) CALL FIELD_DELETE (YL_LLDDRAF3)
IF (ASSOCIATED (YL_LLO2)) CALL FIELD_DELETE (YL_LLO2)
IF (ASSOCIATED (YL_LLSCVFLAG)) CALL FIELD_DELETE (YL_LLSCVFLAG)
IF (ASSOCIATED (YL_ZCAPDCYCL)) CALL FIELD_DELETE (YL_ZCAPDCYCL)
IF (ASSOCIATED (YL_ZCAPDCYCLLD)) CALL FIELD_DELETE (YL_ZCAPDCYCLLD)
IF (ASSOCIATED (YL_ZCAPDCYCLSE)) CALL FIELD_DELETE (YL_ZCAPDCYCLSE)
IF (ASSOCIATED (YL_ZCAPE)) CALL FIELD_DELETE (YL_ZCAPE)
IF (ASSOCIATED (YL_ZCAPE2)) CALL FIELD_DELETE (YL_ZCAPE2)
IF (ASSOCIATED (YL_ZCAPPBL)) CALL FIELD_DELETE (YL_ZCAPPBL)
IF (ASSOCIATED (YL_ZDHPBL)) CALL FIELD_DELETE (YL_ZDHPBL)
IF (ASSOCIATED (YL_ZDMFDE)) CALL FIELD_DELETE (YL_ZDMFDE)
IF (ASSOCIATED (YL_ZDMFDP)) CALL FIELD_DELETE (YL_ZDMFDP)
IF (ASSOCIATED (YL_ZDMFDPC)) CALL FIELD_DELETE (YL_ZDMFDPC)
IF (ASSOCIATED (YL_ZDMFEN)) CALL FIELD_DELETE (YL_ZDMFEN)
IF (ASSOCIATED (YL_ZDMFUP)) CALL FIELD_DELETE (YL_ZDMFUP)
IF (ASSOCIATED (YL_ZDMFUPC)) CALL FIELD_DELETE (YL_ZDMFUPC)
IF (ASSOCIATED (YL_ZDPMEL)) CALL FIELD_DELETE (YL_ZDPMEL)
IF (ASSOCIATED (YL_ZDQCV)) CALL FIELD_DELETE (YL_ZDQCV)
IF (ASSOCIATED (YL_ZDX)) CALL FIELD_DELETE (YL_ZDX)
IF (ASSOCIATED (YL_ZFACCA)) CALL FIELD_DELETE (YL_ZFACCA)
IF (ASSOCIATED (YL_ZHEAT)) CALL FIELD_DELETE (YL_ZHEAT)
IF (ASSOCIATED (YL_ZKHFL)) CALL FIELD_DELETE (YL_ZKHFL)
IF (ASSOCIATED (YL_ZKHVFL)) CALL FIELD_DELETE (YL_ZKHVFL)
IF (ASSOCIATED (YL_ZKINED)) CALL FIELD_DELETE (YL_ZKINED)
IF (ASSOCIATED (YL_ZKINEU)) CALL FIELD_DELETE (YL_ZKINEU)
IF (ASSOCIATED (YL_ZKMFL)) CALL FIELD_DELETE (YL_ZKMFL)
IF (ASSOCIATED (YL_ZMFCFL)) CALL FIELD_DELETE (YL_ZMFCFL)
IF (ASSOCIATED (YL_ZMFDDR)) CALL FIELD_DELETE (YL_ZMFDDR)
IF (ASSOCIATED (YL_ZMFDQ)) CALL FIELD_DELETE (YL_ZMFDQ)
IF (ASSOCIATED (YL_ZMFDS)) CALL FIELD_DELETE (YL_ZMFDS)
IF (ASSOCIATED (YL_ZMFDUS)) CALL FIELD_DELETE (YL_ZMFDUS)
IF (ASSOCIATED (YL_ZMFS)) CALL FIELD_DELETE (YL_ZMFS)
IF (ASSOCIATED (YL_ZMFUB)) CALL FIELD_DELETE (YL_ZMFUB)
IF (ASSOCIATED (YL_ZMFUB1)) CALL FIELD_DELETE (YL_ZMFUB1)
IF (ASSOCIATED (YL_ZMFUDR)) CALL FIELD_DELETE (YL_ZMFUDR)
IF (ASSOCIATED (YL_ZMFUL)) CALL FIELD_DELETE (YL_ZMFUL)
IF (ASSOCIATED (YL_ZMFUQ)) CALL FIELD_DELETE (YL_ZMFUQ)
IF (ASSOCIATED (YL_ZMFUS)) CALL FIELD_DELETE (YL_ZMFUS)
IF (ASSOCIATED (YL_ZMFUUB)) CALL FIELD_DELETE (YL_ZMFUUB)
IF (ASSOCIATED (YL_ZMFUUS)) CALL FIELD_DELETE (YL_ZMFUUS)
IF (ASSOCIATED (YL_ZMFUVB)) CALL FIELD_DELETE (YL_ZMFUVB)
IF (ASSOCIATED (YL_ZMF_SHAL)) CALL FIELD_DELETE (YL_ZMF_SHAL)
IF (ASSOCIATED (YL_ZQD)) CALL FIELD_DELETE (YL_ZQD)
IF (ASSOCIATED (YL_ZQENH)) CALL FIELD_DELETE (YL_ZQENH)
IF (ASSOCIATED (YL_ZQENH2)) CALL FIELD_DELETE (YL_ZQENH2)
IF (ASSOCIATED (YL_ZQSENH)) CALL FIELD_DELETE (YL_ZQSENH)
IF (ASSOCIATED (YL_ZRFL)) CALL FIELD_DELETE (YL_ZRFL)
IF (ASSOCIATED (YL_ZSATFR)) CALL FIELD_DELETE (YL_ZSATFR)
IF (ASSOCIATED (YL_ZSUM12)) CALL FIELD_DELETE (YL_ZSUM12)
IF (ASSOCIATED (YL_ZSUM22)) CALL FIELD_DELETE (YL_ZSUM22)
IF (ASSOCIATED (YL_ZTAU)) CALL FIELD_DELETE (YL_ZTAU)
IF (ASSOCIATED (YL_ZTAUPBL)) CALL FIELD_DELETE (YL_ZTAUPBL)
IF (ASSOCIATED (YL_ZTD)) CALL FIELD_DELETE (YL_ZTD)
IF (ASSOCIATED (YL_ZTENH)) CALL FIELD_DELETE (YL_ZTENH)
IF (ASSOCIATED (YL_ZTENH2)) CALL FIELD_DELETE (YL_ZTENH2)
IF (ASSOCIATED (YL_ZTENU)) CALL FIELD_DELETE (YL_ZTENU)
IF (ASSOCIATED (YL_ZTENV)) CALL FIELD_DELETE (YL_ZTENV)
IF (ASSOCIATED (YL_ZUD)) CALL FIELD_DELETE (YL_ZUD)
IF (ASSOCIATED (YL_ZUU)) CALL FIELD_DELETE (YL_ZUU)
IF (ASSOCIATED (YL_ZUV2)) CALL FIELD_DELETE (YL_ZUV2)
IF (ASSOCIATED (YL_ZVD)) CALL FIELD_DELETE (YL_ZVD)
IF (ASSOCIATED (YL_ZVU)) CALL FIELD_DELETE (YL_ZVU)
IF (ASSOCIATED (YL_ZWUBASE)) CALL FIELD_DELETE (YL_ZWUBASE)
IF (ASSOCIATED (YL_ZXTAU)) CALL FIELD_DELETE (YL_ZXTAU)
IF (LHOOK) CALL DR_HOOK ('DELETE_TEMPORARIES',1,ZHOOK_HANDLE_FIELD_API)
IF (LHOOK) CALL DR_HOOK ('CUMASTRN_PARALLEL', 1, ZHOOK_HANDLE)
END SUBROUTINE CUMASTRN_PARALLEL
