MODULE UTIL_TRCOEF_MOD

USE YOMRCOEF, ONLY : TRCOEF

INTERFACE ACDC_SAVE
MODULE PROCEDURE ACDC_SAVE_TRCOEF
END INTERFACE

INTERFACE ACDC_LOAD
MODULE PROCEDURE ACDC_LOAD_TRCOEF
END INTERFACE

INTERFACE ACDC_COPY
MODULE PROCEDURE ACDC_COPY_TRCOEF
END INTERFACE

INTERFACE ACDC_HOST
MODULE PROCEDURE ACDC_HOST_TRCOEF
END INTERFACE


INTERFACE ACDC_CRC64
MODULE PROCEDURE ACDC_CRC64_TRCOEF
END INTERFACE

INTERFACE ACDC_WIPE
MODULE PROCEDURE ACDC_WIPE_TRCOEF
END INTERFACE

INTERFACE ACDC_SIZE
MODULE PROCEDURE ACDC_SIZE_TRCOEF
END INTERFACE

CONTAINS

SUBROUTINE ACDC_SAVE_TRCOEF (SELF, KLUN)

IMPLICIT NONE
TYPE (TRCOEF), INTENT (IN), TARGET :: SELF
INTEGER, INTENT (IN) :: KLUN
LOGICAL :: LSOLRAD, LTHERRAD, LTRMATSUM, LTRWEIGHT
WRITE (KLUN) SELF%LRCOEF
WRITE (KLUN) SELF%LTLADDIA
WRITE (KLUN) SELF%LGLOBRAD
WRITE (KLUN) SELF%NG3SR
WRITE (KLUN) SELF%NGMTR
WRITE (KLUN) SELF%NLATWR
WRITE (KLUN) SELF%NLATRD
WRITE (KLUN) SELF%NLENGSRB
WRITE (KLUN) SELF%NLENGTRB
LSOLRAD = ALLOCATED (SELF%SOLRAD)
WRITE (KLUN) LSOLRAD
IF (LSOLRAD) THEN
  WRITE (KLUN) LBOUND (SELF%SOLRAD)
  WRITE (KLUN) UBOUND (SELF%SOLRAD)
  WRITE (KLUN) SELF%SOLRAD
ENDIF
LTHERRAD = ALLOCATED (SELF%THERRAD)
WRITE (KLUN) LTHERRAD
IF (LTHERRAD) THEN
  WRITE (KLUN) LBOUND (SELF%THERRAD)
  WRITE (KLUN) UBOUND (SELF%THERRAD)
  WRITE (KLUN) SELF%THERRAD
ENDIF
LTRWEIGHT = ALLOCATED (SELF%TRWEIGHT)
WRITE (KLUN) LTRWEIGHT
IF (LTRWEIGHT) THEN
  WRITE (KLUN) LBOUND (SELF%TRWEIGHT)
  WRITE (KLUN) UBOUND (SELF%TRWEIGHT)
  WRITE (KLUN) SELF%TRWEIGHT
ENDIF
LTRMATSUM = ALLOCATED (SELF%TRMATSUM)
WRITE (KLUN) LTRMATSUM
IF (LTRMATSUM) THEN
  WRITE (KLUN) LBOUND (SELF%TRMATSUM)
  WRITE (KLUN) UBOUND (SELF%TRMATSUM)
  WRITE (KLUN) SELF%TRMATSUM
ENDIF
END SUBROUTINE

SUBROUTINE ACDC_LOAD_TRCOEF (SELF, KLUN)
USE PARKIND1, ONLY : JPRD
IMPLICIT NONE
TYPE (TRCOEF), INTENT (OUT), TARGET :: SELF
INTEGER, INTENT (IN) :: KLUN
INTEGER :: IL1(1), IU1(1), IL2(2), IU2(2)
LOGICAL :: LSOLRAD, LTHERRAD, LTRMATSUM, LTRWEIGHT
REAL(KIND=JPRD), ALLOCATABLE :: ZTMP1 (:)
REAL(KIND=JPRD), ALLOCATABLE :: ZTMP2 (:,:)
READ (KLUN) SELF%LRCOEF
READ (KLUN) SELF%LTLADDIA
READ (KLUN) SELF%LGLOBRAD
READ (KLUN) SELF%NG3SR
READ (KLUN) SELF%NGMTR
READ (KLUN) SELF%NLATWR
READ (KLUN) SELF%NLATRD
READ (KLUN) SELF%NLENGSRB
READ (KLUN) SELF%NLENGTRB
READ (KLUN) LSOLRAD
IF (LSOLRAD) THEN
  READ (KLUN) IL1
  READ (KLUN) IU1
  ALLOCATE (SELF%SOLRAD (IL1(1):IU1(1)))
  ALLOCATE (ZTMP1(LBOUND(SELF%SOLRAD,1):UBOUND(SELF%SOLRAD,1)))
  READ (KLUN) ZTMP1
  SELF%SOLRAD = ZTMP1
  DEALLOCATE (ZTMP1)
ENDIF
READ (KLUN) LTHERRAD
IF (LTHERRAD) THEN
  READ (KLUN) IL2
  READ (KLUN) IU2
  ALLOCATE (SELF%THERRAD (IL2(1):IU2(1), IL2(2):IU2(2)))
  ALLOCATE (ZTMP2(LBOUND(SELF%THERRAD,1):UBOUND(SELF%THERRAD,1), LBOUND(SELF%THERRAD,2):UBOUND(SELF%THERRAD,2)))
  READ (KLUN) ZTMP2
  SELF%THERRAD = ZTMP2
  DEALLOCATE (ZTMP2)
ENDIF
READ (KLUN) LTRWEIGHT
IF (LTRWEIGHT) THEN
  READ (KLUN) IL2
  READ (KLUN) IU2
  ALLOCATE (SELF%TRWEIGHT (IL2(1):IU2(1), IL2(2):IU2(2)))
  ALLOCATE (ZTMP2(LBOUND(SELF%TRWEIGHT,1):UBOUND(SELF%TRWEIGHT,1), LBOUND(SELF%TRWEIGHT,2):UBOUND(SELF%TRWEIGHT,2)))
  READ (KLUN) ZTMP2
  SELF%TRWEIGHT = ZTMP2
  DEALLOCATE (ZTMP2)
ENDIF
READ (KLUN) LTRMATSUM
IF (LTRMATSUM) THEN
  READ (KLUN) IL2
  READ (KLUN) IU2
  ALLOCATE (SELF%TRMATSUM (IL2(1):IU2(1), IL2(2):IU2(2)))
  ALLOCATE (ZTMP2(LBOUND(SELF%TRMATSUM,1):UBOUND(SELF%TRMATSUM,1), LBOUND(SELF%TRMATSUM,2):UBOUND(SELF%TRMATSUM,2)))
  READ (KLUN) ZTMP2
  SELF%TRMATSUM = ZTMP2
  DEALLOCATE (ZTMP2)
ENDIF
END SUBROUTINE

SUBROUTINE ACDC_COPY_TRCOEF (SELF, LDCREATED, LDFIELDAPI)

IMPLICIT NONE
TYPE (TRCOEF), INTENT (IN), TARGET :: SELF
LOGICAL, OPTIONAL, INTENT (IN) :: LDCREATED, LDFIELDAPI
LOGICAL :: LLCREATED
LOGICAL :: LLFIELDAPI
LOGICAL :: LSOLRAD, LTHERRAD, LTRMATSUM, LTRWEIGHT
LLFIELDAPI = .FALSE.
IF (PRESENT (LDFIELDAPI)) THEN
  LLFIELDAPI = LDFIELDAPI
ENDIF
LLCREATED = .FALSE.
IF (PRESENT (LDCREATED)) THEN
  LLCREATED = LDCREATED
ENDIF
IF (.NOT. LLCREATED) THEN
  !$ACC ENTER DATA CREATE (SELF)
  !$ACC UPDATE DEVICE (SELF)
ENDIF

LSOLRAD = ALLOCATED (SELF%SOLRAD)
IF (LSOLRAD) THEN
  !$ACC ENTER DATA CREATE (SELF%SOLRAD)
  !$ACC UPDATE DEVICE (SELF%SOLRAD)
  !$ACC ENTER DATA ATTACH (SELF%SOLRAD)
ENDIF

LTHERRAD = ALLOCATED (SELF%THERRAD)
IF (LTHERRAD) THEN
  !$ACC ENTER DATA CREATE (SELF%THERRAD)
  !$ACC UPDATE DEVICE (SELF%THERRAD)
  !$ACC ENTER DATA ATTACH (SELF%THERRAD)
ENDIF

LTRWEIGHT = ALLOCATED (SELF%TRWEIGHT)
IF (LTRWEIGHT) THEN
  !$ACC ENTER DATA CREATE (SELF%TRWEIGHT)
  !$ACC UPDATE DEVICE (SELF%TRWEIGHT)
  !$ACC ENTER DATA ATTACH (SELF%TRWEIGHT)
ENDIF

LTRMATSUM = ALLOCATED (SELF%TRMATSUM)
IF (LTRMATSUM) THEN
  !$ACC ENTER DATA CREATE (SELF%TRMATSUM)
  !$ACC UPDATE DEVICE (SELF%TRMATSUM)
  !$ACC ENTER DATA ATTACH (SELF%TRMATSUM)
ENDIF

END SUBROUTINE

SUBROUTINE ACDC_HOST_TRCOEF (SELF)

IMPLICIT NONE
TYPE (TRCOEF), TARGET :: SELF
LOGICAL :: LSOLRAD, LTHERRAD, LTRMATSUM, LTRWEIGHT

END SUBROUTINE



SUBROUTINE ACDC_CRC64_TRCOEF (SELF, KLUN, CDPATH)
USE FXTRAN_ACDC_CRC64_INTRINSIC_MOD, ONLY : FCRC64 => FXTRAN_ACDC_CRC64
IMPLICIT NONE
TYPE (TRCOEF), TARGET :: SELF
INTEGER, INTENT (IN) :: KLUN
CHARACTER(LEN=*), INTENT (IN) :: CDPATH
CHARACTER(LEN=128) :: CLIND
LOGICAL :: LSOLRAD, LTHERRAD, LTRMATSUM, LTRWEIGHT
WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (SELF%LRCOEF), CDPATH//'%LRCOEF'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (SELF%LTLADDIA), CDPATH//'%LTLADDIA'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (SELF%LGLOBRAD), CDPATH//'%LGLOBRAD'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (SELF%NG3SR), CDPATH//'%NG3SR'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (SELF%NGMTR), CDPATH//'%NGMTR'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (SELF%NLATWR), CDPATH//'%NLATWR'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (SELF%NLATRD), CDPATH//'%NLATRD'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (SELF%NLENGSRB), CDPATH//'%NLENGSRB'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (SELF%NLENGTRB), CDPATH//'%NLENGTRB'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (SELF%SOLRAD), CDPATH//'%SOLRAD'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (SELF%THERRAD), CDPATH//'%THERRAD'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (SELF%TRWEIGHT), CDPATH//'%TRWEIGHT'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (SELF%TRMATSUM), CDPATH//'%TRMATSUM'

END SUBROUTINE

SUBROUTINE ACDC_WIPE_TRCOEF (SELF, LDDELETED, LDFIELDAPI)

IMPLICIT NONE
TYPE (TRCOEF), INTENT (IN), TARGET :: SELF
LOGICAL, OPTIONAL, INTENT (IN) :: LDDELETED, LDFIELDAPI
LOGICAL :: LLDELETED
LOGICAL :: LLFIELDAPI
LOGICAL :: LSOLRAD, LTHERRAD, LTRMATSUM, LTRWEIGHT
LLFIELDAPI = .FALSE.
IF (PRESENT (LDFIELDAPI)) THEN
  LLFIELDAPI = LDFIELDAPI
ENDIF

LSOLRAD = ALLOCATED (SELF%SOLRAD)
IF (LSOLRAD) THEN
  !$ACC EXIT DATA DETACH (SELF%SOLRAD)
  !$ACC EXIT DATA DELETE (SELF%SOLRAD)
ENDIF

LTHERRAD = ALLOCATED (SELF%THERRAD)
IF (LTHERRAD) THEN
  !$ACC EXIT DATA DETACH (SELF%THERRAD)
  !$ACC EXIT DATA DELETE (SELF%THERRAD)
ENDIF

LTRWEIGHT = ALLOCATED (SELF%TRWEIGHT)
IF (LTRWEIGHT) THEN
  !$ACC EXIT DATA DETACH (SELF%TRWEIGHT)
  !$ACC EXIT DATA DELETE (SELF%TRWEIGHT)
ENDIF

LTRMATSUM = ALLOCATED (SELF%TRMATSUM)
IF (LTRMATSUM) THEN
  !$ACC EXIT DATA DETACH (SELF%TRMATSUM)
  !$ACC EXIT DATA DELETE (SELF%TRMATSUM)
ENDIF

LLDELETED = .FALSE.
IF (PRESENT (LDDELETED)) THEN
  LLDELETED = LDDELETED
ENDIF
IF (.NOT. LLDELETED) THEN
  !$ACC EXIT DATA DELETE (SELF)
ENDIF
END SUBROUTINE

FUNCTION ACDC_SIZE_TRCOEF (SELF, CDPATH, LDPRINT) RESULT (KSIZE)

IMPLICIT NONE
TYPE (TRCOEF),     INTENT (IN), TARGET :: SELF
CHARACTER(LEN=*), INTENT (IN), OPTIONAL :: CDPATH
LOGICAL,          INTENT (IN), OPTIONAL :: LDPRINT
INTEGER*8 :: KSIZE
INTEGER*8 :: ISIZE, JSIZE
LOGICAL :: LLPRINT
CHARACTER(LEN=128) :: CLPATH
LOGICAL :: LSOLRAD, LTHERRAD, LTRMATSUM, LTRWEIGHT
LLPRINT = .FALSE.
IF (PRESENT (LDPRINT)) THEN
  LLPRINT = LDPRINT
ENDIF
CLPATH=''
IF (PRESENT (CDPATH)) THEN
  CLPATH = CDPATH
ENDIF
KSIZE = 0
ISIZE = KIND (SELF%LRCOEF)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%LRCOEF'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (SELF%LTLADDIA)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%LTLADDIA'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (SELF%LGLOBRAD)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%LGLOBRAD'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (SELF%NG3SR)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NG3SR'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (SELF%NGMTR)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NGMTR'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (SELF%NLATWR)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NLATWR'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (SELF%NLATRD)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NLATRD'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (SELF%NLENGSRB)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NLENGSRB'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (SELF%NLENGTRB)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NLENGTRB'
ENDIF
KSIZE = KSIZE + ISIZE
LSOLRAD = ALLOCATED (SELF%SOLRAD)
IF (LSOLRAD) THEN
  ISIZE = KIND (SELF%SOLRAD) * SIZE (SELF%SOLRAD)
  IF (LLPRINT) THEN
    WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
    WRITE (*, *) TRIM (CLPATH)//'%SOLRAD'
  ENDIF
  KSIZE = KSIZE + ISIZE
ENDIF
LTHERRAD = ALLOCATED (SELF%THERRAD)
IF (LTHERRAD) THEN
  ISIZE = KIND (SELF%THERRAD) * SIZE (SELF%THERRAD)
  IF (LLPRINT) THEN
    WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
    WRITE (*, *) TRIM (CLPATH)//'%THERRAD'
  ENDIF
  KSIZE = KSIZE + ISIZE
ENDIF
LTRWEIGHT = ALLOCATED (SELF%TRWEIGHT)
IF (LTRWEIGHT) THEN
  ISIZE = KIND (SELF%TRWEIGHT) * SIZE (SELF%TRWEIGHT)
  IF (LLPRINT) THEN
    WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
    WRITE (*, *) TRIM (CLPATH)//'%TRWEIGHT'
  ENDIF
  KSIZE = KSIZE + ISIZE
ENDIF
LTRMATSUM = ALLOCATED (SELF%TRMATSUM)
IF (LTRMATSUM) THEN
  ISIZE = KIND (SELF%TRMATSUM) * SIZE (SELF%TRMATSUM)
  IF (LLPRINT) THEN
    WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
    WRITE (*, *) TRIM (CLPATH)//'%TRMATSUM'
  ENDIF
  KSIZE = KSIZE + ISIZE
ENDIF
END FUNCTION

END MODULE
