SUBROUTINE GPGEO_EXPL_OPENACC (KPROMA, KST, KEND, KFLEV&
&, PHI, PHIF, PT, PR, PLNPR, PALPH, YDVGEOM, YDSTACK)
!$ACC ROUTINE (GPGEO_EXPL_OPENACC) SEQ
USE PARKIND1,ONLY:JPIM, JPRB

USE YOMVERT,ONLY:TVERTICAL_GEOM
#include "fxtran_acdc_stack.h"
USE FXTRAN_ACDC_STACK_MOD
USE FXTRAN_ACDC_ABORT_MOD

IMPLICIT NONE


INTEGER (KIND=JPIM), INTENT (IN)::KPROMA
INTEGER (KIND=JPIM), INTENT (IN)::KST
INTEGER (KIND=JPIM), INTENT (IN)::KEND
INTEGER (KIND=JPIM), INTENT (IN)::KFLEV
REAL (KIND=JPRB), INTENT (INOUT)::PHI (KPROMA, 0:KFLEV)
REAL (KIND=JPRB), INTENT (OUT)::PHIF (KPROMA, KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PT (KPROMA, KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PR (KPROMA, KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PLNPR (KPROMA, KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PALPH (KPROMA, KFLEV)
TYPE (TVERTICAL_GEOM), INTENT (IN)::YDVGEOM
TYPE(FXTRAN_ACDC_STACK), INTENT (IN) :: YDSTACK
TYPE(FXTRAN_ACDC_STACK) :: YLSTACK
INTEGER (KIND=JPIM)::JROF
INTEGER (KIND=JPIM)::JLEV
CHARACTER (LEN=4)::CLOPER
fxtran_acdc_temp (REAL (KIND=JPRB), ZPHI, (KPROMA, 0:KFLEV+1))

#include "verdisint_openacc.intfb.h"

YLSTACK = YDSTACK



IF (KIND (ZPHI) == 8) THEN
    fxtran_acdc_alloc8 (ZPHI)
ELSEIF (KIND (ZPHI) == 4) THEN
    fxtran_acdc_alloc4 (ZPHI)
ELSE
    STOP 1
ENDIF


JROF = KST



IF (YDVGEOM%YRCVER%LVERTFE) THEN
  CLOPER='IBOT'

  IF (YDVGEOM%YRCVER%LVFE_COMPATIBLE)  THEN
    CLOPER='INTG'
  ENDIF


  DO JLEV=1, KFLEV
    
    ZPHI (JROF, JLEV)=-PR (JROF, JLEV)*PT (JROF, JLEV)*PLNPR&
    & (JROF, JLEV)*YDVGEOM%YRVETA%VFE_RDETAH (JLEV)
  
  ENDDO

  ZPHI (JROF, 0)=0.0_JPRB
  ZPHI (JROF, KFLEV+1)=0.0_JPRB
  CALL VERDISINT_OPENACC (YDVGEOM%YRVFE, YDVGEOM%YRCVER, CLOPER,'11', KPROMA&
  &, KST, KEND, KFLEV, ZPHI, PHIF, PINS=PHI (:, KFLEV), YDSTACK=YLSTACK)

  DO JLEV=KFLEV, 1,-1
    
    PHI (JROF, JLEV-1)=PHI (JROF, JLEV)+PR (JROF, JLEV)*PT (JROF, JLEV)*PLNPR (JROF, JLEV)
  
  ENDDO

ELSE

  DO JLEV=KFLEV, 1,-1
    
    PHI (JROF, JLEV-1)=PHI (JROF, JLEV)+PR (JROF, JLEV)*PT (JROF, JLEV)*PLNPR (JROF, JLEV)
    PHIF (JROF, JLEV)=PHI (JROF, JLEV)+PALPH (JROF, JLEV)*PR (JROF, JLEV)*PT (JROF, JLEV)
  
  ENDDO

ENDIF


END SUBROUTINE GPGEO_EXPL_OPENACC
