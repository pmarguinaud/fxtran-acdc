SUBROUTINE ACLENDER_OPENACC (YDCST, YDPHY, YDPHY0, KIDIA, KFDIA, KLON, KTDIAN&
&, KLEV, PAPHI, PAPHIF, PAPRS, PAPRSF, PT, PQV, PQICE, PQLI, PNLAB, PNLABCVP&
&, PLSCPE, PU, PV, PECT, PGZ0, PUSLE, PLEND, PPHI3, YDSTACK)
!$ACC ROUTINE (ACLENDER_OPENACC) SEQ
USE PARKIND1,ONLY:JPIM, JPRB

USE YOMCST,ONLY:TCST
USE YOMPHY,ONLY:TPHY
USE YOMPHY0,ONLY:TPHY0
#include "fxtran_acdc_stack.h"
USE FXTRAN_ACDC_STACK_MOD
USE FXTRAN_ACDC_ABORT_MOD

IMPLICIT NONE


TYPE (TCST), INTENT (IN)::YDCST
TYPE (TPHY), INTENT (IN)::YDPHY
TYPE (TPHY0), INTENT (IN)::YDPHY0
INTEGER (KIND=JPIM), INTENT (IN)::KLON
INTEGER (KIND=JPIM), INTENT (IN)::KLEV
INTEGER (KIND=JPIM), INTENT (IN)::KIDIA
INTEGER (KIND=JPIM), INTENT (IN)::KFDIA
INTEGER (KIND=JPIM), INTENT (IN)::KTDIAN
REAL (KIND=JPRB), INTENT (IN)::PNLAB (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PNLABCVP (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PAPHI (KLON, 0:KLEV)
REAL (KIND=JPRB), INTENT (IN)::PAPHIF (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PAPRS (KLON, 0:KLEV)
REAL (KIND=JPRB), INTENT (IN)::PAPRSF (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PT (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PQV (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PQICE (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PQLI (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PLSCPE (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PU (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PV (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PECT (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PGZ0 (KLON)
REAL (KIND=JPRB), INTENT (OUT)::PLEND (KLON, KLEV)
REAL (KIND=JPRB), INTENT (OUT)::PUSLE (KLON, KLEV)
REAL (KIND=JPRB), INTENT (OUT)::PPHI3 (KLON, KLEV)
TYPE(FXTRAN_ACDC_STACK), INTENT (IN) :: YDSTACK
TYPE(FXTRAN_ACDC_STACK) :: YLSTACK
INTEGER (KIND=JPIM)::JLON
INTEGER (KIND=JPIM)::JLEV
REAL (KIND=JPRB)::ZLINF
REAL (KIND=JPRB)::ZDPHI
REAL (KIND=JPRB)::ZCIS
REAL (KIND=JPRB)::ZQC
REAL (KIND=JPRB)::ZDTHETA
REAL (KIND=JPRB)::ZPREF
REAL (KIND=JPRB)::ZGLKARMN
REAL (KIND=JPRB)::ZPHIH
REAL (KIND=JPRB)::ZC1
REAL (KIND=JPRB)::ZARIH
REAL (KIND=JPRB)::ZARIM
REAL (KIND=JPRB)::ZSEUILH
REAL (KIND=JPRB)::ZSEUILM
REAL (KIND=JPRB)::ZPIS2
REAL (KIND=JPRB)::ZALPHARM
REAL (KIND=JPRB)::ZALPHARH
REAL (KIND=JPRB)::ZALPHACH
REAL (KIND=JPRB)::ZALPHACM
REAL (KIND=JPRB)::ZALPHAN
REAL (KIND=JPRB)::ZCN
REAL (KIND=JPRB)::ZCD
REAL (KIND=JPRB)::ZC0
REAL (KIND=JPRB)::ZB
REAL (KIND=JPRB)::ZCH
REAL (KIND=JPRB)::ZCM_CLOUD
REAL (KIND=JPRB)::ZCM_CLEAR
REAL (KIND=JPRB)::ZC3H_CLOUD
REAL (KIND=JPRB)::ZC3H_CLEAR
REAL (KIND=JPRB)::ZC3M_CLOUD
REAL (KIND=JPRB)::ZC3M_CLEAR
fxtran_acdc_temp (REAL (KIND=JPRB), ZDCIS, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZDTH2, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZDTH, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZRI, (KLON, 0:KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZTHETAVL, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZFH_CLOUD, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZFH_CLEAR, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZFM_CLOUD, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZFM_CLEAR, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZLUPH_CLOUD, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZLUPH_CLEAR, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZLUPM_CLOUD, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZLUPM_CLEAR, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZLDNH_CLOUD, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZLDNH_CLEAR, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZLDNM_CLOUD, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZLDNM_CLEAR, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZLSH_CLOUD, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZLSH_CLEAR, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZLSM_CLOUD, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZLSM_CLEAR, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZLINTH_CLOUD, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZLINTH_CLEAR, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZLINTM_CLOUD, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZLINTM_CLEAR, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZLENDH_CLEAR, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZLENDM_CLEAR, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZLENDH_CLOUD, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZLENDM_CLOUD, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZLENDMM, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZTHETA, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZLENDH, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZLENDM, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZRIF, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZNN_CLOUD, (KLON, 0:KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZNN_CLEAR, (KLON, 0:KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZGLMINF, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZLMIN, (KLON, KLEV))
REAL (KIND=JPRB)::ZDQL2
REAL (KIND=JPRB)::ZDQL1
REAL (KIND=JPRB)::ZNEIGE
REAL (KIND=JPRB)::ZDH2
REAL (KIND=JPRB)::ZQVSH2
REAL (KIND=JPRB)::ZDH1
REAL (KIND=JPRB)::ZQVSH1
REAL (KIND=JPRB)::ZLOG
REAL (KIND=JPRB)::ZTDERI
REAL (KIND=JPRB)::ZTJ
fxtran_acdc_temp (REAL (KIND=JPRB), ZQVS, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZLH, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZCPH, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZRH, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZQL, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZQV, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZTHUC, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZTHDC, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZTHU, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZTHD, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZQSEUIL, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZRIF2, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZRI2, (KLON, 0:KLEV))
REAL (KIND=JPRB)::ZGZTOPCVP 
REAL (KIND=JPRB)::ZGZBOTCVP 
REAL (KIND=JPRB)::ZGZTOP 
REAL (KIND=JPRB)::ZGZBOT 
REAL (KIND=JPRB)::ZQWF1
REAL (KIND=JPRB)::ZDELTQF1
REAL (KIND=JPRB)::ZTHETAL1
REAL (KIND=JPRB)::ZQSLTLF1
REAL (KIND=JPRB)::ZDLEWF1
REAL (KIND=JPRB)::ZQSATF1
REAL (KIND=JPRB)::ZEW1
REAL (KIND=JPRB)::ZH1
REAL (KIND=JPRB)::ZTLF1
REAL (KIND=JPRB)::ZLSCPEF1
REAL (KIND=JPRB)::ZQCF1
REAL (KIND=JPRB)::ZTF1
REAL (KIND=JPRB)::ZQWF2
REAL (KIND=JPRB)::ZDELTQF2
REAL (KIND=JPRB)::ZTHETAL2
REAL (KIND=JPRB)::ZQSLTLF2
REAL (KIND=JPRB)::ZDLEWF2
REAL (KIND=JPRB)::ZQSATF2
REAL (KIND=JPRB)::ZEW2
REAL (KIND=JPRB)::ZH2
REAL (KIND=JPRB)::ZTLF2
REAL (KIND=JPRB)::ZLSCPEF2
REAL (KIND=JPRB)::ZQCF2
REAL (KIND=JPRB)::ZTF2
REAL (KIND=JPRB)::ZQ11
REAL (KIND=JPRB)::ZIGMAS
REAL (KIND=JPRB)::ZDQW
REAL (KIND=JPRB)::ZINC
REAL (KIND=JPRB)::ZEPSQ
REAL (KIND=JPRB)::ZEPDELT
REAL (KIND=JPRB)::ZEPSIG
REAL (KIND=JPRB)::ZDTHETAL
REAL (KIND=JPRB)::ZBB
REAL (KIND=JPRB)::ZTHETAH
REAL (KIND=JPRB)::ZLSCPEH
REAL (KIND=JPRB)::ZQSLTLH
REAL (KIND=JPRB)::ZTH
fxtran_acdc_temp (REAL (KIND=JPRB), ZDELTQH, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZAA, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZIGMAS_CLEAR, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZIGMAS_CLOUD, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZQVL, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZNEBI, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZNEB, (KLON, KLEV))
REAL (KIND=JPRB)::ZOFFSET
REAL (KIND=JPRB)::ZRIH
REAL (KIND=JPRB)::ZZN1D
REAL (KIND=JPRB)::ZEPNEBS
REAL (KIND=JPRB)::ZSURSAT
REAL (KIND=JPRB)::ZRESUL
REAL (KIND=JPRB)::ZTC
REAL (KIND=JPRB)::ZDQV
REAL (KIND=JPRB)::ZGZLCVPDN
REAL (KIND=JPRB)::ZGZLCVPUP
REAL (KIND=JPRB)::ZPHI3I
REAL (KIND=JPRB)::ZPHI3MAX
fxtran_acdc_temp (REAL (KIND=JPRB), ZG2LD2, (KLON, KLEV))
INTEGER (KIND=JPIM)::JN
INTEGER (KIND=JPIM)::INQ1

#include "fcttrm.func.h"

YLSTACK = YDSTACK



IF (KIND (ZDCIS) == 8) THEN
    fxtran_acdc_alloc8 (ZDCIS)
ELSEIF (KIND (ZDCIS) == 4) THEN
    fxtran_acdc_alloc4 (ZDCIS)
ELSE
    STOP 1
ENDIF


IF (KIND (ZDTH2) == 8) THEN
    fxtran_acdc_alloc8 (ZDTH2)
ELSEIF (KIND (ZDTH2) == 4) THEN
    fxtran_acdc_alloc4 (ZDTH2)
ELSE
    STOP 1
ENDIF


IF (KIND (ZDTH) == 8) THEN
    fxtran_acdc_alloc8 (ZDTH)
ELSEIF (KIND (ZDTH) == 4) THEN
    fxtran_acdc_alloc4 (ZDTH)
ELSE
    STOP 1
ENDIF


IF (KIND (ZRI) == 8) THEN
    fxtran_acdc_alloc8 (ZRI)
ELSEIF (KIND (ZRI) == 4) THEN
    fxtran_acdc_alloc4 (ZRI)
ELSE
    STOP 1
ENDIF


IF (KIND (ZTHETAVL) == 8) THEN
    fxtran_acdc_alloc8 (ZTHETAVL)
ELSEIF (KIND (ZTHETAVL) == 4) THEN
    fxtran_acdc_alloc4 (ZTHETAVL)
ELSE
    STOP 1
ENDIF


IF (KIND (ZFH_CLOUD) == 8) THEN
    fxtran_acdc_alloc8 (ZFH_CLOUD)
ELSEIF (KIND (ZFH_CLOUD) == 4) THEN
    fxtran_acdc_alloc4 (ZFH_CLOUD)
ELSE
    STOP 1
ENDIF


IF (KIND (ZFH_CLEAR) == 8) THEN
    fxtran_acdc_alloc8 (ZFH_CLEAR)
ELSEIF (KIND (ZFH_CLEAR) == 4) THEN
    fxtran_acdc_alloc4 (ZFH_CLEAR)
ELSE
    STOP 1
ENDIF


IF (KIND (ZFM_CLOUD) == 8) THEN
    fxtran_acdc_alloc8 (ZFM_CLOUD)
ELSEIF (KIND (ZFM_CLOUD) == 4) THEN
    fxtran_acdc_alloc4 (ZFM_CLOUD)
ELSE
    STOP 1
ENDIF


IF (KIND (ZFM_CLEAR) == 8) THEN
    fxtran_acdc_alloc8 (ZFM_CLEAR)
ELSEIF (KIND (ZFM_CLEAR) == 4) THEN
    fxtran_acdc_alloc4 (ZFM_CLEAR)
ELSE
    STOP 1
ENDIF


IF (KIND (ZLUPH_CLOUD) == 8) THEN
    fxtran_acdc_alloc8 (ZLUPH_CLOUD)
ELSEIF (KIND (ZLUPH_CLOUD) == 4) THEN
    fxtran_acdc_alloc4 (ZLUPH_CLOUD)
ELSE
    STOP 1
ENDIF


IF (KIND (ZLUPH_CLEAR) == 8) THEN
    fxtran_acdc_alloc8 (ZLUPH_CLEAR)
ELSEIF (KIND (ZLUPH_CLEAR) == 4) THEN
    fxtran_acdc_alloc4 (ZLUPH_CLEAR)
ELSE
    STOP 1
ENDIF


IF (KIND (ZLUPM_CLOUD) == 8) THEN
    fxtran_acdc_alloc8 (ZLUPM_CLOUD)
ELSEIF (KIND (ZLUPM_CLOUD) == 4) THEN
    fxtran_acdc_alloc4 (ZLUPM_CLOUD)
ELSE
    STOP 1
ENDIF


IF (KIND (ZLUPM_CLEAR) == 8) THEN
    fxtran_acdc_alloc8 (ZLUPM_CLEAR)
ELSEIF (KIND (ZLUPM_CLEAR) == 4) THEN
    fxtran_acdc_alloc4 (ZLUPM_CLEAR)
ELSE
    STOP 1
ENDIF


IF (KIND (ZLDNH_CLOUD) == 8) THEN
    fxtran_acdc_alloc8 (ZLDNH_CLOUD)
ELSEIF (KIND (ZLDNH_CLOUD) == 4) THEN
    fxtran_acdc_alloc4 (ZLDNH_CLOUD)
ELSE
    STOP 1
ENDIF


IF (KIND (ZLDNH_CLEAR) == 8) THEN
    fxtran_acdc_alloc8 (ZLDNH_CLEAR)
ELSEIF (KIND (ZLDNH_CLEAR) == 4) THEN
    fxtran_acdc_alloc4 (ZLDNH_CLEAR)
ELSE
    STOP 1
ENDIF


IF (KIND (ZLDNM_CLOUD) == 8) THEN
    fxtran_acdc_alloc8 (ZLDNM_CLOUD)
ELSEIF (KIND (ZLDNM_CLOUD) == 4) THEN
    fxtran_acdc_alloc4 (ZLDNM_CLOUD)
ELSE
    STOP 1
ENDIF


IF (KIND (ZLDNM_CLEAR) == 8) THEN
    fxtran_acdc_alloc8 (ZLDNM_CLEAR)
ELSEIF (KIND (ZLDNM_CLEAR) == 4) THEN
    fxtran_acdc_alloc4 (ZLDNM_CLEAR)
ELSE
    STOP 1
ENDIF


IF (KIND (ZLSH_CLOUD) == 8) THEN
    fxtran_acdc_alloc8 (ZLSH_CLOUD)
ELSEIF (KIND (ZLSH_CLOUD) == 4) THEN
    fxtran_acdc_alloc4 (ZLSH_CLOUD)
ELSE
    STOP 1
ENDIF


IF (KIND (ZLSH_CLEAR) == 8) THEN
    fxtran_acdc_alloc8 (ZLSH_CLEAR)
ELSEIF (KIND (ZLSH_CLEAR) == 4) THEN
    fxtran_acdc_alloc4 (ZLSH_CLEAR)
ELSE
    STOP 1
ENDIF


IF (KIND (ZLSM_CLOUD) == 8) THEN
    fxtran_acdc_alloc8 (ZLSM_CLOUD)
ELSEIF (KIND (ZLSM_CLOUD) == 4) THEN
    fxtran_acdc_alloc4 (ZLSM_CLOUD)
ELSE
    STOP 1
ENDIF


IF (KIND (ZLSM_CLEAR) == 8) THEN
    fxtran_acdc_alloc8 (ZLSM_CLEAR)
ELSEIF (KIND (ZLSM_CLEAR) == 4) THEN
    fxtran_acdc_alloc4 (ZLSM_CLEAR)
ELSE
    STOP 1
ENDIF


IF (KIND (ZLINTH_CLOUD) == 8) THEN
    fxtran_acdc_alloc8 (ZLINTH_CLOUD)
ELSEIF (KIND (ZLINTH_CLOUD) == 4) THEN
    fxtran_acdc_alloc4 (ZLINTH_CLOUD)
ELSE
    STOP 1
ENDIF


IF (KIND (ZLINTH_CLEAR) == 8) THEN
    fxtran_acdc_alloc8 (ZLINTH_CLEAR)
ELSEIF (KIND (ZLINTH_CLEAR) == 4) THEN
    fxtran_acdc_alloc4 (ZLINTH_CLEAR)
ELSE
    STOP 1
ENDIF


IF (KIND (ZLINTM_CLOUD) == 8) THEN
    fxtran_acdc_alloc8 (ZLINTM_CLOUD)
ELSEIF (KIND (ZLINTM_CLOUD) == 4) THEN
    fxtran_acdc_alloc4 (ZLINTM_CLOUD)
ELSE
    STOP 1
ENDIF


IF (KIND (ZLINTM_CLEAR) == 8) THEN
    fxtran_acdc_alloc8 (ZLINTM_CLEAR)
ELSEIF (KIND (ZLINTM_CLEAR) == 4) THEN
    fxtran_acdc_alloc4 (ZLINTM_CLEAR)
ELSE
    STOP 1
ENDIF


IF (KIND (ZLENDH_CLEAR) == 8) THEN
    fxtran_acdc_alloc8 (ZLENDH_CLEAR)
ELSEIF (KIND (ZLENDH_CLEAR) == 4) THEN
    fxtran_acdc_alloc4 (ZLENDH_CLEAR)
ELSE
    STOP 1
ENDIF


IF (KIND (ZLENDM_CLEAR) == 8) THEN
    fxtran_acdc_alloc8 (ZLENDM_CLEAR)
ELSEIF (KIND (ZLENDM_CLEAR) == 4) THEN
    fxtran_acdc_alloc4 (ZLENDM_CLEAR)
ELSE
    STOP 1
ENDIF


IF (KIND (ZLENDH_CLOUD) == 8) THEN
    fxtran_acdc_alloc8 (ZLENDH_CLOUD)
ELSEIF (KIND (ZLENDH_CLOUD) == 4) THEN
    fxtran_acdc_alloc4 (ZLENDH_CLOUD)
ELSE
    STOP 1
ENDIF


IF (KIND (ZLENDM_CLOUD) == 8) THEN
    fxtran_acdc_alloc8 (ZLENDM_CLOUD)
ELSEIF (KIND (ZLENDM_CLOUD) == 4) THEN
    fxtran_acdc_alloc4 (ZLENDM_CLOUD)
ELSE
    STOP 1
ENDIF


IF (KIND (ZLENDMM) == 8) THEN
    fxtran_acdc_alloc8 (ZLENDMM)
ELSEIF (KIND (ZLENDMM) == 4) THEN
    fxtran_acdc_alloc4 (ZLENDMM)
ELSE
    STOP 1
ENDIF


IF (KIND (ZTHETA) == 8) THEN
    fxtran_acdc_alloc8 (ZTHETA)
ELSEIF (KIND (ZTHETA) == 4) THEN
    fxtran_acdc_alloc4 (ZTHETA)
ELSE
    STOP 1
ENDIF


IF (KIND (ZLENDH) == 8) THEN
    fxtran_acdc_alloc8 (ZLENDH)
ELSEIF (KIND (ZLENDH) == 4) THEN
    fxtran_acdc_alloc4 (ZLENDH)
ELSE
    STOP 1
ENDIF


IF (KIND (ZLENDM) == 8) THEN
    fxtran_acdc_alloc8 (ZLENDM)
ELSEIF (KIND (ZLENDM) == 4) THEN
    fxtran_acdc_alloc4 (ZLENDM)
ELSE
    STOP 1
ENDIF


IF (KIND (ZRIF) == 8) THEN
    fxtran_acdc_alloc8 (ZRIF)
ELSEIF (KIND (ZRIF) == 4) THEN
    fxtran_acdc_alloc4 (ZRIF)
ELSE
    STOP 1
ENDIF


IF (KIND (ZNN_CLOUD) == 8) THEN
    fxtran_acdc_alloc8 (ZNN_CLOUD)
ELSEIF (KIND (ZNN_CLOUD) == 4) THEN
    fxtran_acdc_alloc4 (ZNN_CLOUD)
ELSE
    STOP 1
ENDIF


IF (KIND (ZNN_CLEAR) == 8) THEN
    fxtran_acdc_alloc8 (ZNN_CLEAR)
ELSEIF (KIND (ZNN_CLEAR) == 4) THEN
    fxtran_acdc_alloc4 (ZNN_CLEAR)
ELSE
    STOP 1
ENDIF


IF (KIND (ZGLMINF) == 8) THEN
    fxtran_acdc_alloc8 (ZGLMINF)
ELSEIF (KIND (ZGLMINF) == 4) THEN
    fxtran_acdc_alloc4 (ZGLMINF)
ELSE
    STOP 1
ENDIF


IF (KIND (ZLMIN) == 8) THEN
    fxtran_acdc_alloc8 (ZLMIN)
ELSEIF (KIND (ZLMIN) == 4) THEN
    fxtran_acdc_alloc4 (ZLMIN)
ELSE
    STOP 1
ENDIF


IF (KIND (ZQVS) == 8) THEN
    fxtran_acdc_alloc8 (ZQVS)
ELSEIF (KIND (ZQVS) == 4) THEN
    fxtran_acdc_alloc4 (ZQVS)
ELSE
    STOP 1
ENDIF


IF (KIND (ZLH) == 8) THEN
    fxtran_acdc_alloc8 (ZLH)
ELSEIF (KIND (ZLH) == 4) THEN
    fxtran_acdc_alloc4 (ZLH)
ELSE
    STOP 1
ENDIF


IF (KIND (ZCPH) == 8) THEN
    fxtran_acdc_alloc8 (ZCPH)
ELSEIF (KIND (ZCPH) == 4) THEN
    fxtran_acdc_alloc4 (ZCPH)
ELSE
    STOP 1
ENDIF


IF (KIND (ZRH) == 8) THEN
    fxtran_acdc_alloc8 (ZRH)
ELSEIF (KIND (ZRH) == 4) THEN
    fxtran_acdc_alloc4 (ZRH)
ELSE
    STOP 1
ENDIF


IF (KIND (ZQL) == 8) THEN
    fxtran_acdc_alloc8 (ZQL)
ELSEIF (KIND (ZQL) == 4) THEN
    fxtran_acdc_alloc4 (ZQL)
ELSE
    STOP 1
ENDIF


IF (KIND (ZQV) == 8) THEN
    fxtran_acdc_alloc8 (ZQV)
ELSEIF (KIND (ZQV) == 4) THEN
    fxtran_acdc_alloc4 (ZQV)
ELSE
    STOP 1
ENDIF


IF (KIND (ZTHUC) == 8) THEN
    fxtran_acdc_alloc8 (ZTHUC)
ELSEIF (KIND (ZTHUC) == 4) THEN
    fxtran_acdc_alloc4 (ZTHUC)
ELSE
    STOP 1
ENDIF


IF (KIND (ZTHDC) == 8) THEN
    fxtran_acdc_alloc8 (ZTHDC)
ELSEIF (KIND (ZTHDC) == 4) THEN
    fxtran_acdc_alloc4 (ZTHDC)
ELSE
    STOP 1
ENDIF


IF (KIND (ZTHU) == 8) THEN
    fxtran_acdc_alloc8 (ZTHU)
ELSEIF (KIND (ZTHU) == 4) THEN
    fxtran_acdc_alloc4 (ZTHU)
ELSE
    STOP 1
ENDIF


IF (KIND (ZTHD) == 8) THEN
    fxtran_acdc_alloc8 (ZTHD)
ELSEIF (KIND (ZTHD) == 4) THEN
    fxtran_acdc_alloc4 (ZTHD)
ELSE
    STOP 1
ENDIF


IF (KIND (ZQSEUIL) == 8) THEN
    fxtran_acdc_alloc8 (ZQSEUIL)
ELSEIF (KIND (ZQSEUIL) == 4) THEN
    fxtran_acdc_alloc4 (ZQSEUIL)
ELSE
    STOP 1
ENDIF


IF (KIND (ZRIF2) == 8) THEN
    fxtran_acdc_alloc8 (ZRIF2)
ELSEIF (KIND (ZRIF2) == 4) THEN
    fxtran_acdc_alloc4 (ZRIF2)
ELSE
    STOP 1
ENDIF


IF (KIND (ZRI2) == 8) THEN
    fxtran_acdc_alloc8 (ZRI2)
ELSEIF (KIND (ZRI2) == 4) THEN
    fxtran_acdc_alloc4 (ZRI2)
ELSE
    STOP 1
ENDIF


IF (KIND (ZDELTQH) == 8) THEN
    fxtran_acdc_alloc8 (ZDELTQH)
ELSEIF (KIND (ZDELTQH) == 4) THEN
    fxtran_acdc_alloc4 (ZDELTQH)
ELSE
    STOP 1
ENDIF


IF (KIND (ZAA) == 8) THEN
    fxtran_acdc_alloc8 (ZAA)
ELSEIF (KIND (ZAA) == 4) THEN
    fxtran_acdc_alloc4 (ZAA)
ELSE
    STOP 1
ENDIF


IF (KIND (ZIGMAS_CLEAR) == 8) THEN
    fxtran_acdc_alloc8 (ZIGMAS_CLEAR)
ELSEIF (KIND (ZIGMAS_CLEAR) == 4) THEN
    fxtran_acdc_alloc4 (ZIGMAS_CLEAR)
ELSE
    STOP 1
ENDIF


IF (KIND (ZIGMAS_CLOUD) == 8) THEN
    fxtran_acdc_alloc8 (ZIGMAS_CLOUD)
ELSEIF (KIND (ZIGMAS_CLOUD) == 4) THEN
    fxtran_acdc_alloc4 (ZIGMAS_CLOUD)
ELSE
    STOP 1
ENDIF


IF (KIND (ZQVL) == 8) THEN
    fxtran_acdc_alloc8 (ZQVL)
ELSEIF (KIND (ZQVL) == 4) THEN
    fxtran_acdc_alloc4 (ZQVL)
ELSE
    STOP 1
ENDIF


IF (KIND (ZNEBI) == 8) THEN
    fxtran_acdc_alloc8 (ZNEBI)
ELSEIF (KIND (ZNEBI) == 4) THEN
    fxtran_acdc_alloc4 (ZNEBI)
ELSE
    STOP 1
ENDIF


IF (KIND (ZNEB) == 8) THEN
    fxtran_acdc_alloc8 (ZNEB)
ELSEIF (KIND (ZNEB) == 4) THEN
    fxtran_acdc_alloc4 (ZNEB)
ELSE
    STOP 1
ENDIF


IF (KIND (ZG2LD2) == 8) THEN
    fxtran_acdc_alloc8 (ZG2LD2)
ELSEIF (KIND (ZG2LD2) == 4) THEN
    fxtran_acdc_alloc4 (ZG2LD2)
ELSE
    STOP 1
ENDIF


JLON = KIDIA



ZLINF=75.0_JPRB
ZB=4._JPRB
ZC0=3.75_JPRB
ZCD=1._JPRB/ZC0/ZC0
ZCN=SQRT (SQRT (ZCD))
ZPIS2=YDCST%RPI/2.0_JPRB
ZALPHAN=ZCN*YDPHY0%VKARMN
ZOFFSET=0.2_JPRB
ZALPHACH=3._JPRB*ZCN*YDPHY0%VKARMN
ZALPHACM=3._JPRB*ZCN*YDPHY0%VKARMN
ZALPHARH=ZALPHAN*ZPIS2*ZB/(ZALPHACH-ZALPHAN)
ZALPHARM=ZALPHAN*ZPIS2*ZB/(ZALPHACM-ZALPHAN)
ZCH=0.2_JPRB
ZRI (JLON,:)=0.0_JPRB
ZRI2 (JLON,:)=0.0_JPRB
ZFM_CLEAR (JLON,:)=0.0_JPRB
ZFM_CLOUD (JLON,:)=0.0_JPRB
ZFH_CLEAR (JLON,:)=0.0_JPRB
ZFH_CLOUD (JLON,:)=0.0_JPRB
ZDTH (JLON,:)=0.0_JPRB
ZDTH2 (JLON,:)=0.0_JPRB
ZDCIS (JLON,:)=0.0_JPRB
ZLSM_CLEAR (JLON,:)=0.0_JPRB
ZLSM_CLOUD (JLON,:)=0.0_JPRB
ZLSH_CLEAR (JLON,:)=0.0_JPRB
ZLSH_CLOUD (JLON,:)=0.0_JPRB
ZNN_CLEAR (JLON,:)=0.0_JPRB
ZNN_CLOUD (JLON,:)=0.0_JPRB
ZIGMAS_CLOUD (JLON,:)=0.0_JPRB
ZIGMAS_CLEAR (JLON,:)=0.0_JPRB
ZDELTQH (JLON,:)=0.0_JPRB
ZNEIGE=0.0_JPRB

DO JLEV=1, KLEV
  
  ZQV (JLON, JLEV)=MAX (0.0_JPRB, PQV (JLON, JLEV))
  ZQL (JLON, JLEV)=MAX (0.0_JPRB, PQLI (JLON, JLEV))
  ZQVL (JLON, JLEV)=ZQV (JLON, JLEV)+ZQL (JLON, JLEV)
  ZQSEUIL (JLON, JLEV)=MAX (0.0_JPRB, SIGN (1.0_JPRB, ZQL (JLON, JLEV)-1.0E-6_JPRB))
  ZRH (JLON, JLEV)=YDCST%RD+(YDCST%RD-YDCST%RV)*ZQV (JLON, JLEV)
  ZCPH (JLON, JLEV)=YDCST%RCPD*(1.0_JPRB-ZQV (JLON, JLEV)-ZQL (JLON,&
  & JLEV))+YDCST%RCPV*ZQV (JLON, JLEV)+YDCST%RCW*ZQL (JLON, JLEV)
  ZLH (JLON, JLEV)=YDCST%RLVTT-(PT (JLON, JLEV)-YDCST%RTT)*(YDCST%RCW-YDCST%RCPV)
  ZTC=PT (JLON, JLEV)-PLSCPE (JLON, JLEV)*ZQL (JLON, JLEV)
  ZQVS (JLON, JLEV)=FOQS (FOEW (ZTC, ZNEIGE)/PAPRSF (JLON, JLEV))
  
ENDDO


DO JLEV=1, KLEV
  
  ZPREF=PAPRSF (JLON, JLEV)
  ZTHETA (JLON, JLEV)=PT (JLON, JLEV)*(YDCST%RATM/ZPREF)**(YDCST%RKAPPA)
  ZQC=ZQL (JLON, JLEV)+PQICE (JLON, JLEV)
  ZTHETAVL (JLON, JLEV)=ZTHETA (JLON, JLEV)*(1.0_JPRB+YDCST%RETV*ZQV (JLON, JLEV)-ZQC)
  
ENDDO


DO JLEV=1, KLEV-1
  
  ZDTHETA=(ZTHETAVL (JLON, JLEV+1)-ZTHETAVL (JLON, JLEV))
  ZDTH (JLON, JLEV)=ZDTHETA
  ZCIS=MAX (1.0E-10_JPRB,(PU (JLON, JLEV+1)-PU (JLON, JLEV&
  &))**2+(PV (JLON, JLEV+1)-PV (JLON, JLEV))**2)
  ZDCIS (JLON, JLEV)=ZCIS
  ZDPHI=PAPHIF (JLON, JLEV+1)-PAPHIF (JLON, JLEV)
  ZTHETAH=0.5_JPRB*(ZTHETAVL (JLON, JLEV+1)+ZTHETAVL (JLON, JLEV))
  ZG2LD2 (JLON, JLEV)=PECT (JLON, JLEV)*ZTHETAH*ZDPHI/ZDTHETA

  IF (YDPHY%NLEND==2) THEN
    ZLSCPEH=0.5_JPRB*(PLSCPE (JLON, JLEV)+PLSCPE (JLON, JLEV))
    ZDQV=ZQVL (JLON, JLEV+1)-ZQVS (JLON, JLEV+1)-(ZQVL (JLON, JLEV)-ZQVS (JLON, JLEV))
  ELSE
    ZDQV=0.0_JPRB
  ENDIF

  ZRI (JLON, JLEV)=ZDPHI*(ZDTHETA+ZDQV)/ZCIS/ZTHETAH
  ZNN_CLEAR (JLON, JLEV)=MAX (1.0E-10_JPRB, ZDTHETA/ZDPHI/ZTHETAH)
  
ENDDO


DO JLEV=1, KLEV-1
  
  ZTJ=PT (JLON, JLEV)*(PAPRS (JLON, JLEV)/PAPRSF (JLON, JLEV))**(ZRH (JLON, JLEV)/ZCPH (JLON, JLEV))
  ZTDERI=0.5_JPRB*(PT (JLON, JLEV)+ZTJ)
  ZLOG=LOG (PAPRS (JLON, JLEV)/PAPRSF (JLON, JLEV))
  ZQVSH1=FOQS (FOEW (ZTJ, ZNEIGE)/PAPRS (JLON, JLEV))
  ZDQL1=ZQSEUIL (JLON, JLEV)*(ZQVS (JLON, JLEV)-ZQVSH1)
  ZDH1=ZCPH (JLON, JLEV)*(ZTJ-PT (JLON, JLEV))+ZLH (JLON, JLEV)*ZDQL1-ZRH (JLON, JLEV)*ZTJ*ZLOG
  ZQVSH2=FOQS (FOEW (ZTDERI, ZNEIGE)/PAPRS (JLON, JLEV))
  ZDQL2=ZQSEUIL (JLON, JLEV)*(ZQVS (JLON, JLEV)-ZQVSH2)
  ZDH2=ZCPH (JLON, JLEV)*(ZTDERI-PT (JLON, JLEV))+ZLH (JLON, JLEV)*ZDQL2-ZRH (JLON, JLEV)*ZTDERI*ZLOG
  ZTHDC (JLON, JLEV)=ZTJ+ZDH1*(ZTDERI-ZTJ)/(ZDH1-ZDH2)
  ZTHD (JLON, JLEV)=ZTJ
  
ENDDO


DO JLEV=1, KLEV-1
  
  ZTJ=PT (JLON, JLEV+1)*(PAPRS (JLON, JLEV)/PAPRSF (JLON,&
  & JLEV+1))**(ZRH (JLON, JLEV+1)/ZCPH (JLON, JLEV+1))
  ZTDERI=0.5_JPRB*(PT (JLON, JLEV+1)+ZTJ)
  ZLOG=LOG (PAPRS (JLON, JLEV)/PAPRSF (JLON, JLEV+1))
  ZQVSH1=FOQS (FOEW (ZTJ, ZNEIGE)/PAPRS (JLON, JLEV))
  ZDQL1=ZQSEUIL (JLON, JLEV+1)*(ZQVS (JLON, JLEV+1)-ZQVSH1)
  ZDH1=ZCPH (JLON, JLEV+1)*(ZTJ-PT (JLON, JLEV+1))+ZLH&
  & (JLON, JLEV+1)*ZDQL1-ZRH (JLON, JLEV+1)*ZTJ*ZLOG
  ZQVSH2=FOQS (FOEW (ZTDERI, ZNEIGE)/PAPRS (JLON, JLEV))
  ZDQL2=ZQSEUIL (JLON, JLEV+1)*(ZQVS (JLON, JLEV+1)-ZQVSH2)
  ZDH2=ZCPH (JLON, JLEV+1)*(ZTDERI-PT (JLON, JLEV+1))+ZLH&
  & (JLON, JLEV+1)*ZDQL2-ZRH (JLON, JLEV+1)*ZTDERI*ZLOG
  ZTHUC (JLON, JLEV)=ZTJ+ZDH1*(ZTDERI-ZTJ)/(ZDH1-ZDH2)
  ZTHU (JLON, JLEV)=ZTJ
  
ENDDO


ZTHDC (JLON, KLEV)=ZTHDC (JLON, KLEV-1)
ZTHD (JLON, KLEV)=ZTHD (JLON, KLEV-1)
ZTHUC (JLON, KLEV)=ZTHUC (JLON, KLEV-1)
ZTHU (JLON, KLEV)=ZTHU (JLON, KLEV-1)


DO JLEV=1, KLEV-1
  
  ZDTH2 (JLON, JLEV)=ZTHUC (JLON, JLEV)-ZTHDC (JLON, JLEV)
  ZCIS=MAX (1.0E-10_JPRB,(PU (JLON, JLEV+1)-PU (JLON, JLEV&
  &))**2+(PV (JLON, JLEV+1)-PV (JLON, JLEV))**2)
  ZTHETAH=0.5_JPRB*(ZTHETAVL (JLON, JLEV+1)+ZTHETAVL (JLON, JLEV))
  ZDPHI=PAPHIF (JLON, JLEV+1)-PAPHIF (JLON, JLEV)
  ZRI2 (JLON, JLEV)=ZDPHI*ZDTH2 (JLON, JLEV)/ZCIS/ZTHETAH
  ZNN_CLOUD (JLON, JLEV)=MAX (1.0E-10_JPRB, ZDTH2 (JLON, JLEV)/ZDPHI/ZTHETAH)
  
ENDDO


ZNN_CLEAR (JLON, KLEV)=ZNN_CLEAR (JLON, KLEV-1)
ZNN_CLOUD (JLON, KLEV)=ZNN_CLOUD (JLON, KLEV-1)


DO JLEV=1, KLEV
  
  ZRIF (JLON, JLEV)=0.5_JPRB*(ZRI (JLON, JLEV-1)+ZRI (JLON, JLEV))
  ZRIF2 (JLON, JLEV)=0.5_JPRB*(ZRI2 (JLON, JLEV-1)+ZRI2 (JLON, JLEV))
  
ENDDO


DO JLEV=1, KLEV
  
  ZSEUILM=MAX (0.0_JPRB, SIGN (1.0_JPRB, ZRIF (JLON, JLEV)))
  ZSEUILH=MAX (0.0_JPRB, SIGN (1.0_JPRB, ZRIF (JLON, JLEV)))
  ZARIM=ZALPHARM*ZRIF (JLON, JLEV)
  ZARIH=ZALPHARH*ZRIF (JLON, JLEV)
  ZFM_CLEAR (JLON, JLEV)=ZOFFSET+(ZALPHAN-(ZALPHACM-ZALPHAN)&
  &*(ZSEUILM*ZARIM+(1.0_JPRB-ZSEUILM)*ATAN (ZARIM))/ZPIS2)
  ZFH_CLEAR (JLON, JLEV)=ZOFFSET+(ZALPHAN-(ZALPHACH-ZALPHAN)&
  &*(ZSEUILH*ZARIH+(1.0_JPRB-ZSEUILH)*ATAN (ZARIH))/ZPIS2)
  
ENDDO


DO JLEV=1, KLEV
  
  ZSEUILM=MAX (0.0_JPRB, SIGN (1.0_JPRB, ZRIF2 (JLON, JLEV)))
  ZSEUILH=MAX (0.0_JPRB, SIGN (1.0_JPRB, ZRIF2 (JLON, JLEV)))
  ZARIM=ZALPHARM*ZRIF2 (JLON, JLEV)
  ZARIH=ZALPHARH*ZRIF2 (JLON, JLEV)
  ZFM_CLOUD (JLON, JLEV)=ZOFFSET+(ZALPHAN-(ZALPHACM-ZALPHAN)&
  &*(ZSEUILM*ZARIM+(1.0_JPRB-ZSEUILM)*ATAN (ZARIM))/ZPIS2)
  ZFH_CLOUD (JLON, JLEV)=ZOFFSET+(ZALPHAN-(ZALPHACH-ZALPHAN)&
  &*(ZSEUILH*ZARIH+(1.0_JPRB-ZSEUILH)*ATAN (ZARIH))/ZPIS2)
  
ENDDO


ZLUPM_CLEAR (JLON, KLEV)=0.0_JPRB
ZLDNM_CLEAR (JLON, 1)=0.0_JPRB
ZLUPH_CLEAR (JLON, KLEV)=0.0_JPRB
ZLDNH_CLEAR (JLON, 1)=0.0_JPRB
ZLUPM_CLOUD (JLON, KLEV)=0.0_JPRB
ZLDNM_CLOUD (JLON, 1)=0.0_JPRB
ZLUPH_CLOUD (JLON, KLEV)=0.0_JPRB
ZLDNH_CLOUD (JLON, 1)=0.0_JPRB

ZGZTOP =0.0_JPRB
ZGZBOT =100000.0_JPRB
ZGZTOPCVP =0.0_JPRB
ZGZBOTCVP =100000.0_JPRB

DO JLEV=KTDIAN, KLEV
  
  ZGZTOP =MAX (ZGZTOP , PAPHIF (JLON, JLEV)*PNLAB (JLON, JLEV))
  ZGZBOT =(1.0_JPRB-PNLAB (JLON, JLEV))*ZGZBOT +PNLAB (JLON, JLEV)*MIN (ZGZBOT , PAPHIF (JLON, JLEV))
  
ENDDO


DO JLEV=KTDIAN, KLEV
  
  ZGZTOPCVP =MAX (ZGZTOPCVP , PAPHIF (JLON, JLEV)*PNLABCVP (JLON, JLEV))
  ZGZBOTCVP =(1.0_JPRB-PNLABCVP (JLON, JLEV))*ZGZBOTCVP +PNLABCVP&
  & (JLON, JLEV)*MIN (ZGZBOTCVP , PAPHIF (JLON, JLEV))
  
ENDDO


DO JLEV=KLEV-1, 1,-1
  
  ZLUPM_CLEAR (JLON, JLEV)=MAX (0.0_JPRB, ZLUPM_CLEAR (JLON, JLEV+1)+ZFM_CLEAR&
  & (JLON, JLEV+1)*(PAPHI (JLON, JLEV)-PAPHI (JLON, JLEV+1)))
  ZLUPH_CLEAR (JLON, JLEV)=MAX (0.0_JPRB, ZLUPH_CLEAR (JLON, JLEV+1)+ZFH_CLEAR&
  & (JLON, JLEV+1)*(PAPHI (JLON, JLEV)-PAPHI (JLON, JLEV+1)))
  ZLUPM_CLOUD (JLON, JLEV)=MAX (0.0_JPRB, ZLUPM_CLOUD (JLON, JLEV+1)+ZFM_CLOUD&
  & (JLON, JLEV+1)*(PAPHI (JLON, JLEV)-PAPHI (JLON, JLEV+1)))
  ZLUPH_CLOUD (JLON, JLEV)=MAX (0.0_JPRB, ZLUPH_CLOUD (JLON, JLEV+1)+ZFH_CLOUD&
  & (JLON, JLEV+1)*(PAPHI (JLON, JLEV)-PAPHI (JLON, JLEV+1)))
  
ENDDO


DO JLEV=2, KLEV
  
  ZLDNM_CLEAR (JLON, JLEV)=MAX (0.0_JPRB, ZLDNM_CLEAR (JLON, JLEV-1)+ZFM_CLEAR&
  & (JLON, JLEV)*(PAPHI (JLON, JLEV-1)-PAPHI (JLON, JLEV)))
  ZLDNH_CLEAR (JLON, JLEV)=MAX (0.0_JPRB, ZLDNH_CLEAR (JLON, JLEV-1)+ZFH_CLEAR&
  & (JLON, JLEV)*(PAPHI (JLON, JLEV-1)-PAPHI (JLON, JLEV)))
  ZLDNM_CLOUD (JLON, JLEV)=MAX (0.0_JPRB, ZLDNM_CLOUD (JLON, JLEV-1)+ZFM_CLOUD&
  & (JLON, JLEV)*(PAPHI (JLON, JLEV-1)-PAPHI (JLON, JLEV)))
  ZLDNH_CLOUD (JLON, JLEV)=MAX (0.0_JPRB, ZLDNH_CLOUD (JLON, JLEV-1)+ZFH_CLOUD&
  & (JLON, JLEV)*(PAPHI (JLON, JLEV-1)-PAPHI (JLON, JLEV)))
  
ENDDO


DO JLEV=KTDIAN, KLEV-1

  

  IF (YDPHY%LECSHAL) THEN
    ZLUPM_CLEAR (JLON, JLEV)=MAX (ZLUPM_CLEAR (JLON, JLEV)&
    &, PNLAB (JLON, JLEV)*(ZGZTOP -PAPHI (JLON, JLEV)))
    ZLUPM_CLOUD (JLON, JLEV)=MAX (ZLUPM_CLOUD (JLON, JLEV)&
    &, PNLAB (JLON, JLEV)*(ZGZTOP -PAPHI (JLON, JLEV)))
    ZLUPH_CLEAR (JLON, JLEV)=MAX (ZLUPH_CLEAR (JLON, JLEV)&
    &, PNLAB (JLON, JLEV)*(ZGZTOP -PAPHI (JLON, JLEV)))
    ZLUPH_CLOUD (JLON, JLEV)=MAX (ZLUPH_CLOUD (JLON, JLEV)&
    &, PNLAB (JLON, JLEV)*(ZGZTOP -PAPHI (JLON, JLEV)))
    ZLDNM_CLEAR (JLON, JLEV)=MAX (ZLDNM_CLEAR (JLON, JLEV)&
    &, PNLAB (JLON, JLEV)*(PAPHI (JLON, JLEV)-ZGZBOT ))
    ZLDNM_CLOUD (JLON, JLEV)=MAX (ZLDNM_CLOUD (JLON, JLEV)&
    &, PNLAB (JLON, JLEV)*(PAPHI (JLON, JLEV)-ZGZBOT ))
    ZLDNH_CLEAR (JLON, JLEV)=MAX (ZLDNH_CLEAR (JLON, JLEV)&
    &, PNLAB (JLON, JLEV)*(PAPHI (JLON, JLEV)-ZGZBOT ))
    ZLDNH_CLOUD (JLON, JLEV)=MAX (ZLDNH_CLOUD (JLON, JLEV)&
    &, PNLAB (JLON, JLEV)*(PAPHI (JLON, JLEV)-ZGZBOT ))
  ENDIF


  IF (YDPHY%LECDEEP) THEN
    ZGZLCVPUP=MIN (YDCST%RG*YDPHY0%ALMAVX, ZGZTOPCVP -PAPHI (JLON, JLEV))
    ZGZLCVPDN=MIN (YDCST%RG*YDPHY0%ALMAVX, PAPHI (JLON, JLEV)-ZGZBOTCVP )
    ZLUPM_CLEAR (JLON, JLEV)=MAX (ZLUPM_CLEAR (JLON, JLEV), PNLABCVP (JLON, JLEV)*ZGZLCVPUP)
    ZLUPM_CLOUD (JLON, JLEV)=MAX (ZLUPM_CLOUD (JLON, JLEV), PNLABCVP (JLON, JLEV)*ZGZLCVPUP)
    ZLUPH_CLEAR (JLON, JLEV)=MAX (ZLUPH_CLEAR (JLON, JLEV), PNLABCVP (JLON, JLEV)*ZGZLCVPUP)
    ZLUPH_CLOUD (JLON, JLEV)=MAX (ZLUPH_CLOUD (JLON, JLEV), PNLABCVP (JLON, JLEV)*ZGZLCVPUP)
    ZLDNM_CLEAR (JLON, JLEV)=MAX (ZLDNM_CLEAR (JLON, JLEV), PNLABCVP (JLON, JLEV)*ZGZLCVPDN)
    ZLDNM_CLOUD (JLON, JLEV)=MAX (ZLDNM_CLOUD (JLON, JLEV), PNLABCVP (JLON, JLEV)*ZGZLCVPDN)
    ZLDNH_CLEAR (JLON, JLEV)=MAX (ZLDNH_CLEAR (JLON, JLEV), PNLABCVP (JLON, JLEV)*ZGZLCVPDN)
    ZLDNH_CLOUD (JLON, JLEV)=MAX (ZLDNH_CLOUD (JLON, JLEV), PNLABCVP (JLON, JLEV)*ZGZLCVPDN)
  ENDIF

  
ENDDO


DO JLEV=2, KLEV
  
  ZPHIH=PAPHI (JLON, JLEV)-PAPHI (JLON, KLEV)+PGZ0 (JLON)
  ZLDNH_CLEAR (JLON, JLEV)=MIN (ZPHIH, ZLDNH_CLEAR (JLON, JLEV))
  ZLDNH_CLOUD (JLON, JLEV)=MIN (ZPHIH, ZLDNH_CLOUD (JLON, JLEV))
  ZLDNM_CLEAR (JLON, JLEV)=MIN (ZPHIH, ZLDNM_CLEAR (JLON, JLEV))
  ZLDNM_CLOUD (JLON, JLEV)=MIN (ZPHIH, ZLDNM_CLOUD (JLON, JLEV))
  
ENDDO


DO JLEV=1, KLEV
  
  ZLINTM_CLEAR (JLON, JLEV)=(ZLDNM_CLEAR (JLON, JLEV)*ZLUPM_CLEAR (JLON, JLEV&
  &))/MAX (1.0E-10_JPRB, ZLDNM_CLEAR (JLON, JLEV)+ZLUPM_CLEAR (JLON, JLEV))
  ZLINTH_CLEAR (JLON, JLEV)=(ZLDNH_CLEAR (JLON, JLEV)*ZLUPH_CLEAR (JLON, JLEV&
  &))/MAX (1.0E-10_JPRB, ZLDNH_CLEAR (JLON, JLEV)+ZLUPH_CLEAR (JLON, JLEV))
  ZLINTM_CLOUD (JLON, JLEV)=(ZLDNM_CLOUD (JLON, JLEV)*ZLUPM_CLOUD (JLON, JLEV&
  &))/MAX (1.0E-10_JPRB, ZLDNM_CLOUD (JLON, JLEV)+ZLUPM_CLOUD (JLON, JLEV))
  ZLINTH_CLOUD (JLON, JLEV)=(ZLDNH_CLOUD (JLON, JLEV)*ZLUPH_CLOUD (JLON, JLEV&
  &))/MAX (1.0E-10_JPRB, ZLDNH_CLOUD (JLON, JLEV)+ZLUPH_CLOUD (JLON, JLEV))
  ZCM_CLEAR=ZCH*MIN (1.0_JPRB, MAX (3.0_JPRB, 1.0_JPRB+2.0_JPRB*ZRIF (JLON, JLEV)))
  ZCM_CLOUD=ZCH*MIN (1.0_JPRB, MAX (3.0_JPRB, 1.0_JPRB+2.0_JPRB*ZRIF2 (JLON, JLEV)))
  ZLSM_CLEAR (JLON, JLEV)=ZCM_CLEAR*SQRT (PECT (JLON, JLEV)/ZNN_CLEAR (JLON, JLEV))
  ZLSH_CLEAR (JLON, JLEV)=ZCH*SQRT (PECT (JLON, JLEV)/ZNN_CLEAR (JLON, JLEV))
  ZLSM_CLOUD (JLON, JLEV)=ZCM_CLOUD*SQRT (PECT (JLON, JLEV)/ZNN_CLOUD (JLON, JLEV))
  ZLSH_CLOUD (JLON, JLEV)=ZCH*SQRT (PECT (JLON, JLEV)/ZNN_CLOUD (JLON, JLEV))
  ZC1=ZCN*YDCST%RKAPPA*PAPHI (JLON, JLEV)/YDCST%RG
  ZLMIN (JLON, JLEV)=ZLINF*ZC1/(ZC1+ZLINF)
  ZC3M_CLEAR=ZLINTM_CLEAR (JLON, JLEV)*ZLINTM_CLEAR (JLON, JLEV)+ZLMIN (JLON, JLEV)*ZLMIN (JLON, JLEV)
  ZC3H_CLEAR=ZLINTH_CLEAR (JLON, JLEV)*ZLINTH_CLEAR (JLON, JLEV)+ZLMIN (JLON, JLEV)*ZLMIN (JLON, JLEV)
  ZLENDM_CLEAR (JLON, JLEV)=SQRT (2.0_JPRB)*ZLSM_CLEAR (JLON, JLEV)*SQRT (ZC3M_CLEAR&
  &/(ZLSM_CLEAR (JLON, JLEV)*ZLSM_CLEAR (JLON, JLEV)+ZC3M_CLEAR))
  ZLENDH_CLEAR (JLON, JLEV)=SQRT (2.0_JPRB)*ZLSH_CLEAR (JLON, JLEV)*SQRT (ZC3H_CLEAR&
  &/(ZLSH_CLEAR (JLON, JLEV)*ZLSH_CLEAR (JLON, JLEV)+ZC3H_CLEAR))
  ZC3M_CLOUD=ZLINTM_CLOUD (JLON, JLEV)*ZLINTM_CLOUD (JLON, JLEV)+ZLMIN (JLON, JLEV)*ZLMIN (JLON, JLEV)
  ZC3H_CLOUD=ZLINTH_CLOUD (JLON, JLEV)*ZLINTH_CLOUD (JLON, JLEV)+ZLMIN (JLON, JLEV)*ZLMIN (JLON, JLEV)
  ZLENDM_CLOUD (JLON, JLEV)=SQRT (2.0_JPRB)*ZLSM_CLOUD (JLON, JLEV)*SQRT (ZC3M_CLOUD&
  &/(ZLSM_CLOUD (JLON, JLEV)*ZLSM_CLOUD (JLON, JLEV)+ZC3M_CLOUD))
  ZLENDH_CLOUD (JLON, JLEV)=SQRT (2.0_JPRB)*ZLSH_CLOUD (JLON, JLEV)*SQRT (ZC3H_CLOUD&
  &/(ZLSH_CLOUD (JLON, JLEV)*ZLSH_CLOUD (JLON, JLEV)+ZC3H_CLOUD))
  
ENDDO


IF (YDPHY%NLEND==3) THEN
  ZEPSIG=1.E-12_JPRB
  ZEPDELT=1.E-12_JPRB
  ZEPSQ=1.E-12_JPRB
  ZEPNEBS=1.E-12_JPRB
  ZNEB (JLON,:)=0.0_JPRB
  ZNEBI (JLON,:)=0.0_JPRB

  DO JLEV=KTDIAN, KLEV-1
    
    ZTF1=PT (JLON, JLEV)
    ZQCF1=PQLI (JLON, JLEV)+PQICE (JLON, JLEV)
    ZQWF1=PQV (JLON, JLEV)+PQLI (JLON, JLEV)+PQICE (JLON, JLEV)
    ZQWF1=MAX (ABS (ZQWF1), ZEPSQ)
    ZLSCPEF1=PLSCPE (JLON, JLEV)
    ZTLF1=ZTF1-ZLSCPEF1*ZQCF1
    ZH1=MAX (0.0_JPRB, SIGN (1.0_JPRB, YDCST%RTT-ZTLF1))
    ZEW1=FOEW (ZTLF1, ZH1)/PAPRSF (JLON, JLEV)
    ZQSATF1=FOQS (ZEW1)
    ZDLEWF1=FODLEW (ZTLF1, ZH1)
    ZQSLTLF1=FODQS (ZQSATF1, ZEW1, ZDLEWF1)
    ZTHETAL1=ZTHETA (JLON, JLEV)*(1.0_JPRB-ZLSCPEF1*ZQCF1/ZTF1)
    ZDELTQF1=ZQWF1-ZQSATF1
    ZDELTQF1=SIGN (MAX (ABS (ZDELTQF1), ZEPDELT), ZDELTQF1)
    ZTF2=PT (JLON, JLEV+1)
    ZQCF2=PQLI (JLON, JLEV+1)+PQICE (JLON, JLEV+1)
    ZQWF2=PQV (JLON, JLEV+1)+PQLI (JLON, JLEV+1)+PQICE (JLON, JLEV+1)
    ZQWF2=MAX (ABS (ZQWF2), ZEPSQ)
    ZLSCPEF2=PLSCPE (JLON, JLEV+1)
    ZTLF2=ZTF2-ZLSCPEF2*ZQCF2
    ZH2=MAX (0.0_JPRB, SIGN (1.0_JPRB, YDCST%RTT-ZTLF2))
    ZEW2=FOEW (ZTLF2, ZH2)/PAPRSF (JLON, JLEV+1)
    ZQSATF2=FOQS (ZEW2)
    ZDLEWF2=FODLEW (ZTLF2, ZH2)
    ZQSLTLF2=FODQS (ZQSATF2, ZEW2, ZDLEWF2)
    ZTHETAL2=ZTHETA (JLON, JLEV+1)*(1.0_JPRB-ZLSCPEF2*ZQCF2/ZTF2)
    ZDELTQF2=ZQWF2-ZQSATF2
    ZDELTQF2=SIGN (MAX (ABS (ZDELTQF2), ZEPDELT), ZDELTQF2)
    ZTH=(ZTF1+ZTF2)/2.0_JPRB
    ZQSLTLH=(ZQSLTLF1+ZQSLTLF2)/2.0_JPRB
    ZLSCPEH=(ZLSCPEF1+ZLSCPEF2)/2.0_JPRB
    ZDELTQH (JLON, JLEV)=(ZDELTQF1+ZDELTQF2)/2.0_JPRB
    ZTHETAH=ZTH*(YDCST%RATM/PAPRS (JLON, JLEV))**YDCST%RKAPPA
    ZBB=ZTH*ZQSLTLH/ZTHETAH
    ZDTHETAL=ZTHETAL1-ZTHETAL2
    ZDPHI=PAPHIF (JLON, JLEV)-PAPHIF (JLON, JLEV+1)
    ZDQW=PQV (JLON, JLEV)-PQV (JLON, JLEV+1)+PQLI (JLON, JLEV)-PQLI&
    & (JLON, JLEV+1)+PQICE (JLON, JLEV)-PQICE (JLON, JLEV+1)
    ZAA (JLON, JLEV)=1.0_JPRB/(1.0_JPRB+ZLSCPEH*ZQSLTLH)
    ZIGMAS_CLOUD (JLON, JLEV)=MAX (ZEPSIG, ABS (0.2_JPRB*ZLENDM_CLOUD&
    & (JLON, JLEV)*ZAA (JLON, JLEV)*(ZDQW-ZBB*ZDTHETAL)/ZDPHI))
    ZIGMAS_CLEAR (JLON, JLEV)=MAX (ZEPSIG, ABS (0.2_JPRB*ZLENDM_CLEAR&
    & (JLON, JLEV)*ZAA (JLON, JLEV)*(ZDQW-ZBB*ZDTHETAL)/ZDPHI))
    ZNEBI (JLON, JLEV)=MAX (0.0_JPRB, SIGN (1.0_JPRB, ZTH-YDCST%RTT))
  
  ENDDO


  DO JN=1, 3

    DO JLEV=KTDIAN, KLEV-1
      
      ZIGMAS=ZNEB (JLON, JLEV)*ZIGMAS_CLOUD (JLON, JLEV)+(1.0_JPRB&
      &-ZNEB (JLON, JLEV))*ZIGMAS_CLEAR (JLON, JLEV)
      ZRIH=ZNEB (JLON, JLEV)*ZRI2 (JLON, JLEV)+(1.0_JPRB-ZNEB (JLON, JLEV))*ZRI (JLON, JLEV)
      ZRESUL=MAX (0.0_JPRB, SIGN (1.0_JPRB, YDPHY0%RICRET-ZRIH))
      ZSURSAT=MAX (0.0_JPRB, SIGN (1.0_JPRB, ZDELTQH (JLON, JLEV)))
      ZQ11=ZAA (JLON, JLEV)*ZDELTQH (JLON, JLEV)/(2*ZIGMAS)
      INQ1=MIN (MAX (-22, FLOOR (2*ZQ11)), 10)
      ZINC=2.0_JPRB*ZQ11-INQ1
      ZZN1D=MIN (1.0_JPRB,(1.0_JPRB-ZINC)*YDPHY0%RN1D (INQ1)+ZINC*YDPHY0%RN1D (INQ1+1))
      ZNEB (JLON, JLEV)=(ZZN1D*ZRESUL+ZSURSAT*(1.0_JPRB-ZRESUL))*YDPHY0%RFACNSM
      ZNEB (JLON, JLEV)=ZNEBI (JLON, JLEV)*MAX (ZEPNEBS, MIN (ZNEB (JLON, JLEV), 0.5_JPRB))
    
    ENDDO

  ENDDO


  DO JLEV=1, KLEV
    
    ZLENDM (JLON, JLEV)=ZNEB (JLON, JLEV)*ZLENDM_CLOUD (JLON, JLEV&
    &)+(1.0_JPRB-ZNEB (JLON, JLEV))*ZLENDM_CLEAR (JLON, JLEV)
    ZLENDH (JLON, JLEV)=ZNEB (JLON, JLEV)*ZLENDH_CLOUD (JLON, JLEV&
    &)+(1.0_JPRB-ZNEB (JLON, JLEV))*ZLENDH_CLEAR (JLON, JLEV)
  
  ENDDO

ELSE

  DO JLEV=1, KLEV
    
    ZLENDM (JLON, JLEV)=ZLENDM_CLEAR (JLON, JLEV)
    ZLENDH (JLON, JLEV)=ZLENDH_CLEAR (JLON, JLEV)
  
  ENDDO

ENDIF


DO JLEV=2, KLEV-1
  
  ZLENDMM (JLON, JLEV)=0.5_JPRB*ZLENDM (JLON, JLEV)+0.25_JPRB&
  &*ZLENDM (JLON, JLEV-1)+0.25_JPRB*ZLENDM (JLON, JLEV+1)
  
ENDDO


ZLENDMM (JLON, KLEV)=0.75_JPRB*ZLENDM (JLON, KLEV)+0.25_JPRB*ZLENDM (JLON, KLEV-1)
ZLENDMM (JLON, 1)=0.75_JPRB*ZLENDM (JLON, 1)+0.25_JPRB*ZLENDM (JLON, 2)


DO JLEV=1, KLEV
  
  ZPHIH=PAPHI (JLON, JLEV)-PAPHI (JLON, KLEV)+PGZ0 (JLON)
  ZGLKARMN=YDPHY0%VKARMN*ZPHIH
  ZGLMINF (JLON, JLEV)=MIN (YDCST%RG*YDPHY0%ALMAVE, ZGLKARMN)
  PLEND (JLON, JLEV)=MAX (YDCST%RG*ZLENDMM (JLON, JLEV), ZGLMINF (JLON, JLEV))
  PUSLE (JLON, JLEV)=1.0_JPRB/(YDPHY0%ALD*PLEND (JLON, JLEV))
  
ENDDO

ZPHI3MAX=(1.0_JPRB-YDPHY0%ACBRPHIM)/YDPHY0%ACBRPHIM

DO JLEV=1, KLEV-1
  
  ZPHI3I=1._JPRB+MAX (ZPHI3MAX, YDPHY0%ARSC1*MIN (2.0_JPRB, PLEND&
  & (JLON, JLEV)*PLEND (JLON, JLEV)/ZG2LD2 (JLON, JLEV)))
  PPHI3 (JLON, JLEV)=1._JPRB/ZPHI3I
  
ENDDO


PPHI3 (JLON, KLEV)=1._JPRB



END SUBROUTINE ACLENDER_OPENACC
