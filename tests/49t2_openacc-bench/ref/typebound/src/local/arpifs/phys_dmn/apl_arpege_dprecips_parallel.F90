SUBROUTINE APL_ARPEGE_DPRECIPS_PARALLEL (YDMF_PHYS_BASE_STATE, YDCPG_BNDS, YDCPG_OPTS&
&, YDMF_PHYS, YDVARS, YDMODEL, YD_PPRC_DPRECIPS, YD_PPRC_DPRECIPS2)

USE YOMHOOK,ONLY:LHOOK, DR_HOOK, JPHOOK
USE MF_PHYS_BASE_STATE_TYPE_MOD,ONLY:MF_PHYS_BASE_STATE_TYPE
USE CPG_OPTS_TYPE_MOD,ONLY:CPG_BNDS_TYPE, CPG_OPTS_TYPE
USE MF_PHYS_TYPE_MOD,ONLY:MF_PHYS_TYPE
USE FIELD_VARIABLES_MOD,ONLY:FIELD_VARIABLES
USE TYPE_MODEL,ONLY:MODEL
USE FIELD_MODULE
USE FIELD_FACTORY_MODULE
USE FIELD_ACCESS_MODULE
USE FXTRAN_ACDC_PARALLELMETHOD_MOD
USE FXTRAN_ACDC_STACK_MOD
USE PARKIND1
USE FXTRAN_ACDC_ARRAY_COPY_MOD
USE FXTRAN_ACDC_GPUMEM_MOD
#include "fxtran_acdc_stack.h"

IMPLICIT NONE


TYPE (MF_PHYS_BASE_STATE_TYPE), INTENT (IN)::YDMF_PHYS_BASE_STATE
TYPE (CPG_BNDS_TYPE), INTENT (IN)::YDCPG_BNDS
TYPE (CPG_OPTS_TYPE), INTENT (IN)::YDCPG_OPTS
TYPE (MF_PHYS_TYPE), INTENT (INOUT)::YDMF_PHYS
TYPE (FIELD_VARIABLES), INTENT (INOUT)::YDVARS
TYPE (MODEL), INTENT (IN)::YDMODEL
CLASS (FIELD_3RB), POINTER :: YD_PPRC_DPRECIPS
REAL (KIND=JPRB), POINTER::PPRC_DPRECIPS (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PPRC_DPRECIPS2
REAL (KIND=JPRB), POINTER::PPRC_DPRECIPS2 (:,:,:)
#include "dprecips.intfb.h"
#include "abor1.intfb.h"
#include "dprecips_openacc.intfb.h"
#include "ppwetpoint.intfb.h"
#include "ppwetpoint_openacc.intfb.h"
CLASS (FIELD_3RB), POINTER :: YL_ZDZZ
REAL (KIND=JPRB), POINTER::ZDZZ (:,:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZFPLC
REAL (KIND=JPRB), POINTER::ZFPLC (:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZFPLS
REAL (KIND=JPRB), POINTER::ZFPLS (:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZFPLSG
REAL (KIND=JPRB), POINTER::ZFPLSG (:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZTW
REAL (KIND=JPRB), POINTER::ZTW (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZZZ
REAL (KIND=JPRB), POINTER::ZZZ (:,:,:)
REAL (KIND=JPRB)::ZINVG
INTEGER (KIND=JPIM)::JLEV
INTEGER (KIND=JPIM)::JLON
REAL (KIND=JPHOOK)::ZHOOK_HANDLE
INTEGER(KIND=JPIM) :: JBLK
TYPE(CPG_BNDS_TYPE) :: YLCPG_BNDS
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_FIELD_API
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_PARALLEL
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_COMPUTE
TYPE(FXTRAN_ACDC_STACK) :: YLSTACK
TYPE(FXTRAN_ACDC_STACK) :: YLOFFSET
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_BASE_STATE_I(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_BASE_STATE_L(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_BASE_STATE_Q(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_BASE_STATE_T(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHI(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_PREHYDF(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_DIAGH(:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FPLCL(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FPLCN(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FPLSL(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FPLSN(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_TPWCLS(:,:)
REAL(KIND=JPRB), POINTER :: Z_YDVARS_GEOMETRY_OROG_T0(:,:)
IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_DPRECIPS_PARALLEL', 0, ZHOOK_HANDLE)

CALL FXTRAN_ACDC_GPUMEMSTAT (__FILE__, __LINE__, "BEGIN")


IF (LHOOK) CALL DR_HOOK ('CREATE_TEMPORARIES',0,ZHOOK_HANDLE_FIELD_API)
CALL FIELD_NEW (YL_ZZZ, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZTW, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZFPLSG, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZFPLS, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZFPLC, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%JBLKMAX&
&], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZDZZ, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
IF (LHOOK) CALL DR_HOOK ('CREATE_TEMPORARIES',1,ZHOOK_HANDLE_FIELD_API)
ZINVG=1._JPRB/YDMODEL%YRCST%RG

IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_DPRECIPS_PARALLEL:0',0,ZHOOK_HANDLE_PARALLEL)

IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','APL_ARPEGE_DPRECIPS_PARALLEL:0')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_DPRECIPS_PARALLEL:0:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  PPRC_DPRECIPS => GET_HOST_DATA_RDWR (YD_PPRC_DPRECIPS)
  PPRC_DPRECIPS2 => GET_HOST_DATA_RDWR (YD_PPRC_DPRECIPS2)
  ZDZZ => GET_HOST_DATA_RDWR (YL_ZDZZ)
  ZFPLC => GET_HOST_DATA_RDWR (YL_ZFPLC)
  ZFPLS => GET_HOST_DATA_RDWR (YL_ZFPLS)
  ZFPLSG => GET_HOST_DATA_RDWR (YL_ZFPLSG)
  ZTW => GET_HOST_DATA_RDWR (YL_ZTW)
  ZZZ => GET_HOST_DATA_RDWR (YL_ZZZ)
  Z_YDMF_PHYS_BASE_STATE_I => GET_HOST_DATA_RDONLY (YDMF_PHYS_BASE_STATE%F_I)
  Z_YDMF_PHYS_BASE_STATE_L => GET_HOST_DATA_RDONLY (YDMF_PHYS_BASE_STATE%F_L)
  Z_YDMF_PHYS_BASE_STATE_Q => GET_HOST_DATA_RDONLY (YDMF_PHYS_BASE_STATE%F_Q)
  Z_YDMF_PHYS_BASE_STATE_T => GET_HOST_DATA_RDONLY (YDMF_PHYS_BASE_STATE%F_T)
  Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHI => GET_HOST_DATA_RDONLY (YDMF_PHYS_BASE_STATE%YCPG_DYN%F_PHI)
  Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF => GET_HOST_DATA_RDONLY (YDMF_PHYS_BASE_STATE%YCPG_DYN%F_PHIF)
  Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_PREHYDF => GET_HOST_DATA_RDONLY&
  & (YDMF_PHYS_BASE_STATE%YCPG_PHY%F_PREHYDF)
  Z_YDMF_PHYS_OUT_DIAGH => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_DIAGH)
  Z_YDMF_PHYS_OUT_FPLCL => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FPLCL)
  Z_YDMF_PHYS_OUT_FPLCN => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FPLCN)
  Z_YDMF_PHYS_OUT_FPLSL => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FPLSL)
  Z_YDMF_PHYS_OUT_FPLSN => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FPLSN)
  Z_YDMF_PHYS_OUT_TPWCLS => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_TPWCLS)
  Z_YDVARS_GEOMETRY_OROG_T0 => GET_HOST_DATA_RDONLY (YDVARS%GEOMETRY%OROG%FT0)
  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_DPRECIPS_PARALLEL:0:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_DPRECIPS_PARALLEL:0:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
  !$OMP PARALLEL DO PRIVATE (JBLK, JLEV, JLON) FIRSTPRIVATE (YLCPG_BNDS)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    CALL YLCPG_BNDS%UPDATE (JBLK)
    
    CALL PPWETPOINT (YDMODEL%YRCST, YDMODEL%YRML_PHY_MF%YRPHY, YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA&
    &, YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_PREHYDF (:,:, JBLK)&
    &, Z_YDMF_PHYS_BASE_STATE_T (:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_Q (:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_L&
    & (:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_I (:,:, JBLK), ZTW (:,:, JBLK))

    DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
      ZFPLS (JLON, JBLK)=Z_YDMF_PHYS_OUT_FPLCN (JLON, YDCPG_OPTS%KFLEVG&
      &, JBLK)+Z_YDMF_PHYS_OUT_FPLSN (JLON, YDCPG_OPTS%KFLEVG, JBLK)
      ZFPLC (JLON, JBLK)=Z_YDMF_PHYS_OUT_FPLCL (JLON, YDCPG_OPTS%KFLEVG&
      &, JBLK)+Z_YDMF_PHYS_OUT_FPLSL (JLON, YDCPG_OPTS%KFLEVG, JBLK)
      ZFPLSG (JLON, JBLK)=0._JPRB
    ENDDO


    DO JLEV=1, YDCPG_OPTS%KFLEVG

      DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
        ZZZ (JLON, JLEV, JBLK)=Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHI (JLON, JLEV, JBLK)*ZINVG
      ENDDO

    ENDDO


    DO JLEV=2, YDCPG_OPTS%KFLEVG

      DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
        ZDZZ (JLON, JLEV, JBLK)=ZZZ (JLON, JLEV-1, JBLK)-ZZZ (JLON, JLEV, JBLK)
      ENDDO

    ENDDO


    DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
      ZDZZ (JLON, 1, JBLK)=Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHI (JLON, 0, JBLK)*ZINVG-ZZZ (JLON, 1, JBLK)
    ENDDO

    CALL DPRECIPS (YDMODEL%YRCST, YDMODEL%YRML_PHY_MF%YRPHY%YRDPRECIPS, YLCPG_BNDS%KIDIA, YLCPG_BNDS&
    &%KFDIA, YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, Z_YDVARS_GEOMETRY_OROG_T0(:, JBLK), Z_YDMF_PHYS_OUT_TPWCLS&
    &(:, JBLK), Z_YDMF_PHYS_OUT_DIAGH(:, JBLK), Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF(:,:, JBLK), ZDZZ&
    &(:,:, JBLK), ZTW(:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_L(:,:, JBLK), ZFPLC(:, JBLK), ZFPLS(:, JBLK&
    &), ZFPLSG(:, JBLK), PPRC_DPRECIPS (:, YDCPG_OPTS%NDTPRECCUR, JBLK))
    CALL DPRECIPS (YDMODEL%YRCST, YDMODEL%YRML_PHY_MF%YRPHY%YRDPRECIPS, YLCPG_BNDS%KIDIA, YLCPG_BNDS&
    &%KFDIA, YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, Z_YDVARS_GEOMETRY_OROG_T0(:, JBLK), Z_YDMF_PHYS_OUT_TPWCLS&
    &(:, JBLK), Z_YDMF_PHYS_OUT_DIAGH(:, JBLK), Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF(:,:, JBLK), ZDZZ&
    &(:,:, JBLK), ZTW(:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_L(:,:, JBLK), ZFPLC(:, JBLK), ZFPLS(:, JBLK&
    &), ZFPLSG(:, JBLK), PPRC_DPRECIPS2 (:, YDCPG_OPTS%NDTPRECCUR2, JBLK))
  ENDDO

  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_DPRECIPS_PARALLEL:0:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

  IF (FXTRAN_ACDC_LSYNCHOST ('APL_ARPEGE_DPRECIPS_PARALLEL:0')) THEN
    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_DPRECIPS_PARALLEL:0:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
    PPRC_DPRECIPS => GET_HOST_DATA_RDWR (YD_PPRC_DPRECIPS)
    PPRC_DPRECIPS2 => GET_HOST_DATA_RDWR (YD_PPRC_DPRECIPS2)
    ZDZZ => GET_HOST_DATA_RDWR (YL_ZDZZ)
    ZFPLC => GET_HOST_DATA_RDWR (YL_ZFPLC)
    ZFPLS => GET_HOST_DATA_RDWR (YL_ZFPLS)
    ZFPLSG => GET_HOST_DATA_RDWR (YL_ZFPLSG)
    ZTW => GET_HOST_DATA_RDWR (YL_ZTW)
    ZZZ => GET_HOST_DATA_RDWR (YL_ZZZ)
    Z_YDMF_PHYS_BASE_STATE_I => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%F_I)
    Z_YDMF_PHYS_BASE_STATE_L => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%F_L)
    Z_YDMF_PHYS_BASE_STATE_Q => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%F_Q)
    Z_YDMF_PHYS_BASE_STATE_T => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%F_T)
    Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHI => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%YCPG_DYN%F_PHI)
    Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%YCPG_DYN%F_PHIF)
    Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_PREHYDF => GET_HOST_DATA_RDWR&
    & (YDMF_PHYS_BASE_STATE%YCPG_PHY%F_PREHYDF)
    Z_YDMF_PHYS_OUT_DIAGH => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_DIAGH)
    Z_YDMF_PHYS_OUT_FPLCL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLCL)
    Z_YDMF_PHYS_OUT_FPLCN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLCN)
    Z_YDMF_PHYS_OUT_FPLSL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLSL)
    Z_YDMF_PHYS_OUT_FPLSN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLSN)
    Z_YDMF_PHYS_OUT_TPWCLS => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_TPWCLS)
    Z_YDVARS_GEOMETRY_OROG_T0 => GET_HOST_DATA_RDWR (YDVARS%GEOMETRY%OROG%FT0)
    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_DPRECIPS_PARALLEL:0:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_DPRECIPS_PARALLEL:0:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  PPRC_DPRECIPS => NULL ()
  PPRC_DPRECIPS2 => NULL ()
  ZDZZ => NULL ()
  ZFPLC => NULL ()
  ZFPLS => NULL ()
  ZFPLSG => NULL ()
  ZTW => NULL ()
  ZZZ => NULL ()
  Z_YDMF_PHYS_BASE_STATE_I => NULL ()
  Z_YDMF_PHYS_BASE_STATE_L => NULL ()
  Z_YDMF_PHYS_BASE_STATE_Q => NULL ()
  Z_YDMF_PHYS_BASE_STATE_T => NULL ()
  Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHI => NULL ()
  Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF => NULL ()
  Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_PREHYDF => NULL ()
  Z_YDMF_PHYS_OUT_DIAGH => NULL ()
  Z_YDMF_PHYS_OUT_FPLCL => NULL ()
  Z_YDMF_PHYS_OUT_FPLCN => NULL ()
  Z_YDMF_PHYS_OUT_FPLSL => NULL ()
  Z_YDMF_PHYS_OUT_FPLSN => NULL ()
  Z_YDMF_PHYS_OUT_TPWCLS => NULL ()
  Z_YDVARS_GEOMETRY_OROG_T0 => NULL ()
  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_DPRECIPS_PARALLEL:0:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMPSINGLECOLUMN','APL_ARPEGE_DPRECIPS_PARALLEL:0')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_DPRECIPS_PARALLEL:0:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  PPRC_DPRECIPS => GET_HOST_DATA_RDWR (YD_PPRC_DPRECIPS)
  PPRC_DPRECIPS2 => GET_HOST_DATA_RDWR (YD_PPRC_DPRECIPS2)
  ZDZZ => GET_HOST_DATA_RDWR (YL_ZDZZ)
  ZFPLC => GET_HOST_DATA_RDWR (YL_ZFPLC)
  ZFPLS => GET_HOST_DATA_RDWR (YL_ZFPLS)
  ZFPLSG => GET_HOST_DATA_RDWR (YL_ZFPLSG)
  ZTW => GET_HOST_DATA_RDWR (YL_ZTW)
  ZZZ => GET_HOST_DATA_RDWR (YL_ZZZ)
  Z_YDMF_PHYS_BASE_STATE_I => GET_HOST_DATA_RDONLY (YDMF_PHYS_BASE_STATE%F_I)
  Z_YDMF_PHYS_BASE_STATE_L => GET_HOST_DATA_RDONLY (YDMF_PHYS_BASE_STATE%F_L)
  Z_YDMF_PHYS_BASE_STATE_Q => GET_HOST_DATA_RDONLY (YDMF_PHYS_BASE_STATE%F_Q)
  Z_YDMF_PHYS_BASE_STATE_T => GET_HOST_DATA_RDONLY (YDMF_PHYS_BASE_STATE%F_T)
  Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHI => GET_HOST_DATA_RDONLY (YDMF_PHYS_BASE_STATE%YCPG_DYN%F_PHI)
  Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF => GET_HOST_DATA_RDONLY (YDMF_PHYS_BASE_STATE%YCPG_DYN%F_PHIF)
  Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_PREHYDF => GET_HOST_DATA_RDONLY&
  & (YDMF_PHYS_BASE_STATE%YCPG_PHY%F_PREHYDF)
  Z_YDMF_PHYS_OUT_DIAGH => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_DIAGH)
  Z_YDMF_PHYS_OUT_FPLCL => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FPLCL)
  Z_YDMF_PHYS_OUT_FPLCN => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FPLCN)
  Z_YDMF_PHYS_OUT_FPLSL => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FPLSL)
  Z_YDMF_PHYS_OUT_FPLSN => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FPLSN)
  Z_YDMF_PHYS_OUT_TPWCLS => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_TPWCLS)
  Z_YDVARS_GEOMETRY_OROG_T0 => GET_HOST_DATA_RDONLY (YDVARS%GEOMETRY%OROG%FT0)
  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_DPRECIPS_PARALLEL:0:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_DPRECIPS_PARALLEL:0:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  !$OMP PARALLEL DO PRIVATE (JBLK, JLEV, JLON, YLCPG_BNDS, YLSTACK)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX

    

    

    DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JLON
      YLCPG_BNDS%KFDIA = JLON
      YLSTACK%L8 = fxtran_acdc_stack_l8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%U8 = fxtran_acdc_stack_u8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%L4 = fxtran_acdc_stack_l4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%U4 = fxtran_acdc_stack_u4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      
      CALL PPWETPOINT_OPENACC (YDMODEL%YRCST, YDMODEL%YRML_PHY_MF%YRPHY, YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA&
      &, YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_PREHYDF (:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_T&
      & (:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_Q (:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_L (:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_I&
      & (:,:, JBLK), ZTW (:,:, JBLK),YDSTACK=YLSTACK)
      
      ZFPLS (JLON, JBLK)=Z_YDMF_PHYS_OUT_FPLCN (JLON, YDCPG_OPTS%KFLEVG&
      &, JBLK)+Z_YDMF_PHYS_OUT_FPLSN (JLON, YDCPG_OPTS%KFLEVG, JBLK)
      ZFPLC (JLON, JBLK)=Z_YDMF_PHYS_OUT_FPLCL (JLON, YDCPG_OPTS%KFLEVG&
      &, JBLK)+Z_YDMF_PHYS_OUT_FPLSL (JLON, YDCPG_OPTS%KFLEVG, JBLK)
      ZFPLSG (JLON, JBLK)=0._JPRB

      

      DO JLEV=1, YDCPG_OPTS%KFLEVG
        
        ZZZ (JLON, JLEV, JBLK)=Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHI (JLON, JLEV, JBLK)*ZINVG
      
      ENDDO


      DO JLEV=2, YDCPG_OPTS%KFLEVG
        
        ZDZZ (JLON, JLEV, JBLK)=ZZZ (JLON, JLEV-1, JBLK)-ZZZ (JLON, JLEV, JBLK)
      
      ENDDO

      
      ZDZZ (JLON, 1, JBLK)=Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHI (JLON, 0, JBLK)*ZINVG-ZZZ (JLON, 1, JBLK)
      
      CALL DPRECIPS_OPENACC (YDMODEL%YRCST, YDMODEL%YRML_PHY_MF%YRPHY%YRDPRECIPS, YLCPG_BNDS%KIDIA, YLCPG_BNDS&
      &%KFDIA, YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, Z_YDVARS_GEOMETRY_OROG_T0(:, JBLK), Z_YDMF_PHYS_OUT_TPWCLS&
      &(:, JBLK), Z_YDMF_PHYS_OUT_DIAGH(:, JBLK), Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF(:,:, JBLK), ZDZZ(&
      &:,:, JBLK), ZTW(:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_L(:,:, JBLK), ZFPLC(:, JBLK), ZFPLS(:, JBLK), ZFPLSG&
      &(:, JBLK), PPRC_DPRECIPS (:, YDCPG_OPTS%NDTPRECCUR, JBLK),YDSTACK=YLSTACK)
      CALL DPRECIPS_OPENACC (YDMODEL%YRCST, YDMODEL%YRML_PHY_MF%YRPHY%YRDPRECIPS, YLCPG_BNDS%KIDIA, YLCPG_BNDS&
      &%KFDIA, YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, Z_YDVARS_GEOMETRY_OROG_T0(:, JBLK), Z_YDMF_PHYS_OUT_TPWCLS&
      &(:, JBLK), Z_YDMF_PHYS_OUT_DIAGH(:, JBLK), Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF(:,:, JBLK), ZDZZ(&
      &:,:, JBLK), ZTW(:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_L(:,:, JBLK), ZFPLC(:, JBLK), ZFPLS(:, JBLK), ZFPLSG&
      &(:, JBLK), PPRC_DPRECIPS2 (:, YDCPG_OPTS%NDTPRECCUR2, JBLK),YDSTACK=YLSTACK)
    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_DPRECIPS_PARALLEL:0:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

  IF (FXTRAN_ACDC_LSYNCHOST ('APL_ARPEGE_DPRECIPS_PARALLEL:0')) THEN
    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_DPRECIPS_PARALLEL:0:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
    PPRC_DPRECIPS => GET_HOST_DATA_RDWR (YD_PPRC_DPRECIPS)
    PPRC_DPRECIPS2 => GET_HOST_DATA_RDWR (YD_PPRC_DPRECIPS2)
    ZDZZ => GET_HOST_DATA_RDWR (YL_ZDZZ)
    ZFPLC => GET_HOST_DATA_RDWR (YL_ZFPLC)
    ZFPLS => GET_HOST_DATA_RDWR (YL_ZFPLS)
    ZFPLSG => GET_HOST_DATA_RDWR (YL_ZFPLSG)
    ZTW => GET_HOST_DATA_RDWR (YL_ZTW)
    ZZZ => GET_HOST_DATA_RDWR (YL_ZZZ)
    Z_YDMF_PHYS_BASE_STATE_I => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%F_I)
    Z_YDMF_PHYS_BASE_STATE_L => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%F_L)
    Z_YDMF_PHYS_BASE_STATE_Q => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%F_Q)
    Z_YDMF_PHYS_BASE_STATE_T => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%F_T)
    Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHI => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%YCPG_DYN%F_PHI)
    Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%YCPG_DYN%F_PHIF)
    Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_PREHYDF => GET_HOST_DATA_RDWR&
    & (YDMF_PHYS_BASE_STATE%YCPG_PHY%F_PREHYDF)
    Z_YDMF_PHYS_OUT_DIAGH => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_DIAGH)
    Z_YDMF_PHYS_OUT_FPLCL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLCL)
    Z_YDMF_PHYS_OUT_FPLCN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLCN)
    Z_YDMF_PHYS_OUT_FPLSL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLSL)
    Z_YDMF_PHYS_OUT_FPLSN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLSN)
    Z_YDMF_PHYS_OUT_TPWCLS => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_TPWCLS)
    Z_YDVARS_GEOMETRY_OROG_T0 => GET_HOST_DATA_RDWR (YDVARS%GEOMETRY%OROG%FT0)
    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_DPRECIPS_PARALLEL:0:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_DPRECIPS_PARALLEL:0:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  PPRC_DPRECIPS => NULL ()
  PPRC_DPRECIPS2 => NULL ()
  ZDZZ => NULL ()
  ZFPLC => NULL ()
  ZFPLS => NULL ()
  ZFPLSG => NULL ()
  ZTW => NULL ()
  ZZZ => NULL ()
  Z_YDMF_PHYS_BASE_STATE_I => NULL ()
  Z_YDMF_PHYS_BASE_STATE_L => NULL ()
  Z_YDMF_PHYS_BASE_STATE_Q => NULL ()
  Z_YDMF_PHYS_BASE_STATE_T => NULL ()
  Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHI => NULL ()
  Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF => NULL ()
  Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_PREHYDF => NULL ()
  Z_YDMF_PHYS_OUT_DIAGH => NULL ()
  Z_YDMF_PHYS_OUT_FPLCL => NULL ()
  Z_YDMF_PHYS_OUT_FPLCN => NULL ()
  Z_YDMF_PHYS_OUT_FPLSL => NULL ()
  Z_YDMF_PHYS_OUT_FPLSN => NULL ()
  Z_YDMF_PHYS_OUT_TPWCLS => NULL ()
  Z_YDVARS_GEOMETRY_OROG_T0 => NULL ()
  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_DPRECIPS_PARALLEL:0:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN','APL_ARPEGE_DPRECIPS_PARALLEL:0')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_DPRECIPS_PARALLEL:0:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  PPRC_DPRECIPS => GET_DEVICE_DATA_RDWR (YD_PPRC_DPRECIPS)
  PPRC_DPRECIPS2 => GET_DEVICE_DATA_RDWR (YD_PPRC_DPRECIPS2)
  ZDZZ => GET_DEVICE_DATA_RDWR (YL_ZDZZ)
  ZFPLC => GET_DEVICE_DATA_RDWR (YL_ZFPLC)
  ZFPLS => GET_DEVICE_DATA_RDWR (YL_ZFPLS)
  ZFPLSG => GET_DEVICE_DATA_RDWR (YL_ZFPLSG)
  ZTW => GET_DEVICE_DATA_RDWR (YL_ZTW)
  ZZZ => GET_DEVICE_DATA_RDWR (YL_ZZZ)
  Z_YDMF_PHYS_BASE_STATE_I => GET_DEVICE_DATA_RDONLY (YDMF_PHYS_BASE_STATE%F_I)
  Z_YDMF_PHYS_BASE_STATE_L => GET_DEVICE_DATA_RDONLY (YDMF_PHYS_BASE_STATE%F_L)
  Z_YDMF_PHYS_BASE_STATE_Q => GET_DEVICE_DATA_RDONLY (YDMF_PHYS_BASE_STATE%F_Q)
  Z_YDMF_PHYS_BASE_STATE_T => GET_DEVICE_DATA_RDONLY (YDMF_PHYS_BASE_STATE%F_T)
  Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHI => GET_DEVICE_DATA_RDONLY (YDMF_PHYS_BASE_STATE%YCPG_DYN%F_PHI)
  Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF => GET_DEVICE_DATA_RDONLY&
  & (YDMF_PHYS_BASE_STATE%YCPG_DYN%F_PHIF)
  Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_PREHYDF => GET_DEVICE_DATA_RDONLY&
  & (YDMF_PHYS_BASE_STATE%YCPG_PHY%F_PREHYDF)
  Z_YDMF_PHYS_OUT_DIAGH => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_DIAGH)
  Z_YDMF_PHYS_OUT_FPLCL => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_FPLCL)
  Z_YDMF_PHYS_OUT_FPLCN => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_FPLCN)
  Z_YDMF_PHYS_OUT_FPLSL => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_FPLSL)
  Z_YDMF_PHYS_OUT_FPLSN => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_FPLSN)
  Z_YDMF_PHYS_OUT_TPWCLS => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_TPWCLS)
  Z_YDVARS_GEOMETRY_OROG_T0 => GET_DEVICE_DATA_RDONLY (YDVARS%GEOMETRY%OROG%FT0)
  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_DPRECIPS_PARALLEL:0:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_DPRECIPS_PARALLEL:0:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  
    !$ACC PARALLEL LOOP GANG &
    !$ACC&PRESENT (PPRC_DPRECIPS, PPRC_DPRECIPS2, YDCPG_OPTS, YDMODEL, YFXTRAN_ACDC_STACK, &
    !$ACC&         ZDZZ, ZFPLC, ZFPLS, ZFPLSG, ZTW, ZZZ, Z_YDMF_PHYS_BASE_STATE_I, Z_YDMF_PHYS_BASE_STATE_L, &
    !$ACC&         Z_YDMF_PHYS_BASE_STATE_Q, Z_YDMF_PHYS_BASE_STATE_T, Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHI, &
    !$ACC&         Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF, Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_PREHYDF, &
    !$ACC&         Z_YDMF_PHYS_OUT_DIAGH, Z_YDMF_PHYS_OUT_FPLCL, Z_YDMF_PHYS_OUT_FPLCN, &
    !$ACC&         Z_YDMF_PHYS_OUT_FPLSL, Z_YDMF_PHYS_OUT_FPLSN, Z_YDMF_PHYS_OUT_TPWCLS, &
    !$ACC&         Z_YDVARS_GEOMETRY_OROG_T0) &
    !$ACC&PRIVATE (JBLK) &
    !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
    
    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    
    
    
    !$ACC LOOP VECTOR &
    !$ACC&PRIVATE (JLEV, JLON, YLCPG_BNDS, YLSTACK) 

    

    DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JLON
      YLCPG_BNDS%KFDIA = JLON
      YLSTACK%L8 = fxtran_acdc_stack_l8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%U8 = fxtran_acdc_stack_u8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%L4 = fxtran_acdc_stack_l4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%U4 = fxtran_acdc_stack_u4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      
      CALL PPWETPOINT_OPENACC (YDMODEL%YRCST, YDMODEL%YRML_PHY_MF%YRPHY, YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA&
      &, YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_PREHYDF (:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_T&
      & (:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_Q (:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_L (:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_I&
      & (:,:, JBLK), ZTW (:,:, JBLK),YDSTACK=YLSTACK)
      
      ZFPLS (JLON, JBLK)=Z_YDMF_PHYS_OUT_FPLCN (JLON, YDCPG_OPTS%KFLEVG&
      &, JBLK)+Z_YDMF_PHYS_OUT_FPLSN (JLON, YDCPG_OPTS%KFLEVG, JBLK)
      ZFPLC (JLON, JBLK)=Z_YDMF_PHYS_OUT_FPLCL (JLON, YDCPG_OPTS%KFLEVG&
      &, JBLK)+Z_YDMF_PHYS_OUT_FPLSL (JLON, YDCPG_OPTS%KFLEVG, JBLK)
      ZFPLSG (JLON, JBLK)=0._JPRB

      

      DO JLEV=1, YDCPG_OPTS%KFLEVG
        
        ZZZ (JLON, JLEV, JBLK)=Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHI (JLON, JLEV, JBLK)*ZINVG
      
      ENDDO


      DO JLEV=2, YDCPG_OPTS%KFLEVG
        
        ZDZZ (JLON, JLEV, JBLK)=ZZZ (JLON, JLEV-1, JBLK)-ZZZ (JLON, JLEV, JBLK)
      
      ENDDO

      
      ZDZZ (JLON, 1, JBLK)=Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHI (JLON, 0, JBLK)*ZINVG-ZZZ (JLON, 1, JBLK)
      
      CALL DPRECIPS_OPENACC (YDMODEL%YRCST, YDMODEL%YRML_PHY_MF%YRPHY%YRDPRECIPS, YLCPG_BNDS%KIDIA, YLCPG_BNDS&
      &%KFDIA, YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, Z_YDVARS_GEOMETRY_OROG_T0(:, JBLK), Z_YDMF_PHYS_OUT_TPWCLS&
      &(:, JBLK), Z_YDMF_PHYS_OUT_DIAGH(:, JBLK), Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF(:,:, JBLK), ZDZZ(&
      &:,:, JBLK), ZTW(:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_L(:,:, JBLK), ZFPLC(:, JBLK), ZFPLS(:, JBLK), ZFPLSG&
      &(:, JBLK), PPRC_DPRECIPS (:, YDCPG_OPTS%NDTPRECCUR, JBLK),YDSTACK=YLSTACK)
      CALL DPRECIPS_OPENACC (YDMODEL%YRCST, YDMODEL%YRML_PHY_MF%YRPHY%YRDPRECIPS, YLCPG_BNDS%KIDIA, YLCPG_BNDS&
      &%KFDIA, YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, Z_YDVARS_GEOMETRY_OROG_T0(:, JBLK), Z_YDMF_PHYS_OUT_TPWCLS&
      &(:, JBLK), Z_YDMF_PHYS_OUT_DIAGH(:, JBLK), Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF(:,:, JBLK), ZDZZ(&
      &:,:, JBLK), ZTW(:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_L(:,:, JBLK), ZFPLC(:, JBLK), ZFPLS(:, JBLK), ZFPLSG&
      &(:, JBLK), PPRC_DPRECIPS2 (:, YDCPG_OPTS%NDTPRECCUR2, JBLK),YDSTACK=YLSTACK)
    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_DPRECIPS_PARALLEL:0:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

  IF (FXTRAN_ACDC_LSYNCHOST ('APL_ARPEGE_DPRECIPS_PARALLEL:0')) THEN
    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_DPRECIPS_PARALLEL:0:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
    PPRC_DPRECIPS => GET_HOST_DATA_RDWR (YD_PPRC_DPRECIPS)
    PPRC_DPRECIPS2 => GET_HOST_DATA_RDWR (YD_PPRC_DPRECIPS2)
    ZDZZ => GET_HOST_DATA_RDWR (YL_ZDZZ)
    ZFPLC => GET_HOST_DATA_RDWR (YL_ZFPLC)
    ZFPLS => GET_HOST_DATA_RDWR (YL_ZFPLS)
    ZFPLSG => GET_HOST_DATA_RDWR (YL_ZFPLSG)
    ZTW => GET_HOST_DATA_RDWR (YL_ZTW)
    ZZZ => GET_HOST_DATA_RDWR (YL_ZZZ)
    Z_YDMF_PHYS_BASE_STATE_I => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%F_I)
    Z_YDMF_PHYS_BASE_STATE_L => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%F_L)
    Z_YDMF_PHYS_BASE_STATE_Q => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%F_Q)
    Z_YDMF_PHYS_BASE_STATE_T => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%F_T)
    Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHI => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%YCPG_DYN%F_PHI)
    Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%YCPG_DYN%F_PHIF)
    Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_PREHYDF => GET_HOST_DATA_RDWR&
    & (YDMF_PHYS_BASE_STATE%YCPG_PHY%F_PREHYDF)
    Z_YDMF_PHYS_OUT_DIAGH => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_DIAGH)
    Z_YDMF_PHYS_OUT_FPLCL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLCL)
    Z_YDMF_PHYS_OUT_FPLCN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLCN)
    Z_YDMF_PHYS_OUT_FPLSL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLSL)
    Z_YDMF_PHYS_OUT_FPLSN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLSN)
    Z_YDMF_PHYS_OUT_TPWCLS => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_TPWCLS)
    Z_YDVARS_GEOMETRY_OROG_T0 => GET_HOST_DATA_RDWR (YDVARS%GEOMETRY%OROG%FT0)
    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_DPRECIPS_PARALLEL:0:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_DPRECIPS_PARALLEL:0:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  PPRC_DPRECIPS => NULL ()
  PPRC_DPRECIPS2 => NULL ()
  ZDZZ => NULL ()
  ZFPLC => NULL ()
  ZFPLS => NULL ()
  ZFPLSG => NULL ()
  ZTW => NULL ()
  ZZZ => NULL ()
  Z_YDMF_PHYS_BASE_STATE_I => NULL ()
  Z_YDMF_PHYS_BASE_STATE_L => NULL ()
  Z_YDMF_PHYS_BASE_STATE_Q => NULL ()
  Z_YDMF_PHYS_BASE_STATE_T => NULL ()
  Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHI => NULL ()
  Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF => NULL ()
  Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_PREHYDF => NULL ()
  Z_YDMF_PHYS_OUT_DIAGH => NULL ()
  Z_YDMF_PHYS_OUT_FPLCL => NULL ()
  Z_YDMF_PHYS_OUT_FPLCN => NULL ()
  Z_YDMF_PHYS_OUT_FPLSL => NULL ()
  Z_YDMF_PHYS_OUT_FPLSN => NULL ()
  Z_YDMF_PHYS_OUT_TPWCLS => NULL ()
  Z_YDVARS_GEOMETRY_OROG_T0 => NULL ()
  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_DPRECIPS_PARALLEL:0:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSE
    CALL ABOR1 ('APL_ARPEGE_DPRECIPS_PARALLEL: NOT METHOD WAS FOUND')
ENDIF

IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_DPRECIPS_PARALLEL:0',1,ZHOOK_HANDLE_PARALLEL)


CALL FXTRAN_ACDC_GPUMEMSTAT (__FILE__, __LINE__, "END")

IF (LHOOK) CALL DR_HOOK ('DELETE_TEMPORARIES',0,ZHOOK_HANDLE_FIELD_API)
IF (ASSOCIATED (YL_ZDZZ)) CALL FIELD_DELETE (YL_ZDZZ)
IF (ASSOCIATED (YL_ZFPLC)) CALL FIELD_DELETE (YL_ZFPLC)
IF (ASSOCIATED (YL_ZFPLS)) CALL FIELD_DELETE (YL_ZFPLS)
IF (ASSOCIATED (YL_ZFPLSG)) CALL FIELD_DELETE (YL_ZFPLSG)
IF (ASSOCIATED (YL_ZTW)) CALL FIELD_DELETE (YL_ZTW)
IF (ASSOCIATED (YL_ZZZ)) CALL FIELD_DELETE (YL_ZZZ)
IF (LHOOK) CALL DR_HOOK ('DELETE_TEMPORARIES',1,ZHOOK_HANDLE_FIELD_API)
IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_DPRECIPS_PARALLEL', 1, ZHOOK_HANDLE)
END SUBROUTINE APL_ARPEGE_DPRECIPS_PARALLEL
