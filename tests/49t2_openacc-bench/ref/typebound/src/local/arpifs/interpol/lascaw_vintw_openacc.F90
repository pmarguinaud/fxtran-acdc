SUBROUTINE LASCAW_VINTW_OPENACC (YDDYNA, KPROMA, KFLEV, KST, KEND, LDCOMADV, LDT_SLHD, LDSLVF&
&, LDSLHDHEAT, PSLHDKMIN, KLEV, PLEV, PDVER, PDVERMAD, PSTDDISW, PKAPPA, PKAPPAT, PVETA, PVCUICO&
&, PVSLD, PVSLDW, PVSLVF, PVINTW, PVINTWMAD, PVINTWSLD, PVINTWSLT, PVINTWSLVF, YDSTACK)
!$ACC ROUTINE (LASCAW_VINTW_OPENACC) SEQ
USE PARKIND1,ONLY:JPIM, JPIB, JPRB

USE YOMDYNA,ONLY:TDYNA
#include "fxtran_acdc_stack.h"
USE FXTRAN_ACDC_STACK_MOD
USE FXTRAN_ACDC_ABORT_MOD

IMPLICIT NONE


TYPE (TDYNA), INTENT (IN)::YDDYNA
INTEGER (KIND=JPIM), INTENT (IN)::KPROMA
INTEGER (KIND=JPIM), INTENT (IN)::KFLEV
INTEGER (KIND=JPIM), INTENT (IN)::KST
INTEGER (KIND=JPIM), INTENT (IN)::KEND
LOGICAL, INTENT (IN)::LDCOMADV
LOGICAL, INTENT (IN)::LDT_SLHD (3)
LOGICAL, INTENT (IN)::LDSLVF
LOGICAL, INTENT (IN)::LDSLHDHEAT
REAL (KIND=JPRB), INTENT (IN)::PSLHDKMIN
INTEGER (KIND=JPIM), INTENT (IN)::KLEV (KPROMA, KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PLEV (KPROMA, KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PDVER (KPROMA, KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PDVERMAD (KPROMA, KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PKAPPA (KPROMA, KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PSTDDISW (KPROMA, KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PKAPPAT (KPROMA, KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PVETA (0:KFLEV+1)
REAL (KIND=JPRB), INTENT (IN)::PVCUICO (4, 0:KFLEV-1)
REAL (KIND=JPRB), INTENT (IN)::PVSLD (3, 0:KFLEV-1)
REAL (KIND=JPRB), INTENT (IN)::PVSLDW (3, 3, 0:KFLEV-1)
REAL (KIND=JPRB), INTENT (IN)::PVSLVF (3, 3, 0:KFLEV-1)
REAL (KIND=JPRB), INTENT (OUT)::PVINTW (KPROMA, KFLEV, 3)
REAL (KIND=JPRB), INTENT (OUT)::PVINTWMAD (KPROMA, KFLEV, 3)
REAL (KIND=JPRB), INTENT (OUT)::PVINTWSLD (KPROMA, KFLEV, 3)
REAL (KIND=JPRB), INTENT (OUT)::PVINTWSLT (KPROMA, KFLEV, 3)
REAL (KIND=JPRB), INTENT (OUT)::PVINTWSLVF (KPROMA, KFLEV, 3)
TYPE(FXTRAN_ACDC_STACK), INTENT (IN) :: YDSTACK
INTEGER (KIND=JPIM)::JLEV
INTEGER (KIND=JPIM)::ILEV
INTEGER (KIND=JPIM)::JROF
LOGICAL::LLSLHDQUAD
LOGICAL::LLSLHD
REAL (KIND=JPRB)::ZWL3
REAL (KIND=JPRB)::ZWL2
REAL (KIND=JPRB)::ZWL1
REAL (KIND=JPRB)::ZWDS3 
REAL (KIND=JPRB)::ZWDS2 
REAL (KIND=JPRB)::ZWDS1 
REAL (KIND=JPRB)::ZWH3 
REAL (KIND=JPRB)::ZWH2 
REAL (KIND=JPRB)::ZWH1 
REAL (KIND=JPRB)::ZKAPT
REAL (KIND=JPRB)::ZKAP
REAL (KIND=JPRB)::ZSLHDKMIN
REAL (KIND=JPRB)::ZSQR
REAL (KIND=JPRB)::ZWD3
REAL (KIND=JPRB)::ZWD2
REAL (KIND=JPRB)::ZWD1
REAL (KIND=JPRB)::ZC4
REAL (KIND=JPRB)::ZC3
REAL (KIND=JPRB)::ZC2
REAL (KIND=JPRB)::Z2
REAL (KIND=JPRB)::Z1
REAL (KIND=JPRB)::ZDV
REAL (KIND=JPRB)::ZD3
REAL (KIND=JPRB)::ZD2
REAL (KIND=JPRB)::ZD1
REAL (KIND=JPRB)::ZD0


JROF = KST


LLSLHD=LDT_SLHD (1)
LLSLHDQUAD=LDT_SLHD (2)

DO JLEV=1, KFLEV

  IF (LLSLHD) THEN
    
    ILEV=KLEV (JROF, JLEV)

    IF (ILEV>=1.AND.ILEV<=KFLEV-3) THEN
      Z1=PVETA (ILEV+1)
      Z2=PVETA (ILEV+2)
      ZD0=PLEV (JROF, JLEV)-PVETA (ILEV)
      ZD1=PLEV (JROF, JLEV)-Z1
      ZD2=PLEV (JROF, JLEV)-Z2
      ZD3=PLEV (JROF, JLEV)-PVETA (ILEV+3)
      ZC2=PVCUICO (2, ILEV)
      ZC3=PVCUICO (3, ILEV)
      ZC4=PVCUICO (4, ILEV)
      ZDV=ZD0*ZD1
      ZWH1 =ZD0*ZD2*ZD3*ZC2
      ZWH2 =ZDV*ZD3*ZC3
      ZWH3 =ZDV*ZD2*ZC4
      ZWL3=0.0_JPRB
      ZWL2=PDVER (JROF, JLEV)
      ZWL1=1.0_JPRB-ZWL2

      IF (LLSLHDQUAD) THEN
        ZSQR=ZWL1*ZWL2
        ZWL1=ZSQR*PVSLD (1, ILEV)+ZWL1
        ZWL2=ZSQR*PVSLD (2, ILEV)+ZWL2
        ZWL3=ZSQR*PVSLD (3, ILEV)
      ENDIF

      ZWD1=ZWH1 +YDDYNA%SLHDKMAX*(ZWL1-ZWH1 )
      ZWD2=ZWH2 +YDDYNA%SLHDKMAX*(ZWL2-ZWH2 )
      ZWD3=ZWH3 +YDDYNA%SLHDKMAX*(ZWL3-ZWH3 )
      ZWDS1 =PVSLDW (1, 1, ILEV)*ZWD1+PVSLDW (1, 2, ILEV)*ZWD2+PVSLDW (1, 3, ILEV)*ZWD3
      ZWDS2 =PVSLDW (2, 1, ILEV)*ZWD1+PVSLDW (2, 2, ILEV)*ZWD2+PVSLDW (2, 3, ILEV)*ZWD3
      ZWDS3 =PVSLDW (3, 1, ILEV)*ZWD1+PVSLDW (3, 2, ILEV)*ZWD2+PVSLDW (3, 3, ILEV)*ZWD3

      IF (LDCOMADV) THEN
        ZDV=0.5_JPRB*(Z2-Z1)*(1._JPRB-PSTDDISW (JROF, JLEV))
        ZD1=ZD1*PSTDDISW (JROF, JLEV)+ZDV
        ZD2=ZD2*PSTDDISW (JROF, JLEV)-ZDV
        ZD0=Z1-PVETA (ILEV)+ZD1
        ZD3=Z2-PVETA (ILEV+3)+ZD2
      ENDIF


      IF (PKAPPA (JROF, JLEV)<0._JPRB) THEN
        ZKAP=-PKAPPA (JROF, JLEV)
        ZSLHDKMIN=YDDYNA%SLHDKREF
      ELSE
        ZKAP=PKAPPA (JROF, JLEV)
        ZSLHDKMIN=PSLHDKMIN
      ENDIF

      ZWH1 =ZWH1 +ZSLHDKMIN*(ZWL1-ZWH1 )
      ZWH2 =ZWH2 +ZSLHDKMIN*(ZWL2-ZWH2 )
      ZWH3 =ZWH3 +ZSLHDKMIN*(ZWL3-ZWH3 )
      PVINTW (JROF, JLEV, 1)=ZWH1 
      PVINTW (JROF, JLEV, 2)=ZWH2 
      PVINTW (JROF, JLEV, 3)=ZWH3 
      PVINTWMAD (JROF, JLEV, 1)=ZD0*ZD2*ZD3*ZC2
      PVINTWMAD (JROF, JLEV, 2)=ZD0*ZD1*ZD3*ZC3
      PVINTWMAD (JROF, JLEV, 3)=ZD0*ZD1*ZD2*ZC4
      PVINTWSLD (JROF, JLEV, 1)=ZWH1 +ZKAP*(ZWDS1 -ZWH1 )
      PVINTWSLD (JROF, JLEV, 2)=ZWH2 +ZKAP*(ZWDS2 -ZWH2 )
      PVINTWSLD (JROF, JLEV, 3)=ZWH3 +ZKAP*(ZWDS3 -ZWH3 )
    ELSE
      PVINTW (JROF, JLEV, 1)=1.0_JPRB-PDVER (JROF, JLEV)
      PVINTW (JROF, JLEV, 2)=PDVER (JROF, JLEV)
      PVINTW (JROF, JLEV, 3)=0.0_JPRB
      PVINTWMAD (JROF, JLEV, 1)=1.0_JPRB-PDVERMAD (JROF, JLEV)
      PVINTWMAD (JROF, JLEV, 2)=PDVERMAD (JROF, JLEV)
      PVINTWMAD (JROF, JLEV, 3)=0.0_JPRB
      PVINTWSLD (JROF, JLEV, 1)=PVINTW (JROF, JLEV, 1)
      PVINTWSLD (JROF, JLEV, 2)=PVINTW (JROF, JLEV, 2)
      PVINTWSLD (JROF, JLEV, 3)=PVINTW (JROF, JLEV, 3)
    ENDIF


    

    IF (LDSLHDHEAT) THEN
      
      ILEV=KLEV (JROF, JLEV)

      IF (ILEV>=1.AND.ILEV<=KFLEV-3) THEN
        ZKAPT=ABS (PKAPPAT (JROF, JLEV))
        PVINTWSLT (JROF, JLEV, 1)=ZWH1 +ZKAPT*(ZWDS1 -ZWH1 )
        PVINTWSLT (JROF, JLEV, 2)=ZWH2 +ZKAPT*(ZWDS2 -ZWH2 )
        PVINTWSLT (JROF, JLEV, 3)=ZWH3 +ZKAPT*(ZWDS3 -ZWH3 )
      ELSE
        PVINTWSLT (JROF, JLEV, 1)=PVINTW (JROF, JLEV, 1)
        PVINTWSLT (JROF, JLEV, 2)=PVINTW (JROF, JLEV, 2)
        PVINTWSLT (JROF, JLEV, 3)=PVINTW (JROF, JLEV, 3)
      ENDIF

    
    ENDIF


    IF (LDSLVF) THEN
      
      ILEV=KLEV (JROF, JLEV)
      PVINTWSLVF (JROF, JLEV, 1)=PVSLVF (1, 1, ILEV)*PVINTW (JROF, JLEV, 1)+PVSLVF (1&
      &, 2, ILEV)*PVINTW (JROF, JLEV, 2)+PVSLVF (1, 3, ILEV)*PVINTW (JROF, JLEV, 3)
      PVINTWSLVF (JROF, JLEV, 2)=PVSLVF (2, 1, ILEV)*PVINTW (JROF, JLEV, 1)+PVSLVF (2&
      &, 2, ILEV)*PVINTW (JROF, JLEV, 2)+PVSLVF (2, 3, ILEV)*PVINTW (JROF, JLEV, 3)
      PVINTWSLVF (JROF, JLEV, 3)=PVSLVF (3, 1, ILEV)*PVINTW (JROF, JLEV, 1)+PVSLVF (3&
      &, 2, ILEV)*PVINTW (JROF, JLEV, 2)+PVSLVF (3, 3, ILEV)*PVINTW (JROF, JLEV, 3)
    
    ENDIF

  ELSE
    
    ILEV=KLEV (JROF, JLEV)

    IF (ILEV>=1.AND.ILEV<=KFLEV-3) THEN
      Z1=PVETA (ILEV+1)
      Z2=PVETA (ILEV+2)
      ZD0=PLEV (JROF, JLEV)-PVETA (ILEV)
      ZD1=PLEV (JROF, JLEV)-Z1
      ZD2=PLEV (JROF, JLEV)-Z2
      ZD3=PLEV (JROF, JLEV)-PVETA (ILEV+3)
      ZDV=ZD0*ZD1
      ZC2=PVCUICO (2, ILEV)
      ZC3=PVCUICO (3, ILEV)
      ZC4=PVCUICO (4, ILEV)
      ZWH1 =ZD0*ZD2*ZD3*ZC2
      ZWH2 =ZDV*ZD3*ZC3
      ZWH3 =ZDV*ZD2*ZC4

      IF (LDCOMADV) THEN
        ZDV=0.5_JPRB*(Z2-Z1)*(1._JPRB-PSTDDISW (JROF, JLEV))
        ZD1=ZD1*PSTDDISW (JROF, JLEV)+ZDV
        ZD2=ZD2*PSTDDISW (JROF, JLEV)-ZDV
        ZD0=Z1-PVETA (ILEV)+ZD1
        ZD3=Z2-PVETA (ILEV+3)+ZD2
      ENDIF


      IF (LLSLHDQUAD) THEN
        ZWL2=PDVER (JROF, JLEV)
        ZWL1=1.0_JPRB-ZWL2
        ZSQR=ZWL1*ZWL2
        ZWL1=ZSQR*PVSLD (1, ILEV)+ZWL1
        ZWL2=ZSQR*PVSLD (2, ILEV)+ZWL2
        ZWL3=ZSQR*PVSLD (3, ILEV)
        ZWH1 =ZWH1 +PSLHDKMIN*(ZWL1-ZWH1 )
        ZWH2 =ZWH2 +PSLHDKMIN*(ZWL2-ZWH2 )
        ZWH3 =ZWH3 +PSLHDKMIN*(ZWL3-ZWH3 )
      ENDIF

      PVINTW (JROF, JLEV, 1)=ZWH1 
      PVINTW (JROF, JLEV, 2)=ZWH2 
      PVINTW (JROF, JLEV, 3)=ZWH3 
      PVINTWMAD (JROF, JLEV, 1)=ZD0*ZD2*ZD3*ZC2
      PVINTWMAD (JROF, JLEV, 2)=ZD0*ZD1*ZD3*ZC3
      PVINTWMAD (JROF, JLEV, 3)=ZD0*ZD1*ZD2*ZC4
    ELSE
      PVINTW (JROF, JLEV, 1)=1.0_JPRB-PDVER (JROF, JLEV)
      PVINTW (JROF, JLEV, 2)=PDVER (JROF, JLEV)
      PVINTW (JROF, JLEV, 3)=0.0_JPRB
      PVINTWMAD (JROF, JLEV, 1)=1.0_JPRB-PDVERMAD (JROF, JLEV)
      PVINTWMAD (JROF, JLEV, 2)=PDVERMAD (JROF, JLEV)
      PVINTWMAD (JROF, JLEV, 3)=0.0_JPRB
    ENDIF

    PVINTWSLD (JROF, JLEV, 1)=PVINTW (JROF, JLEV, 1)
    PVINTWSLD (JROF, JLEV, 2)=PVINTW (JROF, JLEV, 2)
    PVINTWSLD (JROF, JLEV, 3)=PVINTW (JROF, JLEV, 3)

    

    IF (LDSLHDHEAT) THEN
      
      PVINTWSLT (JROF, JLEV, JROF)=PVINTW (JROF, JLEV, JROF)
    
    ENDIF


    IF (LDSLVF) THEN
      
      ILEV=KLEV (JROF, JLEV)

      IF (ILEV>=1.AND.ILEV<=KFLEV-3) THEN
        PVINTWSLVF (JROF, JLEV, 1)=PVSLVF (1, 1, ILEV)*ZWH1 +PVSLVF&
        & (1, 2, ILEV)*ZWH2 +PVSLVF (1, 3, ILEV)*ZWH3 
        PVINTWSLVF (JROF, JLEV, 2)=PVSLVF (2, 1, ILEV)*ZWH1 +PVSLVF&
        & (2, 2, ILEV)*ZWH2 +PVSLVF (2, 3, ILEV)*ZWH3 
        PVINTWSLVF (JROF, JLEV, 3)=PVSLVF (3, 1, ILEV)*ZWH1 +PVSLVF&
        & (3, 2, ILEV)*ZWH2 +PVSLVF (3, 3, ILEV)*ZWH3 
      ELSE
        PVINTWSLVF (JROF, JLEV, 1)=PVINTW (JROF, JLEV, 1)
        PVINTWSLVF (JROF, JLEV, 2)=PVINTW (JROF, JLEV, 2)
        PVINTWSLVF (JROF, JLEV, 3)=PVINTW (JROF, JLEV, 3)
      ENDIF

    
    ENDIF

  ENDIF

ENDDO


END SUBROUTINE LASCAW_VINTW_OPENACC
