SUBROUTINE LAIHVT_OPENACC (KSLB1, KPROMA, KST, KEND, KFLEV, KFLDN, KFLDX&
&, KQM, PDLAT, PCLA, PDLO, PCLO, KL0, PVDERW, PDZ, PXSL, PXF, YDSTACK)
!$ACC ROUTINE (LAIHVT_OPENACC) SEQ
USE PARKIND1,ONLY:JPIM, JPRB, JPIB

#include "fxtran_acdc_stack.h"
USE FXTRAN_ACDC_STACK_MOD
USE FXTRAN_ACDC_ABORT_MOD

IMPLICIT NONE


INTEGER (KIND=JPIM), INTENT (IN)::KSLB1
INTEGER (KIND=JPIM), INTENT (IN)::KPROMA
INTEGER (KIND=JPIM), INTENT (IN)::KFLEV
INTEGER (KIND=JPIM), INTENT (IN)::KFLDN
INTEGER (KIND=JPIM), INTENT (IN)::KFLDX
INTEGER (KIND=JPIM), INTENT (IN)::KST
INTEGER (KIND=JPIM), INTENT (IN)::KEND
INTEGER (KIND=JPIM), INTENT (IN)::KQM
REAL (KIND=JPRB), INTENT (IN)::PDLAT (KPROMA, KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PCLA (KPROMA, KFLEV, 3)
REAL (KIND=JPRB), INTENT (IN)::PDLO (KPROMA, KFLEV, 0:3)
REAL (KIND=JPRB), INTENT (IN)::PCLO (KPROMA, KFLEV, 3, 2)
INTEGER (KIND=JPIM), INTENT (IN)::KL0 (KPROMA, KFLEV, 0:3)
REAL (KIND=JPRB), INTENT (IN)::PVDERW (KPROMA, KFLEV, 2, 2)
REAL (KIND=JPRB), INTENT (IN)::PDZ (KPROMA, KFLEV, 4)
REAL (KIND=JPRB), INTENT (IN)::PXSL (KSLB1*(KFLDX-KFLDN+1))
REAL (KIND=JPRB), INTENT (OUT)::PXF (KPROMA, KFLEV)
TYPE(FXTRAN_ACDC_STACK), INTENT (IN) :: YDSTACK
INTEGER (KIND=JPIM)::IL3
INTEGER (KIND=JPIM)::IL2
INTEGER (KIND=JPIM)::IL1
INTEGER (KIND=JPIM)::JROF
INTEGER (KIND=JPIM)::JL
LOGICAL::LQMH
REAL (KIND=JPRB)::Z3 
REAL (KIND=JPRB)::Z2 
REAL (KIND=JPRB)::Z1 
REAL (KIND=JPRB)::Z0 
REAL (KIND=JPRB)::ZZ
REAL (KIND=JPRB)::Z31
REAL (KIND=JPRB)::Z22
REAL (KIND=JPRB)::Z21
REAL (KIND=JPRB)::Z20
REAL (KIND=JPRB)::Z12
REAL (KIND=JPRB)::Z11
REAL (KIND=JPRB)::Z10
REAL (KIND=JPRB)::Z01
REAL (KIND=JPRB)::ZDV2
REAL (KIND=JPRB)::ZDV1

#include "interp.func.h"

JROF = KST


LQMH=KQM==1.OR.KQM==2
IL1=KSLB1
IL2=IL1+KSLB1
IL3=IL2+KSLB1

DO JL=1, KFLEV
  
  Z11=PXSL (KL0 (JROF, JL, 1)+1)
  Z11=FDWEIGHT (PDLO (JROF, JL, 1), Z11, PXSL (KL0 (JROF, JL, 1)+2))
  Z12=PXSL (KL0 (JROF, JL, 2)+1)
  Z12=FDWEIGHT (PDLO (JROF, JL, 2), Z12, PXSL (KL0 (JROF, JL, 2)+2))
  Z0 =FDWEIGHT (PDLAT (JROF, JL), Z11, Z12)
  Z21=PXSL (IL3+KL0 (JROF, JL, 1)+1)
  Z21=FDWEIGHT (PDLO (JROF, JL, 1), Z21, PXSL (IL3+KL0 (JROF, JL, 1)+2))
  Z22=PXSL (IL3+KL0 (JROF, JL, 2)+1)
  Z22=FDWEIGHT (PDLO (JROF, JL, 2), Z22, PXSL (IL3+KL0 (JROF, JL, 2)+2))
  Z3 =FDWEIGHT (PDLAT (JROF, JL), Z21, Z22)
  
  
  Z01=PXSL (IL1+KL0 (JROF, JL, 0)+1)
  Z01=FDWEIGHT (PDLO (JROF, JL, 0), Z01, PXSL (IL1+KL0 (JROF, JL, 0)+2))
  Z10=PXSL (IL1+KL0 (JROF, JL, 1))
  Z11=PXSL (IL1+KL0 (JROF, JL, 1)+1)
  Z12=PXSL (IL1+KL0 (JROF, JL, 1)+2)
  Z10=FCWEIGHT (PCLO (JROF, JL, 1, 1), PCLO (JROF, JL, 2, 1), PCLO (JROF&
  &, JL, 3, 1), Z10, Z11, Z12, PXSL (IL1+KL0 (JROF, JL, 1)+3))
  Z20=PXSL (IL1+KL0 (JROF, JL, 2))
  Z21=PXSL (IL1+KL0 (JROF, JL, 2)+1)
  Z22=PXSL (IL1+KL0 (JROF, JL, 2)+2)
  Z20=FCWEIGHT (PCLO (JROF, JL, 1, 2), PCLO (JROF, JL, 2, 2), PCLO (JROF&
  &, JL, 3, 2), Z20, Z21, Z22, PXSL (IL1+KL0 (JROF, JL, 2)+3))

  IF (LQMH) THEN
    Z10=FCLIPHIGH (Z10, Z11, Z12)
    Z10=FCLIPLOW (Z10, Z11, Z12)
    Z20=FCLIPHIGH (Z20, Z21, Z22)
    Z20=FCLIPLOW (Z20, Z21, Z22)
  ENDIF

  Z31=PXSL (IL1+KL0 (JROF, JL, 3)+1)
  Z31=FDWEIGHT (PDLO (JROF, JL, 3), Z31, PXSL (IL1+KL0 (JROF, JL, 3)+2))
  Z1 =FCWEIGHT (PCLA (JROF, JL, 1), PCLA (JROF, JL, 2), PCLA (JROF, JL, 3), Z01, Z10, Z20, Z31)

  IF (LQMH) THEN
    ZZ=FCLIPHIGH (Z1 , Z10, Z20)
    Z1 =FCLIPLOW (ZZ, Z10, Z20)
  ENDIF

  Z01=PXSL (IL2+KL0 (JROF, JL, 0)+1)
  Z01=FDWEIGHT (PDLO (JROF, JL, 0), Z01, PXSL (IL2+KL0 (JROF, JL, 0)+2))
  Z10=PXSL (IL2+KL0 (JROF, JL, 1))
  Z11=PXSL (IL2+KL0 (JROF, JL, 1)+1)
  Z12=PXSL (IL2+KL0 (JROF, JL, 1)+2)
  Z10=FCWEIGHT (PCLO (JROF, JL, 1, 1), PCLO (JROF, JL, 2, 1), PCLO (JROF&
  &, JL, 3, 1), Z10, Z11, Z12, PXSL (IL2+KL0 (JROF, JL, 1)+3))
  Z20=PXSL (IL2+KL0 (JROF, JL, 2))
  Z21=PXSL (IL2+KL0 (JROF, JL, 2)+1)
  Z22=PXSL (IL2+KL0 (JROF, JL, 2)+2)
  Z20=FCWEIGHT (PCLO (JROF, JL, 1, 2), PCLO (JROF, JL, 2, 2), PCLO (JROF&
  &, JL, 3, 2), Z20, Z21, Z22, PXSL (IL2+KL0 (JROF, JL, 2)+3))

  IF (LQMH) THEN
    Z10=FCLIPHIGH (Z10, Z11, Z12)
    Z10=FCLIPLOW (Z10, Z11, Z12)
    Z20=FCLIPHIGH (Z20, Z21, Z22)
    Z20=FCLIPLOW (Z20, Z21, Z22)
  ENDIF

  Z31=PXSL (IL2+KL0 (JROF, JL, 3)+1)
  Z31=FDWEIGHT (PDLO (JROF, JL, 3), Z31, PXSL (IL2+KL0 (JROF, JL, 3)+2))
  Z2 =FCWEIGHT (PCLA (JROF, JL, 1), PCLA (JROF, JL, 2), PCLA (JROF, JL, 3), Z01, Z10, Z20, Z31)

  IF (LQMH) THEN
    ZZ=FCLIPHIGH (Z2 , Z10, Z20)
    Z2 =FCLIPLOW (ZZ, Z10, Z20)
  ENDIF

  
  
  ZDV1=PVDERW (JROF, JL, 1, 1)*(Z1 -Z0 )+PVDERW (JROF, JL, 2, 1)*(Z2 -Z1 )
  ZDV2=PVDERW (JROF, JL, 1, 2)*(Z2 -Z1 )+PVDERW (JROF, JL, 2, 2)*(Z3 -Z2 )
  PXF (JROF, JL)=PDZ (JROF, JL, 1)*Z1 +PDZ (JROF, JL, 2)&
  &*Z2 +PDZ (JROF, JL, 3)*ZDV1+PDZ (JROF, JL, 4)*ZDV2

  IF (KQM==2) THEN
    PXF (JROF, JL)=FCLIPHIGH (PXF (JROF, JL), Z1 , Z2 )
    PXF (JROF, JL)=FCLIPLOW (PXF (JROF, JL), Z1 , Z2 )
  ENDIF

  
ENDDO


END SUBROUTINE LAIHVT_OPENACC
