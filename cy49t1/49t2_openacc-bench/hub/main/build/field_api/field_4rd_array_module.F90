
MODULE FIELD_4RD_ARRAY_MODULE


USE FIELD_4RD_MODULE
USE FIELD_4RD_FACTORY_MODULE

USE PARKIND1, ONLY : JPRM, JPRD, JPIM, JPLM

IMPLICIT NONE

PRIVATE

TYPE FIELD_4RD_ARRAY
  CLASS (FIELD_4RD), POINTER :: F_P => NULL ()
  REAL(KIND=JPRD), POINTER, CONTIGUOUS :: P_FIELD (:,:,:,:) => NULL()
  REAL(KIND=JPRD), POINTER :: P (:,:,:) => NULL()
CONTAINS
  GENERIC :: INIT => INIT_FIELD_4RD_ARRAY_WRAPPER, INIT_FIELD_4RD_ARRAY_OWNER
  PROCEDURE, PRIVATE :: INIT_FIELD_4RD_ARRAY_WRAPPER
  PROCEDURE, PRIVATE :: INIT_FIELD_4RD_ARRAY_OWNER
  PROCEDURE :: RESIZE => RESIZE_FIELD_4RD_ARRAY
  PROCEDURE :: FINAL => FINAL_FIELD_4RD_ARRAY
  PROCEDURE :: UPDATE_VIEW => UPDATE_VIEW_FIELD_4RD_ARRAY
END TYPE

PUBLIC :: FIELD_4RD_ARRAY


CONTAINS

SUBROUTINE INIT_FIELD_4RD_ARRAY_WRAPPER (SELF, P, LBOUNDS)

CLASS (FIELD_4RD_ARRAY) :: SELF
REAL(KIND=JPRD), INTENT (IN), TARGET :: P (:,:,:,:)
INTEGER (KIND=JPIM), INTENT (IN), OPTIONAL :: LBOUNDS (4)

IF(SIZE(P) > 0) CALL FIELD_NEW (SELF%F_P, DATA=P, PERSISTENT=.TRUE., LBOUNDS=LBOUNDS)

END SUBROUTINE

SUBROUTINE INIT_FIELD_4RD_ARRAY_OWNER (SELF, PERSISTENT, UBOUNDS, LBOUNDS)

CLASS (FIELD_4RD_ARRAY) :: SELF
INTEGER (KIND=JPIM), INTENT (IN) :: UBOUNDS (4)
INTEGER (KIND=JPIM), INTENT (IN), OPTIONAL :: LBOUNDS (4)
LOGICAL,             INTENT (IN), OPTIONAL :: PERSISTENT

CALL FIELD_NEW (SELF%F_P, UBOUNDS=UBOUNDS, PERSISTENT=PERSISTENT, LBOUNDS=LBOUNDS)

END SUBROUTINE

SUBROUTINE RESIZE_FIELD_4RD_ARRAY (SELF, UBOUNDS, LBOUNDS, PERSISTENT)

CLASS (FIELD_4RD_ARRAY) :: SELF
INTEGER (KIND=JPIM), INTENT (IN) :: UBOUNDS (4)
INTEGER (KIND=JPIM), INTENT (IN), OPTIONAL :: LBOUNDS (4)
LOGICAL,             INTENT (IN), OPTIONAL :: PERSISTENT

CALL FIELD_RESIZE (SELF%F_P, UBOUNDS=UBOUNDS, PERSISTENT=PERSISTENT, LBOUNDS=LBOUNDS)

END SUBROUTINE

SUBROUTINE UPDATE_VIEW_FIELD_4RD_ARRAY (SELF, BLOCK_INDEX)
CLASS (FIELD_4RD_ARRAY) :: SELF
INTEGER (KIND=JPIM), INTENT (IN) :: BLOCK_INDEX

IF (ASSOCIATED (SELF%F_P)) THEN
  SELF%P => SELF%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF

END SUBROUTINE

SUBROUTINE FINAL_FIELD_4RD_ARRAY (SELF)
CLASS (FIELD_4RD_ARRAY) :: SELF

IF (ASSOCIATED (SELF%F_P)) THEN
  CALL FIELD_DELETE (SELF%F_P)
  SELF%P_FIELD => NULL ()
  SELF%P => NULL ()
ENDIF

END SUBROUTINE


END MODULE
