SUBROUTINE LAMAXWIND_OPENACC (YDML_DYN, YDCST, KPROMA, KFLEVG&
&, KST, KEND, PURL, PVRL, PRCOLON, PGEMU, YDSTACK)
!$ACC ROUTINE (LAMAXWIND_OPENACC) SEQ
USE PARKIND1,ONLY:JPIM, JPRB, JPRD

USE YOMLUN,ONLY:NULERR
USE YOMCST,ONLY:TCST
USE MODEL_DYNAMICS_MOD,ONLY:MODEL_DYNAMICS_TYPE
#include "fxtran_acdc_stack.h"
USE FXTRAN_ACDC_STACK_MOD
USE FXTRAN_ACDC_ABORT_MOD

IMPLICIT NONE



TYPE (MODEL_DYNAMICS_TYPE), INTENT (IN)::YDML_DYN
TYPE (TCST), INTENT (IN)::YDCST
INTEGER (KIND=JPIM), INTENT (IN)::KFLEVG
INTEGER (KIND=JPIM), INTENT (IN)::KPROMA
INTEGER (KIND=JPIM), INTENT (IN)::KST
INTEGER (KIND=JPIM), INTENT (IN)::KEND
REAL (KIND=JPRB), INTENT (IN)::PURL (KPROMA, KFLEVG)
REAL (KIND=JPRB), INTENT (IN)::PVRL (KPROMA, KFLEVG)
REAL (KIND=JPRD), INTENT (IN)::PRCOLON (KPROMA)
REAL (KIND=JPRB), INTENT (IN)::PGEMU (KPROMA)
TYPE(FXTRAN_ACDC_STACK), INTENT (IN) :: YDSTACK
REAL (KIND=JPRB)::ZEWX
REAL (KIND=JPRB)::ZEW
REAL (KIND=JPRB)::ZNORX
REAL (KIND=JPRB)::ZNOR
REAL (KIND=JPRB)::ZVMAX2
REAL (KIND=JPRB)::ZVMAX1
INTEGER (KIND=JPIM)::JLEV
INTEGER (KIND=JPIM)::JROF
INTEGER (KIND=JPIM)::ILEVEXP
INTEGER (KIND=JPIM)::IROFEXP


JROF = KST




ZNOR=0.0_JPRB
ZEW=0.0_JPRB
ZVMAX1=YDML_DYN%YRDYN%VMAX1*YDML_DYN%YRDYN%VMAX1
ZVMAX2=YDML_DYN%YRDYN%VMAX2*YDML_DYN%YRDYN%VMAX2

DO JLEV=1, KFLEVG
  
  ZNOR=MAX (PVRL (JROF, JLEV)*PVRL (JROF, JLEV), ZNOR)
  ZEW=MAX (PURL (JROF, JLEV)*PURL (JROF, JLEV), ZEW)
  
ENDDO


IF (ZNOR>ZVMAX1) THEN
  PRINT *, 'MAXVWIND=',SQRT(ZNOR)
ENDIF


IF (ZEW>ZVMAX1) THEN
  PRINT *, 'MAXUWIND=',SQRT(ZEW)
ENDIF


IF (ZNOR>ZVMAX2) THEN
  ZNOR=0.0_JPRB

  DO JLEV=1, KFLEVG
    
    ZNORX=PVRL (JROF, JLEV)*PVRL (JROF, JLEV)
    ZNOR=MAX (ZNORX, ZNOR)

    IF (ZNOR==ZNORX) THEN
      ILEVEXP=JLEV
      IROFEXP=JROF
    ENDIF

  
  ENDDO

  PRINT *, 'VWIND=',SQRT(ZNOR),'ISTOOSTRONG,EXPLOSION.'
  PRINT *, 'LEVEL=',ILEVEXP,'POINT=',IROFEXP
  PRINT *, 'LON=',ACOS(PRCOLON(JROF))*180._JPRB/YDCST%RPI,'DEGREES'
  PRINT *, 'LAT=',ASIN(PGEMU(JROF))*180._JPRB/YDCST%RPI,'DEGREES'
  CALL FXTRAN_ACDC_ABORT (' !V WIND TOO STRONG, EXPLOSION!!!')
ENDIF


IF (ZEW>ZVMAX2) THEN
  ZEW=0.0_JPRB

  DO JLEV=1, KFLEVG
    
    ZEWX=PURL (JROF, JLEV)*PURL (JROF, JLEV)
    ZEW=MAX (ZEWX, ZEW)

    IF (ZEW==ZEWX) THEN
      ILEVEXP=JLEV
      IROFEXP=JROF
    ENDIF

  
  ENDDO

  PRINT *, 'UWIND=',SQRT(ZEW),'ISTOOSTRONG,EXPLOSION.'
  PRINT *, 'LEVEL=',ILEVEXP,'POINT=',IROFEXP
  PRINT *, 'LON=',ACOS(PRCOLON(JROF))*180._JPRB/YDCST%RPI,'DEGREES'
  PRINT *, 'LAT=',ASIN(PGEMU(JROF))*180._JPRB/YDCST%RPI,'DEGREES'
  CALL FXTRAN_ACDC_ABORT (' !U WIND TOO STRONG, EXPLOSION!!!')
ENDIF




END SUBROUTINE LAMAXWIND_OPENACC
