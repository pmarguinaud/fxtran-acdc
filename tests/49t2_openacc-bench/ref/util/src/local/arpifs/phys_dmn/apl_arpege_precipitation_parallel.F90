SUBROUTINE APL_ARPEGE_PRECIPITATION_PARALLEL (YDMF_PHYS_BASE_STATE, YDCPG_BNDS,&
& YDCPG_OPTS, YDMF_PHYS, YDMF_PHYS_SURF, YDVARS, YDMODEL, YD_PFLU_NEIJ, YD_PNEBS&
&, YD_PNEB_CVPP, YD_PQC_DET_PCMT, YD_PQI, YD_PQL, YD_PQLIS, YD_PQLI_CVPP, YD_PQR&
&, YD_PQS, YD_PQV, YD_PSEDIQI, YD_PSEDIQL, YD_PTENHA, YD_PTENQVA, YDSTA)
USE YOMHOOK,ONLY:LHOOK, DR_HOOK, JPHOOK

USE MF_PHYS_BASE_STATE_TYPE_MOD,ONLY:MF_PHYS_BASE_STATE_TYPE
USE CPG_OPTS_TYPE_MOD,ONLY:CPG_BNDS_TYPE, CPG_OPTS_TYPE
USE MF_PHYS_TYPE_MOD,ONLY:MF_PHYS_TYPE
USE MF_PHYS_SURFACE_TYPE_MOD,ONLY:MF_PHYS_SURF_TYPE
USE FIELD_VARIABLES_MOD,ONLY:FIELD_VARIABLES
USE TYPE_MODEL,ONLY:MODEL
USE YOMSTA,ONLY:TSTA
USE FIELD_MODULE
USE FIELD_FACTORY_MODULE
USE FIELD_ACCESS_MODULE
USE FXTRAN_ACDC_PARALLELMETHOD_MOD
USE FXTRAN_ACDC_STACK_MOD
USE PARKIND1
USE FXTRAN_ACDC_ARRAY_COPY_MOD
USE FXTRAN_ACDC_GPUMEM_MOD
#include "fxtran_acdc_stack.h"

IMPLICIT NONE


TYPE (MF_PHYS_BASE_STATE_TYPE), INTENT (IN)::YDMF_PHYS_BASE_STATE
TYPE (CPG_BNDS_TYPE), INTENT (IN)::YDCPG_BNDS
TYPE (CPG_OPTS_TYPE), INTENT (IN)::YDCPG_OPTS
TYPE (MF_PHYS_TYPE), INTENT (INOUT)::YDMF_PHYS
TYPE (MF_PHYS_SURF_TYPE), INTENT (INOUT)::YDMF_PHYS_SURF
TYPE (FIELD_VARIABLES), INTENT (INOUT)::YDVARS
TYPE (MODEL), INTENT (IN)::YDMODEL
CLASS (FIELD_2RB), POINTER :: YD_PFLU_NEIJ
REAL (KIND=JPRB), POINTER::PFLU_NEIJ (:,:)
CLASS (FIELD_3RB), POINTER :: YD_PNEBS
REAL (KIND=JPRB), POINTER::PNEBS (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PNEB_CVPP
REAL (KIND=JPRB), POINTER::PNEB_CVPP (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PQC_DET_PCMT
REAL (KIND=JPRB), POINTER::PQC_DET_PCMT (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PQI
REAL (KIND=JPRB), POINTER::PQI (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PQL
REAL (KIND=JPRB), POINTER::PQL (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PQLIS
REAL (KIND=JPRB), POINTER::PQLIS (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PQLI_CVPP
REAL (KIND=JPRB), POINTER::PQLI_CVPP (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PQR
REAL (KIND=JPRB), POINTER::PQR (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PQS
REAL (KIND=JPRB), POINTER::PQS (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PQV
REAL (KIND=JPRB), POINTER::PQV (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PSEDIQI
REAL (KIND=JPRB), POINTER::PSEDIQI (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PSEDIQL
REAL (KIND=JPRB), POINTER::PSEDIQL (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PTENHA
REAL (KIND=JPRB), POINTER::PTENHA (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PTENQVA
REAL (KIND=JPRB), POINTER::PTENQVA (:,:,:)
TYPE (TSTA), INTENT (IN)::YDSTA
#include "acpluiz.intfb.h"
#include "abor1.intfb.h"
#include "acpluiz_openacc.intfb.h"
#include "acuptq.intfb.h"
#include "acuptq_openacc.intfb.h"
CLASS (FIELD_3RB), POINTER :: YL_ZFRSO
REAL (KIND=JPRB), POINTER::ZFRSO (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZFRTH
REAL (KIND=JPRB), POINTER::ZFRTH (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZQMIC
REAL (KIND=JPRB), POINTER::ZQMIC (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZTMIC
REAL (KIND=JPRB), POINTER::ZTMIC (:,:,:)
LOGICAL::LLPTQ
INTEGER (KIND=JPIM)::JLEV
INTEGER (KIND=JPIM)::JLON
REAL (KIND=JPHOOK)::ZHOOK_HANDLE
INTEGER(KIND=JPIM) :: JBLK
TYPE(CPG_BNDS_TYPE) :: YLCPG_BNDS
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_FIELD_API
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_PARALLEL
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_COMPUTE
TYPE(FXTRAN_ACDC_STACK) :: YLSTACK
TYPE(FXTRAN_ACDC_STACK) :: YLOFFSET
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_BASE_STATE_Q(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_BASE_STATE_T(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHI(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_CP(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_R(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_PREHYDF(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_DELP(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_RDELP(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_BASE_STATE_YGSP_RR_T(:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_DIFCQ(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_DIFCS(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_DIFTQ(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_DIFTS(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FCCQL(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FCCQN(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FCSQL(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FCSQN(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FPEVPCL(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FPEVPCN(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FPEVPSL(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FPEVPSN(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FPFPCL(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FPFPCN(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FPFPSL(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FPFPSN(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FPLCL(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FPLCN(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FPLSL(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FPLSN(:,:,:)
REAL(KIND=JPRB), POINTER :: Z_YDMF_PHYS_SURF_GSD_VF_PLSM(:,:)
REAL(KIND=JPRB), POINTER :: Z_YDVARS_GEOMETRY_GM_T0(:,:)
IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_PRECIPITATION_PARALLEL', 0, ZHOOK_HANDLE)

CALL FXTRAN_ACDC_GPUMEMSTAT (__FILE__, __LINE__, "BEGIN")


IF (LHOOK) CALL DR_HOOK ('CREATE_TEMPORARIES',0,ZHOOK_HANDLE_FIELD_API)
CALL FIELD_NEW (YL_ZTMIC, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZQMIC, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZFRTH, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 0, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZFRSO, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 0, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
IF (LHOOK) CALL DR_HOOK ('CREATE_TEMPORARIES',1,ZHOOK_HANDLE_FIELD_API)

LLPTQ=.TRUE.
IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_PRECIPITATION_PARALLEL:ACUPTQ',0,ZHOOK_HANDLE_PARALLEL)

IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','APL_ARPEGE_PRECIPITATION_PARALLEL:ACUPTQ')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_PRECIPITATION_PARALLEL&
  &:ACUPTQ:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  PFLU_NEIJ => GET_HOST_DATA_RDONLY (YD_PFLU_NEIJ)
  PNEBS => GET_HOST_DATA_RDWR (YD_PNEBS)
  PNEB_CVPP => GET_HOST_DATA_RDONLY (YD_PNEB_CVPP)
  PQC_DET_PCMT => GET_HOST_DATA_RDONLY (YD_PQC_DET_PCMT)
  PQI => GET_HOST_DATA_RDONLY (YD_PQI)
  PQL => GET_HOST_DATA_RDONLY (YD_PQL)
  PQLIS => GET_HOST_DATA_RDWR (YD_PQLIS)
  PQLI_CVPP => GET_HOST_DATA_RDONLY (YD_PQLI_CVPP)
  PQR => GET_HOST_DATA_RDONLY (YD_PQR)
  PQS => GET_HOST_DATA_RDONLY (YD_PQS)
  PQV => GET_HOST_DATA_RDONLY (YD_PQV)
  PSEDIQI => GET_HOST_DATA_RDWR (YD_PSEDIQI)
  PSEDIQL => GET_HOST_DATA_RDWR (YD_PSEDIQL)
  PTENHA => GET_HOST_DATA_RDWR (YD_PTENHA)
  PTENQVA => GET_HOST_DATA_RDWR (YD_PTENQVA)
  ZFRSO => GET_HOST_DATA_RDWR (YL_ZFRSO)
  ZFRTH => GET_HOST_DATA_RDWR (YL_ZFRTH)
  ZQMIC => GET_HOST_DATA_RDWR (YL_ZQMIC)
  ZTMIC => GET_HOST_DATA_RDWR (YL_ZTMIC)
  Z_YDMF_PHYS_BASE_STATE_Q => GET_HOST_DATA_RDONLY (YDMF_PHYS_BASE_STATE%F_Q)
  Z_YDMF_PHYS_BASE_STATE_T => GET_HOST_DATA_RDONLY (YDMF_PHYS_BASE_STATE%F_T)
  Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHI => GET_HOST_DATA_RDONLY (YDMF_PHYS_BASE_STATE%YCPG_DYN%F_PHI)
  Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_CP => GET_HOST_DATA_RDONLY&
  & (YDMF_PHYS_BASE_STATE%YCPG_DYN%RCP%F_CP)
  Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_R => GET_HOST_DATA_RDONLY&
  & (YDMF_PHYS_BASE_STATE%YCPG_DYN%RCP%F_R)
  Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_PREHYDF => GET_HOST_DATA_RDONLY&
  & (YDMF_PHYS_BASE_STATE%YCPG_PHY%F_PREHYDF)
  Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_DELP => GET_HOST_DATA_RDONLY&
  & (YDMF_PHYS_BASE_STATE%YCPG_PHY%XYB%F_DELP)
  Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_RDELP => GET_HOST_DATA_RDONLY&
  & (YDMF_PHYS_BASE_STATE%YCPG_PHY%XYB%F_RDELP)
  Z_YDMF_PHYS_BASE_STATE_YGSP_RR_T => GET_HOST_DATA_RDONLY (YDMF_PHYS_BASE_STATE%YGSP_RR%F_T)
  Z_YDMF_PHYS_OUT_DIFCQ => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_DIFCQ)
  Z_YDMF_PHYS_OUT_DIFCS => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_DIFCS)
  Z_YDMF_PHYS_OUT_DIFTQ => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_DIFTQ)
  Z_YDMF_PHYS_OUT_DIFTS => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_DIFTS)
  Z_YDMF_PHYS_OUT_FCCQL => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FCCQL)
  Z_YDMF_PHYS_OUT_FCCQN => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FCCQN)
  Z_YDMF_PHYS_OUT_FCSQL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FCSQL)
  Z_YDMF_PHYS_OUT_FCSQN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FCSQN)
  Z_YDMF_PHYS_OUT_FPEVPCL => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FPEVPCL)
  Z_YDMF_PHYS_OUT_FPEVPCN => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FPEVPCN)
  Z_YDMF_PHYS_OUT_FPEVPSL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPEVPSL)
  Z_YDMF_PHYS_OUT_FPEVPSN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPEVPSN)
  Z_YDMF_PHYS_OUT_FPFPCL => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FPFPCL)
  Z_YDMF_PHYS_OUT_FPFPCN => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FPFPCN)
  Z_YDMF_PHYS_OUT_FPFPSL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPFPSL)
  Z_YDMF_PHYS_OUT_FPFPSN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPFPSN)
  Z_YDMF_PHYS_OUT_FPLCL => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FPLCL)
  Z_YDMF_PHYS_OUT_FPLCN => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FPLCN)
  Z_YDMF_PHYS_OUT_FPLSL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLSL)
  Z_YDMF_PHYS_OUT_FPLSN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLSN)
  Z_YDMF_PHYS_SURF_GSD_VF_PLSM => GET_HOST_DATA_RDONLY (YDMF_PHYS_SURF%GSD_VF%F_LSM)
  Z_YDVARS_GEOMETRY_GM_T0 => GET_HOST_DATA_RDONLY (YDVARS%GEOMETRY%GM%FT0)
  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_PRECIPITATION_PARALLEL&
  &:ACUPTQ:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_PRECIPITATION_PARALLEL:ACUPTQ:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
  !$OMP PARALLEL DO PRIVATE (JBLK, JLEV, JLON) FIRSTPRIVATE (YLCPG_BNDS)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    CALL YLCPG_BNDS%UPDATE (JBLK)
    
    ZFRSO (:,:, JBLK)=0.0_JPRB
    ZFRTH (:,:, JBLK)=0.0_JPRB
    CALL ACUPTQ (YDMODEL%YRCST, YDCPG_OPTS%KLON, YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA, YDCPG_OPTS%KFLEVG&
    &, 0, LLPTQ, ZFRSO(:,:, JBLK), ZFRTH(:,:, JBLK), Z_YDMF_PHYS_OUT_DIFCQ(:,:, JBLK), Z_YDMF_PHYS_OUT_DIFCS&
    &(:,:, JBLK), Z_YDMF_PHYS_OUT_DIFTQ(:,:, JBLK), Z_YDMF_PHYS_OUT_DIFTS(:,:, JBLK), Z_YDMF_PHYS_OUT_FCCQL&
    &(:,:, JBLK), Z_YDMF_PHYS_OUT_FCCQN(:,:, JBLK), Z_YDMF_PHYS_OUT_FPLCL(:,:, JBLK), Z_YDMF_PHYS_OUT_FPLCN&
    &(:,:, JBLK), Z_YDMF_PHYS_OUT_FPEVPCL(:,:, JBLK), Z_YDMF_PHYS_OUT_FPEVPCN(:,:, JBLK), Z_YDMF_PHYS_OUT_FPFPCL&
    &(:,:, JBLK), Z_YDMF_PHYS_OUT_FPFPCN(:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_RDELP(:,:, JBLK&
    &), Z_YDMF_PHYS_BASE_STATE_T(:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_Q(:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_YGSP_RR_T&
    &(:, JBLK), PTENHA(:,:, JBLK), PTENQVA(:,:, JBLK))

    DO JLEV=YDCPG_OPTS%KTDIA, YDCPG_OPTS%KFLEVG

      DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
        ZTMIC (JLON, JLEV, JBLK)=Z_YDMF_PHYS_BASE_STATE_T (JLON, JLEV, JBLK)
        ZQMIC (JLON, JLEV, JBLK)=PQV (JLON, JLEV, JBLK)
      ENDDO

    ENDDO

    CALL ACPLUIZ (YDMODEL%YRCST, YDMODEL%YRML_PHY_MF, YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA, YDCPG_OPTS&
    &%KLON, YDMODEL%YRML_PHY_MF%YRTOPH%NTPLUI, YDCPG_OPTS%KFLEVG, ZTMIC(:,:, JBLK), ZQMIC(:,:, JBLK&
    &), PQL(:,:, JBLK), PQI(:,:, JBLK), PQR(:,:, JBLK), PQS(:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_DELP&
    &(:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_PREHYDF(:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_CP&
    &(:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_R(:,:, JBLK), PNEBS(:,:, JBLK), PQLIS(:,:, JBLK&
    &), PNEB_CVPP(:,:, JBLK), PQLI_CVPP(:,:, JBLK), PQC_DET_PCMT(:,:, JBLK), PTENHA(:,:, JBLK), PTENQVA&
    &(:,:, JBLK),.TRUE., Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHI(:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_YGSP_RR_T&
    &(:, JBLK), PFLU_NEIJ(:, JBLK), Z_YDMF_PHYS_SURF_GSD_VF_PLSM(:, JBLK), Z_YDVARS_GEOMETRY_GM_T0(&
    &:, JBLK), YDSTA, Z_YDMF_PHYS_OUT_FCSQL(:,:, JBLK), Z_YDMF_PHYS_OUT_FCSQN(:,:, JBLK), Z_YDMF_PHYS_OUT_FPLSL&
    &(:,:, JBLK), Z_YDMF_PHYS_OUT_FPLSN(:,:, JBLK), Z_YDMF_PHYS_OUT_FPEVPSL(:,:, JBLK), Z_YDMF_PHYS_OUT_FPEVPSN&
    &(:,:, JBLK), Z_YDMF_PHYS_OUT_FPFPSL(:,:, JBLK), Z_YDMF_PHYS_OUT_FPFPSN(:,:, JBLK), PSEDIQL(:,:&
    &, JBLK), PSEDIQI(:,:, JBLK))
  ENDDO

  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_PRECIPITATION_PARALLEL:ACUPTQ:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

  IF (FXTRAN_ACDC_LSYNCHOST ('APL_ARPEGE_PRECIPITATION_PARALLEL:ACUPTQ')) THEN
    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_PRECIPITATION_PARALLEL&
    &:ACUPTQ:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
    PFLU_NEIJ => GET_HOST_DATA_RDWR (YD_PFLU_NEIJ)
    PNEBS => GET_HOST_DATA_RDWR (YD_PNEBS)
    PNEB_CVPP => GET_HOST_DATA_RDWR (YD_PNEB_CVPP)
    PQC_DET_PCMT => GET_HOST_DATA_RDWR (YD_PQC_DET_PCMT)
    PQI => GET_HOST_DATA_RDWR (YD_PQI)
    PQL => GET_HOST_DATA_RDWR (YD_PQL)
    PQLIS => GET_HOST_DATA_RDWR (YD_PQLIS)
    PQLI_CVPP => GET_HOST_DATA_RDWR (YD_PQLI_CVPP)
    PQR => GET_HOST_DATA_RDWR (YD_PQR)
    PQS => GET_HOST_DATA_RDWR (YD_PQS)
    PQV => GET_HOST_DATA_RDWR (YD_PQV)
    PSEDIQI => GET_HOST_DATA_RDWR (YD_PSEDIQI)
    PSEDIQL => GET_HOST_DATA_RDWR (YD_PSEDIQL)
    PTENHA => GET_HOST_DATA_RDWR (YD_PTENHA)
    PTENQVA => GET_HOST_DATA_RDWR (YD_PTENQVA)
    ZFRSO => GET_HOST_DATA_RDWR (YL_ZFRSO)
    ZFRTH => GET_HOST_DATA_RDWR (YL_ZFRTH)
    ZQMIC => GET_HOST_DATA_RDWR (YL_ZQMIC)
    ZTMIC => GET_HOST_DATA_RDWR (YL_ZTMIC)
    Z_YDMF_PHYS_BASE_STATE_Q => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%F_Q)
    Z_YDMF_PHYS_BASE_STATE_T => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%F_T)
    Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHI => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%YCPG_DYN%F_PHI)
    Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_CP => GET_HOST_DATA_RDWR&
    & (YDMF_PHYS_BASE_STATE%YCPG_DYN%RCP%F_CP)
    Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_R => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%YCPG_DYN%RCP%F_R)
    Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_PREHYDF => GET_HOST_DATA_RDWR&
    & (YDMF_PHYS_BASE_STATE%YCPG_PHY%F_PREHYDF)
    Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_DELP => GET_HOST_DATA_RDWR&
    & (YDMF_PHYS_BASE_STATE%YCPG_PHY%XYB%F_DELP)
    Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_RDELP => GET_HOST_DATA_RDWR&
    & (YDMF_PHYS_BASE_STATE%YCPG_PHY%XYB%F_RDELP)
    Z_YDMF_PHYS_BASE_STATE_YGSP_RR_T => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%YGSP_RR%F_T)
    Z_YDMF_PHYS_OUT_DIFCQ => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_DIFCQ)
    Z_YDMF_PHYS_OUT_DIFCS => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_DIFCS)
    Z_YDMF_PHYS_OUT_DIFTQ => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_DIFTQ)
    Z_YDMF_PHYS_OUT_DIFTS => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_DIFTS)
    Z_YDMF_PHYS_OUT_FCCQL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FCCQL)
    Z_YDMF_PHYS_OUT_FCCQN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FCCQN)
    Z_YDMF_PHYS_OUT_FCSQL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FCSQL)
    Z_YDMF_PHYS_OUT_FCSQN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FCSQN)
    Z_YDMF_PHYS_OUT_FPEVPCL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPEVPCL)
    Z_YDMF_PHYS_OUT_FPEVPCN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPEVPCN)
    Z_YDMF_PHYS_OUT_FPEVPSL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPEVPSL)
    Z_YDMF_PHYS_OUT_FPEVPSN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPEVPSN)
    Z_YDMF_PHYS_OUT_FPFPCL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPFPCL)
    Z_YDMF_PHYS_OUT_FPFPCN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPFPCN)
    Z_YDMF_PHYS_OUT_FPFPSL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPFPSL)
    Z_YDMF_PHYS_OUT_FPFPSN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPFPSN)
    Z_YDMF_PHYS_OUT_FPLCL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLCL)
    Z_YDMF_PHYS_OUT_FPLCN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLCN)
    Z_YDMF_PHYS_OUT_FPLSL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLSL)
    Z_YDMF_PHYS_OUT_FPLSN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLSN)
    Z_YDMF_PHYS_SURF_GSD_VF_PLSM => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSD_VF%F_LSM)
    Z_YDVARS_GEOMETRY_GM_T0 => GET_HOST_DATA_RDWR (YDVARS%GEOMETRY%GM%FT0)
    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_PRECIPITATION_PARALLEL&
    &:ACUPTQ:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_PRECIPITATION_PARALLEL&
  &:ACUPTQ:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  PFLU_NEIJ => NULL ()
  PNEBS => NULL ()
  PNEB_CVPP => NULL ()
  PQC_DET_PCMT => NULL ()
  PQI => NULL ()
  PQL => NULL ()
  PQLIS => NULL ()
  PQLI_CVPP => NULL ()
  PQR => NULL ()
  PQS => NULL ()
  PQV => NULL ()
  PSEDIQI => NULL ()
  PSEDIQL => NULL ()
  PTENHA => NULL ()
  PTENQVA => NULL ()
  ZFRSO => NULL ()
  ZFRTH => NULL ()
  ZQMIC => NULL ()
  ZTMIC => NULL ()
  Z_YDMF_PHYS_BASE_STATE_Q => NULL ()
  Z_YDMF_PHYS_BASE_STATE_T => NULL ()
  Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHI => NULL ()
  Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_CP => NULL ()
  Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_R => NULL ()
  Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_PREHYDF => NULL ()
  Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_DELP => NULL ()
  Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_RDELP => NULL ()
  Z_YDMF_PHYS_BASE_STATE_YGSP_RR_T => NULL ()
  Z_YDMF_PHYS_OUT_DIFCQ => NULL ()
  Z_YDMF_PHYS_OUT_DIFCS => NULL ()
  Z_YDMF_PHYS_OUT_DIFTQ => NULL ()
  Z_YDMF_PHYS_OUT_DIFTS => NULL ()
  Z_YDMF_PHYS_OUT_FCCQL => NULL ()
  Z_YDMF_PHYS_OUT_FCCQN => NULL ()
  Z_YDMF_PHYS_OUT_FCSQL => NULL ()
  Z_YDMF_PHYS_OUT_FCSQN => NULL ()
  Z_YDMF_PHYS_OUT_FPEVPCL => NULL ()
  Z_YDMF_PHYS_OUT_FPEVPCN => NULL ()
  Z_YDMF_PHYS_OUT_FPEVPSL => NULL ()
  Z_YDMF_PHYS_OUT_FPEVPSN => NULL ()
  Z_YDMF_PHYS_OUT_FPFPCL => NULL ()
  Z_YDMF_PHYS_OUT_FPFPCN => NULL ()
  Z_YDMF_PHYS_OUT_FPFPSL => NULL ()
  Z_YDMF_PHYS_OUT_FPFPSN => NULL ()
  Z_YDMF_PHYS_OUT_FPLCL => NULL ()
  Z_YDMF_PHYS_OUT_FPLCN => NULL ()
  Z_YDMF_PHYS_OUT_FPLSL => NULL ()
  Z_YDMF_PHYS_OUT_FPLSN => NULL ()
  Z_YDMF_PHYS_SURF_GSD_VF_PLSM => NULL ()
  Z_YDVARS_GEOMETRY_GM_T0 => NULL ()
  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_PRECIPITATION_PARALLEL&
  &:ACUPTQ:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMPSINGLECOLUMN&
  &','APL_ARPEGE_PRECIPITATION_PARALLEL:ACUPTQ')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_PRECIPITATION_PARALLEL&
  &:ACUPTQ:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  PFLU_NEIJ => GET_HOST_DATA_RDONLY (YD_PFLU_NEIJ)
  PNEBS => GET_HOST_DATA_RDWR (YD_PNEBS)
  PNEB_CVPP => GET_HOST_DATA_RDONLY (YD_PNEB_CVPP)
  PQC_DET_PCMT => GET_HOST_DATA_RDONLY (YD_PQC_DET_PCMT)
  PQI => GET_HOST_DATA_RDONLY (YD_PQI)
  PQL => GET_HOST_DATA_RDONLY (YD_PQL)
  PQLIS => GET_HOST_DATA_RDWR (YD_PQLIS)
  PQLI_CVPP => GET_HOST_DATA_RDONLY (YD_PQLI_CVPP)
  PQR => GET_HOST_DATA_RDONLY (YD_PQR)
  PQS => GET_HOST_DATA_RDONLY (YD_PQS)
  PQV => GET_HOST_DATA_RDONLY (YD_PQV)
  PSEDIQI => GET_HOST_DATA_RDWR (YD_PSEDIQI)
  PSEDIQL => GET_HOST_DATA_RDWR (YD_PSEDIQL)
  PTENHA => GET_HOST_DATA_RDWR (YD_PTENHA)
  PTENQVA => GET_HOST_DATA_RDWR (YD_PTENQVA)
  ZFRSO => GET_HOST_DATA_RDWR (YL_ZFRSO)
  ZFRTH => GET_HOST_DATA_RDWR (YL_ZFRTH)
  ZQMIC => GET_HOST_DATA_RDWR (YL_ZQMIC)
  ZTMIC => GET_HOST_DATA_RDWR (YL_ZTMIC)
  Z_YDMF_PHYS_BASE_STATE_Q => GET_HOST_DATA_RDONLY (YDMF_PHYS_BASE_STATE%F_Q)
  Z_YDMF_PHYS_BASE_STATE_T => GET_HOST_DATA_RDONLY (YDMF_PHYS_BASE_STATE%F_T)
  Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHI => GET_HOST_DATA_RDONLY (YDMF_PHYS_BASE_STATE%YCPG_DYN%F_PHI)
  Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_CP => GET_HOST_DATA_RDONLY&
  & (YDMF_PHYS_BASE_STATE%YCPG_DYN%RCP%F_CP)
  Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_R => GET_HOST_DATA_RDONLY&
  & (YDMF_PHYS_BASE_STATE%YCPG_DYN%RCP%F_R)
  Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_PREHYDF => GET_HOST_DATA_RDONLY&
  & (YDMF_PHYS_BASE_STATE%YCPG_PHY%F_PREHYDF)
  Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_DELP => GET_HOST_DATA_RDONLY&
  & (YDMF_PHYS_BASE_STATE%YCPG_PHY%XYB%F_DELP)
  Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_RDELP => GET_HOST_DATA_RDONLY&
  & (YDMF_PHYS_BASE_STATE%YCPG_PHY%XYB%F_RDELP)
  Z_YDMF_PHYS_BASE_STATE_YGSP_RR_T => GET_HOST_DATA_RDONLY (YDMF_PHYS_BASE_STATE%YGSP_RR%F_T)
  Z_YDMF_PHYS_OUT_DIFCQ => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_DIFCQ)
  Z_YDMF_PHYS_OUT_DIFCS => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_DIFCS)
  Z_YDMF_PHYS_OUT_DIFTQ => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_DIFTQ)
  Z_YDMF_PHYS_OUT_DIFTS => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_DIFTS)
  Z_YDMF_PHYS_OUT_FCCQL => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FCCQL)
  Z_YDMF_PHYS_OUT_FCCQN => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FCCQN)
  Z_YDMF_PHYS_OUT_FCSQL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FCSQL)
  Z_YDMF_PHYS_OUT_FCSQN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FCSQN)
  Z_YDMF_PHYS_OUT_FPEVPCL => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FPEVPCL)
  Z_YDMF_PHYS_OUT_FPEVPCN => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FPEVPCN)
  Z_YDMF_PHYS_OUT_FPEVPSL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPEVPSL)
  Z_YDMF_PHYS_OUT_FPEVPSN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPEVPSN)
  Z_YDMF_PHYS_OUT_FPFPCL => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FPFPCL)
  Z_YDMF_PHYS_OUT_FPFPCN => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FPFPCN)
  Z_YDMF_PHYS_OUT_FPFPSL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPFPSL)
  Z_YDMF_PHYS_OUT_FPFPSN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPFPSN)
  Z_YDMF_PHYS_OUT_FPLCL => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FPLCL)
  Z_YDMF_PHYS_OUT_FPLCN => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FPLCN)
  Z_YDMF_PHYS_OUT_FPLSL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLSL)
  Z_YDMF_PHYS_OUT_FPLSN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLSN)
  Z_YDMF_PHYS_SURF_GSD_VF_PLSM => GET_HOST_DATA_RDONLY (YDMF_PHYS_SURF%GSD_VF%F_LSM)
  Z_YDVARS_GEOMETRY_GM_T0 => GET_HOST_DATA_RDONLY (YDVARS%GEOMETRY%GM%FT0)
  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_PRECIPITATION_PARALLEL&
  &:ACUPTQ:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_PRECIPITATION_PARALLEL:ACUPTQ:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  !$OMP PARALLEL DO PRIVATE (JBLK, JLEV, JLON, YLCPG_BNDS, YLSTACK)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX

    

    

    DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JLON
      YLCPG_BNDS%KFDIA = JLON
      YLSTACK%L8 = fxtran_acdc_stack_l8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%U8 = fxtran_acdc_stack_u8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%L4 = fxtran_acdc_stack_l4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%U4 = fxtran_acdc_stack_u4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      
      ZFRSO (JLON,:, JBLK)=0.0_JPRB
      ZFRTH (JLON,:, JBLK)=0.0_JPRB
      CALL ACUPTQ_OPENACC (YDMODEL%YRCST, YDCPG_OPTS%KLON, YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA, YDCPG_OPTS%KFLEVG&
      &, 0, LLPTQ, ZFRSO(:,:, JBLK), ZFRTH(:,:, JBLK), Z_YDMF_PHYS_OUT_DIFCQ(:,:, JBLK), Z_YDMF_PHYS_OUT_DIFCS&
      &(:,:, JBLK), Z_YDMF_PHYS_OUT_DIFTQ(:,:, JBLK), Z_YDMF_PHYS_OUT_DIFTS(:,:, JBLK), Z_YDMF_PHYS_OUT_FCCQL&
      &(:,:, JBLK), Z_YDMF_PHYS_OUT_FCCQN(:,:, JBLK), Z_YDMF_PHYS_OUT_FPLCL(:,:, JBLK), Z_YDMF_PHYS_OUT_FPLCN&
      &(:,:, JBLK), Z_YDMF_PHYS_OUT_FPEVPCL(:,:, JBLK), Z_YDMF_PHYS_OUT_FPEVPCN(:,:, JBLK), Z_YDMF_PHYS_OUT_FPFPCL&
      &(:,:, JBLK), Z_YDMF_PHYS_OUT_FPFPCN(:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_RDELP(:,:, JBLK)&
      &, Z_YDMF_PHYS_BASE_STATE_T(:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_Q(:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_YGSP_RR_T&
      &(:, JBLK), PTENHA(:,:, JBLK), PTENQVA(:,:, JBLK),YDSTACK=YLSTACK)

      DO JLEV=YDCPG_OPTS%KTDIA, YDCPG_OPTS%KFLEVG
        
        ZTMIC (JLON, JLEV, JBLK)=Z_YDMF_PHYS_BASE_STATE_T (JLON, JLEV, JBLK)
        ZQMIC (JLON, JLEV, JBLK)=PQV (JLON, JLEV, JBLK)
      
      ENDDO

      CALL ACPLUIZ_OPENACC (YDMODEL%YRCST, YDMODEL%YRML_PHY_MF, YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA, YDCPG_OPTS&
      &%KLON, YDMODEL%YRML_PHY_MF%YRTOPH%NTPLUI, YDCPG_OPTS%KFLEVG, ZTMIC(:,:, JBLK), ZQMIC(:,:, JBLK),&
      & PQL(:,:, JBLK), PQI(:,:, JBLK), PQR(:,:, JBLK), PQS(:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_DELP&
      &(:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_PREHYDF(:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_CP&
      &(:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_R(:,:, JBLK), PNEBS(:,:, JBLK), PQLIS(:,:, JBLK&
      &), PNEB_CVPP(:,:, JBLK), PQLI_CVPP(:,:, JBLK), PQC_DET_PCMT(:,:, JBLK), PTENHA(:,:, JBLK), PTENQVA&
      &(:,:, JBLK),.TRUE., Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHI(:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_YGSP_RR_T&
      &(:, JBLK), PFLU_NEIJ(:, JBLK), Z_YDMF_PHYS_SURF_GSD_VF_PLSM(:, JBLK), Z_YDVARS_GEOMETRY_GM_T0(:,&
      & JBLK), YDSTA, Z_YDMF_PHYS_OUT_FCSQL(:,:, JBLK), Z_YDMF_PHYS_OUT_FCSQN(:,:, JBLK), Z_YDMF_PHYS_OUT_FPLSL&
      &(:,:, JBLK), Z_YDMF_PHYS_OUT_FPLSN(:,:, JBLK), Z_YDMF_PHYS_OUT_FPEVPSL(:,:, JBLK), Z_YDMF_PHYS_OUT_FPEVPSN&
      &(:,:, JBLK), Z_YDMF_PHYS_OUT_FPFPSL(:,:, JBLK), Z_YDMF_PHYS_OUT_FPFPSN(:,:, JBLK), PSEDIQL(:,:, JBLK&
      &), PSEDIQI(:,:, JBLK),YDSTACK=YLSTACK)
    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_PRECIPITATION_PARALLEL:ACUPTQ:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

  IF (FXTRAN_ACDC_LSYNCHOST ('APL_ARPEGE_PRECIPITATION_PARALLEL:ACUPTQ')) THEN
    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_PRECIPITATION_PARALLEL&
    &:ACUPTQ:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
    PFLU_NEIJ => GET_HOST_DATA_RDWR (YD_PFLU_NEIJ)
    PNEBS => GET_HOST_DATA_RDWR (YD_PNEBS)
    PNEB_CVPP => GET_HOST_DATA_RDWR (YD_PNEB_CVPP)
    PQC_DET_PCMT => GET_HOST_DATA_RDWR (YD_PQC_DET_PCMT)
    PQI => GET_HOST_DATA_RDWR (YD_PQI)
    PQL => GET_HOST_DATA_RDWR (YD_PQL)
    PQLIS => GET_HOST_DATA_RDWR (YD_PQLIS)
    PQLI_CVPP => GET_HOST_DATA_RDWR (YD_PQLI_CVPP)
    PQR => GET_HOST_DATA_RDWR (YD_PQR)
    PQS => GET_HOST_DATA_RDWR (YD_PQS)
    PQV => GET_HOST_DATA_RDWR (YD_PQV)
    PSEDIQI => GET_HOST_DATA_RDWR (YD_PSEDIQI)
    PSEDIQL => GET_HOST_DATA_RDWR (YD_PSEDIQL)
    PTENHA => GET_HOST_DATA_RDWR (YD_PTENHA)
    PTENQVA => GET_HOST_DATA_RDWR (YD_PTENQVA)
    ZFRSO => GET_HOST_DATA_RDWR (YL_ZFRSO)
    ZFRTH => GET_HOST_DATA_RDWR (YL_ZFRTH)
    ZQMIC => GET_HOST_DATA_RDWR (YL_ZQMIC)
    ZTMIC => GET_HOST_DATA_RDWR (YL_ZTMIC)
    Z_YDMF_PHYS_BASE_STATE_Q => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%F_Q)
    Z_YDMF_PHYS_BASE_STATE_T => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%F_T)
    Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHI => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%YCPG_DYN%F_PHI)
    Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_CP => GET_HOST_DATA_RDWR&
    & (YDMF_PHYS_BASE_STATE%YCPG_DYN%RCP%F_CP)
    Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_R => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%YCPG_DYN%RCP%F_R)
    Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_PREHYDF => GET_HOST_DATA_RDWR&
    & (YDMF_PHYS_BASE_STATE%YCPG_PHY%F_PREHYDF)
    Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_DELP => GET_HOST_DATA_RDWR&
    & (YDMF_PHYS_BASE_STATE%YCPG_PHY%XYB%F_DELP)
    Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_RDELP => GET_HOST_DATA_RDWR&
    & (YDMF_PHYS_BASE_STATE%YCPG_PHY%XYB%F_RDELP)
    Z_YDMF_PHYS_BASE_STATE_YGSP_RR_T => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%YGSP_RR%F_T)
    Z_YDMF_PHYS_OUT_DIFCQ => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_DIFCQ)
    Z_YDMF_PHYS_OUT_DIFCS => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_DIFCS)
    Z_YDMF_PHYS_OUT_DIFTQ => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_DIFTQ)
    Z_YDMF_PHYS_OUT_DIFTS => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_DIFTS)
    Z_YDMF_PHYS_OUT_FCCQL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FCCQL)
    Z_YDMF_PHYS_OUT_FCCQN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FCCQN)
    Z_YDMF_PHYS_OUT_FCSQL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FCSQL)
    Z_YDMF_PHYS_OUT_FCSQN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FCSQN)
    Z_YDMF_PHYS_OUT_FPEVPCL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPEVPCL)
    Z_YDMF_PHYS_OUT_FPEVPCN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPEVPCN)
    Z_YDMF_PHYS_OUT_FPEVPSL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPEVPSL)
    Z_YDMF_PHYS_OUT_FPEVPSN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPEVPSN)
    Z_YDMF_PHYS_OUT_FPFPCL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPFPCL)
    Z_YDMF_PHYS_OUT_FPFPCN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPFPCN)
    Z_YDMF_PHYS_OUT_FPFPSL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPFPSL)
    Z_YDMF_PHYS_OUT_FPFPSN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPFPSN)
    Z_YDMF_PHYS_OUT_FPLCL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLCL)
    Z_YDMF_PHYS_OUT_FPLCN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLCN)
    Z_YDMF_PHYS_OUT_FPLSL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLSL)
    Z_YDMF_PHYS_OUT_FPLSN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLSN)
    Z_YDMF_PHYS_SURF_GSD_VF_PLSM => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSD_VF%F_LSM)
    Z_YDVARS_GEOMETRY_GM_T0 => GET_HOST_DATA_RDWR (YDVARS%GEOMETRY%GM%FT0)
    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_PRECIPITATION_PARALLEL&
    &:ACUPTQ:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_PRECIPITATION_PARALLEL&
  &:ACUPTQ:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  PFLU_NEIJ => NULL ()
  PNEBS => NULL ()
  PNEB_CVPP => NULL ()
  PQC_DET_PCMT => NULL ()
  PQI => NULL ()
  PQL => NULL ()
  PQLIS => NULL ()
  PQLI_CVPP => NULL ()
  PQR => NULL ()
  PQS => NULL ()
  PQV => NULL ()
  PSEDIQI => NULL ()
  PSEDIQL => NULL ()
  PTENHA => NULL ()
  PTENQVA => NULL ()
  ZFRSO => NULL ()
  ZFRTH => NULL ()
  ZQMIC => NULL ()
  ZTMIC => NULL ()
  Z_YDMF_PHYS_BASE_STATE_Q => NULL ()
  Z_YDMF_PHYS_BASE_STATE_T => NULL ()
  Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHI => NULL ()
  Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_CP => NULL ()
  Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_R => NULL ()
  Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_PREHYDF => NULL ()
  Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_DELP => NULL ()
  Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_RDELP => NULL ()
  Z_YDMF_PHYS_BASE_STATE_YGSP_RR_T => NULL ()
  Z_YDMF_PHYS_OUT_DIFCQ => NULL ()
  Z_YDMF_PHYS_OUT_DIFCS => NULL ()
  Z_YDMF_PHYS_OUT_DIFTQ => NULL ()
  Z_YDMF_PHYS_OUT_DIFTS => NULL ()
  Z_YDMF_PHYS_OUT_FCCQL => NULL ()
  Z_YDMF_PHYS_OUT_FCCQN => NULL ()
  Z_YDMF_PHYS_OUT_FCSQL => NULL ()
  Z_YDMF_PHYS_OUT_FCSQN => NULL ()
  Z_YDMF_PHYS_OUT_FPEVPCL => NULL ()
  Z_YDMF_PHYS_OUT_FPEVPCN => NULL ()
  Z_YDMF_PHYS_OUT_FPEVPSL => NULL ()
  Z_YDMF_PHYS_OUT_FPEVPSN => NULL ()
  Z_YDMF_PHYS_OUT_FPFPCL => NULL ()
  Z_YDMF_PHYS_OUT_FPFPCN => NULL ()
  Z_YDMF_PHYS_OUT_FPFPSL => NULL ()
  Z_YDMF_PHYS_OUT_FPFPSN => NULL ()
  Z_YDMF_PHYS_OUT_FPLCL => NULL ()
  Z_YDMF_PHYS_OUT_FPLCN => NULL ()
  Z_YDMF_PHYS_OUT_FPLSL => NULL ()
  Z_YDMF_PHYS_OUT_FPLSN => NULL ()
  Z_YDMF_PHYS_SURF_GSD_VF_PLSM => NULL ()
  Z_YDVARS_GEOMETRY_GM_T0 => NULL ()
  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_PRECIPITATION_PARALLEL&
  &:ACUPTQ:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN&
  &','APL_ARPEGE_PRECIPITATION_PARALLEL:ACUPTQ')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_PRECIPITATION_PARALLEL&
  &:ACUPTQ:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  PFLU_NEIJ => GET_DEVICE_DATA_RDONLY (YD_PFLU_NEIJ)
  PNEBS => GET_DEVICE_DATA_RDWR (YD_PNEBS)
  PNEB_CVPP => GET_DEVICE_DATA_RDONLY (YD_PNEB_CVPP)
  PQC_DET_PCMT => GET_DEVICE_DATA_RDONLY (YD_PQC_DET_PCMT)
  PQI => GET_DEVICE_DATA_RDONLY (YD_PQI)
  PQL => GET_DEVICE_DATA_RDONLY (YD_PQL)
  PQLIS => GET_DEVICE_DATA_RDWR (YD_PQLIS)
  PQLI_CVPP => GET_DEVICE_DATA_RDONLY (YD_PQLI_CVPP)
  PQR => GET_DEVICE_DATA_RDONLY (YD_PQR)
  PQS => GET_DEVICE_DATA_RDONLY (YD_PQS)
  PQV => GET_DEVICE_DATA_RDONLY (YD_PQV)
  PSEDIQI => GET_DEVICE_DATA_RDWR (YD_PSEDIQI)
  PSEDIQL => GET_DEVICE_DATA_RDWR (YD_PSEDIQL)
  PTENHA => GET_DEVICE_DATA_RDWR (YD_PTENHA)
  PTENQVA => GET_DEVICE_DATA_RDWR (YD_PTENQVA)
  ZFRSO => GET_DEVICE_DATA_RDWR (YL_ZFRSO)
  ZFRTH => GET_DEVICE_DATA_RDWR (YL_ZFRTH)
  ZQMIC => GET_DEVICE_DATA_RDWR (YL_ZQMIC)
  ZTMIC => GET_DEVICE_DATA_RDWR (YL_ZTMIC)
  Z_YDMF_PHYS_BASE_STATE_Q => GET_DEVICE_DATA_RDONLY (YDMF_PHYS_BASE_STATE%F_Q)
  Z_YDMF_PHYS_BASE_STATE_T => GET_DEVICE_DATA_RDONLY (YDMF_PHYS_BASE_STATE%F_T)
  Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHI => GET_DEVICE_DATA_RDONLY (YDMF_PHYS_BASE_STATE%YCPG_DYN%F_PHI)
  Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_CP => GET_DEVICE_DATA_RDONLY&
  & (YDMF_PHYS_BASE_STATE%YCPG_DYN%RCP%F_CP)
  Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_R => GET_DEVICE_DATA_RDONLY&
  & (YDMF_PHYS_BASE_STATE%YCPG_DYN%RCP%F_R)
  Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_PREHYDF => GET_DEVICE_DATA_RDONLY&
  & (YDMF_PHYS_BASE_STATE%YCPG_PHY%F_PREHYDF)
  Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_DELP => GET_DEVICE_DATA_RDONLY&
  & (YDMF_PHYS_BASE_STATE%YCPG_PHY%XYB%F_DELP)
  Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_RDELP => GET_DEVICE_DATA_RDONLY&
  & (YDMF_PHYS_BASE_STATE%YCPG_PHY%XYB%F_RDELP)
  Z_YDMF_PHYS_BASE_STATE_YGSP_RR_T => GET_DEVICE_DATA_RDONLY (YDMF_PHYS_BASE_STATE%YGSP_RR%F_T)
  Z_YDMF_PHYS_OUT_DIFCQ => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_DIFCQ)
  Z_YDMF_PHYS_OUT_DIFCS => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_DIFCS)
  Z_YDMF_PHYS_OUT_DIFTQ => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_DIFTQ)
  Z_YDMF_PHYS_OUT_DIFTS => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_DIFTS)
  Z_YDMF_PHYS_OUT_FCCQL => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_FCCQL)
  Z_YDMF_PHYS_OUT_FCCQN => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_FCCQN)
  Z_YDMF_PHYS_OUT_FCSQL => GET_DEVICE_DATA_RDWR (YDMF_PHYS%OUT%F_FCSQL)
  Z_YDMF_PHYS_OUT_FCSQN => GET_DEVICE_DATA_RDWR (YDMF_PHYS%OUT%F_FCSQN)
  Z_YDMF_PHYS_OUT_FPEVPCL => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_FPEVPCL)
  Z_YDMF_PHYS_OUT_FPEVPCN => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_FPEVPCN)
  Z_YDMF_PHYS_OUT_FPEVPSL => GET_DEVICE_DATA_RDWR (YDMF_PHYS%OUT%F_FPEVPSL)
  Z_YDMF_PHYS_OUT_FPEVPSN => GET_DEVICE_DATA_RDWR (YDMF_PHYS%OUT%F_FPEVPSN)
  Z_YDMF_PHYS_OUT_FPFPCL => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_FPFPCL)
  Z_YDMF_PHYS_OUT_FPFPCN => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_FPFPCN)
  Z_YDMF_PHYS_OUT_FPFPSL => GET_DEVICE_DATA_RDWR (YDMF_PHYS%OUT%F_FPFPSL)
  Z_YDMF_PHYS_OUT_FPFPSN => GET_DEVICE_DATA_RDWR (YDMF_PHYS%OUT%F_FPFPSN)
  Z_YDMF_PHYS_OUT_FPLCL => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_FPLCL)
  Z_YDMF_PHYS_OUT_FPLCN => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_FPLCN)
  Z_YDMF_PHYS_OUT_FPLSL => GET_DEVICE_DATA_RDWR (YDMF_PHYS%OUT%F_FPLSL)
  Z_YDMF_PHYS_OUT_FPLSN => GET_DEVICE_DATA_RDWR (YDMF_PHYS%OUT%F_FPLSN)
  Z_YDMF_PHYS_SURF_GSD_VF_PLSM => GET_DEVICE_DATA_RDONLY (YDMF_PHYS_SURF%GSD_VF%F_LSM)
  Z_YDVARS_GEOMETRY_GM_T0 => GET_DEVICE_DATA_RDONLY (YDVARS%GEOMETRY%GM%FT0)
  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_PRECIPITATION_PARALLEL&
  &:ACUPTQ:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_PRECIPITATION_PARALLEL:ACUPTQ:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  
    !$ACC PARALLEL LOOP GANG &
    !$ACC&PRESENT (PFLU_NEIJ, PNEBS, PNEB_CVPP, PQC_DET_PCMT, PQI, PQL, PQLIS, PQLI_CVPP, &
    !$ACC&         PQR, PQS, PQV, PSEDIQI, PSEDIQL, PTENHA, PTENQVA, YDCPG_OPTS, YDMODEL, &
    !$ACC&         YDSTA, YFXTRAN_ACDC_STACK, ZFRSO, ZFRTH, ZQMIC, ZTMIC, Z_YDMF_PHYS_BASE_STATE_Q, &
    !$ACC&         Z_YDMF_PHYS_BASE_STATE_T, Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHI, &
    !$ACC&         Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_CP, Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_R, &
    !$ACC&         Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_PREHYDF, Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_DELP, &
    !$ACC&         Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_RDELP, Z_YDMF_PHYS_BASE_STATE_YGSP_RR_T, &
    !$ACC&         Z_YDMF_PHYS_OUT_DIFCQ, Z_YDMF_PHYS_OUT_DIFCS, Z_YDMF_PHYS_OUT_DIFTQ, &
    !$ACC&         Z_YDMF_PHYS_OUT_DIFTS, Z_YDMF_PHYS_OUT_FCCQL, Z_YDMF_PHYS_OUT_FCCQN, &
    !$ACC&         Z_YDMF_PHYS_OUT_FCSQL, Z_YDMF_PHYS_OUT_FCSQN, Z_YDMF_PHYS_OUT_FPEVPCL, &
    !$ACC&         Z_YDMF_PHYS_OUT_FPEVPCN, Z_YDMF_PHYS_OUT_FPEVPSL, Z_YDMF_PHYS_OUT_FPEVPSN, &
    !$ACC&         Z_YDMF_PHYS_OUT_FPFPCL, Z_YDMF_PHYS_OUT_FPFPCN, Z_YDMF_PHYS_OUT_FPFPSL, &
    !$ACC&         Z_YDMF_PHYS_OUT_FPFPSN, Z_YDMF_PHYS_OUT_FPLCL, Z_YDMF_PHYS_OUT_FPLCN, &
    !$ACC&         Z_YDMF_PHYS_OUT_FPLSL, Z_YDMF_PHYS_OUT_FPLSN, Z_YDMF_PHYS_SURF_GSD_VF_PLSM, &
    !$ACC&         Z_YDVARS_GEOMETRY_GM_T0) &
    !$ACC&PRIVATE (JBLK) &
    !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
    
    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    
    
    
    !$ACC LOOP VECTOR &
    !$ACC&PRIVATE (JLEV, JLON, YLCPG_BNDS, YLSTACK) 

    

    DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JLON
      YLCPG_BNDS%KFDIA = JLON
      YLSTACK%L8 = fxtran_acdc_stack_l8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%U8 = fxtran_acdc_stack_u8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%L4 = fxtran_acdc_stack_l4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%U4 = fxtran_acdc_stack_u4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      
      ZFRSO (JLON,:, JBLK)=0.0_JPRB
      ZFRTH (JLON,:, JBLK)=0.0_JPRB
      CALL ACUPTQ_OPENACC (YDMODEL%YRCST, YDCPG_OPTS%KLON, YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA, YDCPG_OPTS%KFLEVG&
      &, 0, LLPTQ, ZFRSO(:,:, JBLK), ZFRTH(:,:, JBLK), Z_YDMF_PHYS_OUT_DIFCQ(:,:, JBLK), Z_YDMF_PHYS_OUT_DIFCS&
      &(:,:, JBLK), Z_YDMF_PHYS_OUT_DIFTQ(:,:, JBLK), Z_YDMF_PHYS_OUT_DIFTS(:,:, JBLK), Z_YDMF_PHYS_OUT_FCCQL&
      &(:,:, JBLK), Z_YDMF_PHYS_OUT_FCCQN(:,:, JBLK), Z_YDMF_PHYS_OUT_FPLCL(:,:, JBLK), Z_YDMF_PHYS_OUT_FPLCN&
      &(:,:, JBLK), Z_YDMF_PHYS_OUT_FPEVPCL(:,:, JBLK), Z_YDMF_PHYS_OUT_FPEVPCN(:,:, JBLK), Z_YDMF_PHYS_OUT_FPFPCL&
      &(:,:, JBLK), Z_YDMF_PHYS_OUT_FPFPCN(:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_RDELP(:,:, JBLK)&
      &, Z_YDMF_PHYS_BASE_STATE_T(:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_Q(:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_YGSP_RR_T&
      &(:, JBLK), PTENHA(:,:, JBLK), PTENQVA(:,:, JBLK),YDSTACK=YLSTACK)

      DO JLEV=YDCPG_OPTS%KTDIA, YDCPG_OPTS%KFLEVG
        
        ZTMIC (JLON, JLEV, JBLK)=Z_YDMF_PHYS_BASE_STATE_T (JLON, JLEV, JBLK)
        ZQMIC (JLON, JLEV, JBLK)=PQV (JLON, JLEV, JBLK)
      
      ENDDO

      CALL ACPLUIZ_OPENACC (YDMODEL%YRCST, YDMODEL%YRML_PHY_MF, YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA, YDCPG_OPTS&
      &%KLON, YDMODEL%YRML_PHY_MF%YRTOPH%NTPLUI, YDCPG_OPTS%KFLEVG, ZTMIC(:,:, JBLK), ZQMIC(:,:, JBLK),&
      & PQL(:,:, JBLK), PQI(:,:, JBLK), PQR(:,:, JBLK), PQS(:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_DELP&
      &(:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_PREHYDF(:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_CP&
      &(:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_R(:,:, JBLK), PNEBS(:,:, JBLK), PQLIS(:,:, JBLK&
      &), PNEB_CVPP(:,:, JBLK), PQLI_CVPP(:,:, JBLK), PQC_DET_PCMT(:,:, JBLK), PTENHA(:,:, JBLK), PTENQVA&
      &(:,:, JBLK),.TRUE., Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHI(:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_YGSP_RR_T&
      &(:, JBLK), PFLU_NEIJ(:, JBLK), Z_YDMF_PHYS_SURF_GSD_VF_PLSM(:, JBLK), Z_YDVARS_GEOMETRY_GM_T0(:,&
      & JBLK), YDSTA, Z_YDMF_PHYS_OUT_FCSQL(:,:, JBLK), Z_YDMF_PHYS_OUT_FCSQN(:,:, JBLK), Z_YDMF_PHYS_OUT_FPLSL&
      &(:,:, JBLK), Z_YDMF_PHYS_OUT_FPLSN(:,:, JBLK), Z_YDMF_PHYS_OUT_FPEVPSL(:,:, JBLK), Z_YDMF_PHYS_OUT_FPEVPSN&
      &(:,:, JBLK), Z_YDMF_PHYS_OUT_FPFPSL(:,:, JBLK), Z_YDMF_PHYS_OUT_FPFPSN(:,:, JBLK), PSEDIQL(:,:, JBLK&
      &), PSEDIQI(:,:, JBLK),YDSTACK=YLSTACK)
    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_PRECIPITATION_PARALLEL:ACUPTQ:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

  IF (FXTRAN_ACDC_LSYNCHOST ('APL_ARPEGE_PRECIPITATION_PARALLEL:ACUPTQ')) THEN
    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_PRECIPITATION_PARALLEL&
    &:ACUPTQ:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
    PFLU_NEIJ => GET_HOST_DATA_RDWR (YD_PFLU_NEIJ)
    PNEBS => GET_HOST_DATA_RDWR (YD_PNEBS)
    PNEB_CVPP => GET_HOST_DATA_RDWR (YD_PNEB_CVPP)
    PQC_DET_PCMT => GET_HOST_DATA_RDWR (YD_PQC_DET_PCMT)
    PQI => GET_HOST_DATA_RDWR (YD_PQI)
    PQL => GET_HOST_DATA_RDWR (YD_PQL)
    PQLIS => GET_HOST_DATA_RDWR (YD_PQLIS)
    PQLI_CVPP => GET_HOST_DATA_RDWR (YD_PQLI_CVPP)
    PQR => GET_HOST_DATA_RDWR (YD_PQR)
    PQS => GET_HOST_DATA_RDWR (YD_PQS)
    PQV => GET_HOST_DATA_RDWR (YD_PQV)
    PSEDIQI => GET_HOST_DATA_RDWR (YD_PSEDIQI)
    PSEDIQL => GET_HOST_DATA_RDWR (YD_PSEDIQL)
    PTENHA => GET_HOST_DATA_RDWR (YD_PTENHA)
    PTENQVA => GET_HOST_DATA_RDWR (YD_PTENQVA)
    ZFRSO => GET_HOST_DATA_RDWR (YL_ZFRSO)
    ZFRTH => GET_HOST_DATA_RDWR (YL_ZFRTH)
    ZQMIC => GET_HOST_DATA_RDWR (YL_ZQMIC)
    ZTMIC => GET_HOST_DATA_RDWR (YL_ZTMIC)
    Z_YDMF_PHYS_BASE_STATE_Q => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%F_Q)
    Z_YDMF_PHYS_BASE_STATE_T => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%F_T)
    Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHI => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%YCPG_DYN%F_PHI)
    Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_CP => GET_HOST_DATA_RDWR&
    & (YDMF_PHYS_BASE_STATE%YCPG_DYN%RCP%F_CP)
    Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_R => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%YCPG_DYN%RCP%F_R)
    Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_PREHYDF => GET_HOST_DATA_RDWR&
    & (YDMF_PHYS_BASE_STATE%YCPG_PHY%F_PREHYDF)
    Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_DELP => GET_HOST_DATA_RDWR&
    & (YDMF_PHYS_BASE_STATE%YCPG_PHY%XYB%F_DELP)
    Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_RDELP => GET_HOST_DATA_RDWR&
    & (YDMF_PHYS_BASE_STATE%YCPG_PHY%XYB%F_RDELP)
    Z_YDMF_PHYS_BASE_STATE_YGSP_RR_T => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%YGSP_RR%F_T)
    Z_YDMF_PHYS_OUT_DIFCQ => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_DIFCQ)
    Z_YDMF_PHYS_OUT_DIFCS => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_DIFCS)
    Z_YDMF_PHYS_OUT_DIFTQ => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_DIFTQ)
    Z_YDMF_PHYS_OUT_DIFTS => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_DIFTS)
    Z_YDMF_PHYS_OUT_FCCQL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FCCQL)
    Z_YDMF_PHYS_OUT_FCCQN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FCCQN)
    Z_YDMF_PHYS_OUT_FCSQL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FCSQL)
    Z_YDMF_PHYS_OUT_FCSQN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FCSQN)
    Z_YDMF_PHYS_OUT_FPEVPCL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPEVPCL)
    Z_YDMF_PHYS_OUT_FPEVPCN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPEVPCN)
    Z_YDMF_PHYS_OUT_FPEVPSL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPEVPSL)
    Z_YDMF_PHYS_OUT_FPEVPSN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPEVPSN)
    Z_YDMF_PHYS_OUT_FPFPCL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPFPCL)
    Z_YDMF_PHYS_OUT_FPFPCN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPFPCN)
    Z_YDMF_PHYS_OUT_FPFPSL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPFPSL)
    Z_YDMF_PHYS_OUT_FPFPSN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPFPSN)
    Z_YDMF_PHYS_OUT_FPLCL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLCL)
    Z_YDMF_PHYS_OUT_FPLCN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLCN)
    Z_YDMF_PHYS_OUT_FPLSL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLSL)
    Z_YDMF_PHYS_OUT_FPLSN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLSN)
    Z_YDMF_PHYS_SURF_GSD_VF_PLSM => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSD_VF%F_LSM)
    Z_YDVARS_GEOMETRY_GM_T0 => GET_HOST_DATA_RDWR (YDVARS%GEOMETRY%GM%FT0)
    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_PRECIPITATION_PARALLEL&
    &:ACUPTQ:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_PRECIPITATION_PARALLEL&
  &:ACUPTQ:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  PFLU_NEIJ => NULL ()
  PNEBS => NULL ()
  PNEB_CVPP => NULL ()
  PQC_DET_PCMT => NULL ()
  PQI => NULL ()
  PQL => NULL ()
  PQLIS => NULL ()
  PQLI_CVPP => NULL ()
  PQR => NULL ()
  PQS => NULL ()
  PQV => NULL ()
  PSEDIQI => NULL ()
  PSEDIQL => NULL ()
  PTENHA => NULL ()
  PTENQVA => NULL ()
  ZFRSO => NULL ()
  ZFRTH => NULL ()
  ZQMIC => NULL ()
  ZTMIC => NULL ()
  Z_YDMF_PHYS_BASE_STATE_Q => NULL ()
  Z_YDMF_PHYS_BASE_STATE_T => NULL ()
  Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHI => NULL ()
  Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_CP => NULL ()
  Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_R => NULL ()
  Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_PREHYDF => NULL ()
  Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_DELP => NULL ()
  Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_RDELP => NULL ()
  Z_YDMF_PHYS_BASE_STATE_YGSP_RR_T => NULL ()
  Z_YDMF_PHYS_OUT_DIFCQ => NULL ()
  Z_YDMF_PHYS_OUT_DIFCS => NULL ()
  Z_YDMF_PHYS_OUT_DIFTQ => NULL ()
  Z_YDMF_PHYS_OUT_DIFTS => NULL ()
  Z_YDMF_PHYS_OUT_FCCQL => NULL ()
  Z_YDMF_PHYS_OUT_FCCQN => NULL ()
  Z_YDMF_PHYS_OUT_FCSQL => NULL ()
  Z_YDMF_PHYS_OUT_FCSQN => NULL ()
  Z_YDMF_PHYS_OUT_FPEVPCL => NULL ()
  Z_YDMF_PHYS_OUT_FPEVPCN => NULL ()
  Z_YDMF_PHYS_OUT_FPEVPSL => NULL ()
  Z_YDMF_PHYS_OUT_FPEVPSN => NULL ()
  Z_YDMF_PHYS_OUT_FPFPCL => NULL ()
  Z_YDMF_PHYS_OUT_FPFPCN => NULL ()
  Z_YDMF_PHYS_OUT_FPFPSL => NULL ()
  Z_YDMF_PHYS_OUT_FPFPSN => NULL ()
  Z_YDMF_PHYS_OUT_FPLCL => NULL ()
  Z_YDMF_PHYS_OUT_FPLCN => NULL ()
  Z_YDMF_PHYS_OUT_FPLSL => NULL ()
  Z_YDMF_PHYS_OUT_FPLSN => NULL ()
  Z_YDMF_PHYS_SURF_GSD_VF_PLSM => NULL ()
  Z_YDVARS_GEOMETRY_GM_T0 => NULL ()
  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_PRECIPITATION_PARALLEL&
  &:ACUPTQ:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSE
    CALL ABOR1 ('APL_ARPEGE_PRECIPITATION_PARALLEL: NOT METHOD WAS FOUND')
ENDIF

IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_PRECIPITATION_PARALLEL:ACUPTQ',1,ZHOOK_HANDLE_PARALLEL)


CALL FXTRAN_ACDC_GPUMEMSTAT (__FILE__, __LINE__, "END")

IF (LHOOK) CALL DR_HOOK ('DELETE_TEMPORARIES',0,ZHOOK_HANDLE_FIELD_API)
IF (ASSOCIATED (YL_ZFRSO)) CALL FIELD_DELETE (YL_ZFRSO)
IF (ASSOCIATED (YL_ZFRTH)) CALL FIELD_DELETE (YL_ZFRTH)
IF (ASSOCIATED (YL_ZQMIC)) CALL FIELD_DELETE (YL_ZQMIC)
IF (ASSOCIATED (YL_ZTMIC)) CALL FIELD_DELETE (YL_ZTMIC)
IF (LHOOK) CALL DR_HOOK ('DELETE_TEMPORARIES',1,ZHOOK_HANDLE_FIELD_API)
IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_PRECIPITATION_PARALLEL', 1, ZHOOK_HANDLE)
END SUBROUTINE APL_ARPEGE_PRECIPITATION_PARALLEL
