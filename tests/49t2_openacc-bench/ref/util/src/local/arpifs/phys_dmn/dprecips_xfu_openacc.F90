SUBROUTINE DPRECIPS_XFU_OPENACC (KIDIA, KFDIA, KLON, KDTPREC&
&, KSTATS, PDPRECIPS, PXPTYPE, LDRESET, YDSTACK)
!$ACC ROUTINE (DPRECIPS_XFU_OPENACC) SEQ
USE PARKIND1,ONLY:JPIM, JPRB

#include "fxtran_acdc_stack.h"
USE FXTRAN_ACDC_STACK_MOD
USE FXTRAN_ACDC_ABORT_MOD

IMPLICIT NONE


INTEGER (KIND=JPIM), INTENT (IN)::KIDIA
INTEGER (KIND=JPIM), INTENT (IN)::KFDIA
INTEGER (KIND=JPIM), INTENT (IN)::KLON
INTEGER (KIND=JPIM), INTENT (IN)::KDTPREC
INTEGER (KIND=JPIM), INTENT (IN)::KSTATS
REAL (KIND=JPRB), INTENT (IN)::PDPRECIPS (KLON, KDTPREC)
REAL (KIND=JPRB), INTENT (INOUT)::PXPTYPE (KLON)
LOGICAL, INTENT (IN)::LDRESET
TYPE(FXTRAN_ACDC_STACK), INTENT (IN) :: YDSTACK
REAL (KIND=JPRB)::ZTYPE
INTEGER (KIND=JPIM)::INB 
INTEGER (KIND=JPIM)::JTYPE
INTEGER (KIND=JPIM)::JPREC
INTEGER (KIND=JPIM)::JLON
INTEGER (KIND=JPIM)::INDTOT 
INTEGER (KIND=JPIM)::IDPRECIPS (11)
INTEGER (KIND=JPIM)::ITYPE 
INTEGER (KIND=JPIM), PARAMETER::JPTYPES=11
INTEGER (KIND=JPIM), PARAMETER::INDPTYPE (JPTYPES)=(/11, 1, 7, 8, 9, 5, 6, 193, 10, 12, 3/)


JLON = KIDIA



IF (LDRESET) THEN
  PXPTYPE (JLON)=0._JPRB
ENDIF


DO JTYPE=1, JPTYPES
  ZTYPE=REAL (INDPTYPE (JTYPE), KIND=JPRB)
  IDPRECIPS (JTYPE)=0_JPIM

  DO JPREC=1, KDTPREC

    

    IF (PDPRECIPS (JLON, JPREC)==ZTYPE) THEN
      IDPRECIPS (JTYPE)=IDPRECIPS (JTYPE)+1_JPIM
    ENDIF

  
  ENDDO

ENDDO


INDTOT =SUM (IDPRECIPS (:))

INB =0
ITYPE =0_JPIM

IF (KSTATS==0) THEN

  DO JTYPE=1, JPTYPES

    

    IF (IDPRECIPS (JTYPE)>=INB ) THEN
      ITYPE =INDPTYPE (JTYPE)
      INB =IDPRECIPS (JTYPE)
    ENDIF

  
  ENDDO

ELSEIF (KSTATS==2) THEN

  DO JTYPE=1, JPTYPES

    

    IF (IDPRECIPS (JTYPE)>0_JPIM) THEN
      ITYPE =INDPTYPE (JTYPE)
    ENDIF

  
  ENDDO

ENDIF



IF (INDTOT <INT (REAL (KDTPREC, KIND=JPRB)/12._JPRB).AND.ITYPE /=10_JPIM) THEN
  ITYPE =0_JPIM
ENDIF


IF (INDTOT <INT (REAL (KDTPREC, KIND=JPRB)*5._JPRB/6._JPRB)) THEN

  IF (ITYPE ==1_JPIM)  THEN
    ITYPE =201_JPRB
  ENDIF


  IF (ITYPE ==7_JPIM)  THEN
    ITYPE =207_JPRB
  ENDIF


  IF (ITYPE ==6_JPIM)  THEN
    ITYPE =206_JPRB
  ENDIF


  IF (ITYPE ==5_JPIM)  THEN
    ITYPE =205_JPRB
  ENDIF


  IF (ITYPE ==193_JPIM)  THEN
    ITYPE =213_JPRB
  ENDIF


  IF (ITYPE ==11_JPIM)  THEN
    ITYPE =201_JPRB
  ENDIF

ENDIF

PXPTYPE (JLON)=REAL (ITYPE , KIND=JPRB)


END SUBROUTINE DPRECIPS_XFU_OPENACC
