SUBROUTINE APL_ARPEGE_SURFACE_UPDATE_PARALLEL (YDCPG_BNDS, YDCPG_OPTS, YDCPG_GPAR, YDMF_PHYS, YDMF_PHYS_SURF&
&, YDMODEL, LDCONFX, PDTPHY, YD_PDSA_C1, YD_PDSA_C2, YD_PFLU_FEVI, YD_PFLU_VEG)
USE YOMHOOK,ONLY:LHOOK, DR_HOOK, JPHOOK

USE CPG_OPTS_TYPE_MOD,ONLY:CPG_BNDS_TYPE, CPG_OPTS_TYPE
USE CPG_TYPE_MOD,ONLY:CPG_GPAR_TYPE
USE MF_PHYS_TYPE_MOD,ONLY:MF_PHYS_TYPE
USE MF_PHYS_SURFACE_TYPE_MOD,ONLY:MF_PHYS_SURF_TYPE
USE TYPE_MODEL,ONLY:MODEL
USE FIELD_MODULE
USE FIELD_FACTORY_MODULE
USE FIELD_ACCESS_MODULE
USE FXTRAN_ACDC_PARALLELMETHOD_MOD
USE FXTRAN_ACDC_STACK_MOD
USE PARKIND1
USE FXTRAN_ACDC_ARRAY_COPY_MOD
USE FXTRAN_ACDC_GPUMEM_MOD
#include "fxtran_acdc_stack.h"

IMPLICIT NONE


TYPE (CPG_BNDS_TYPE), INTENT (IN)::YDCPG_BNDS
TYPE (CPG_OPTS_TYPE), INTENT (IN)::YDCPG_OPTS
TYPE (CPG_GPAR_TYPE), INTENT (INOUT)::YDCPG_GPAR
TYPE (MF_PHYS_TYPE), INTENT (INOUT)::YDMF_PHYS
TYPE (MF_PHYS_SURF_TYPE), INTENT (INOUT)::YDMF_PHYS_SURF
TYPE (MODEL), INTENT (IN)::YDMODEL
LOGICAL, INTENT (IN)::LDCONFX
REAL (KIND=JPRB), INTENT (IN)::PDTPHY
CLASS (FIELD_2RB), POINTER :: YD_PDSA_C1
REAL (KIND=JPRB), POINTER::PDSA_C1 (:,:)
CLASS (FIELD_2RB), POINTER :: YD_PDSA_C2
REAL (KIND=JPRB), POINTER::PDSA_C2 (:,:)
CLASS (FIELD_3RB), POINTER :: YD_PFLU_FEVI
REAL (KIND=JPRB), POINTER::PFLU_FEVI (:,:,:)
CLASS (FIELD_2RB), POINTER :: YD_PFLU_VEG
REAL (KIND=JPRB), POINTER::PFLU_VEG (:,:)
#include "cptends.intfb.h"
#include "abor1.intfb.h"
#include "cptends_openacc.intfb.h"
#include "cpwts.intfb.h"
#include "cpwts_openacc.intfb.h"
CLASS (FIELD_3RB), POINTER :: YL_ZPFL_FPLSN
REAL (KIND=JPRB), POINTER::ZPFL_FPLSN (:,:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZTDS_TDALBNS
REAL (KIND=JPRB), POINTER::ZTDS_TDALBNS (:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZTDS_TDRHONS
REAL (KIND=JPRB), POINTER::ZTDS_TDRHONS (:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZTDS_TDSNS
REAL (KIND=JPRB), POINTER::ZTDS_TDSNS (:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZTDS_TDTP
REAL (KIND=JPRB), POINTER::ZTDS_TDTP (:,:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZTDS_TDTS
REAL (KIND=JPRB), POINTER::ZTDS_TDTS (:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZTDS_TDWL
REAL (KIND=JPRB), POINTER::ZTDS_TDWL (:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZTDS_TDWP
REAL (KIND=JPRB), POINTER::ZTDS_TDWP (:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZTDS_TDWPI
REAL (KIND=JPRB), POINTER::ZTDS_TDWPI (:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZTDS_TDWS
REAL (KIND=JPRB), POINTER::ZTDS_TDWS (:,:)
CLASS (FIELD_2RB), POINTER :: YL_ZTDS_TDWSI
REAL (KIND=JPRB), POINTER::ZTDS_TDWSI (:,:)
INTEGER (KIND=JPIM)::JLON
INTEGER (KIND=JPIM)::JLEV
REAL (KIND=JPHOOK)::ZHOOK_HANDLE
INTEGER(KIND=JPIM) :: JBLK
TYPE(CPG_BNDS_TYPE) :: YLCPG_BNDS
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_FIELD_API
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_PARALLEL
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_COMPUTE
TYPE(FXTRAN_ACDC_STACK) :: YLSTACK
TYPE(FXTRAN_ACDC_STACK) :: YLOFFSET
REAL (KIND=JPRB), POINTER :: Z_YDCPG_GPAR_VTS(:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_CT(:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FCHSP(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FCLL(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FCLN(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FCS(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FEVL(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FEVN(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FEVV(:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FGEL(:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FGELS(:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FLWSP(:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FONTE(:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FPLCL(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FPLCN(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FPLSG(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FPLSL(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FPLSN(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FRSO(:,:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FRTH(:,:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_FTR(:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_RUISL(:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_RUISP(:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_RUISS(:,:)
REAL(KIND=JPRB), POINTER :: Z_YDMF_PHYS_SURF_GSD_VF_PLSM(:,:)
REAL(KIND=JPRB), POINTER :: Z_YDMF_PHYS_SURF_GSD_VP_PTPC(:,:)
REAL(KIND=JPRB), POINTER :: Z_YDMF_PHYS_SURF_GSD_VP_PWPC(:,:)
REAL(KIND=JPRB), POINTER :: Z_YDMF_PHYS_SURF_GSD_VV_PIVEG(:,:)
REAL(KIND=JPRB), POINTER :: Z_YDMF_PHYS_SURF_GSP_RR_PFC_T1(:,:)
REAL(KIND=JPRB), POINTER :: Z_YDMF_PHYS_SURF_GSP_RR_PIC_T1(:,:)
REAL(KIND=JPRB), POINTER :: Z_YDMF_PHYS_SURF_GSP_RR_PT_T0(:,:)
REAL(KIND=JPRB), POINTER :: Z_YDMF_PHYS_SURF_GSP_RR_PT_T1(:,:)
REAL(KIND=JPRB), POINTER :: Z_YDMF_PHYS_SURF_GSP_RR_PW_T1(:,:)
REAL(KIND=JPRB), POINTER :: Z_YDMF_PHYS_SURF_GSP_SB_PQ_T1(:,:,:)
REAL(KIND=JPRB), POINTER :: Z_YDMF_PHYS_SURF_GSP_SB_PTL_T1(:,:,:)
REAL(KIND=JPRB), POINTER :: Z_YDMF_PHYS_SURF_GSP_SB_PT_T1(:,:,:)
REAL(KIND=JPRB), POINTER :: Z_YDMF_PHYS_SURF_GSP_SG_PA_T1(:,:,:)
REAL(KIND=JPRB), POINTER :: Z_YDMF_PHYS_SURF_GSP_SG_PF_T1(:,:,:)
REAL(KIND=JPRB), POINTER :: Z_YDMF_PHYS_SURF_GSP_SG_PR_T1(:,:,:)
IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL', 0, ZHOOK_HANDLE)

CALL FXTRAN_ACDC_GPUMEMSTAT (__FILE__, __LINE__, "BEGIN")


IF (LHOOK) CALL DR_HOOK ('CREATE_TEMPORARIES',0,ZHOOK_HANDLE_FIELD_API)
CALL FIELD_NEW (YL_ZTDS_TDWSI, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZTDS_TDWS, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZTDS_TDWPI, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZTDS_TDWP, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZTDS_TDWL, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZTDS_TDTS, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZTDS_TDTP, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%YRSURF_DIMS%YSP_SBD&
&%NLEVS, YDCPG_OPTS%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZTDS_TDSNS, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZTDS_TDRHONS, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZTDS_TDALBNS, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZPFL_FPLSN, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 0, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
IF (LHOOK) CALL DR_HOOK ('CREATE_TEMPORARIES',1,ZHOOK_HANDLE_FIELD_API)



IF (.NOT.YDMODEL%YRML_PHY_MF%YRARPHY%LMSE) THEN
  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL:LMSE_F',0,ZHOOK_HANDLE_PARALLEL)

  IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','APL_ARPEGE_SURFACE_UPDATE_PARALLEL:LMSE_F')) THEN
    
    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL&
    &:LMSE_F:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
    PDSA_C1 => GET_HOST_DATA_RDONLY (YD_PDSA_C1)
    PDSA_C2 => GET_HOST_DATA_RDONLY (YD_PDSA_C2)
    PFLU_FEVI => GET_HOST_DATA_RDONLY (YD_PFLU_FEVI)
    PFLU_VEG => GET_HOST_DATA_RDONLY (YD_PFLU_VEG)
    ZPFL_FPLSN => GET_HOST_DATA_RDWR (YL_ZPFL_FPLSN)
    ZTDS_TDALBNS => GET_HOST_DATA_RDWR (YL_ZTDS_TDALBNS)
    ZTDS_TDRHONS => GET_HOST_DATA_RDWR (YL_ZTDS_TDRHONS)
    ZTDS_TDSNS => GET_HOST_DATA_RDWR (YL_ZTDS_TDSNS)
    ZTDS_TDTP => GET_HOST_DATA_RDWR (YL_ZTDS_TDTP)
    ZTDS_TDTS => GET_HOST_DATA_RDWR (YL_ZTDS_TDTS)
    ZTDS_TDWL => GET_HOST_DATA_RDWR (YL_ZTDS_TDWL)
    ZTDS_TDWP => GET_HOST_DATA_RDWR (YL_ZTDS_TDWP)
    ZTDS_TDWPI => GET_HOST_DATA_RDWR (YL_ZTDS_TDWPI)
    ZTDS_TDWS => GET_HOST_DATA_RDWR (YL_ZTDS_TDWS)
    ZTDS_TDWSI => GET_HOST_DATA_RDWR (YL_ZTDS_TDWSI)
    Z_YDMF_PHYS_OUT_CT => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_CT)
    Z_YDMF_PHYS_OUT_FCHSP => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FCHSP)
    Z_YDMF_PHYS_OUT_FCLL => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FCLL)
    Z_YDMF_PHYS_OUT_FCLN => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FCLN)
    Z_YDMF_PHYS_OUT_FCS => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FCS)
    Z_YDMF_PHYS_OUT_FEVL => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FEVL)
    Z_YDMF_PHYS_OUT_FEVN => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FEVN)
    Z_YDMF_PHYS_OUT_FEVV => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FEVV)
    Z_YDMF_PHYS_OUT_FGEL => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FGEL)
    Z_YDMF_PHYS_OUT_FGELS => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FGELS)
    Z_YDMF_PHYS_OUT_FLWSP => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FLWSP)
    Z_YDMF_PHYS_OUT_FONTE => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FONTE)
    Z_YDMF_PHYS_OUT_FPLCL => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FPLCL)
    Z_YDMF_PHYS_OUT_FPLCN => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FPLCN)
    Z_YDMF_PHYS_OUT_FPLSG => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FPLSG)
    Z_YDMF_PHYS_OUT_FPLSL => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FPLSL)
    Z_YDMF_PHYS_OUT_FPLSN => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FPLSN)
    Z_YDMF_PHYS_OUT_FRSO => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FRSO)
    Z_YDMF_PHYS_OUT_FRTH => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FRTH)
    Z_YDMF_PHYS_OUT_FTR => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FTR)
    Z_YDMF_PHYS_OUT_RUISL => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_RUISL)
    Z_YDMF_PHYS_OUT_RUISP => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_RUISP)
    Z_YDMF_PHYS_OUT_RUISS => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_RUISS)
    Z_YDMF_PHYS_SURF_GSD_VF_PLSM => GET_HOST_DATA_RDONLY (YDMF_PHYS_SURF%GSD_VF%F_LSM)
    Z_YDMF_PHYS_SURF_GSD_VP_PTPC => GET_HOST_DATA_RDONLY (YDMF_PHYS_SURF%GSD_VP%F_TPC)
    Z_YDMF_PHYS_SURF_GSD_VP_PWPC => GET_HOST_DATA_RDONLY (YDMF_PHYS_SURF%GSD_VP%F_WPC)
    Z_YDMF_PHYS_SURF_GSD_VV_PIVEG => GET_HOST_DATA_RDONLY (YDMF_PHYS_SURF%GSD_VV%F_IVEG)
    Z_YDMF_PHYS_SURF_GSP_RR_PFC_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_RR%F_FC_T1)
    Z_YDMF_PHYS_SURF_GSP_RR_PIC_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_RR%F_IC_T1)
    Z_YDMF_PHYS_SURF_GSP_RR_PT_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_RR%F_T_T1)
    Z_YDMF_PHYS_SURF_GSP_RR_PW_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_RR%F_W_T1)
    Z_YDMF_PHYS_SURF_GSP_SB_PQ_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_SB%F_Q_T1)
    Z_YDMF_PHYS_SURF_GSP_SB_PTL_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_SB%F_TL_T1)
    Z_YDMF_PHYS_SURF_GSP_SB_PT_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_SB%F_T_T1)
    Z_YDMF_PHYS_SURF_GSP_SG_PA_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_SG%F_A_T1)
    Z_YDMF_PHYS_SURF_GSP_SG_PF_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_SG%F_F_T1)
    Z_YDMF_PHYS_SURF_GSP_SG_PR_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_SG%F_R_T1)
    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL&
    &:LMSE_F:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL:LMSE_F:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
    
    CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
    !$OMP PARALLEL DO PRIVATE (JBLK, JLEV, JLON) FIRSTPRIVATE (YLCPG_BNDS)

    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
      CALL YLCPG_BNDS%UPDATE (JBLK)

      

      DO JLEV=0, YDCPG_OPTS%KFLEVG

        DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
          ZPFL_FPLSN (JLON, JLEV, JBLK)=Z_YDMF_PHYS_OUT_FPLSN (JLON&
          &, JLEV, JBLK)+Z_YDMF_PHYS_OUT_FPLSG (JLON, JLEV, JBLK)
        ENDDO

      ENDDO

      CALL CPTENDS (YDMODEL%YRCST, YDMODEL%YRML_PHY_MF, YDCPG_OPTS%KLON, YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA&
      &, YDCPG_OPTS%KFLEVG, YDCPG_OPTS%YRSURF_DIMS%YSP_SBD%NLEVS, PDTPHY, Z_YDMF_PHYS_OUT_FPLCL(:,:, JBLK&
      &), Z_YDMF_PHYS_OUT_FPLSL(:,:, JBLK), Z_YDMF_PHYS_OUT_FPLCN(:,:, JBLK), ZPFL_FPLSN(:,:, JBLK), Z_YDMF_PHYS_OUT_FRSO&
      &(:,:,:, JBLK), Z_YDMF_PHYS_OUT_FRTH(:,:,:, JBLK), Z_YDMF_PHYS_SURF_GSP_SG_PA_T1 (:, 1, JBLK), Z_YDMF_PHYS_OUT_CT&
      &(:, JBLK), PDSA_C1(:, JBLK), PDSA_C2(:, JBLK), Z_YDMF_PHYS_OUT_FCHSP(:,:, JBLK), Z_YDMF_PHYS_OUT_FCLL&
      & (:, 1, JBLK), Z_YDMF_PHYS_OUT_FCLN (:, 1, JBLK), Z_YDMF_PHYS_OUT_FCS (:, 1, JBLK), PFLU_FEVI (:,&
      & 1, JBLK), Z_YDMF_PHYS_OUT_FEVL (:, 1, JBLK), Z_YDMF_PHYS_OUT_FEVN (:, 1, JBLK), Z_YDMF_PHYS_OUT_FEVV&
      &(:, JBLK), Z_YDMF_PHYS_OUT_FGEL(:, JBLK), Z_YDMF_PHYS_OUT_FGELS(:, JBLK), Z_YDMF_PHYS_OUT_FLWSP(:&
      &, JBLK), Z_YDMF_PHYS_OUT_FONTE(:, JBLK), Z_YDMF_PHYS_OUT_FTR(:, JBLK), Z_YDMF_PHYS_SURF_GSD_VF_PLSM&
      &(:, JBLK), Z_YDMF_PHYS_SURF_GSP_SG_PR_T1 (:, 1, JBLK), Z_YDMF_PHYS_OUT_RUISL(:, JBLK), Z_YDMF_PHYS_OUT_RUISP&
      &(:, JBLK), Z_YDMF_PHYS_OUT_RUISS(:, JBLK), Z_YDMF_PHYS_SURF_GSP_SG_PF_T1 (:, 1, JBLK), PFLU_VEG(:&
      &, JBLK), ZTDS_TDTS(:, JBLK), ZTDS_TDTP(:,:, JBLK), ZTDS_TDWS(:, JBLK), ZTDS_TDWSI(:, JBLK), ZTDS_TDWP&
      &(:, JBLK), ZTDS_TDWPI(:, JBLK), ZTDS_TDWL(:, JBLK), ZTDS_TDSNS(:, JBLK), ZTDS_TDALBNS(:, JBLK), ZTDS_TDRHONS&
      &(:, JBLK))
      CALL CPWTS (YDMODEL%YRCST, YDCPG_OPTS, YDMODEL%YRML_AOC%YRMCC, YDMODEL%YRML_PHY_MF%YRPHY, YDMODEL&
      &%YRML_PHY_MF%YRPHY1, YDCPG_OPTS%KLON, YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA, YDCPG_OPTS%YRSURF_DIMS&
      &%YSP_SBD%NLEVS, PDTPHY, ZTDS_TDTS(:, JBLK), ZTDS_TDTP(:,:, JBLK), ZTDS_TDWS(:, JBLK), ZTDS_TDWSI&
      &(:, JBLK), ZTDS_TDWP(:, JBLK), ZTDS_TDWPI(:, JBLK), ZTDS_TDWL(:, JBLK), ZTDS_TDSNS(:, JBLK),&
      & ZTDS_TDALBNS(:, JBLK), ZTDS_TDRHONS(:, JBLK), Z_YDMF_PHYS_SURF_GSD_VP_PTPC(:, JBLK), Z_YDMF_PHYS_SURF_GSD_VP_PWPC&
      &(:, JBLK), Z_YDMF_PHYS_SURF_GSD_VF_PLSM(:, JBLK), Z_YDMF_PHYS_SURF_GSD_VV_PIVEG(:, JBLK), Z_YDMF_PHYS_SURF_GSP_RR_PT_T1&
      &(:, JBLK), Z_YDMF_PHYS_SURF_GSP_SB_PT_T1(:,:, JBLK), Z_YDMF_PHYS_SURF_GSP_RR_PW_T1(:, JBLK),&
      & Z_YDMF_PHYS_SURF_GSP_RR_PIC_T1(:, JBLK), Z_YDMF_PHYS_SURF_GSP_SB_PQ_T1 (:, 1, JBLK), Z_YDMF_PHYS_SURF_GSP_SB_PTL_T1&
      & (:, 1, JBLK), Z_YDMF_PHYS_SURF_GSP_RR_PFC_T1(:, JBLK), Z_YDMF_PHYS_SURF_GSP_SG_PF_T1 (:, 1,&
      & JBLK), Z_YDMF_PHYS_SURF_GSP_SG_PA_T1 (:, 1, JBLK), Z_YDMF_PHYS_SURF_GSP_SG_PR_T1 (:, 1, JBLK&
      &))
    ENDDO

    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL:LMSE_F:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

    IF (FXTRAN_ACDC_LSYNCHOST ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL:LMSE_F')) THEN
      IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL&
      &:LMSE_F:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
      PDSA_C1 => GET_HOST_DATA_RDWR (YD_PDSA_C1)
      PDSA_C2 => GET_HOST_DATA_RDWR (YD_PDSA_C2)
      PFLU_FEVI => GET_HOST_DATA_RDWR (YD_PFLU_FEVI)
      PFLU_VEG => GET_HOST_DATA_RDWR (YD_PFLU_VEG)
      ZPFL_FPLSN => GET_HOST_DATA_RDWR (YL_ZPFL_FPLSN)
      ZTDS_TDALBNS => GET_HOST_DATA_RDWR (YL_ZTDS_TDALBNS)
      ZTDS_TDRHONS => GET_HOST_DATA_RDWR (YL_ZTDS_TDRHONS)
      ZTDS_TDSNS => GET_HOST_DATA_RDWR (YL_ZTDS_TDSNS)
      ZTDS_TDTP => GET_HOST_DATA_RDWR (YL_ZTDS_TDTP)
      ZTDS_TDTS => GET_HOST_DATA_RDWR (YL_ZTDS_TDTS)
      ZTDS_TDWL => GET_HOST_DATA_RDWR (YL_ZTDS_TDWL)
      ZTDS_TDWP => GET_HOST_DATA_RDWR (YL_ZTDS_TDWP)
      ZTDS_TDWPI => GET_HOST_DATA_RDWR (YL_ZTDS_TDWPI)
      ZTDS_TDWS => GET_HOST_DATA_RDWR (YL_ZTDS_TDWS)
      ZTDS_TDWSI => GET_HOST_DATA_RDWR (YL_ZTDS_TDWSI)
      Z_YDMF_PHYS_OUT_CT => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_CT)
      Z_YDMF_PHYS_OUT_FCHSP => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FCHSP)
      Z_YDMF_PHYS_OUT_FCLL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FCLL)
      Z_YDMF_PHYS_OUT_FCLN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FCLN)
      Z_YDMF_PHYS_OUT_FCS => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FCS)
      Z_YDMF_PHYS_OUT_FEVL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FEVL)
      Z_YDMF_PHYS_OUT_FEVN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FEVN)
      Z_YDMF_PHYS_OUT_FEVV => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FEVV)
      Z_YDMF_PHYS_OUT_FGEL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FGEL)
      Z_YDMF_PHYS_OUT_FGELS => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FGELS)
      Z_YDMF_PHYS_OUT_FLWSP => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FLWSP)
      Z_YDMF_PHYS_OUT_FONTE => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FONTE)
      Z_YDMF_PHYS_OUT_FPLCL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLCL)
      Z_YDMF_PHYS_OUT_FPLCN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLCN)
      Z_YDMF_PHYS_OUT_FPLSG => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLSG)
      Z_YDMF_PHYS_OUT_FPLSL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLSL)
      Z_YDMF_PHYS_OUT_FPLSN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLSN)
      Z_YDMF_PHYS_OUT_FRSO => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FRSO)
      Z_YDMF_PHYS_OUT_FRTH => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FRTH)
      Z_YDMF_PHYS_OUT_FTR => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FTR)
      Z_YDMF_PHYS_OUT_RUISL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_RUISL)
      Z_YDMF_PHYS_OUT_RUISP => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_RUISP)
      Z_YDMF_PHYS_OUT_RUISS => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_RUISS)
      Z_YDMF_PHYS_SURF_GSD_VF_PLSM => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSD_VF%F_LSM)
      Z_YDMF_PHYS_SURF_GSD_VP_PTPC => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSD_VP%F_TPC)
      Z_YDMF_PHYS_SURF_GSD_VP_PWPC => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSD_VP%F_WPC)
      Z_YDMF_PHYS_SURF_GSD_VV_PIVEG => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSD_VV%F_IVEG)
      Z_YDMF_PHYS_SURF_GSP_RR_PFC_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_RR%F_FC_T1)
      Z_YDMF_PHYS_SURF_GSP_RR_PIC_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_RR%F_IC_T1)
      Z_YDMF_PHYS_SURF_GSP_RR_PT_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_RR%F_T_T1)
      Z_YDMF_PHYS_SURF_GSP_RR_PW_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_RR%F_W_T1)
      Z_YDMF_PHYS_SURF_GSP_SB_PQ_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_SB%F_Q_T1)
      Z_YDMF_PHYS_SURF_GSP_SB_PTL_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_SB%F_TL_T1)
      Z_YDMF_PHYS_SURF_GSP_SB_PT_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_SB%F_T_T1)
      Z_YDMF_PHYS_SURF_GSP_SG_PA_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_SG%F_A_T1)
      Z_YDMF_PHYS_SURF_GSP_SG_PF_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_SG%F_F_T1)
      Z_YDMF_PHYS_SURF_GSP_SG_PR_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_SG%F_R_T1)
      IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL&
      &:LMSE_F:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
      
      
    ENDIF

    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL&
    &:LMSE_F:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
    PDSA_C1 => NULL ()
    PDSA_C2 => NULL ()
    PFLU_FEVI => NULL ()
    PFLU_VEG => NULL ()
    ZPFL_FPLSN => NULL ()
    ZTDS_TDALBNS => NULL ()
    ZTDS_TDRHONS => NULL ()
    ZTDS_TDSNS => NULL ()
    ZTDS_TDTP => NULL ()
    ZTDS_TDTS => NULL ()
    ZTDS_TDWL => NULL ()
    ZTDS_TDWP => NULL ()
    ZTDS_TDWPI => NULL ()
    ZTDS_TDWS => NULL ()
    ZTDS_TDWSI => NULL ()
    Z_YDMF_PHYS_OUT_CT => NULL ()
    Z_YDMF_PHYS_OUT_FCHSP => NULL ()
    Z_YDMF_PHYS_OUT_FCLL => NULL ()
    Z_YDMF_PHYS_OUT_FCLN => NULL ()
    Z_YDMF_PHYS_OUT_FCS => NULL ()
    Z_YDMF_PHYS_OUT_FEVL => NULL ()
    Z_YDMF_PHYS_OUT_FEVN => NULL ()
    Z_YDMF_PHYS_OUT_FEVV => NULL ()
    Z_YDMF_PHYS_OUT_FGEL => NULL ()
    Z_YDMF_PHYS_OUT_FGELS => NULL ()
    Z_YDMF_PHYS_OUT_FLWSP => NULL ()
    Z_YDMF_PHYS_OUT_FONTE => NULL ()
    Z_YDMF_PHYS_OUT_FPLCL => NULL ()
    Z_YDMF_PHYS_OUT_FPLCN => NULL ()
    Z_YDMF_PHYS_OUT_FPLSG => NULL ()
    Z_YDMF_PHYS_OUT_FPLSL => NULL ()
    Z_YDMF_PHYS_OUT_FPLSN => NULL ()
    Z_YDMF_PHYS_OUT_FRSO => NULL ()
    Z_YDMF_PHYS_OUT_FRTH => NULL ()
    Z_YDMF_PHYS_OUT_FTR => NULL ()
    Z_YDMF_PHYS_OUT_RUISL => NULL ()
    Z_YDMF_PHYS_OUT_RUISP => NULL ()
    Z_YDMF_PHYS_OUT_RUISS => NULL ()
    Z_YDMF_PHYS_SURF_GSD_VF_PLSM => NULL ()
    Z_YDMF_PHYS_SURF_GSD_VP_PTPC => NULL ()
    Z_YDMF_PHYS_SURF_GSD_VP_PWPC => NULL ()
    Z_YDMF_PHYS_SURF_GSD_VV_PIVEG => NULL ()
    Z_YDMF_PHYS_SURF_GSP_RR_PFC_T1 => NULL ()
    Z_YDMF_PHYS_SURF_GSP_RR_PIC_T1 => NULL ()
    Z_YDMF_PHYS_SURF_GSP_RR_PT_T1 => NULL ()
    Z_YDMF_PHYS_SURF_GSP_RR_PW_T1 => NULL ()
    Z_YDMF_PHYS_SURF_GSP_SB_PQ_T1 => NULL ()
    Z_YDMF_PHYS_SURF_GSP_SB_PTL_T1 => NULL ()
    Z_YDMF_PHYS_SURF_GSP_SB_PT_T1 => NULL ()
    Z_YDMF_PHYS_SURF_GSP_SG_PA_T1 => NULL ()
    Z_YDMF_PHYS_SURF_GSP_SG_PF_T1 => NULL ()
    Z_YDMF_PHYS_SURF_GSP_SG_PR_T1 => NULL ()
    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL&
    &:LMSE_F:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMPSINGLECOLUMN&
    &','APL_ARPEGE_SURFACE_UPDATE_PARALLEL:LMSE_F')) THEN
    
    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL&
    &:LMSE_F:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
    PDSA_C1 => GET_HOST_DATA_RDONLY (YD_PDSA_C1)
    PDSA_C2 => GET_HOST_DATA_RDONLY (YD_PDSA_C2)
    PFLU_FEVI => GET_HOST_DATA_RDONLY (YD_PFLU_FEVI)
    PFLU_VEG => GET_HOST_DATA_RDONLY (YD_PFLU_VEG)
    ZPFL_FPLSN => GET_HOST_DATA_RDWR (YL_ZPFL_FPLSN)
    ZTDS_TDALBNS => GET_HOST_DATA_RDWR (YL_ZTDS_TDALBNS)
    ZTDS_TDRHONS => GET_HOST_DATA_RDWR (YL_ZTDS_TDRHONS)
    ZTDS_TDSNS => GET_HOST_DATA_RDWR (YL_ZTDS_TDSNS)
    ZTDS_TDTP => GET_HOST_DATA_RDWR (YL_ZTDS_TDTP)
    ZTDS_TDTS => GET_HOST_DATA_RDWR (YL_ZTDS_TDTS)
    ZTDS_TDWL => GET_HOST_DATA_RDWR (YL_ZTDS_TDWL)
    ZTDS_TDWP => GET_HOST_DATA_RDWR (YL_ZTDS_TDWP)
    ZTDS_TDWPI => GET_HOST_DATA_RDWR (YL_ZTDS_TDWPI)
    ZTDS_TDWS => GET_HOST_DATA_RDWR (YL_ZTDS_TDWS)
    ZTDS_TDWSI => GET_HOST_DATA_RDWR (YL_ZTDS_TDWSI)
    Z_YDMF_PHYS_OUT_CT => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_CT)
    Z_YDMF_PHYS_OUT_FCHSP => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FCHSP)
    Z_YDMF_PHYS_OUT_FCLL => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FCLL)
    Z_YDMF_PHYS_OUT_FCLN => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FCLN)
    Z_YDMF_PHYS_OUT_FCS => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FCS)
    Z_YDMF_PHYS_OUT_FEVL => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FEVL)
    Z_YDMF_PHYS_OUT_FEVN => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FEVN)
    Z_YDMF_PHYS_OUT_FEVV => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FEVV)
    Z_YDMF_PHYS_OUT_FGEL => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FGEL)
    Z_YDMF_PHYS_OUT_FGELS => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FGELS)
    Z_YDMF_PHYS_OUT_FLWSP => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FLWSP)
    Z_YDMF_PHYS_OUT_FONTE => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FONTE)
    Z_YDMF_PHYS_OUT_FPLCL => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FPLCL)
    Z_YDMF_PHYS_OUT_FPLCN => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FPLCN)
    Z_YDMF_PHYS_OUT_FPLSG => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FPLSG)
    Z_YDMF_PHYS_OUT_FPLSL => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FPLSL)
    Z_YDMF_PHYS_OUT_FPLSN => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FPLSN)
    Z_YDMF_PHYS_OUT_FRSO => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FRSO)
    Z_YDMF_PHYS_OUT_FRTH => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FRTH)
    Z_YDMF_PHYS_OUT_FTR => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_FTR)
    Z_YDMF_PHYS_OUT_RUISL => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_RUISL)
    Z_YDMF_PHYS_OUT_RUISP => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_RUISP)
    Z_YDMF_PHYS_OUT_RUISS => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_RUISS)
    Z_YDMF_PHYS_SURF_GSD_VF_PLSM => GET_HOST_DATA_RDONLY (YDMF_PHYS_SURF%GSD_VF%F_LSM)
    Z_YDMF_PHYS_SURF_GSD_VP_PTPC => GET_HOST_DATA_RDONLY (YDMF_PHYS_SURF%GSD_VP%F_TPC)
    Z_YDMF_PHYS_SURF_GSD_VP_PWPC => GET_HOST_DATA_RDONLY (YDMF_PHYS_SURF%GSD_VP%F_WPC)
    Z_YDMF_PHYS_SURF_GSD_VV_PIVEG => GET_HOST_DATA_RDONLY (YDMF_PHYS_SURF%GSD_VV%F_IVEG)
    Z_YDMF_PHYS_SURF_GSP_RR_PFC_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_RR%F_FC_T1)
    Z_YDMF_PHYS_SURF_GSP_RR_PIC_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_RR%F_IC_T1)
    Z_YDMF_PHYS_SURF_GSP_RR_PT_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_RR%F_T_T1)
    Z_YDMF_PHYS_SURF_GSP_RR_PW_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_RR%F_W_T1)
    Z_YDMF_PHYS_SURF_GSP_SB_PQ_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_SB%F_Q_T1)
    Z_YDMF_PHYS_SURF_GSP_SB_PTL_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_SB%F_TL_T1)
    Z_YDMF_PHYS_SURF_GSP_SB_PT_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_SB%F_T_T1)
    Z_YDMF_PHYS_SURF_GSP_SG_PA_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_SG%F_A_T1)
    Z_YDMF_PHYS_SURF_GSP_SG_PF_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_SG%F_F_T1)
    Z_YDMF_PHYS_SURF_GSP_SG_PR_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_SG%F_R_T1)
    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL&
    &:LMSE_F:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL:LMSE_F:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
    
    !$OMP PARALLEL DO PRIVATE (JBLK, JLEV, JLON, YLCPG_BNDS, YLSTACK)

    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX

      

      

      DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
        YLCPG_BNDS%KIDIA = JLON
        YLCPG_BNDS%KFDIA = JLON
        YLSTACK%L8 = fxtran_acdc_stack_l8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
        YLSTACK%U8 = fxtran_acdc_stack_u8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
        YLSTACK%L4 = fxtran_acdc_stack_l4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
        YLSTACK%U4 = fxtran_acdc_stack_u4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)

        

        DO JLEV=0, YDCPG_OPTS%KFLEVG
          
          ZPFL_FPLSN (JLON, JLEV, JBLK)=Z_YDMF_PHYS_OUT_FPLSN (JLON&
          &, JLEV, JBLK)+Z_YDMF_PHYS_OUT_FPLSG (JLON, JLEV, JBLK)
        
        ENDDO

        CALL CPTENDS_OPENACC (YDMODEL%YRCST, YDMODEL%YRML_PHY_MF, YDCPG_OPTS%KLON, YLCPG_BNDS%KIDIA, YLCPG_BNDS&
        &%KFDIA, YDCPG_OPTS%KFLEVG, YDCPG_OPTS%YRSURF_DIMS%YSP_SBD%NLEVS, PDTPHY, Z_YDMF_PHYS_OUT_FPLCL(:,:&
        &, JBLK), Z_YDMF_PHYS_OUT_FPLSL(:,:, JBLK), Z_YDMF_PHYS_OUT_FPLCN(:,:, JBLK), ZPFL_FPLSN(:,:, JBLK)&
        &, Z_YDMF_PHYS_OUT_FRSO(:,:,:, JBLK), Z_YDMF_PHYS_OUT_FRTH(:,:,:, JBLK), Z_YDMF_PHYS_SURF_GSP_SG_PA_T1&
        & (:, 1, JBLK), Z_YDMF_PHYS_OUT_CT(:, JBLK), PDSA_C1(:, JBLK), PDSA_C2(:, JBLK), Z_YDMF_PHYS_OUT_FCHSP&
        &(:,:, JBLK), Z_YDMF_PHYS_OUT_FCLL (:, 1, JBLK), Z_YDMF_PHYS_OUT_FCLN (:, 1, JBLK), Z_YDMF_PHYS_OUT_FCS&
        & (:, 1, JBLK), PFLU_FEVI (:, 1, JBLK), Z_YDMF_PHYS_OUT_FEVL (:, 1, JBLK), Z_YDMF_PHYS_OUT_FEVN (:,&
        & 1, JBLK), Z_YDMF_PHYS_OUT_FEVV(:, JBLK), Z_YDMF_PHYS_OUT_FGEL(:, JBLK), Z_YDMF_PHYS_OUT_FGELS(:, JBLK&
        &), Z_YDMF_PHYS_OUT_FLWSP(:, JBLK), Z_YDMF_PHYS_OUT_FONTE(:, JBLK), Z_YDMF_PHYS_OUT_FTR(:, JBLK), Z_YDMF_PHYS_SURF_GSD_VF_PLSM&
        &(:, JBLK), Z_YDMF_PHYS_SURF_GSP_SG_PR_T1 (:, 1, JBLK), Z_YDMF_PHYS_OUT_RUISL(:, JBLK), Z_YDMF_PHYS_OUT_RUISP&
        &(:, JBLK), Z_YDMF_PHYS_OUT_RUISS(:, JBLK), Z_YDMF_PHYS_SURF_GSP_SG_PF_T1 (:, 1, JBLK), PFLU_VEG(:,&
        & JBLK), ZTDS_TDTS(:, JBLK), ZTDS_TDTP(:,:, JBLK), ZTDS_TDWS(:, JBLK), ZTDS_TDWSI(:, JBLK), ZTDS_TDWP&
        &(:, JBLK), ZTDS_TDWPI(:, JBLK), ZTDS_TDWL(:, JBLK), ZTDS_TDSNS(:, JBLK), ZTDS_TDALBNS(:, JBLK), ZTDS_TDRHONS&
        &(:, JBLK),YDSTACK=YLSTACK)
        CALL CPWTS_OPENACC (YDMODEL%YRCST, YDCPG_OPTS, YDMODEL%YRML_AOC%YRMCC, YDMODEL%YRML_PHY_MF%YRPHY&
        &, YDMODEL%YRML_PHY_MF%YRPHY1, YDCPG_OPTS%KLON, YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA, YDCPG_OPTS%YRSURF_DIMS&
        &%YSP_SBD%NLEVS, PDTPHY, ZTDS_TDTS(:, JBLK), ZTDS_TDTP(:,:, JBLK), ZTDS_TDWS(:, JBLK), ZTDS_TDWSI&
        &(:, JBLK), ZTDS_TDWP(:, JBLK), ZTDS_TDWPI(:, JBLK), ZTDS_TDWL(:, JBLK), ZTDS_TDSNS(:, JBLK), ZTDS_TDALBNS&
        &(:, JBLK), ZTDS_TDRHONS(:, JBLK), Z_YDMF_PHYS_SURF_GSD_VP_PTPC(:, JBLK), Z_YDMF_PHYS_SURF_GSD_VP_PWPC&
        &(:, JBLK), Z_YDMF_PHYS_SURF_GSD_VF_PLSM(:, JBLK), Z_YDMF_PHYS_SURF_GSD_VV_PIVEG(:, JBLK), Z_YDMF_PHYS_SURF_GSP_RR_PT_T1&
        &(:, JBLK), Z_YDMF_PHYS_SURF_GSP_SB_PT_T1(:,:, JBLK), Z_YDMF_PHYS_SURF_GSP_RR_PW_T1(:, JBLK), Z_YDMF_PHYS_SURF_GSP_RR_PIC_T1&
        &(:, JBLK), Z_YDMF_PHYS_SURF_GSP_SB_PQ_T1 (:, 1, JBLK), Z_YDMF_PHYS_SURF_GSP_SB_PTL_T1 (:, 1, JBLK&
        &), Z_YDMF_PHYS_SURF_GSP_RR_PFC_T1(:, JBLK), Z_YDMF_PHYS_SURF_GSP_SG_PF_T1 (:, 1, JBLK), Z_YDMF_PHYS_SURF_GSP_SG_PA_T1&
        & (:, 1, JBLK), Z_YDMF_PHYS_SURF_GSP_SG_PR_T1 (:, 1, JBLK),YDSTACK=YLSTACK)
      ENDDO

    ENDDO

    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL:LMSE_F:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

    IF (FXTRAN_ACDC_LSYNCHOST ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL:LMSE_F')) THEN
      IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL&
      &:LMSE_F:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
      PDSA_C1 => GET_HOST_DATA_RDWR (YD_PDSA_C1)
      PDSA_C2 => GET_HOST_DATA_RDWR (YD_PDSA_C2)
      PFLU_FEVI => GET_HOST_DATA_RDWR (YD_PFLU_FEVI)
      PFLU_VEG => GET_HOST_DATA_RDWR (YD_PFLU_VEG)
      ZPFL_FPLSN => GET_HOST_DATA_RDWR (YL_ZPFL_FPLSN)
      ZTDS_TDALBNS => GET_HOST_DATA_RDWR (YL_ZTDS_TDALBNS)
      ZTDS_TDRHONS => GET_HOST_DATA_RDWR (YL_ZTDS_TDRHONS)
      ZTDS_TDSNS => GET_HOST_DATA_RDWR (YL_ZTDS_TDSNS)
      ZTDS_TDTP => GET_HOST_DATA_RDWR (YL_ZTDS_TDTP)
      ZTDS_TDTS => GET_HOST_DATA_RDWR (YL_ZTDS_TDTS)
      ZTDS_TDWL => GET_HOST_DATA_RDWR (YL_ZTDS_TDWL)
      ZTDS_TDWP => GET_HOST_DATA_RDWR (YL_ZTDS_TDWP)
      ZTDS_TDWPI => GET_HOST_DATA_RDWR (YL_ZTDS_TDWPI)
      ZTDS_TDWS => GET_HOST_DATA_RDWR (YL_ZTDS_TDWS)
      ZTDS_TDWSI => GET_HOST_DATA_RDWR (YL_ZTDS_TDWSI)
      Z_YDMF_PHYS_OUT_CT => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_CT)
      Z_YDMF_PHYS_OUT_FCHSP => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FCHSP)
      Z_YDMF_PHYS_OUT_FCLL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FCLL)
      Z_YDMF_PHYS_OUT_FCLN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FCLN)
      Z_YDMF_PHYS_OUT_FCS => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FCS)
      Z_YDMF_PHYS_OUT_FEVL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FEVL)
      Z_YDMF_PHYS_OUT_FEVN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FEVN)
      Z_YDMF_PHYS_OUT_FEVV => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FEVV)
      Z_YDMF_PHYS_OUT_FGEL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FGEL)
      Z_YDMF_PHYS_OUT_FGELS => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FGELS)
      Z_YDMF_PHYS_OUT_FLWSP => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FLWSP)
      Z_YDMF_PHYS_OUT_FONTE => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FONTE)
      Z_YDMF_PHYS_OUT_FPLCL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLCL)
      Z_YDMF_PHYS_OUT_FPLCN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLCN)
      Z_YDMF_PHYS_OUT_FPLSG => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLSG)
      Z_YDMF_PHYS_OUT_FPLSL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLSL)
      Z_YDMF_PHYS_OUT_FPLSN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLSN)
      Z_YDMF_PHYS_OUT_FRSO => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FRSO)
      Z_YDMF_PHYS_OUT_FRTH => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FRTH)
      Z_YDMF_PHYS_OUT_FTR => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FTR)
      Z_YDMF_PHYS_OUT_RUISL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_RUISL)
      Z_YDMF_PHYS_OUT_RUISP => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_RUISP)
      Z_YDMF_PHYS_OUT_RUISS => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_RUISS)
      Z_YDMF_PHYS_SURF_GSD_VF_PLSM => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSD_VF%F_LSM)
      Z_YDMF_PHYS_SURF_GSD_VP_PTPC => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSD_VP%F_TPC)
      Z_YDMF_PHYS_SURF_GSD_VP_PWPC => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSD_VP%F_WPC)
      Z_YDMF_PHYS_SURF_GSD_VV_PIVEG => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSD_VV%F_IVEG)
      Z_YDMF_PHYS_SURF_GSP_RR_PFC_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_RR%F_FC_T1)
      Z_YDMF_PHYS_SURF_GSP_RR_PIC_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_RR%F_IC_T1)
      Z_YDMF_PHYS_SURF_GSP_RR_PT_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_RR%F_T_T1)
      Z_YDMF_PHYS_SURF_GSP_RR_PW_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_RR%F_W_T1)
      Z_YDMF_PHYS_SURF_GSP_SB_PQ_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_SB%F_Q_T1)
      Z_YDMF_PHYS_SURF_GSP_SB_PTL_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_SB%F_TL_T1)
      Z_YDMF_PHYS_SURF_GSP_SB_PT_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_SB%F_T_T1)
      Z_YDMF_PHYS_SURF_GSP_SG_PA_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_SG%F_A_T1)
      Z_YDMF_PHYS_SURF_GSP_SG_PF_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_SG%F_F_T1)
      Z_YDMF_PHYS_SURF_GSP_SG_PR_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_SG%F_R_T1)
      IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL&
      &:LMSE_F:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
      
      
    ENDIF

    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL&
    &:LMSE_F:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
    PDSA_C1 => NULL ()
    PDSA_C2 => NULL ()
    PFLU_FEVI => NULL ()
    PFLU_VEG => NULL ()
    ZPFL_FPLSN => NULL ()
    ZTDS_TDALBNS => NULL ()
    ZTDS_TDRHONS => NULL ()
    ZTDS_TDSNS => NULL ()
    ZTDS_TDTP => NULL ()
    ZTDS_TDTS => NULL ()
    ZTDS_TDWL => NULL ()
    ZTDS_TDWP => NULL ()
    ZTDS_TDWPI => NULL ()
    ZTDS_TDWS => NULL ()
    ZTDS_TDWSI => NULL ()
    Z_YDMF_PHYS_OUT_CT => NULL ()
    Z_YDMF_PHYS_OUT_FCHSP => NULL ()
    Z_YDMF_PHYS_OUT_FCLL => NULL ()
    Z_YDMF_PHYS_OUT_FCLN => NULL ()
    Z_YDMF_PHYS_OUT_FCS => NULL ()
    Z_YDMF_PHYS_OUT_FEVL => NULL ()
    Z_YDMF_PHYS_OUT_FEVN => NULL ()
    Z_YDMF_PHYS_OUT_FEVV => NULL ()
    Z_YDMF_PHYS_OUT_FGEL => NULL ()
    Z_YDMF_PHYS_OUT_FGELS => NULL ()
    Z_YDMF_PHYS_OUT_FLWSP => NULL ()
    Z_YDMF_PHYS_OUT_FONTE => NULL ()
    Z_YDMF_PHYS_OUT_FPLCL => NULL ()
    Z_YDMF_PHYS_OUT_FPLCN => NULL ()
    Z_YDMF_PHYS_OUT_FPLSG => NULL ()
    Z_YDMF_PHYS_OUT_FPLSL => NULL ()
    Z_YDMF_PHYS_OUT_FPLSN => NULL ()
    Z_YDMF_PHYS_OUT_FRSO => NULL ()
    Z_YDMF_PHYS_OUT_FRTH => NULL ()
    Z_YDMF_PHYS_OUT_FTR => NULL ()
    Z_YDMF_PHYS_OUT_RUISL => NULL ()
    Z_YDMF_PHYS_OUT_RUISP => NULL ()
    Z_YDMF_PHYS_OUT_RUISS => NULL ()
    Z_YDMF_PHYS_SURF_GSD_VF_PLSM => NULL ()
    Z_YDMF_PHYS_SURF_GSD_VP_PTPC => NULL ()
    Z_YDMF_PHYS_SURF_GSD_VP_PWPC => NULL ()
    Z_YDMF_PHYS_SURF_GSD_VV_PIVEG => NULL ()
    Z_YDMF_PHYS_SURF_GSP_RR_PFC_T1 => NULL ()
    Z_YDMF_PHYS_SURF_GSP_RR_PIC_T1 => NULL ()
    Z_YDMF_PHYS_SURF_GSP_RR_PT_T1 => NULL ()
    Z_YDMF_PHYS_SURF_GSP_RR_PW_T1 => NULL ()
    Z_YDMF_PHYS_SURF_GSP_SB_PQ_T1 => NULL ()
    Z_YDMF_PHYS_SURF_GSP_SB_PTL_T1 => NULL ()
    Z_YDMF_PHYS_SURF_GSP_SB_PT_T1 => NULL ()
    Z_YDMF_PHYS_SURF_GSP_SG_PA_T1 => NULL ()
    Z_YDMF_PHYS_SURF_GSP_SG_PF_T1 => NULL ()
    Z_YDMF_PHYS_SURF_GSP_SG_PR_T1 => NULL ()
    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL&
    &:LMSE_F:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN&
    &','APL_ARPEGE_SURFACE_UPDATE_PARALLEL:LMSE_F')) THEN
    
    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL&
    &:LMSE_F:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
    PDSA_C1 => GET_DEVICE_DATA_RDONLY (YD_PDSA_C1)
    PDSA_C2 => GET_DEVICE_DATA_RDONLY (YD_PDSA_C2)
    PFLU_FEVI => GET_DEVICE_DATA_RDONLY (YD_PFLU_FEVI)
    PFLU_VEG => GET_DEVICE_DATA_RDONLY (YD_PFLU_VEG)
    ZPFL_FPLSN => GET_DEVICE_DATA_RDWR (YL_ZPFL_FPLSN)
    ZTDS_TDALBNS => GET_DEVICE_DATA_RDWR (YL_ZTDS_TDALBNS)
    ZTDS_TDRHONS => GET_DEVICE_DATA_RDWR (YL_ZTDS_TDRHONS)
    ZTDS_TDSNS => GET_DEVICE_DATA_RDWR (YL_ZTDS_TDSNS)
    ZTDS_TDTP => GET_DEVICE_DATA_RDWR (YL_ZTDS_TDTP)
    ZTDS_TDTS => GET_DEVICE_DATA_RDWR (YL_ZTDS_TDTS)
    ZTDS_TDWL => GET_DEVICE_DATA_RDWR (YL_ZTDS_TDWL)
    ZTDS_TDWP => GET_DEVICE_DATA_RDWR (YL_ZTDS_TDWP)
    ZTDS_TDWPI => GET_DEVICE_DATA_RDWR (YL_ZTDS_TDWPI)
    ZTDS_TDWS => GET_DEVICE_DATA_RDWR (YL_ZTDS_TDWS)
    ZTDS_TDWSI => GET_DEVICE_DATA_RDWR (YL_ZTDS_TDWSI)
    Z_YDMF_PHYS_OUT_CT => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_CT)
    Z_YDMF_PHYS_OUT_FCHSP => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_FCHSP)
    Z_YDMF_PHYS_OUT_FCLL => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_FCLL)
    Z_YDMF_PHYS_OUT_FCLN => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_FCLN)
    Z_YDMF_PHYS_OUT_FCS => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_FCS)
    Z_YDMF_PHYS_OUT_FEVL => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_FEVL)
    Z_YDMF_PHYS_OUT_FEVN => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_FEVN)
    Z_YDMF_PHYS_OUT_FEVV => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_FEVV)
    Z_YDMF_PHYS_OUT_FGEL => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_FGEL)
    Z_YDMF_PHYS_OUT_FGELS => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_FGELS)
    Z_YDMF_PHYS_OUT_FLWSP => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_FLWSP)
    Z_YDMF_PHYS_OUT_FONTE => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_FONTE)
    Z_YDMF_PHYS_OUT_FPLCL => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_FPLCL)
    Z_YDMF_PHYS_OUT_FPLCN => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_FPLCN)
    Z_YDMF_PHYS_OUT_FPLSG => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_FPLSG)
    Z_YDMF_PHYS_OUT_FPLSL => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_FPLSL)
    Z_YDMF_PHYS_OUT_FPLSN => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_FPLSN)
    Z_YDMF_PHYS_OUT_FRSO => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_FRSO)
    Z_YDMF_PHYS_OUT_FRTH => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_FRTH)
    Z_YDMF_PHYS_OUT_FTR => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_FTR)
    Z_YDMF_PHYS_OUT_RUISL => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_RUISL)
    Z_YDMF_PHYS_OUT_RUISP => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_RUISP)
    Z_YDMF_PHYS_OUT_RUISS => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_RUISS)
    Z_YDMF_PHYS_SURF_GSD_VF_PLSM => GET_DEVICE_DATA_RDONLY (YDMF_PHYS_SURF%GSD_VF%F_LSM)
    Z_YDMF_PHYS_SURF_GSD_VP_PTPC => GET_DEVICE_DATA_RDONLY (YDMF_PHYS_SURF%GSD_VP%F_TPC)
    Z_YDMF_PHYS_SURF_GSD_VP_PWPC => GET_DEVICE_DATA_RDONLY (YDMF_PHYS_SURF%GSD_VP%F_WPC)
    Z_YDMF_PHYS_SURF_GSD_VV_PIVEG => GET_DEVICE_DATA_RDONLY (YDMF_PHYS_SURF%GSD_VV%F_IVEG)
    Z_YDMF_PHYS_SURF_GSP_RR_PFC_T1 => GET_DEVICE_DATA_RDWR (YDMF_PHYS_SURF%GSP_RR%F_FC_T1)
    Z_YDMF_PHYS_SURF_GSP_RR_PIC_T1 => GET_DEVICE_DATA_RDWR (YDMF_PHYS_SURF%GSP_RR%F_IC_T1)
    Z_YDMF_PHYS_SURF_GSP_RR_PT_T1 => GET_DEVICE_DATA_RDWR (YDMF_PHYS_SURF%GSP_RR%F_T_T1)
    Z_YDMF_PHYS_SURF_GSP_RR_PW_T1 => GET_DEVICE_DATA_RDWR (YDMF_PHYS_SURF%GSP_RR%F_W_T1)
    Z_YDMF_PHYS_SURF_GSP_SB_PQ_T1 => GET_DEVICE_DATA_RDWR (YDMF_PHYS_SURF%GSP_SB%F_Q_T1)
    Z_YDMF_PHYS_SURF_GSP_SB_PTL_T1 => GET_DEVICE_DATA_RDWR (YDMF_PHYS_SURF%GSP_SB%F_TL_T1)
    Z_YDMF_PHYS_SURF_GSP_SB_PT_T1 => GET_DEVICE_DATA_RDWR (YDMF_PHYS_SURF%GSP_SB%F_T_T1)
    Z_YDMF_PHYS_SURF_GSP_SG_PA_T1 => GET_DEVICE_DATA_RDWR (YDMF_PHYS_SURF%GSP_SG%F_A_T1)
    Z_YDMF_PHYS_SURF_GSP_SG_PF_T1 => GET_DEVICE_DATA_RDWR (YDMF_PHYS_SURF%GSP_SG%F_F_T1)
    Z_YDMF_PHYS_SURF_GSP_SG_PR_T1 => GET_DEVICE_DATA_RDWR (YDMF_PHYS_SURF%GSP_SG%F_R_T1)
    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL&
    &:LMSE_F:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL:LMSE_F:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
    
    
      !$ACC PARALLEL LOOP GANG &
      !$ACC&PRESENT (PDSA_C1, PDSA_C2, PFLU_FEVI, PFLU_VEG, YDCPG_OPTS, YDMODEL, YFXTRAN_ACDC_STACK, &
      !$ACC&         ZPFL_FPLSN, ZTDS_TDALBNS, ZTDS_TDRHONS, ZTDS_TDSNS, ZTDS_TDTP, &
      !$ACC&         ZTDS_TDTS, ZTDS_TDWL, ZTDS_TDWP, ZTDS_TDWPI, ZTDS_TDWS, ZTDS_TDWSI, &
      !$ACC&         Z_YDMF_PHYS_OUT_CT, Z_YDMF_PHYS_OUT_FCHSP, Z_YDMF_PHYS_OUT_FCLL, &
      !$ACC&         Z_YDMF_PHYS_OUT_FCLN, Z_YDMF_PHYS_OUT_FCS, Z_YDMF_PHYS_OUT_FEVL, &
      !$ACC&         Z_YDMF_PHYS_OUT_FEVN, Z_YDMF_PHYS_OUT_FEVV, Z_YDMF_PHYS_OUT_FGEL, &
      !$ACC&         Z_YDMF_PHYS_OUT_FGELS, Z_YDMF_PHYS_OUT_FLWSP, Z_YDMF_PHYS_OUT_FONTE, &
      !$ACC&         Z_YDMF_PHYS_OUT_FPLCL, Z_YDMF_PHYS_OUT_FPLCN, Z_YDMF_PHYS_OUT_FPLSG, &
      !$ACC&         Z_YDMF_PHYS_OUT_FPLSL, Z_YDMF_PHYS_OUT_FPLSN, Z_YDMF_PHYS_OUT_FRSO, &
      !$ACC&         Z_YDMF_PHYS_OUT_FRTH, Z_YDMF_PHYS_OUT_FTR, Z_YDMF_PHYS_OUT_RUISL, &
      !$ACC&         Z_YDMF_PHYS_OUT_RUISP, Z_YDMF_PHYS_OUT_RUISS, Z_YDMF_PHYS_SURF_GSD_VF_PLSM, &
      !$ACC&         Z_YDMF_PHYS_SURF_GSD_VP_PTPC, Z_YDMF_PHYS_SURF_GSD_VP_PWPC, &
      !$ACC&         Z_YDMF_PHYS_SURF_GSD_VV_PIVEG, Z_YDMF_PHYS_SURF_GSP_RR_PFC_T1, &
      !$ACC&         Z_YDMF_PHYS_SURF_GSP_RR_PIC_T1, Z_YDMF_PHYS_SURF_GSP_RR_PT_T1, &
      !$ACC&         Z_YDMF_PHYS_SURF_GSP_RR_PW_T1, Z_YDMF_PHYS_SURF_GSP_SB_PQ_T1, &
      !$ACC&         Z_YDMF_PHYS_SURF_GSP_SB_PTL_T1, Z_YDMF_PHYS_SURF_GSP_SB_PT_T1, &
      !$ACC&         Z_YDMF_PHYS_SURF_GSP_SG_PA_T1, Z_YDMF_PHYS_SURF_GSP_SG_PF_T1, &
      !$ACC&         Z_YDMF_PHYS_SURF_GSP_SG_PR_T1) &
      !$ACC&PRIVATE (JBLK) &
      !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
      
      DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
      
      
      
      !$ACC LOOP VECTOR &
      !$ACC&PRIVATE (JLEV, JLON, YLCPG_BNDS, YLSTACK) 

      

      DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
        YLCPG_BNDS%KIDIA = JLON
        YLCPG_BNDS%KFDIA = JLON
        YLSTACK%L8 = fxtran_acdc_stack_l8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
        YLSTACK%U8 = fxtran_acdc_stack_u8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
        YLSTACK%L4 = fxtran_acdc_stack_l4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
        YLSTACK%U4 = fxtran_acdc_stack_u4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)

        

        DO JLEV=0, YDCPG_OPTS%KFLEVG
          
          ZPFL_FPLSN (JLON, JLEV, JBLK)=Z_YDMF_PHYS_OUT_FPLSN (JLON&
          &, JLEV, JBLK)+Z_YDMF_PHYS_OUT_FPLSG (JLON, JLEV, JBLK)
        
        ENDDO

        CALL CPTENDS_OPENACC (YDMODEL%YRCST, YDMODEL%YRML_PHY_MF, YDCPG_OPTS%KLON, YLCPG_BNDS%KIDIA, YLCPG_BNDS&
        &%KFDIA, YDCPG_OPTS%KFLEVG, YDCPG_OPTS%YRSURF_DIMS%YSP_SBD%NLEVS, PDTPHY, Z_YDMF_PHYS_OUT_FPLCL(:,:&
        &, JBLK), Z_YDMF_PHYS_OUT_FPLSL(:,:, JBLK), Z_YDMF_PHYS_OUT_FPLCN(:,:, JBLK), ZPFL_FPLSN(:,:, JBLK)&
        &, Z_YDMF_PHYS_OUT_FRSO(:,:,:, JBLK), Z_YDMF_PHYS_OUT_FRTH(:,:,:, JBLK), Z_YDMF_PHYS_SURF_GSP_SG_PA_T1&
        & (:, 1, JBLK), Z_YDMF_PHYS_OUT_CT(:, JBLK), PDSA_C1(:, JBLK), PDSA_C2(:, JBLK), Z_YDMF_PHYS_OUT_FCHSP&
        &(:,:, JBLK), Z_YDMF_PHYS_OUT_FCLL (:, 1, JBLK), Z_YDMF_PHYS_OUT_FCLN (:, 1, JBLK), Z_YDMF_PHYS_OUT_FCS&
        & (:, 1, JBLK), PFLU_FEVI (:, 1, JBLK), Z_YDMF_PHYS_OUT_FEVL (:, 1, JBLK), Z_YDMF_PHYS_OUT_FEVN (:,&
        & 1, JBLK), Z_YDMF_PHYS_OUT_FEVV(:, JBLK), Z_YDMF_PHYS_OUT_FGEL(:, JBLK), Z_YDMF_PHYS_OUT_FGELS(:, JBLK&
        &), Z_YDMF_PHYS_OUT_FLWSP(:, JBLK), Z_YDMF_PHYS_OUT_FONTE(:, JBLK), Z_YDMF_PHYS_OUT_FTR(:, JBLK), Z_YDMF_PHYS_SURF_GSD_VF_PLSM&
        &(:, JBLK), Z_YDMF_PHYS_SURF_GSP_SG_PR_T1 (:, 1, JBLK), Z_YDMF_PHYS_OUT_RUISL(:, JBLK), Z_YDMF_PHYS_OUT_RUISP&
        &(:, JBLK), Z_YDMF_PHYS_OUT_RUISS(:, JBLK), Z_YDMF_PHYS_SURF_GSP_SG_PF_T1 (:, 1, JBLK), PFLU_VEG(:,&
        & JBLK), ZTDS_TDTS(:, JBLK), ZTDS_TDTP(:,:, JBLK), ZTDS_TDWS(:, JBLK), ZTDS_TDWSI(:, JBLK), ZTDS_TDWP&
        &(:, JBLK), ZTDS_TDWPI(:, JBLK), ZTDS_TDWL(:, JBLK), ZTDS_TDSNS(:, JBLK), ZTDS_TDALBNS(:, JBLK), ZTDS_TDRHONS&
        &(:, JBLK),YDSTACK=YLSTACK)
        CALL CPWTS_OPENACC (YDMODEL%YRCST, YDCPG_OPTS, YDMODEL%YRML_AOC%YRMCC, YDMODEL%YRML_PHY_MF%YRPHY&
        &, YDMODEL%YRML_PHY_MF%YRPHY1, YDCPG_OPTS%KLON, YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA, YDCPG_OPTS%YRSURF_DIMS&
        &%YSP_SBD%NLEVS, PDTPHY, ZTDS_TDTS(:, JBLK), ZTDS_TDTP(:,:, JBLK), ZTDS_TDWS(:, JBLK), ZTDS_TDWSI&
        &(:, JBLK), ZTDS_TDWP(:, JBLK), ZTDS_TDWPI(:, JBLK), ZTDS_TDWL(:, JBLK), ZTDS_TDSNS(:, JBLK), ZTDS_TDALBNS&
        &(:, JBLK), ZTDS_TDRHONS(:, JBLK), Z_YDMF_PHYS_SURF_GSD_VP_PTPC(:, JBLK), Z_YDMF_PHYS_SURF_GSD_VP_PWPC&
        &(:, JBLK), Z_YDMF_PHYS_SURF_GSD_VF_PLSM(:, JBLK), Z_YDMF_PHYS_SURF_GSD_VV_PIVEG(:, JBLK), Z_YDMF_PHYS_SURF_GSP_RR_PT_T1&
        &(:, JBLK), Z_YDMF_PHYS_SURF_GSP_SB_PT_T1(:,:, JBLK), Z_YDMF_PHYS_SURF_GSP_RR_PW_T1(:, JBLK), Z_YDMF_PHYS_SURF_GSP_RR_PIC_T1&
        &(:, JBLK), Z_YDMF_PHYS_SURF_GSP_SB_PQ_T1 (:, 1, JBLK), Z_YDMF_PHYS_SURF_GSP_SB_PTL_T1 (:, 1, JBLK&
        &), Z_YDMF_PHYS_SURF_GSP_RR_PFC_T1(:, JBLK), Z_YDMF_PHYS_SURF_GSP_SG_PF_T1 (:, 1, JBLK), Z_YDMF_PHYS_SURF_GSP_SG_PA_T1&
        & (:, 1, JBLK), Z_YDMF_PHYS_SURF_GSP_SG_PR_T1 (:, 1, JBLK),YDSTACK=YLSTACK)
      ENDDO

    ENDDO

    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL:LMSE_F:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

    IF (FXTRAN_ACDC_LSYNCHOST ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL:LMSE_F')) THEN
      IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL&
      &:LMSE_F:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
      PDSA_C1 => GET_HOST_DATA_RDWR (YD_PDSA_C1)
      PDSA_C2 => GET_HOST_DATA_RDWR (YD_PDSA_C2)
      PFLU_FEVI => GET_HOST_DATA_RDWR (YD_PFLU_FEVI)
      PFLU_VEG => GET_HOST_DATA_RDWR (YD_PFLU_VEG)
      ZPFL_FPLSN => GET_HOST_DATA_RDWR (YL_ZPFL_FPLSN)
      ZTDS_TDALBNS => GET_HOST_DATA_RDWR (YL_ZTDS_TDALBNS)
      ZTDS_TDRHONS => GET_HOST_DATA_RDWR (YL_ZTDS_TDRHONS)
      ZTDS_TDSNS => GET_HOST_DATA_RDWR (YL_ZTDS_TDSNS)
      ZTDS_TDTP => GET_HOST_DATA_RDWR (YL_ZTDS_TDTP)
      ZTDS_TDTS => GET_HOST_DATA_RDWR (YL_ZTDS_TDTS)
      ZTDS_TDWL => GET_HOST_DATA_RDWR (YL_ZTDS_TDWL)
      ZTDS_TDWP => GET_HOST_DATA_RDWR (YL_ZTDS_TDWP)
      ZTDS_TDWPI => GET_HOST_DATA_RDWR (YL_ZTDS_TDWPI)
      ZTDS_TDWS => GET_HOST_DATA_RDWR (YL_ZTDS_TDWS)
      ZTDS_TDWSI => GET_HOST_DATA_RDWR (YL_ZTDS_TDWSI)
      Z_YDMF_PHYS_OUT_CT => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_CT)
      Z_YDMF_PHYS_OUT_FCHSP => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FCHSP)
      Z_YDMF_PHYS_OUT_FCLL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FCLL)
      Z_YDMF_PHYS_OUT_FCLN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FCLN)
      Z_YDMF_PHYS_OUT_FCS => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FCS)
      Z_YDMF_PHYS_OUT_FEVL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FEVL)
      Z_YDMF_PHYS_OUT_FEVN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FEVN)
      Z_YDMF_PHYS_OUT_FEVV => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FEVV)
      Z_YDMF_PHYS_OUT_FGEL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FGEL)
      Z_YDMF_PHYS_OUT_FGELS => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FGELS)
      Z_YDMF_PHYS_OUT_FLWSP => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FLWSP)
      Z_YDMF_PHYS_OUT_FONTE => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FONTE)
      Z_YDMF_PHYS_OUT_FPLCL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLCL)
      Z_YDMF_PHYS_OUT_FPLCN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLCN)
      Z_YDMF_PHYS_OUT_FPLSG => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLSG)
      Z_YDMF_PHYS_OUT_FPLSL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLSL)
      Z_YDMF_PHYS_OUT_FPLSN => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FPLSN)
      Z_YDMF_PHYS_OUT_FRSO => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FRSO)
      Z_YDMF_PHYS_OUT_FRTH => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FRTH)
      Z_YDMF_PHYS_OUT_FTR => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_FTR)
      Z_YDMF_PHYS_OUT_RUISL => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_RUISL)
      Z_YDMF_PHYS_OUT_RUISP => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_RUISP)
      Z_YDMF_PHYS_OUT_RUISS => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_RUISS)
      Z_YDMF_PHYS_SURF_GSD_VF_PLSM => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSD_VF%F_LSM)
      Z_YDMF_PHYS_SURF_GSD_VP_PTPC => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSD_VP%F_TPC)
      Z_YDMF_PHYS_SURF_GSD_VP_PWPC => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSD_VP%F_WPC)
      Z_YDMF_PHYS_SURF_GSD_VV_PIVEG => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSD_VV%F_IVEG)
      Z_YDMF_PHYS_SURF_GSP_RR_PFC_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_RR%F_FC_T1)
      Z_YDMF_PHYS_SURF_GSP_RR_PIC_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_RR%F_IC_T1)
      Z_YDMF_PHYS_SURF_GSP_RR_PT_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_RR%F_T_T1)
      Z_YDMF_PHYS_SURF_GSP_RR_PW_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_RR%F_W_T1)
      Z_YDMF_PHYS_SURF_GSP_SB_PQ_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_SB%F_Q_T1)
      Z_YDMF_PHYS_SURF_GSP_SB_PTL_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_SB%F_TL_T1)
      Z_YDMF_PHYS_SURF_GSP_SB_PT_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_SB%F_T_T1)
      Z_YDMF_PHYS_SURF_GSP_SG_PA_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_SG%F_A_T1)
      Z_YDMF_PHYS_SURF_GSP_SG_PF_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_SG%F_F_T1)
      Z_YDMF_PHYS_SURF_GSP_SG_PR_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_SG%F_R_T1)
      IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL&
      &:LMSE_F:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
      
      
    ENDIF

    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL&
    &:LMSE_F:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
    PDSA_C1 => NULL ()
    PDSA_C2 => NULL ()
    PFLU_FEVI => NULL ()
    PFLU_VEG => NULL ()
    ZPFL_FPLSN => NULL ()
    ZTDS_TDALBNS => NULL ()
    ZTDS_TDRHONS => NULL ()
    ZTDS_TDSNS => NULL ()
    ZTDS_TDTP => NULL ()
    ZTDS_TDTS => NULL ()
    ZTDS_TDWL => NULL ()
    ZTDS_TDWP => NULL ()
    ZTDS_TDWPI => NULL ()
    ZTDS_TDWS => NULL ()
    ZTDS_TDWSI => NULL ()
    Z_YDMF_PHYS_OUT_CT => NULL ()
    Z_YDMF_PHYS_OUT_FCHSP => NULL ()
    Z_YDMF_PHYS_OUT_FCLL => NULL ()
    Z_YDMF_PHYS_OUT_FCLN => NULL ()
    Z_YDMF_PHYS_OUT_FCS => NULL ()
    Z_YDMF_PHYS_OUT_FEVL => NULL ()
    Z_YDMF_PHYS_OUT_FEVN => NULL ()
    Z_YDMF_PHYS_OUT_FEVV => NULL ()
    Z_YDMF_PHYS_OUT_FGEL => NULL ()
    Z_YDMF_PHYS_OUT_FGELS => NULL ()
    Z_YDMF_PHYS_OUT_FLWSP => NULL ()
    Z_YDMF_PHYS_OUT_FONTE => NULL ()
    Z_YDMF_PHYS_OUT_FPLCL => NULL ()
    Z_YDMF_PHYS_OUT_FPLCN => NULL ()
    Z_YDMF_PHYS_OUT_FPLSG => NULL ()
    Z_YDMF_PHYS_OUT_FPLSL => NULL ()
    Z_YDMF_PHYS_OUT_FPLSN => NULL ()
    Z_YDMF_PHYS_OUT_FRSO => NULL ()
    Z_YDMF_PHYS_OUT_FRTH => NULL ()
    Z_YDMF_PHYS_OUT_FTR => NULL ()
    Z_YDMF_PHYS_OUT_RUISL => NULL ()
    Z_YDMF_PHYS_OUT_RUISP => NULL ()
    Z_YDMF_PHYS_OUT_RUISS => NULL ()
    Z_YDMF_PHYS_SURF_GSD_VF_PLSM => NULL ()
    Z_YDMF_PHYS_SURF_GSD_VP_PTPC => NULL ()
    Z_YDMF_PHYS_SURF_GSD_VP_PWPC => NULL ()
    Z_YDMF_PHYS_SURF_GSD_VV_PIVEG => NULL ()
    Z_YDMF_PHYS_SURF_GSP_RR_PFC_T1 => NULL ()
    Z_YDMF_PHYS_SURF_GSP_RR_PIC_T1 => NULL ()
    Z_YDMF_PHYS_SURF_GSP_RR_PT_T1 => NULL ()
    Z_YDMF_PHYS_SURF_GSP_RR_PW_T1 => NULL ()
    Z_YDMF_PHYS_SURF_GSP_SB_PQ_T1 => NULL ()
    Z_YDMF_PHYS_SURF_GSP_SB_PTL_T1 => NULL ()
    Z_YDMF_PHYS_SURF_GSP_SB_PT_T1 => NULL ()
    Z_YDMF_PHYS_SURF_GSP_SG_PA_T1 => NULL ()
    Z_YDMF_PHYS_SURF_GSP_SG_PF_T1 => NULL ()
    Z_YDMF_PHYS_SURF_GSP_SG_PR_T1 => NULL ()
    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL&
    &:LMSE_F:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ELSE
      CALL ABOR1 ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL: NOT METHOD WAS FOUND')
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL:LMSE_F',1,ZHOOK_HANDLE_PARALLEL)
ELSE
  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL:LMSE_T',0,ZHOOK_HANDLE_PARALLEL)

  IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','APL_ARPEGE_SURFACE_UPDATE_PARALLEL:LMSE_T')) THEN
    
    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL&
    &:LMSE_T:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
    Z_YDCPG_GPAR_VTS => GET_HOST_DATA_RDONLY (YDCPG_GPAR%F_VTS)
    Z_YDMF_PHYS_SURF_GSP_RR_PT_T0 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_RR%F_T_T0)
    Z_YDMF_PHYS_SURF_GSP_RR_PT_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_RR%F_T_T1)
    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL&
    &:LMSE_T:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL:LMSE_T:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
    
    CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
    !$OMP PARALLEL DO PRIVATE (JBLK, JLON) FIRSTPRIVATE (YLCPG_BNDS)

    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
      CALL YLCPG_BNDS%UPDATE (JBLK)

      

      IF (LDCONFX) THEN

        DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
          Z_YDMF_PHYS_SURF_GSP_RR_PT_T0 (JLON, JBLK)=Z_YDCPG_GPAR_VTS (JLON, JBLK)
        ENDDO

      ELSE

        DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
          Z_YDMF_PHYS_SURF_GSP_RR_PT_T1 (JLON, JBLK)=Z_YDCPG_GPAR_VTS (JLON, JBLK)
        ENDDO

      ENDIF

    ENDDO

    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL:LMSE_T:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

    IF (FXTRAN_ACDC_LSYNCHOST ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL:LMSE_T')) THEN
      IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL&
      &:LMSE_T:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
      Z_YDCPG_GPAR_VTS => GET_HOST_DATA_RDWR (YDCPG_GPAR%F_VTS)
      Z_YDMF_PHYS_SURF_GSP_RR_PT_T0 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_RR%F_T_T0)
      Z_YDMF_PHYS_SURF_GSP_RR_PT_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_RR%F_T_T1)
      IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL&
      &:LMSE_T:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
      
      
    ENDIF

    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL&
    &:LMSE_T:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
    Z_YDCPG_GPAR_VTS => NULL ()
    Z_YDMF_PHYS_SURF_GSP_RR_PT_T0 => NULL ()
    Z_YDMF_PHYS_SURF_GSP_RR_PT_T1 => NULL ()
    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL&
    &:LMSE_T:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMPSINGLECOLUMN&
    &','APL_ARPEGE_SURFACE_UPDATE_PARALLEL:LMSE_T')) THEN
    
    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL&
    &:LMSE_T:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
    Z_YDCPG_GPAR_VTS => GET_HOST_DATA_RDONLY (YDCPG_GPAR%F_VTS)
    Z_YDMF_PHYS_SURF_GSP_RR_PT_T0 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_RR%F_T_T0)
    Z_YDMF_PHYS_SURF_GSP_RR_PT_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_RR%F_T_T1)
    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL&
    &:LMSE_T:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL:LMSE_T:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
    
    !$OMP PARALLEL DO PRIVATE (JBLK, JLON, YLCPG_BNDS)

    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX

      

      

      DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
        YLCPG_BNDS%KIDIA = JLON
        YLCPG_BNDS%KFDIA = JLON

        

        IF (LDCONFX) THEN
          
          Z_YDMF_PHYS_SURF_GSP_RR_PT_T0 (JLON, JBLK)=Z_YDCPG_GPAR_VTS (JLON, JBLK)
        
        ELSE
          
          Z_YDMF_PHYS_SURF_GSP_RR_PT_T1 (JLON, JBLK)=Z_YDCPG_GPAR_VTS (JLON, JBLK)
        
        ENDIF

      ENDDO

    ENDDO

    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL:LMSE_T:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

    IF (FXTRAN_ACDC_LSYNCHOST ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL:LMSE_T')) THEN
      IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL&
      &:LMSE_T:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
      Z_YDCPG_GPAR_VTS => GET_HOST_DATA_RDWR (YDCPG_GPAR%F_VTS)
      Z_YDMF_PHYS_SURF_GSP_RR_PT_T0 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_RR%F_T_T0)
      Z_YDMF_PHYS_SURF_GSP_RR_PT_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_RR%F_T_T1)
      IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL&
      &:LMSE_T:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
      
      
    ENDIF

    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL&
    &:LMSE_T:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
    Z_YDCPG_GPAR_VTS => NULL ()
    Z_YDMF_PHYS_SURF_GSP_RR_PT_T0 => NULL ()
    Z_YDMF_PHYS_SURF_GSP_RR_PT_T1 => NULL ()
    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL&
    &:LMSE_T:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN&
    &','APL_ARPEGE_SURFACE_UPDATE_PARALLEL:LMSE_T')) THEN
    
    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL&
    &:LMSE_T:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
    Z_YDCPG_GPAR_VTS => GET_DEVICE_DATA_RDONLY (YDCPG_GPAR%F_VTS)
    Z_YDMF_PHYS_SURF_GSP_RR_PT_T0 => GET_DEVICE_DATA_RDWR (YDMF_PHYS_SURF%GSP_RR%F_T_T0)
    Z_YDMF_PHYS_SURF_GSP_RR_PT_T1 => GET_DEVICE_DATA_RDWR (YDMF_PHYS_SURF%GSP_RR%F_T_T1)
    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL&
    &:LMSE_T:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL:LMSE_T:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
    
    
      !$ACC PARALLEL LOOP GANG &
      !$ACC&PRESENT (YDCPG_OPTS, YFXTRAN_ACDC_STACK, Z_YDCPG_GPAR_VTS, Z_YDMF_PHYS_SURF_GSP_RR_PT_T0, &
      !$ACC&         Z_YDMF_PHYS_SURF_GSP_RR_PT_T1) &
      !$ACC&PRIVATE (JBLK) &
      !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
      
      DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
      
      
      
      !$ACC LOOP VECTOR &
      !$ACC&PRIVATE (JLON, YLCPG_BNDS) 

      

      DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
        YLCPG_BNDS%KIDIA = JLON
        YLCPG_BNDS%KFDIA = JLON

        

        IF (LDCONFX) THEN
          
          Z_YDMF_PHYS_SURF_GSP_RR_PT_T0 (JLON, JBLK)=Z_YDCPG_GPAR_VTS (JLON, JBLK)
        
        ELSE
          
          Z_YDMF_PHYS_SURF_GSP_RR_PT_T1 (JLON, JBLK)=Z_YDCPG_GPAR_VTS (JLON, JBLK)
        
        ENDIF

      ENDDO

    ENDDO

    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL:LMSE_T:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

    IF (FXTRAN_ACDC_LSYNCHOST ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL:LMSE_T')) THEN
      IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL&
      &:LMSE_T:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
      Z_YDCPG_GPAR_VTS => GET_HOST_DATA_RDWR (YDCPG_GPAR%F_VTS)
      Z_YDMF_PHYS_SURF_GSP_RR_PT_T0 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_RR%F_T_T0)
      Z_YDMF_PHYS_SURF_GSP_RR_PT_T1 => GET_HOST_DATA_RDWR (YDMF_PHYS_SURF%GSP_RR%F_T_T1)
      IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL&
      &:LMSE_T:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
      
      
    ENDIF

    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL&
    &:LMSE_T:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
    Z_YDCPG_GPAR_VTS => NULL ()
    Z_YDMF_PHYS_SURF_GSP_RR_PT_T0 => NULL ()
    Z_YDMF_PHYS_SURF_GSP_RR_PT_T1 => NULL ()
    IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL&
    &:LMSE_T:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ELSE
      CALL ABOR1 ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL: NOT METHOD WAS FOUND')
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL:LMSE_T',1,ZHOOK_HANDLE_PARALLEL)
ENDIF



CALL FXTRAN_ACDC_GPUMEMSTAT (__FILE__, __LINE__, "END")

IF (LHOOK) CALL DR_HOOK ('DELETE_TEMPORARIES',0,ZHOOK_HANDLE_FIELD_API)
IF (ASSOCIATED (YL_ZPFL_FPLSN)) CALL FIELD_DELETE (YL_ZPFL_FPLSN)
IF (ASSOCIATED (YL_ZTDS_TDALBNS)) CALL FIELD_DELETE (YL_ZTDS_TDALBNS)
IF (ASSOCIATED (YL_ZTDS_TDRHONS)) CALL FIELD_DELETE (YL_ZTDS_TDRHONS)
IF (ASSOCIATED (YL_ZTDS_TDSNS)) CALL FIELD_DELETE (YL_ZTDS_TDSNS)
IF (ASSOCIATED (YL_ZTDS_TDTP)) CALL FIELD_DELETE (YL_ZTDS_TDTP)
IF (ASSOCIATED (YL_ZTDS_TDTS)) CALL FIELD_DELETE (YL_ZTDS_TDTS)
IF (ASSOCIATED (YL_ZTDS_TDWL)) CALL FIELD_DELETE (YL_ZTDS_TDWL)
IF (ASSOCIATED (YL_ZTDS_TDWP)) CALL FIELD_DELETE (YL_ZTDS_TDWP)
IF (ASSOCIATED (YL_ZTDS_TDWPI)) CALL FIELD_DELETE (YL_ZTDS_TDWPI)
IF (ASSOCIATED (YL_ZTDS_TDWS)) CALL FIELD_DELETE (YL_ZTDS_TDWS)
IF (ASSOCIATED (YL_ZTDS_TDWSI)) CALL FIELD_DELETE (YL_ZTDS_TDWSI)
IF (LHOOK) CALL DR_HOOK ('DELETE_TEMPORARIES',1,ZHOOK_HANDLE_FIELD_API)
IF (LHOOK) CALL DR_HOOK ('APL_ARPEGE_SURFACE_UPDATE_PARALLEL', 1, ZHOOK_HANDLE)
END SUBROUTINE APL_ARPEGE_SURFACE_UPDATE_PARALLEL
