SUBROUTINE APL_WIND_GUST_PARALLEL (YDMF_PHYS_BASE_STATE, YDCPG_BNDS, YDCPG_OPTS&
&, YDMF_PHYS, YDVARS, YDMODEL, YD_KMOC_CLPH, YD_PBLH, YD_PDCAPE)
USE YOMHOOK,ONLY:LHOOK, DR_HOOK, JPHOOK

USE GEOMETRY_MOD,ONLY:GEOMETRY
USE MF_PHYS_BASE_STATE_TYPE_MOD,ONLY:MF_PHYS_BASE_STATE_TYPE
USE CPG_OPTS_TYPE_MOD,ONLY:CPG_BNDS_TYPE, CPG_OPTS_TYPE
USE MF_PHYS_TYPE_MOD,ONLY:MF_PHYS_TYPE
USE FIELD_VARIABLES_MOD,ONLY:FIELD_VARIABLES
USE TYPE_MODEL,ONLY:MODEL
USE FIELD_MODULE
USE FIELD_FACTORY_MODULE
USE FIELD_ACCESS_MODULE
USE FXTRAN_ACDC_PARALLELMETHOD_MOD
USE FXTRAN_ACDC_STACK_MOD
USE PARKIND1
USE FXTRAN_ACDC_ARRAY_COPY_MOD
USE FXTRAN_ACDC_GPUMEM_MOD
#include "fxtran_acdc_stack.h"

IMPLICIT NONE


TYPE (MF_PHYS_BASE_STATE_TYPE), INTENT (IN)::YDMF_PHYS_BASE_STATE
TYPE (CPG_BNDS_TYPE), INTENT (IN)::YDCPG_BNDS
TYPE (CPG_OPTS_TYPE), INTENT (IN)::YDCPG_OPTS
TYPE (MF_PHYS_TYPE), INTENT (INOUT)::YDMF_PHYS
TYPE (FIELD_VARIABLES), INTENT (INOUT)::YDVARS
TYPE (MODEL), INTENT (IN)::YDMODEL
CLASS (FIELD_2IM), POINTER :: YD_KMOC_CLPH
INTEGER (KIND=JPIM), POINTER::KMOC_CLPH (:,:)
CLASS (FIELD_2RB), POINTER :: YD_PBLH
REAL (KIND=JPRB), POINTER::PBLH (:,:)
CLASS (FIELD_2RB), POINTER :: YD_PDCAPE
REAL (KIND=JPRB), POINTER::PDCAPE (:,:)
#include "accldia.intfb.h"
#include "abor1.intfb.h"
#include "accldia_openacc.intfb.h"
REAL (KIND=JPHOOK)::ZHOOK_HANDLE
INTEGER (KIND=JPIM) :: JLON
INTEGER(KIND=JPIM) :: JBLK
TYPE(CPG_BNDS_TYPE) :: YLCPG_BNDS
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_FIELD_API
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_PARALLEL
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_COMPUTE
TYPE(FXTRAN_ACDC_STACK) :: YLSTACK
TYPE(FXTRAN_ACDC_STACK) :: YLOFFSET
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_BASE_STATE_TKE(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_BASE_STATE_U(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_BASE_STATE_V(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_CAPE(:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_UCLS(:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_UGST(:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_VCLS(:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_OUT_VGST(:,:)
REAL(KIND=JPRB), POINTER :: Z_YDVARS_GEOMETRY_OROG_T0(:,:)
IF (LHOOK) CALL DR_HOOK ('APL_WIND_GUST_PARALLEL', 0, ZHOOK_HANDLE)

CALL FXTRAN_ACDC_GPUMEMSTAT (__FILE__, __LINE__, "BEGIN")


IF (LHOOK) CALL DR_HOOK ('CREATE_TEMPORARIES',0,ZHOOK_HANDLE_FIELD_API)
IF (LHOOK) CALL DR_HOOK ('CREATE_TEMPORARIES',1,ZHOOK_HANDLE_FIELD_API)

IF (YDMODEL%YRML_PHY_MF%YRPHY2%LRAFTKE) THEN
  IF (LHOOK) CALL DR_HOOK ('APL_WIND_GUST_PARALLEL:ACCLDIA',0,ZHOOK_HANDLE_PARALLEL)

  IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','APL_WIND_GUST_PARALLEL:ACCLDIA')) THEN
    
    IF (LHOOK) CALL DR_HOOK ('APL_WIND_GUST_PARALLEL:ACCLDIA:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
    KMOC_CLPH => GET_HOST_DATA_RDWR (YD_KMOC_CLPH)
    PBLH => GET_HOST_DATA_RDWR (YD_PBLH)
    PDCAPE => GET_HOST_DATA_RDWR (YD_PDCAPE)
    Z_YDMF_PHYS_BASE_STATE_TKE => GET_HOST_DATA_RDONLY (YDMF_PHYS_BASE_STATE%F_TKE)
    Z_YDMF_PHYS_BASE_STATE_U => GET_HOST_DATA_RDONLY (YDMF_PHYS_BASE_STATE%F_U)
    Z_YDMF_PHYS_BASE_STATE_V => GET_HOST_DATA_RDONLY (YDMF_PHYS_BASE_STATE%F_V)
    Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF => GET_HOST_DATA_RDONLY (YDMF_PHYS_BASE_STATE%YCPG_DYN%F_PHIF)
    Z_YDMF_PHYS_OUT_CAPE => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_CAPE)
    Z_YDMF_PHYS_OUT_UCLS => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_UCLS)
    Z_YDMF_PHYS_OUT_UGST => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_UGST)
    Z_YDMF_PHYS_OUT_VCLS => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_VCLS)
    Z_YDMF_PHYS_OUT_VGST => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_VGST)
    Z_YDVARS_GEOMETRY_OROG_T0 => GET_HOST_DATA_RDONLY (YDVARS%GEOMETRY%OROG%FT0)
    IF (LHOOK) CALL DR_HOOK ('APL_WIND_GUST_PARALLEL:ACCLDIA:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
    IF (LHOOK) CALL DR_HOOK ('APL_WIND_GUST_PARALLEL:ACCLDIA:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
    
    CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
    !$OMP PARALLEL DO PRIVATE (JBLK) FIRSTPRIVATE (YLCPG_BNDS)

    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
      CALL YLCPG_BNDS%UPDATE (JBLK)
      
      Z_YDMF_PHYS_OUT_CAPE (:, JBLK)=0._JPRB
      PDCAPE (:, JBLK)=0._JPRB
      CALL ACCLDIA (YDMODEL%YRCST, YDCPG_OPTS%LXCLP, YDCPG_OPTS%LXTGST, YDCPG_OPTS%LXXGST, YDMODEL%YRML_PHY_MF&
      &%YRPHY, YDMODEL%YRML_PHY_MF%YRPHY2, YDMODEL%YRML_PHY_MF%YRTOPH, YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA&
      &, YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, Z_YDMF_PHYS_OUT_UCLS(:, JBLK), Z_YDMF_PHYS_OUT_VCLS(:, JBLK&
      &), Z_YDMF_PHYS_BASE_STATE_U(:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_V(:,:, JBLK), Z_YDMF_PHYS_OUT_CAPE&
      &(:, JBLK), PDCAPE(:, JBLK), Z_YDMF_PHYS_BASE_STATE_TKE(:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF&
      &(:,:, JBLK), Z_YDVARS_GEOMETRY_OROG_T0(:, JBLK), Z_YDMF_PHYS_OUT_UGST(:, JBLK), Z_YDMF_PHYS_OUT_VGST&
      &(:, JBLK), PBLH(:, JBLK), KMOC_CLPH(:, JBLK))
    ENDDO

    IF (LHOOK) CALL DR_HOOK ('APL_WIND_GUST_PARALLEL:ACCLDIA:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

    IF (FXTRAN_ACDC_LSYNCHOST ('APL_WIND_GUST_PARALLEL:ACCLDIA')) THEN
      IF (LHOOK) CALL DR_HOOK ('APL_WIND_GUST_PARALLEL:ACCLDIA:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
      KMOC_CLPH => GET_HOST_DATA_RDWR (YD_KMOC_CLPH)
      PBLH => GET_HOST_DATA_RDWR (YD_PBLH)
      PDCAPE => GET_HOST_DATA_RDWR (YD_PDCAPE)
      Z_YDMF_PHYS_BASE_STATE_TKE => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%F_TKE)
      Z_YDMF_PHYS_BASE_STATE_U => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%F_U)
      Z_YDMF_PHYS_BASE_STATE_V => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%F_V)
      Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%YCPG_DYN%F_PHIF)
      Z_YDMF_PHYS_OUT_CAPE => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_CAPE)
      Z_YDMF_PHYS_OUT_UCLS => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_UCLS)
      Z_YDMF_PHYS_OUT_UGST => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_UGST)
      Z_YDMF_PHYS_OUT_VCLS => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_VCLS)
      Z_YDMF_PHYS_OUT_VGST => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_VGST)
      Z_YDVARS_GEOMETRY_OROG_T0 => GET_HOST_DATA_RDWR (YDVARS%GEOMETRY%OROG%FT0)
      IF (LHOOK) CALL DR_HOOK ('APL_WIND_GUST_PARALLEL:ACCLDIA:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
      
      
    ENDIF

    IF (LHOOK) CALL DR_HOOK ('APL_WIND_GUST_PARALLEL:ACCLDIA:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
    KMOC_CLPH => NULL ()
    PBLH => NULL ()
    PDCAPE => NULL ()
    Z_YDMF_PHYS_BASE_STATE_TKE => NULL ()
    Z_YDMF_PHYS_BASE_STATE_U => NULL ()
    Z_YDMF_PHYS_BASE_STATE_V => NULL ()
    Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF => NULL ()
    Z_YDMF_PHYS_OUT_CAPE => NULL ()
    Z_YDMF_PHYS_OUT_UCLS => NULL ()
    Z_YDMF_PHYS_OUT_UGST => NULL ()
    Z_YDMF_PHYS_OUT_VCLS => NULL ()
    Z_YDMF_PHYS_OUT_VGST => NULL ()
    Z_YDVARS_GEOMETRY_OROG_T0 => NULL ()
    IF (LHOOK) CALL DR_HOOK ('APL_WIND_GUST_PARALLEL:ACCLDIA:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMPSINGLECOLUMN','APL_WIND_GUST_PARALLEL:ACCLDIA')) THEN
    
    IF (LHOOK) CALL DR_HOOK ('APL_WIND_GUST_PARALLEL:ACCLDIA:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
    KMOC_CLPH => GET_HOST_DATA_RDWR (YD_KMOC_CLPH)
    PBLH => GET_HOST_DATA_RDWR (YD_PBLH)
    PDCAPE => GET_HOST_DATA_RDWR (YD_PDCAPE)
    Z_YDMF_PHYS_BASE_STATE_TKE => GET_HOST_DATA_RDONLY (YDMF_PHYS_BASE_STATE%F_TKE)
    Z_YDMF_PHYS_BASE_STATE_U => GET_HOST_DATA_RDONLY (YDMF_PHYS_BASE_STATE%F_U)
    Z_YDMF_PHYS_BASE_STATE_V => GET_HOST_DATA_RDONLY (YDMF_PHYS_BASE_STATE%F_V)
    Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF => GET_HOST_DATA_RDONLY (YDMF_PHYS_BASE_STATE%YCPG_DYN%F_PHIF)
    Z_YDMF_PHYS_OUT_CAPE => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_CAPE)
    Z_YDMF_PHYS_OUT_UCLS => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_UCLS)
    Z_YDMF_PHYS_OUT_UGST => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_UGST)
    Z_YDMF_PHYS_OUT_VCLS => GET_HOST_DATA_RDONLY (YDMF_PHYS%OUT%F_VCLS)
    Z_YDMF_PHYS_OUT_VGST => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_VGST)
    Z_YDVARS_GEOMETRY_OROG_T0 => GET_HOST_DATA_RDONLY (YDVARS%GEOMETRY%OROG%FT0)
    IF (LHOOK) CALL DR_HOOK ('APL_WIND_GUST_PARALLEL:ACCLDIA:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
    IF (LHOOK) CALL DR_HOOK ('APL_WIND_GUST_PARALLEL:ACCLDIA:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
    
    !$OMP PARALLEL DO PRIVATE (JBLK, JLON, YLCPG_BNDS, YLSTACK)

    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX

      

      

      DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
        YLCPG_BNDS%KIDIA = JLON
        YLCPG_BNDS%KFDIA = JLON
        YLSTACK%L8 = fxtran_acdc_stack_l8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
        YLSTACK%U8 = fxtran_acdc_stack_u8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
        YLSTACK%L4 = fxtran_acdc_stack_l4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
        YLSTACK%U4 = fxtran_acdc_stack_u4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
        
        Z_YDMF_PHYS_OUT_CAPE (JLON, JBLK)=0._JPRB
        PDCAPE (JLON, JBLK)=0._JPRB
        CALL ACCLDIA_OPENACC (YDMODEL%YRCST, YDCPG_OPTS%LXCLP, YDCPG_OPTS%LXTGST, YDCPG_OPTS%LXXGST, YDMODEL&
        &%YRML_PHY_MF%YRPHY, YDMODEL%YRML_PHY_MF%YRPHY2, YDMODEL%YRML_PHY_MF%YRTOPH, YLCPG_BNDS%KIDIA, YLCPG_BNDS&
        &%KFDIA, YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, Z_YDMF_PHYS_OUT_UCLS(:, JBLK), Z_YDMF_PHYS_OUT_VCLS(&
        &:, JBLK), Z_YDMF_PHYS_BASE_STATE_U(:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_V(:,:, JBLK), Z_YDMF_PHYS_OUT_CAPE&
        &(:, JBLK), PDCAPE(:, JBLK), Z_YDMF_PHYS_BASE_STATE_TKE(:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF&
        &(:,:, JBLK), Z_YDVARS_GEOMETRY_OROG_T0(:, JBLK), Z_YDMF_PHYS_OUT_UGST(:, JBLK), Z_YDMF_PHYS_OUT_VGST&
        &(:, JBLK), PBLH(:, JBLK), KMOC_CLPH(:, JBLK),YDSTACK=YLSTACK)
      ENDDO

    ENDDO

    IF (LHOOK) CALL DR_HOOK ('APL_WIND_GUST_PARALLEL:ACCLDIA:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

    IF (FXTRAN_ACDC_LSYNCHOST ('APL_WIND_GUST_PARALLEL:ACCLDIA')) THEN
      IF (LHOOK) CALL DR_HOOK ('APL_WIND_GUST_PARALLEL:ACCLDIA:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
      KMOC_CLPH => GET_HOST_DATA_RDWR (YD_KMOC_CLPH)
      PBLH => GET_HOST_DATA_RDWR (YD_PBLH)
      PDCAPE => GET_HOST_DATA_RDWR (YD_PDCAPE)
      Z_YDMF_PHYS_BASE_STATE_TKE => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%F_TKE)
      Z_YDMF_PHYS_BASE_STATE_U => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%F_U)
      Z_YDMF_PHYS_BASE_STATE_V => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%F_V)
      Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%YCPG_DYN%F_PHIF)
      Z_YDMF_PHYS_OUT_CAPE => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_CAPE)
      Z_YDMF_PHYS_OUT_UCLS => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_UCLS)
      Z_YDMF_PHYS_OUT_UGST => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_UGST)
      Z_YDMF_PHYS_OUT_VCLS => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_VCLS)
      Z_YDMF_PHYS_OUT_VGST => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_VGST)
      Z_YDVARS_GEOMETRY_OROG_T0 => GET_HOST_DATA_RDWR (YDVARS%GEOMETRY%OROG%FT0)
      IF (LHOOK) CALL DR_HOOK ('APL_WIND_GUST_PARALLEL:ACCLDIA:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
      
      
    ENDIF

    IF (LHOOK) CALL DR_HOOK ('APL_WIND_GUST_PARALLEL:ACCLDIA:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
    KMOC_CLPH => NULL ()
    PBLH => NULL ()
    PDCAPE => NULL ()
    Z_YDMF_PHYS_BASE_STATE_TKE => NULL ()
    Z_YDMF_PHYS_BASE_STATE_U => NULL ()
    Z_YDMF_PHYS_BASE_STATE_V => NULL ()
    Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF => NULL ()
    Z_YDMF_PHYS_OUT_CAPE => NULL ()
    Z_YDMF_PHYS_OUT_UCLS => NULL ()
    Z_YDMF_PHYS_OUT_UGST => NULL ()
    Z_YDMF_PHYS_OUT_VCLS => NULL ()
    Z_YDMF_PHYS_OUT_VGST => NULL ()
    Z_YDVARS_GEOMETRY_OROG_T0 => NULL ()
    IF (LHOOK) CALL DR_HOOK ('APL_WIND_GUST_PARALLEL:ACCLDIA:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN','APL_WIND_GUST_PARALLEL:ACCLDIA')) THEN
    
    IF (LHOOK) CALL DR_HOOK ('APL_WIND_GUST_PARALLEL:ACCLDIA:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
    KMOC_CLPH => GET_DEVICE_DATA_RDWR (YD_KMOC_CLPH)
    PBLH => GET_DEVICE_DATA_RDWR (YD_PBLH)
    PDCAPE => GET_DEVICE_DATA_RDWR (YD_PDCAPE)
    Z_YDMF_PHYS_BASE_STATE_TKE => GET_DEVICE_DATA_RDONLY (YDMF_PHYS_BASE_STATE%F_TKE)
    Z_YDMF_PHYS_BASE_STATE_U => GET_DEVICE_DATA_RDONLY (YDMF_PHYS_BASE_STATE%F_U)
    Z_YDMF_PHYS_BASE_STATE_V => GET_DEVICE_DATA_RDONLY (YDMF_PHYS_BASE_STATE%F_V)
    Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF => GET_DEVICE_DATA_RDONLY&
    & (YDMF_PHYS_BASE_STATE%YCPG_DYN%F_PHIF)
    Z_YDMF_PHYS_OUT_CAPE => GET_DEVICE_DATA_RDWR (YDMF_PHYS%OUT%F_CAPE)
    Z_YDMF_PHYS_OUT_UCLS => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_UCLS)
    Z_YDMF_PHYS_OUT_UGST => GET_DEVICE_DATA_RDWR (YDMF_PHYS%OUT%F_UGST)
    Z_YDMF_PHYS_OUT_VCLS => GET_DEVICE_DATA_RDONLY (YDMF_PHYS%OUT%F_VCLS)
    Z_YDMF_PHYS_OUT_VGST => GET_DEVICE_DATA_RDWR (YDMF_PHYS%OUT%F_VGST)
    Z_YDVARS_GEOMETRY_OROG_T0 => GET_DEVICE_DATA_RDONLY (YDVARS%GEOMETRY%OROG%FT0)
    IF (LHOOK) CALL DR_HOOK ('APL_WIND_GUST_PARALLEL:ACCLDIA:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
    IF (LHOOK) CALL DR_HOOK ('APL_WIND_GUST_PARALLEL:ACCLDIA:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
    
    
      !$ACC PARALLEL LOOP GANG &
      !$ACC&PRESENT (KMOC_CLPH, PBLH, PDCAPE, YDCPG_OPTS, YDMODEL, YFXTRAN_ACDC_STACK, &
      !$ACC&         Z_YDMF_PHYS_BASE_STATE_TKE, Z_YDMF_PHYS_BASE_STATE_U, Z_YDMF_PHYS_BASE_STATE_V, &
      !$ACC&         Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF, Z_YDMF_PHYS_OUT_CAPE, &
      !$ACC&         Z_YDMF_PHYS_OUT_UCLS, Z_YDMF_PHYS_OUT_UGST, Z_YDMF_PHYS_OUT_VCLS, &
      !$ACC&         Z_YDMF_PHYS_OUT_VGST, Z_YDVARS_GEOMETRY_OROG_T0) &
      !$ACC&PRIVATE (JBLK) &
      !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
      
      DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
      
      
      
      !$ACC LOOP VECTOR &
      !$ACC&PRIVATE (JLON, YLCPG_BNDS, YLSTACK) 

      

      DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
        YLCPG_BNDS%KIDIA = JLON
        YLCPG_BNDS%KFDIA = JLON
        YLSTACK%L8 = fxtran_acdc_stack_l8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
        YLSTACK%U8 = fxtran_acdc_stack_u8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
        YLSTACK%L4 = fxtran_acdc_stack_l4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
        YLSTACK%U4 = fxtran_acdc_stack_u4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
        
        Z_YDMF_PHYS_OUT_CAPE (JLON, JBLK)=0._JPRB
        PDCAPE (JLON, JBLK)=0._JPRB
        CALL ACCLDIA_OPENACC (YDMODEL%YRCST, YDCPG_OPTS%LXCLP, YDCPG_OPTS%LXTGST, YDCPG_OPTS%LXXGST, YDMODEL&
        &%YRML_PHY_MF%YRPHY, YDMODEL%YRML_PHY_MF%YRPHY2, YDMODEL%YRML_PHY_MF%YRTOPH, YLCPG_BNDS%KIDIA, YLCPG_BNDS&
        &%KFDIA, YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, Z_YDMF_PHYS_OUT_UCLS(:, JBLK), Z_YDMF_PHYS_OUT_VCLS(&
        &:, JBLK), Z_YDMF_PHYS_BASE_STATE_U(:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_V(:,:, JBLK), Z_YDMF_PHYS_OUT_CAPE&
        &(:, JBLK), PDCAPE(:, JBLK), Z_YDMF_PHYS_BASE_STATE_TKE(:,:, JBLK), Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF&
        &(:,:, JBLK), Z_YDVARS_GEOMETRY_OROG_T0(:, JBLK), Z_YDMF_PHYS_OUT_UGST(:, JBLK), Z_YDMF_PHYS_OUT_VGST&
        &(:, JBLK), PBLH(:, JBLK), KMOC_CLPH(:, JBLK),YDSTACK=YLSTACK)
      ENDDO

    ENDDO

    IF (LHOOK) CALL DR_HOOK ('APL_WIND_GUST_PARALLEL:ACCLDIA:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

    IF (FXTRAN_ACDC_LSYNCHOST ('APL_WIND_GUST_PARALLEL:ACCLDIA')) THEN
      IF (LHOOK) CALL DR_HOOK ('APL_WIND_GUST_PARALLEL:ACCLDIA:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
      KMOC_CLPH => GET_HOST_DATA_RDWR (YD_KMOC_CLPH)
      PBLH => GET_HOST_DATA_RDWR (YD_PBLH)
      PDCAPE => GET_HOST_DATA_RDWR (YD_PDCAPE)
      Z_YDMF_PHYS_BASE_STATE_TKE => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%F_TKE)
      Z_YDMF_PHYS_BASE_STATE_U => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%F_U)
      Z_YDMF_PHYS_BASE_STATE_V => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%F_V)
      Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%YCPG_DYN%F_PHIF)
      Z_YDMF_PHYS_OUT_CAPE => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_CAPE)
      Z_YDMF_PHYS_OUT_UCLS => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_UCLS)
      Z_YDMF_PHYS_OUT_UGST => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_UGST)
      Z_YDMF_PHYS_OUT_VCLS => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_VCLS)
      Z_YDMF_PHYS_OUT_VGST => GET_HOST_DATA_RDWR (YDMF_PHYS%OUT%F_VGST)
      Z_YDVARS_GEOMETRY_OROG_T0 => GET_HOST_DATA_RDWR (YDVARS%GEOMETRY%OROG%FT0)
      IF (LHOOK) CALL DR_HOOK ('APL_WIND_GUST_PARALLEL:ACCLDIA:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
      
      
    ENDIF

    IF (LHOOK) CALL DR_HOOK ('APL_WIND_GUST_PARALLEL:ACCLDIA:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
    KMOC_CLPH => NULL ()
    PBLH => NULL ()
    PDCAPE => NULL ()
    Z_YDMF_PHYS_BASE_STATE_TKE => NULL ()
    Z_YDMF_PHYS_BASE_STATE_U => NULL ()
    Z_YDMF_PHYS_BASE_STATE_V => NULL ()
    Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_PHIF => NULL ()
    Z_YDMF_PHYS_OUT_CAPE => NULL ()
    Z_YDMF_PHYS_OUT_UCLS => NULL ()
    Z_YDMF_PHYS_OUT_UGST => NULL ()
    Z_YDMF_PHYS_OUT_VCLS => NULL ()
    Z_YDMF_PHYS_OUT_VGST => NULL ()
    Z_YDVARS_GEOMETRY_OROG_T0 => NULL ()
    IF (LHOOK) CALL DR_HOOK ('APL_WIND_GUST_PARALLEL:ACCLDIA:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ELSE
      CALL ABOR1 ('APL_WIND_GUST_PARALLEL: NOT METHOD WAS FOUND')
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('APL_WIND_GUST_PARALLEL:ACCLDIA',1,ZHOOK_HANDLE_PARALLEL)
ENDIF


CALL FXTRAN_ACDC_GPUMEMSTAT (__FILE__, __LINE__, "END")

IF (LHOOK) CALL DR_HOOK ('DELETE_TEMPORARIES',0,ZHOOK_HANDLE_FIELD_API)
IF (LHOOK) CALL DR_HOOK ('DELETE_TEMPORARIES',1,ZHOOK_HANDLE_FIELD_API)
IF (LHOOK) CALL DR_HOOK ('APL_WIND_GUST_PARALLEL', 1, ZHOOK_HANDLE)
END SUBROUTINE APL_WIND_GUST_PARALLEL
