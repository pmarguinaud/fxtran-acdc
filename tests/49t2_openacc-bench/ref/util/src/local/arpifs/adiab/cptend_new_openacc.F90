SUBROUTINE CPTEND_NEW_OPENACC (YDCST, YDMODEL, KLON, KIDIA, KFDIA, KFLEV, PGNORDL, PGNORDM, PDIFCQ, PDIFCQI&
&, PDIFCQL, PDIFCS, PDIFEXT, PDIFTQ, PDIFTQI, PDIFTQL, PDIFTS, PFCCQL, PFCCQN, PFCSQL, PFCSQN, PFPLSL&
&, PFPLSN, PFPLSG, PFPLCL, PFPLCN, PFPLCG, PFESL, PFESN, PFESG, PFECL, PFECN, PFECG, PFASL, PFASN, PFASG&
&, PFACL, PFACN, PFCQLNG, PFCQING, PFCQRNG, PFCQSNG, PFCQGNG, PFCQNG, PFRMH, PFRMQ, PFCHQ, PFRSO, PFRTH&
&, PSTRCU, PSTRCV, PSTRDU, PSTRDV, PSTRTU, PSTRTV, PSTRMU, PSTRMV, PDIFCQLC, PDIFCQIC, PFIMCC, PFEDQLC&
&, PFEDQIC, PFEDQRC, PFEDQSC, PFCNEGQLC, PFCNEGQIC, PFCNEGQRC, PFCNEGQSC, PFTKE, PFTKEI, PFEFB1, PFEFB2&
&, PFEFB3, PDELP, PRDELP, PAPHIF, PCP, PU, PV, PT, PQ, PQI, PQL, PQLCONV, PQICONV, PQRCONV, PQSCONV, PQR&
&, PQS, PQG, PCPS, PTS, PFHSCL, PFHSCN, PFHSSL, PFHSSN, PFHSSG, PFHPCL, PFHPCN, PFHPCG, PFHPSL, PFHPSN&
&, PFHPSG, PFHP, PFP, PFEPFP, PFCMPCQ, PFCMPSN, PFCMPSL, PTENDU, PTENDV, PTENDU_ZDEC, PTENDV_ZDEC, PTENDH&
&, PTENDQ, PTENDQI, PTENDQL, PTENDQLCONV, PTENDQICONV, PTENDQRCONV, PTENDQSCONV, PTENDQR, PTENDQS, PTENDQG&
&, PTENDTKE, PTENDEFB1, PTENDEFB2, PTENDEFB3, PTENDEXT, YDDDH, YDSTACK)
!$ACC ROUTINE (CPTEND_NEW_OPENACC) SEQ
USE TYPE_MODEL,ONLY:MODEL
USE PARKIND1,ONLY:JPIM, JPRB, JPRD

USE DDH_MIX,ONLY:ADD_FIELD_3D, NEW_ADD_FIELD_3D, TYP_DDH
USE YOMLSFORC,ONLY:LMUSCLFA, NMUSCLFA
USE YOMCST,ONLY:TCST
#include "fxtran_acdc_stack.h"
USE FXTRAN_ACDC_STACK_MOD
USE FXTRAN_ACDC_ABORT_MOD

IMPLICIT NONE


TYPE (TCST), INTENT (IN)::YDCST
TYPE (MODEL), INTENT (IN)::YDMODEL
INTEGER (KIND=JPIM), INTENT (IN)::KLON
INTEGER (KIND=JPIM), INTENT (IN)::KIDIA
INTEGER (KIND=JPIM), INTENT (IN)::KFDIA
INTEGER (KIND=JPIM), INTENT (IN)::KFLEV
REAL (KIND=JPRB), INTENT (IN)::PGNORDL (KLON)
REAL (KIND=JPRB), INTENT (IN)::PGNORDM (KLON)
REAL (KIND=JPRB), INTENT (IN)::PDIFCQ (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PDIFCQI (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PDIFCQL (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PDIFCS (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PDIFEXT (KLON, 0:KFLEV, 1:YDMODEL%YRML_GCONF%YGFL%NGFL_EXT)
REAL (KIND=JPRB), INTENT (IN)::PDIFTQ (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PDIFTQI (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PDIFTQL (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PDIFTS (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFCCQL (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFCCQN (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFCSQL (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFCSQN (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFPLSL (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFPLSN (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFPLSG (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFPLCL (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFPLCN (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFPLCG (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFESL (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFESN (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFESG (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFECL (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFECN (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFECG (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFASL (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFASN (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFASG (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFACL (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFACN (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFCQLNG (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFCQING (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFCQRNG (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFCQSNG (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFCQGNG (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFCQNG (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFRMH (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFRMQ (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFCHQ (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFRSO (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFRTH (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PSTRCU (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PSTRCV (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PSTRDU (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PSTRDV (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PSTRTU (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PSTRTV (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PSTRMU (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PSTRMV (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PDIFCQLC (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PDIFCQIC (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFIMCC (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFEDQLC (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFEDQIC (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFEDQRC (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFEDQSC (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFCNEGQLC (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFCNEGQIC (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFCNEGQRC (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFCNEGQSC (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFTKE (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFTKEI (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFEFB1 (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFEFB2 (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PFEFB3 (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PDELP (KLON, KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PRDELP (KLON, KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PAPHIF (KLON, KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PCP (KLON, KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PU (KLON, KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PV (KLON, KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PT (KLON, KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PQ (KLON, KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PQI (KLON, KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PQL (KLON, KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PQLCONV (KLON, KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PQICONV (KLON, KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PQRCONV (KLON, KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PQSCONV (KLON, KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PQR (KLON, KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PQS (KLON, KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PQG (KLON, KFLEV)
REAL (KIND=JPRB), INTENT (IN)::PCPS (KLON)
REAL (KIND=JPRB), INTENT (IN)::PTS (KLON)
REAL (KIND=JPRB), INTENT (OUT)::PFHSCL (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (OUT)::PFHSCN (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (OUT)::PFHSSL (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (OUT)::PFHSSN (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (OUT)::PFHSSG (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (OUT)::PFHPCL (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (OUT)::PFHPCN (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (OUT)::PFHPCG (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (OUT)::PFHPSL (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (OUT)::PFHPSN (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (OUT)::PFHPSG (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (OUT)::PFHP (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (OUT)::PFP (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (OUT)::PFEPFP (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (OUT)::PFCMPCQ (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (OUT)::PFCMPSN (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (OUT)::PFCMPSL (KLON, 0:KFLEV)
REAL (KIND=JPRB), INTENT (OUT)::PTENDU (KLON, KFLEV)
REAL (KIND=JPRB), INTENT (OUT)::PTENDV (KLON, KFLEV)
REAL (KIND=JPRB), INTENT (OUT)::PTENDU_ZDEC (KLON, KFLEV)
REAL (KIND=JPRB), INTENT (OUT)::PTENDV_ZDEC (KLON, KFLEV)
REAL (KIND=JPRB), INTENT (OUT)::PTENDH (KLON, KFLEV)
REAL (KIND=JPRB), INTENT (OUT)::PTENDQ (KLON, KFLEV)
REAL (KIND=JPRB), INTENT (OUT)::PTENDQI (KLON, KFLEV)
REAL (KIND=JPRB), INTENT (OUT)::PTENDQL (KLON, KFLEV)
REAL (KIND=JPRB), INTENT (OUT)::PTENDQLCONV (KLON, KFLEV)
REAL (KIND=JPRB), INTENT (OUT)::PTENDQICONV (KLON, KFLEV)
REAL (KIND=JPRB), INTENT (OUT)::PTENDQRCONV (KLON, KFLEV)
REAL (KIND=JPRB), INTENT (OUT)::PTENDQSCONV (KLON, KFLEV)
REAL (KIND=JPRB), INTENT (OUT)::PTENDQR (KLON, KFLEV)
REAL (KIND=JPRB), INTENT (OUT)::PTENDQS (KLON, KFLEV)
REAL (KIND=JPRB), INTENT (OUT)::PTENDQG (KLON, KFLEV)
REAL (KIND=JPRB), INTENT (OUT)::PTENDTKE (KLON, KFLEV)
REAL (KIND=JPRB), INTENT (OUT)::PTENDEFB1 (KLON, KFLEV)
REAL (KIND=JPRB), INTENT (OUT)::PTENDEFB2 (KLON, KFLEV)
REAL (KIND=JPRB), INTENT (OUT)::PTENDEFB3 (KLON, KFLEV)
REAL (KIND=JPRB), INTENT (OUT)::PTENDEXT (KLON, KFLEV, YDMODEL%YRML_GCONF%YGFL%NGFL_EXT)
TYPE (TYP_DDH), INTENT (INOUT)::YDDDH
TYPE(FXTRAN_ACDC_STACK), INTENT (IN) :: YDSTACK
TYPE(FXTRAN_ACDC_STACK) :: YLSTACK
fxtran_acdc_temp (REAL (KIND=JPRB), ZGSDP, (KLON, KFLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZJTOT, (KLON, 0:KFLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZFHSENS, (KLON, 0:KFLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZFHDPSFI, (KLON, 0:KFLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZTI, (KLON, 0:KFLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZQH, (KLON, 0:KFLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZQLH, (KLON, 0:KFLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZQIH, (KLON, 0:KFLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZQRH, (KLON, 0:KFLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZQSH, (KLON, 0:KFLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZQGH, (KLON, 0:KFLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZCHAT, (KLON, 0:KFLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZLIFT, (KLON, 0:KFLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZFPL, (KLON, 0:KFLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZFPN, (KLON, 0:KFLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZFPG, (KLON, 0:KFLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZFPLSL, (KLON, 0:KFLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZFPLSN, (KLON, 0:KFLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZFPLSG, (KLON, 0:KFLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZFPLCL, (KLON, 0:KFLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZFPLCN, (KLON, 0:KFLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZFPLCG, (KLON, 0:KFLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZFHIMCC, (KLON, 0:KFLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZTMPVAR, (KLON, KFLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZTMPFLUX, (KLON, 0:KFLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZSTTVG, (KLON, 0:KFLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZSTTUG, (KLON, 0:KFLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZSTCVG, (KLON, 0:KFLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZSTCUG, (KLON, 0:KFLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZSTDVG, (KLON, 0:KFLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZSTDUG, (KLON, 0:KFLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZTNDKKD, (KLON, KFLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZTNDKKC, (KLON, KFLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZKENE, (KLON, KFLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZTNDKKT, (KLON, KFLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZVMGEO, (KLON, KFLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZUZGEO, (KLON, KFLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZQ2, (KLON, KFLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZQ1, (KLON, KFLEV))
REAL (KIND=JPRB)::ZCPH
INTEGER (KIND=JPIM)::JGFL
INTEGER (KIND=JPIM)::JLON
INTEGER (KIND=JPIM)::JLEV
LOGICAL::LLDPSFI

#include "wrscmr.intfb.h"
#include "fcttrm.func.h"

YLSTACK = YDSTACK



IF (KIND (ZGSDP) == 8) THEN
    fxtran_acdc_alloc8 (ZGSDP)
ELSEIF (KIND (ZGSDP) == 4) THEN
    fxtran_acdc_alloc4 (ZGSDP)
ELSE
    STOP 1
ENDIF


IF (KIND (ZJTOT) == 8) THEN
    fxtran_acdc_alloc8 (ZJTOT)
ELSEIF (KIND (ZJTOT) == 4) THEN
    fxtran_acdc_alloc4 (ZJTOT)
ELSE
    STOP 1
ENDIF


IF (KIND (ZFHSENS) == 8) THEN
    fxtran_acdc_alloc8 (ZFHSENS)
ELSEIF (KIND (ZFHSENS) == 4) THEN
    fxtran_acdc_alloc4 (ZFHSENS)
ELSE
    STOP 1
ENDIF


IF (KIND (ZFHDPSFI) == 8) THEN
    fxtran_acdc_alloc8 (ZFHDPSFI)
ELSEIF (KIND (ZFHDPSFI) == 4) THEN
    fxtran_acdc_alloc4 (ZFHDPSFI)
ELSE
    STOP 1
ENDIF


IF (KIND (ZTI) == 8) THEN
    fxtran_acdc_alloc8 (ZTI)
ELSEIF (KIND (ZTI) == 4) THEN
    fxtran_acdc_alloc4 (ZTI)
ELSE
    STOP 1
ENDIF


IF (KIND (ZQH) == 8) THEN
    fxtran_acdc_alloc8 (ZQH)
ELSEIF (KIND (ZQH) == 4) THEN
    fxtran_acdc_alloc4 (ZQH)
ELSE
    STOP 1
ENDIF


IF (KIND (ZQLH) == 8) THEN
    fxtran_acdc_alloc8 (ZQLH)
ELSEIF (KIND (ZQLH) == 4) THEN
    fxtran_acdc_alloc4 (ZQLH)
ELSE
    STOP 1
ENDIF


IF (KIND (ZQIH) == 8) THEN
    fxtran_acdc_alloc8 (ZQIH)
ELSEIF (KIND (ZQIH) == 4) THEN
    fxtran_acdc_alloc4 (ZQIH)
ELSE
    STOP 1
ENDIF


IF (KIND (ZQRH) == 8) THEN
    fxtran_acdc_alloc8 (ZQRH)
ELSEIF (KIND (ZQRH) == 4) THEN
    fxtran_acdc_alloc4 (ZQRH)
ELSE
    STOP 1
ENDIF


IF (KIND (ZQSH) == 8) THEN
    fxtran_acdc_alloc8 (ZQSH)
ELSEIF (KIND (ZQSH) == 4) THEN
    fxtran_acdc_alloc4 (ZQSH)
ELSE
    STOP 1
ENDIF


IF (KIND (ZQGH) == 8) THEN
    fxtran_acdc_alloc8 (ZQGH)
ELSEIF (KIND (ZQGH) == 4) THEN
    fxtran_acdc_alloc4 (ZQGH)
ELSE
    STOP 1
ENDIF


IF (KIND (ZCHAT) == 8) THEN
    fxtran_acdc_alloc8 (ZCHAT)
ELSEIF (KIND (ZCHAT) == 4) THEN
    fxtran_acdc_alloc4 (ZCHAT)
ELSE
    STOP 1
ENDIF


IF (KIND (ZLIFT) == 8) THEN
    fxtran_acdc_alloc8 (ZLIFT)
ELSEIF (KIND (ZLIFT) == 4) THEN
    fxtran_acdc_alloc4 (ZLIFT)
ELSE
    STOP 1
ENDIF


IF (KIND (ZFPL) == 8) THEN
    fxtran_acdc_alloc8 (ZFPL)
ELSEIF (KIND (ZFPL) == 4) THEN
    fxtran_acdc_alloc4 (ZFPL)
ELSE
    STOP 1
ENDIF


IF (KIND (ZFPN) == 8) THEN
    fxtran_acdc_alloc8 (ZFPN)
ELSEIF (KIND (ZFPN) == 4) THEN
    fxtran_acdc_alloc4 (ZFPN)
ELSE
    STOP 1
ENDIF


IF (KIND (ZFPG) == 8) THEN
    fxtran_acdc_alloc8 (ZFPG)
ELSEIF (KIND (ZFPG) == 4) THEN
    fxtran_acdc_alloc4 (ZFPG)
ELSE
    STOP 1
ENDIF


IF (KIND (ZFPLSL) == 8) THEN
    fxtran_acdc_alloc8 (ZFPLSL)
ELSEIF (KIND (ZFPLSL) == 4) THEN
    fxtran_acdc_alloc4 (ZFPLSL)
ELSE
    STOP 1
ENDIF


IF (KIND (ZFPLSN) == 8) THEN
    fxtran_acdc_alloc8 (ZFPLSN)
ELSEIF (KIND (ZFPLSN) == 4) THEN
    fxtran_acdc_alloc4 (ZFPLSN)
ELSE
    STOP 1
ENDIF


IF (KIND (ZFPLSG) == 8) THEN
    fxtran_acdc_alloc8 (ZFPLSG)
ELSEIF (KIND (ZFPLSG) == 4) THEN
    fxtran_acdc_alloc4 (ZFPLSG)
ELSE
    STOP 1
ENDIF


IF (KIND (ZFPLCL) == 8) THEN
    fxtran_acdc_alloc8 (ZFPLCL)
ELSEIF (KIND (ZFPLCL) == 4) THEN
    fxtran_acdc_alloc4 (ZFPLCL)
ELSE
    STOP 1
ENDIF


IF (KIND (ZFPLCN) == 8) THEN
    fxtran_acdc_alloc8 (ZFPLCN)
ELSEIF (KIND (ZFPLCN) == 4) THEN
    fxtran_acdc_alloc4 (ZFPLCN)
ELSE
    STOP 1
ENDIF


IF (KIND (ZFPLCG) == 8) THEN
    fxtran_acdc_alloc8 (ZFPLCG)
ELSEIF (KIND (ZFPLCG) == 4) THEN
    fxtran_acdc_alloc4 (ZFPLCG)
ELSE
    STOP 1
ENDIF


IF (KIND (ZFHIMCC) == 8) THEN
    fxtran_acdc_alloc8 (ZFHIMCC)
ELSEIF (KIND (ZFHIMCC) == 4) THEN
    fxtran_acdc_alloc4 (ZFHIMCC)
ELSE
    STOP 1
ENDIF


IF (KIND (ZTMPVAR) == 8) THEN
    fxtran_acdc_alloc8 (ZTMPVAR)
ELSEIF (KIND (ZTMPVAR) == 4) THEN
    fxtran_acdc_alloc4 (ZTMPVAR)
ELSE
    STOP 1
ENDIF


IF (KIND (ZTMPFLUX) == 8) THEN
    fxtran_acdc_alloc8 (ZTMPFLUX)
ELSEIF (KIND (ZTMPFLUX) == 4) THEN
    fxtran_acdc_alloc4 (ZTMPFLUX)
ELSE
    STOP 1
ENDIF


IF (KIND (ZSTTVG) == 8) THEN
    fxtran_acdc_alloc8 (ZSTTVG)
ELSEIF (KIND (ZSTTVG) == 4) THEN
    fxtran_acdc_alloc4 (ZSTTVG)
ELSE
    STOP 1
ENDIF


IF (KIND (ZSTTUG) == 8) THEN
    fxtran_acdc_alloc8 (ZSTTUG)
ELSEIF (KIND (ZSTTUG) == 4) THEN
    fxtran_acdc_alloc4 (ZSTTUG)
ELSE
    STOP 1
ENDIF


IF (KIND (ZSTCVG) == 8) THEN
    fxtran_acdc_alloc8 (ZSTCVG)
ELSEIF (KIND (ZSTCVG) == 4) THEN
    fxtran_acdc_alloc4 (ZSTCVG)
ELSE
    STOP 1
ENDIF


IF (KIND (ZSTCUG) == 8) THEN
    fxtran_acdc_alloc8 (ZSTCUG)
ELSEIF (KIND (ZSTCUG) == 4) THEN
    fxtran_acdc_alloc4 (ZSTCUG)
ELSE
    STOP 1
ENDIF


IF (KIND (ZSTDVG) == 8) THEN
    fxtran_acdc_alloc8 (ZSTDVG)
ELSEIF (KIND (ZSTDVG) == 4) THEN
    fxtran_acdc_alloc4 (ZSTDVG)
ELSE
    STOP 1
ENDIF


IF (KIND (ZSTDUG) == 8) THEN
    fxtran_acdc_alloc8 (ZSTDUG)
ELSEIF (KIND (ZSTDUG) == 4) THEN
    fxtran_acdc_alloc4 (ZSTDUG)
ELSE
    STOP 1
ENDIF


IF (KIND (ZTNDKKD) == 8) THEN
    fxtran_acdc_alloc8 (ZTNDKKD)
ELSEIF (KIND (ZTNDKKD) == 4) THEN
    fxtran_acdc_alloc4 (ZTNDKKD)
ELSE
    STOP 1
ENDIF


IF (KIND (ZTNDKKC) == 8) THEN
    fxtran_acdc_alloc8 (ZTNDKKC)
ELSEIF (KIND (ZTNDKKC) == 4) THEN
    fxtran_acdc_alloc4 (ZTNDKKC)
ELSE
    STOP 1
ENDIF


IF (KIND (ZKENE) == 8) THEN
    fxtran_acdc_alloc8 (ZKENE)
ELSEIF (KIND (ZKENE) == 4) THEN
    fxtran_acdc_alloc4 (ZKENE)
ELSE
    STOP 1
ENDIF


IF (KIND (ZTNDKKT) == 8) THEN
    fxtran_acdc_alloc8 (ZTNDKKT)
ELSEIF (KIND (ZTNDKKT) == 4) THEN
    fxtran_acdc_alloc4 (ZTNDKKT)
ELSE
    STOP 1
ENDIF


IF (KIND (ZVMGEO) == 8) THEN
    fxtran_acdc_alloc8 (ZVMGEO)
ELSEIF (KIND (ZVMGEO) == 4) THEN
    fxtran_acdc_alloc4 (ZVMGEO)
ELSE
    STOP 1
ENDIF


IF (KIND (ZUZGEO) == 8) THEN
    fxtran_acdc_alloc8 (ZUZGEO)
ELSEIF (KIND (ZUZGEO) == 4) THEN
    fxtran_acdc_alloc4 (ZUZGEO)
ELSE
    STOP 1
ENDIF


IF (KIND (ZQ2) == 8) THEN
    fxtran_acdc_alloc8 (ZQ2)
ELSEIF (KIND (ZQ2) == 4) THEN
    fxtran_acdc_alloc4 (ZQ2)
ELSE
    STOP 1
ENDIF


IF (KIND (ZQ1) == 8) THEN
    fxtran_acdc_alloc8 (ZQ1)
ELSEIF (KIND (ZQ1) == 4) THEN
    fxtran_acdc_alloc4 (ZQ1)
ELSE
    STOP 1
ENDIF


JLON = KIDIA




LLDPSFI=(YDMODEL%YRML_PHY_MF%YRPHY%NDPSFI==1)
ZLIFT(JLON,:)=0.0_JPRB
ZCHAT(JLON,:)=0.0_JPRB

IF (YDMODEL%YRML_PHY_MF%YRPHY%LGPCMT) THEN
  
  ZFHIMCC (JLON, 0)=0._JPRB

  

  DO JLEV=1, KFLEV
    
    ZFHIMCC (JLON, JLEV)=ZFHIMCC (JLON, JLEV-1)+(PFIMCC (JLON, JLEV&
    &)-PFIMCC (JLON, JLEV-1))*(YDCST%RLVZER-YDCST%RLSZER)
  
  ENDDO

ELSE
  ZFHIMCC (JLON,:)=0._JPRB
ENDIF


IF (YDMODEL%YRML_PHY_MF%YRPHY%LPHSPSH) THEN
  
  ZTI (JLON, 0)=PT (JLON, 1)
  ZTI (JLON, KFLEV)=PT (JLON, KFLEV)
  
ELSE
  
  ZTI (JLON, 0)=PT (JLON, 1)
  ZTI (JLON, KFLEV)=PTS (JLON)
  
ENDIF


DO JLEV=1, KFLEV-1
  
  ZTI (JLON, JLEV)=(PT (JLON, JLEV)+PT (JLON, JLEV+1))*0.5_JPRB
  
ENDDO


IF (LLDPSFI) THEN
  
  ZQH (JLON, 0)=0.0_JPRB
  ZQLH (JLON, 0)=0.0_JPRB
  ZQIH (JLON, 0)=0.0_JPRB
  ZQRH (JLON, 0)=0.0_JPRB
  ZQSH (JLON, 0)=0.0_JPRB
  ZQH (JLON, KFLEV)=PQ (JLON, KFLEV)
  ZQLH (JLON, KFLEV)=PQL (JLON, KFLEV)
  ZQIH (JLON, KFLEV)=PQI (JLON, KFLEV)
  ZQRH (JLON, KFLEV)=PQR (JLON, KFLEV)
  ZQSH (JLON, KFLEV)=PQS (JLON, KFLEV)

  

  DO JLEV=1, KFLEV-1
    
    ZQH (JLON, JLEV)=(PQ (JLON, JLEV)+PQ (JLON, JLEV+1))*0.5_JPRB
    ZQLH (JLON, JLEV)=(PQL (JLON, JLEV)+PQL (JLON, JLEV+1))*0.5_JPRB
    ZQIH (JLON, JLEV)=(PQI (JLON, JLEV)+PQI (JLON, JLEV+1))*0.5_JPRB
    ZQRH (JLON, JLEV)=(PQR (JLON, JLEV)+PQR (JLON, JLEV+1))*0.5_JPRB
    ZQSH (JLON, JLEV)=(PQS (JLON, JLEV)+PQS (JLON, JLEV+1))*0.5_JPRB
  
  ENDDO


  IF (YDMODEL%YRML_PHY_MF%YRPHY%LGRAPRO) THEN
    
    ZQGH (JLON, 0)=0.0_JPRB
    ZQGH (JLON, KFLEV)=PQG (JLON, KFLEV)

    

    DO JLEV=1, KFLEV-1
      
      ZQGH (JLON, JLEV)=(PQG (JLON, JLEV)+PQG (JLON, JLEV+1))*0.5_JPRB
    
    ENDDO

  ENDIF

ENDIF


IF (LLDPSFI) THEN

  IF (YDMODEL%YRML_PHY_MF%YRPHY%LGRAPRO) THEN

    DO JLEV=0, KFLEV
      
      ZFPL (JLON, JLEV)=(1.0_JPRB-ZQRH (JLON, JLEV))*PFPLSL (JLON, JLEV&
      &)-ZQRH (JLON, JLEV)*(PFPLSN (JLON, JLEV)+PFPLSG (JLON, JLEV))
      ZFPN (JLON, JLEV)=(1.0_JPRB-ZQSH (JLON, JLEV))*PFPLSN (JLON, JLEV&
      &)-ZQSH (JLON, JLEV)*(PFPLSL (JLON, JLEV)+PFPLSG (JLON, JLEV))
      ZFPG (JLON, JLEV)=(1.0_JPRB-ZQGH (JLON, JLEV))*PFPLSG (JLON, JLEV&
      &)-ZQGH (JLON, JLEV)*(PFPLSL (JLON, JLEV)+PFPLSN (JLON, JLEV))
      ZFPLSL (JLON, JLEV)=ZFPL (JLON, JLEV)
      ZFPLSN (JLON, JLEV)=ZFPN (JLON, JLEV)
      ZFPLSG (JLON, JLEV)=ZFPG (JLON, JLEV)
      ZFPL (JLON, JLEV)=(1.0_JPRB-ZQRH (JLON, JLEV))*PFPLCL (JLON&
      &, JLEV)-ZQRH (JLON, JLEV)*(PFPLCN (JLON, JLEV))
      ZFPN (JLON, JLEV)=(1.0_JPRB-ZQSH (JLON, JLEV))*PFPLCN (JLON&
      &, JLEV)-ZQSH (JLON, JLEV)*(PFPLCL (JLON, JLEV))
      ZFPG (JLON, JLEV)=(1.0_JPRB-ZQGH (JLON, JLEV))*PFPLCG (JLON&
      &, JLEV)-ZQGH (JLON, JLEV)*(PFPLCG (JLON, JLEV))
      ZFPLCL (JLON, JLEV)=ZFPL (JLON, JLEV)
      ZFPLCN (JLON, JLEV)=ZFPN (JLON, JLEV)
      ZFPLCG (JLON, JLEV)=ZFPG (JLON, JLEV)
      ZFPL (JLON, JLEV)=ZFPLSL (JLON, JLEV)+ZFPLCL (JLON, JLEV)
      ZFPN (JLON, JLEV)=ZFPLSN (JLON, JLEV)+ZFPLCN (JLON, JLEV)
      ZFPG (JLON, JLEV)=ZFPLSG (JLON, JLEV)+ZFPLCG (JLON, JLEV)
      ZCPH=YDCST%RCPD+(YDCST%RCPV-YDCST%RCPD)*ZQH (JLON, JLEV)+(YDCST%RCW-YDCST%RCPD)*(ZQLH (JLON, JLEV)+ZQRH&
      & (JLON, JLEV))+(YDCST%RCS-YDCST%RCPD)*(ZQIH (JLON, JLEV)+ZQSH (JLON, JLEV)+ZQGH (JLON, JLEV))
      ZCHAT (JLON, JLEV)=(ZCPH-YDCST%RCW*ZQRH (JLON, JLEV)-YDCST%RCS*(ZQSH (JLON, JLEV)+ZQGH&
      & (JLON, JLEV)))/(1.0_JPRB-ZQRH (JLON, JLEV)-ZQSH (JLON, JLEV)-ZQGH (JLON, JLEV))
      ZLIFT (JLON, JLEV)=(ZFPL (JLON, JLEV)+ZFPN (JLON, JLEV)+ZFPG (JLON, JLEV&
      &))/(1.0_JPRB-ZQRH (JLON, JLEV)-ZQSH (JLON, JLEV)-ZQGH (JLON, JLEV))
    
    ENDDO

  ELSE

    DO JLEV=0, KFLEV
      
      ZFPL (JLON, JLEV)=(1.0_JPRB-ZQRH (JLON, JLEV))*PFPLSL &
      &(JLON, JLEV)-ZQRH (JLON, JLEV)*PFPLSN (JLON, JLEV)
      ZFPN (JLON, JLEV)=(1.0_JPRB-ZQSH (JLON, JLEV))*PFPLSN &
      &(JLON, JLEV)-ZQSH (JLON, JLEV)*PFPLSL (JLON, JLEV)
      ZFPLSL (JLON, JLEV)=ZFPL (JLON, JLEV)
      ZFPLSN (JLON, JLEV)=ZFPN (JLON, JLEV)
      ZFPL (JLON, JLEV)=(1.0_JPRB-ZQRH (JLON, JLEV))*PFPLCL &
      &(JLON, JLEV)-ZQRH (JLON, JLEV)*PFPLCN (JLON, JLEV)
      ZFPN (JLON, JLEV)=(1.0_JPRB-ZQSH (JLON, JLEV))*PFPLCN &
      &(JLON, JLEV)-ZQSH (JLON, JLEV)*PFPLCL (JLON, JLEV)
      ZFPLCL (JLON, JLEV)=ZFPL (JLON, JLEV)
      ZFPLCN (JLON, JLEV)=ZFPN (JLON, JLEV)
      ZFPL (JLON, JLEV)=ZFPLSL (JLON, JLEV)+ZFPLCL (JLON, JLEV)
      ZFPN (JLON, JLEV)=ZFPLSN (JLON, JLEV)+ZFPLCN (JLON, JLEV)
      ZCPH=YDCST%RCPD+(YDCST%RCPV-YDCST%RCPD)*ZQH (JLON, JLEV)+(YDCST%RCW-YDCST%RCPD)*(ZQLH (JLON&
      &, JLEV)+ZQRH (JLON, JLEV))+(YDCST%RCS-YDCST%RCPD)*(ZQIH (JLON, JLEV)+ZQSH (JLON, JLEV))
      ZCHAT (JLON, JLEV)=(ZCPH-YDCST%RCW*ZQRH (JLON, JLEV)-YDCST%RCS*ZQSH&
      & (JLON, JLEV))/(1.0_JPRB-ZQRH (JLON, JLEV)-ZQSH (JLON, JLEV))
      ZLIFT (JLON, JLEV)=(ZFPL (JLON, JLEV)+ZFPN (JLON, JLEV&
      &))/(1.0_JPRB-ZQRH (JLON, JLEV)-ZQSH (JLON, JLEV))
    
    ENDDO

  ENDIF

ELSE

  DO JLEV=0, KFLEV
    
    ZFPL (JLON, JLEV)=PFPLSL (JLON, JLEV)+PFPLCL (JLON, JLEV)
    ZFPN (JLON, JLEV)=PFPLSN (JLON, JLEV)+PFPLCN (JLON, JLEV)
  
  ENDDO


  IF (YDMODEL%YRML_PHY_MF%YRPHY%LGRAPRO) THEN

    DO JLEV=0, KFLEV
      
      ZFPG (JLON, JLEV)=PFPLSG (JLON, JLEV)
    
    ENDDO

  ENDIF

ENDIF


DO JLEV=0, KFLEV

  

  IF (LLDPSFI) THEN
    PFHSCL (JLON, JLEV)=ZFPLCL (JLON, JLEV)*ZTI (JLON, JLEV)*YDCST%RCW
    PFHSCN (JLON, JLEV)=ZFPLCN (JLON, JLEV)*ZTI (JLON, JLEV)*YDCST%RCS
    PFHSSL (JLON, JLEV)=ZFPLSL (JLON, JLEV)*ZTI (JLON, JLEV)*YDCST%RCW
    PFHSSN (JLON, JLEV)=ZFPLSN (JLON, JLEV)*ZTI (JLON, JLEV)*YDCST%RCS

    IF (YDMODEL%YRML_PHY_MF%YRPHY%LGRAPRO) THEN
      PFHSSG (JLON, JLEV)=ZFPLSG (JLON, JLEV)*ZTI (JLON, JLEV)*YDCST%RCS
    ELSE
      PFHSSG (JLON, JLEV)=0._JPRB
    ENDIF

  ELSE
    PFHSCL (JLON, JLEV)=PFPLCL (JLON, JLEV)*ZTI (JLON, JLEV)*(YDCST%RCW-YDCST%RCPD)
    PFHSCN (JLON, JLEV)=PFPLCN (JLON, JLEV)*ZTI (JLON, JLEV)*(YDCST%RCS-YDCST%RCPD)
    PFHSSL (JLON, JLEV)=PFPLSL (JLON, JLEV)*ZTI (JLON, JLEV)*(YDCST%RCW-YDCST%RCPD)
    PFHSSN (JLON, JLEV)=PFPLSN (JLON, JLEV)*ZTI (JLON, JLEV)*(YDCST%RCS-YDCST%RCPD)

    IF (YDMODEL%YRML_PHY_MF%YRPHY%LGRAPRO) THEN
      PFHSSG (JLON, JLEV)=PFPLSG (JLON, JLEV)*ZTI (JLON, JLEV)*(YDCST%RCS-YDCST%RCPD)
    ELSE
      PFHSSG (JLON, JLEV)=0._JPRB
    ENDIF

  ENDIF

  PFHPCL (JLON, JLEV)=-YDCST%RLVZER*(PFCCQL (JLON, JLEV)-PFECL (JLON, JLEV))
  PFHPCN (JLON, JLEV)=-YDCST%RLSZER*(PFCCQN (JLON, JLEV)-PFECN (JLON, JLEV))
  PFHPSL (JLON, JLEV)=-YDCST%RLVZER*(PFCSQL (JLON, JLEV)-PFESL (JLON, JLEV))
  PFHPSN (JLON, JLEV)=-YDCST%RLSZER*(PFCSQN (JLON, JLEV)-PFESN (JLON, JLEV))
  PFP (JLON, JLEV)=ZFPL (JLON, JLEV)+ZFPN (JLON, JLEV)

  IF (YDMODEL%YRML_PHY_MF%YRPHY%LGRAPRO) THEN
    PFHPSG (JLON, JLEV)=-YDCST%RLSZER*(-PFESG (JLON, JLEV))
    PFHPCG (JLON, JLEV)=-YDCST%RLSZER*(-PFECG (JLON, JLEV))
    PFP (JLON, JLEV)=PFP (JLON, JLEV)+ZFPG (JLON, JLEV)
  ELSE
    PFHPSG (JLON, JLEV)=0._JPRB
    PFHPCG (JLON, JLEV)=0._JPRB
  ENDIF

  PFEPFP (JLON, JLEV)=-YDMODEL%YRML_PHY_MF%YRPHY%NDPSFI*ZCHAT&
  & (JLON, JLEV)*ZTI (JLON, JLEV)*PFP (JLON, JLEV)
  PFHP (JLON, JLEV)=PFHSCL (JLON, JLEV)+PFHSCN (JLON, JLEV)+PFHSSL (JLON, JLEV)+PFHSSN (JLON, JLEV)+PFHPCL&
  & (JLON, JLEV)+PFHPCN (JLON, JLEV)+PFHPSL (JLON, JLEV)+PFHPSN (JLON, JLEV)+PFEPFP (JLON, JLEV)

  IF (YDMODEL%YRML_PHY_MF%YRPHY%LGRAPRO) THEN
    PFHP (JLON, JLEV)=PFHP (JLON, JLEV)+PFHSSG (JLON, JLEV)+PFHPSG (JLON, JLEV)+PFHPCG (JLON, JLEV)
  ENDIF

  
ENDDO


DO JLEV=0, KFLEV
  
  ZJTOT (JLON, JLEV)=PFRSO (JLON, JLEV)+PFRTH (JLON, JLEV)+PFRMH (JLON, JLEV)+PDIFTS (JLON,&
  & JLEV)+PDIFCS (JLON, JLEV)+(YDCST%RCW-YDCST%RCPD)*ZFPL (JLON, JLEV)*ZTI (JLON, JLEV)+(YDCST&
  &%RCS-YDCST%RCPD)*ZFPN (JLON, JLEV)*ZTI (JLON, JLEV)-YDCST%RLVZER*(PFCCQL (JLON, JLEV)+PFCSQL&
  & (JLON, JLEV)-PFESL (JLON, JLEV)-PFECL (JLON, JLEV))-YDCST%RLSZER*(PFCCQN (JLON, JLEV)+PFCSQN&
  & (JLON, JLEV)-PFESN (JLON, JLEV)-PFECN (JLON, JLEV))+ZFHIMCC (JLON, JLEV)
  
ENDDO


IF (YDMODEL%YRML_PHY_MF%YRPHY%LGRAPRO) THEN

  DO JLEV=0, KFLEV
    
    ZJTOT (JLON, JLEV)=ZJTOT (JLON, JLEV)+(YDCST%RCS-YDCST%RCPD)*ZFPG (JLON, JLEV&
    &)*ZTI (JLON, JLEV)+YDCST%RLSZER*(PFESG (JLON, JLEV)+PFECG (JLON, JLEV))
  
  ENDDO

ENDIF


IF (LLDPSFI) THEN

  DO JLEV=0, KFLEV
    
    ZFHDPSFI (JLON, JLEV)=-(ZCHAT (JLON, JLEV)-YDCST%RCPD)*ZTI&
    & (JLON, JLEV)*(ZFPL (JLON, JLEV)+ZFPN (JLON, JLEV))

    IF (YDMODEL%YRML_PHY_MF%YRPHY%LGRAPRO) THEN
      ZFHDPSFI (JLON, JLEV)=ZFHDPSFI (JLON, JLEV)-(ZCHAT (JLON,&
      & JLEV)-YDCST%RCPD)*ZTI (JLON, JLEV)*ZFPG (JLON, JLEV)
    ENDIF

    ZJTOT (JLON, JLEV)=ZJTOT (JLON, JLEV)+ZFHDPSFI (JLON, JLEV)
  
  ENDDO

ELSE
  ZFHDPSFI (JLON, 0:KFLEV)=0.
ENDIF


DO JLEV=1, KFLEV
  
  ZGSDP (JLON, JLEV)=YDCST%RG*PRDELP (JLON, JLEV)
  PTENDU (JLON, JLEV)=ZGSDP (JLON, JLEV)*((PSTRCU (JLON, JLEV-1)-PSTRCU (JLON&
  &, JLEV))+(PSTRDU (JLON, JLEV-1)-PSTRDU (JLON, JLEV))+(PSTRMU (JLON, JLEV-1&
  &)-PSTRMU (JLON, JLEV))+(PSTRTU (JLON, JLEV-1)-PSTRTU (JLON, JLEV)))
  PTENDV (JLON, JLEV)=ZGSDP (JLON, JLEV)*((PSTRCV (JLON, JLEV-1)-PSTRCV (JLON&
  &, JLEV))+(PSTRDV (JLON, JLEV-1)-PSTRDV (JLON, JLEV))+(PSTRMV (JLON, JLEV-1&
  &)-PSTRMV (JLON, JLEV))+(PSTRTV (JLON, JLEV-1)-PSTRTV (JLON, JLEV)))

  IF (YDMODEL%YRML_PHY_MF%YRPHY%LCVTDK) THEN
    PTENDU_ZDEC (JLON, JLEV)=0.0_JPRB
    PTENDV_ZDEC (JLON, JLEV)=0.0_JPRB
  ELSE
    PTENDU_ZDEC (JLON, JLEV)=PTENDU (JLON, JLEV)
    PTENDV_ZDEC (JLON, JLEV)=PTENDV (JLON, JLEV)
  ENDIF

  PTENDQ (JLON, JLEV)=ZGSDP (JLON, JLEV)*((PDIFTQ (JLON, JLEV-1)-PDIFTQ (JLON, JLEV))+(PDIFCQ (JLON, JLEV&
  &-1)-PDIFCQ (JLON, JLEV))+(PFRMQ (JLON, JLEV-1)-PFRMQ (JLON, JLEV))+(PFCHQ (JLON, JLEV-1)-PFCHQ (JLON,&
  & JLEV))+(PFCCQL (JLON, JLEV-1)-PFCCQL (JLON, JLEV))+(PFCCQN (JLON, JLEV-1)-PFCCQN (JLON, JLEV))+(PFCSQL&
  & (JLON, JLEV-1)-PFCSQL (JLON, JLEV))+(PFCSQN (JLON, JLEV-1)-PFCSQN (JLON, JLEV))+(PFCQNG (JLON, JLEV-1&
  &)-PFCQNG (JLON, JLEV))-(PFECL (JLON, JLEV-1)-PFECL (JLON, JLEV))-(PFESL (JLON, JLEV-1)-PFESL (JLON, JLEV&
  &))-(PFECN (JLON, JLEV-1)-PFECN (JLON, JLEV))-(PFESN (JLON, JLEV-1)-PFESN (JLON, JLEV)))
  PTENDH (JLON, JLEV)=ZGSDP (JLON, JLEV)*(ZJTOT (JLON, JLEV-1)-ZJTOT (JLON, JLEV))
  
ENDDO


IF (YDMODEL%YRML_PHY_MF%YRPHY%LGRAPRO) THEN

  DO JLEV=1, KFLEV
    
    PTENDQ (JLON, JLEV)=PTENDQ (JLON, JLEV)+ZGSDP (JLON, JLEV)*(-(PFESG (JLON,&
    & JLEV-1)-PFESG (JLON, JLEV))-(PFECG (JLON, JLEV-1)-PFECG (JLON, JLEV)))
  
  ENDDO

ENDIF



IF (YDMODEL%YRML_PHY_MF%YRPHY%LCONDWT.AND..NOT.YDMODEL%YRML_PHY_MF%YRPHY%LGPCMT) THEN

  DO JLEV=1, KFLEV
    
    PTENDQL (JLON, JLEV)=ZGSDP (JLON, JLEV)*((PDIFTQL (JLON, JLEV-1)-PDIFTQL (JLON, JLEV))+(PDIFCQL&
    & (JLON, JLEV-1)-PDIFCQL (JLON, JLEV))+(PFCQLNG (JLON, JLEV-1)-PFCQLNG (JLON, JLEV))+(PFACL&
    & (JLON, JLEV-1)-PFACL (JLON, JLEV))+(PFASL (JLON, JLEV-1)-PFASL (JLON, JLEV))-(PFCSQL (JLON&
    &, JLEV-1)-PFCSQL (JLON, JLEV))-(PFCCQL (JLON, JLEV-1)-PFCCQL (JLON, JLEV)))
  
  ENDDO


  

  DO JLEV=1, KFLEV
    
    PTENDQI (JLON, JLEV)=ZGSDP (JLON, JLEV)*((PDIFTQI (JLON, JLEV-1)-PDIFTQI (JLON, JLEV))+(PDIFCQI&
    & (JLON, JLEV-1)-PDIFCQI (JLON, JLEV))+(PFCQING (JLON, JLEV-1)-PFCQING (JLON, JLEV))+(PFACN&
    & (JLON, JLEV-1)-PFACN (JLON, JLEV))+(PFASN (JLON, JLEV-1)-PFASN (JLON, JLEV))-(PFCSQN (JLON&
    &, JLEV-1)-PFCSQN (JLON, JLEV))-(PFCCQN (JLON, JLEV-1)-PFCCQN (JLON, JLEV)))
  
  ENDDO


  IF (YDMODEL%YRML_PHY_MF%YRPHY%LGRAPRO) THEN

    DO JLEV=1, KFLEV
      
      PTENDQI (JLON, JLEV)=PTENDQI (JLON, JLEV)+ZGSDP (JLON&
      &, JLEV)*(PFASG (JLON, JLEV-1)-PFASG (JLON, JLEV))
    
    ENDDO

  ENDIF


  

  DO JLEV=1, KFLEV
    
    PTENDQR (JLON, JLEV)=ZGSDP (JLON, JLEV)*((PFESL (JLON, JLEV-1)-PFESL (JLON, JLEV))+(PFECL (JLON, JLEV&
    &-1)-PFECL (JLON, JLEV))+(PFCQRNG (JLON, JLEV-1)-PFCQRNG (JLON, JLEV))+(ZFPL (JLON, JLEV-1)-ZFPL (JLON&
    &, JLEV))-(PFACL (JLON, JLEV-1)-PFACL (JLON, JLEV))-(PFASL (JLON, JLEV-1)-PFASL (JLON, JLEV)))
  
  ENDDO


  

  DO JLEV=1, KFLEV
    
    PTENDQS (JLON, JLEV)=ZGSDP (JLON, JLEV)*((PFESN (JLON, JLEV-1)-PFESN (JLON, JLEV))+(PFECN (JLON, JLEV&
    &-1)-PFECN (JLON, JLEV))+(PFCQSNG (JLON, JLEV-1)-PFCQSNG (JLON, JLEV))+(ZFPN (JLON, JLEV-1)-ZFPN (JLON&
    &, JLEV))-(PFACN (JLON, JLEV-1)-PFACN (JLON, JLEV))-(PFASN (JLON, JLEV-1)-PFASN (JLON, JLEV)))
  
  ENDDO


  

  IF (YDMODEL%YRML_PHY_MF%YRPHY%LGRAPRO) THEN

    DO JLEV=1, KFLEV
      
      PTENDQG (JLON, JLEV)=ZGSDP (JLON, JLEV)*((PFESG (JLON, JLEV-1)-PFESG (JLON, JLEV))+(PFECG&
      & (JLON, JLEV-1)-PFECG (JLON, JLEV))+(PFCQGNG (JLON, JLEV-1)-PFCQGNG (JLON, JLEV))+(ZFPG&
      & (JLON, JLEV-1)-ZFPG (JLON, JLEV))-(PFASG (JLON, JLEV-1)-PFASG (JLON, JLEV)))
    
    ENDDO

  
  ENDIF

ELSEIF (YDMODEL%YRML_PHY_MF%YRPHY%LCONDWT.AND.YDMODEL%YRML_PHY_MF%YRPHY%LGPCMT) THEN

  DO JLEV=1, KFLEV
    
    PTENDQL (JLON, JLEV)=ZGSDP (JLON, JLEV)*((PDIFTQL (JLON, JLEV-1)-PDIFTQL (JLON,&
    & JLEV))+(PDIFCQL (JLON, JLEV-1)-PDIFCQL (JLON, JLEV))+(PFCQLNG (JLON, JLEV-1)-PFCQLNG&
    & (JLON, JLEV))-(PFEDQLC (JLON, JLEV-1)-PFEDQLC (JLON, JLEV))+(PFASL (JLON, JLEV&
    &-1)-PFASL (JLON, JLEV))-(PFCSQL (JLON, JLEV-1)-PFCSQL (JLON, JLEV)))
  
  ENDDO


  

  DO JLEV=1, KFLEV
    
    PTENDQI (JLON, JLEV)=ZGSDP (JLON, JLEV)*((PDIFTQI (JLON, JLEV-1)-PDIFTQI (JLON,&
    & JLEV))+(PDIFCQI (JLON, JLEV-1)-PDIFCQI (JLON, JLEV))+(PFCQING (JLON, JLEV-1)-PFCQING&
    & (JLON, JLEV))-(PFEDQIC (JLON, JLEV-1)-PFEDQIC (JLON, JLEV))+(PFASN (JLON, JLEV&
    &-1)-PFASN (JLON, JLEV))-(PFCSQN (JLON, JLEV-1)-PFCSQN (JLON, JLEV)))
  
  ENDDO


  

  DO JLEV=1, KFLEV
    
    PTENDQR (JLON, JLEV)=ZGSDP (JLON, JLEV)*((PFESL (JLON, JLEV-1)-PFESL (JLON, JLEV))+(PFCQRNG&
    & (JLON, JLEV-1)-PFCQRNG (JLON, JLEV))-(PFEDQRC (JLON, JLEV-1)-PFEDQRC (JLON, JLEV))+(PFPLSL&
    & (JLON, JLEV-1)-PFPLSL (JLON, JLEV))-(PFASL (JLON, JLEV-1)-PFASL (JLON, JLEV)))
  
  ENDDO


  

  DO JLEV=1, KFLEV
    
    PTENDQS (JLON, JLEV)=ZGSDP (JLON, JLEV)*((PFESN (JLON, JLEV-1)-PFESN (JLON, JLEV))+(PFCQSNG&
    & (JLON, JLEV-1)-PFCQSNG (JLON, JLEV))-(PFEDQSC (JLON, JLEV-1)-PFEDQSC (JLON, JLEV))+(PFPLSN&
    & (JLON, JLEV-1)-PFPLSN (JLON, JLEV))-(PFASN (JLON, JLEV-1)-PFASN (JLON, JLEV)))
  
  ENDDO


  

  DO JLEV=1, KFLEV
    
    PTENDQLCONV (JLON, JLEV)=ZGSDP (JLON, JLEV)*(+(PFCNEGQLC (JLON, JLEV-1)-PFCNEGQLC &
    &(JLON, JLEV))+(PDIFCQLC (JLON, JLEV-1)-PDIFCQLC (JLON, JLEV))+(PFEDQLC (JLON, JLEV&
    &-1)-PFEDQLC (JLON, JLEV))+(PFIMCC (JLON, JLEV-1)-PFIMCC (JLON, JLEV))-(PFCCQL (JLON&
    &, JLEV-1)-PFCCQL (JLON, JLEV))+(PFACL (JLON, JLEV-1)-PFACL (JLON, JLEV)))
  
  ENDDO


  

  DO JLEV=1, KFLEV
    
    PTENDQICONV (JLON, JLEV)=ZGSDP (JLON, JLEV)*(+(PFCNEGQIC (JLON, JLEV-1)-PFCNEGQIC &
    &(JLON, JLEV))+(PDIFCQIC (JLON, JLEV-1)-PDIFCQIC (JLON, JLEV))+(PFEDQIC (JLON, JLEV&
    &-1)-PFEDQIC (JLON, JLEV))-(PFIMCC (JLON, JLEV-1)-PFIMCC (JLON, JLEV))-(PFCCQN (JLON&
    &, JLEV-1)-PFCCQN (JLON, JLEV))+(PFACN (JLON, JLEV-1)-PFACN (JLON, JLEV)))
  
  ENDDO


  

  DO JLEV=1, KFLEV
    
    PTENDQRCONV (JLON, JLEV)=ZGSDP (JLON, JLEV)*(+(PFCNEGQRC (JLON, JLEV-1)-PFCNEGQRC (JLON, JLEV&
    &))+(PFPLCL (JLON, JLEV-1)-PFPLCL (JLON, JLEV))+(PFEDQRC (JLON, JLEV-1)-PFEDQRC (JLON, JLEV)&
    &)-(PFACL (JLON, JLEV-1)-PFACL (JLON, JLEV))+(PFECL (JLON, JLEV-1)-PFECL (JLON, JLEV)))
  
  ENDDO


  

  DO JLEV=1, KFLEV
    
    PTENDQSCONV (JLON, JLEV)=ZGSDP (JLON, JLEV)*(+(PFCNEGQSC (JLON, JLEV-1)-PFCNEGQSC (JLON, JLEV&
    &))+(PFPLCN (JLON, JLEV-1)-PFPLCN (JLON, JLEV))+(PFEDQSC (JLON, JLEV-1)-PFEDQSC (JLON, JLEV)&
    &)-(PFACN (JLON, JLEV-1)-PFACN (JLON, JLEV))+(PFECN (JLON, JLEV-1)-PFECN (JLON, JLEV)))
  
  ENDDO

  
ENDIF



IF (LLDPSFI) THEN

  DO JLEV=1, KFLEV
    
    PTENDQ (JLON, JLEV)=PTENDQ (JLON, JLEV)-ZGSDP (JLON, JLEV)*(ZQH (JLON,&
    & JLEV-1)*ZLIFT (JLON, JLEV-1)-ZQH (JLON, JLEV)*ZLIFT (JLON, JLEV))

    IF (YDMODEL%YRML_PHY_MF%YRPHY%LCONDWT) THEN
      PTENDQI (JLON, JLEV)=PTENDQI (JLON, JLEV)-ZGSDP (JLON, JLEV)*(ZQIH (JLON&
      &, JLEV-1)*ZLIFT (JLON, JLEV-1)-ZQIH (JLON, JLEV)*ZLIFT (JLON, JLEV))
      PTENDQL (JLON, JLEV)=PTENDQL (JLON, JLEV)-ZGSDP (JLON, JLEV)*(ZQLH (JLON&
      &, JLEV-1)*ZLIFT (JLON, JLEV-1)-ZQLH (JLON, JLEV)*ZLIFT (JLON, JLEV))
    ENDIF

  
  ENDDO

ENDIF


IF (YDMODEL%YRML_PHY_MF%YRPHY%LECT) THEN

  IF (JPRD==JPRB) THEN

    DO JLEV=1, KFLEV
      
      PTENDTKE (JLON, JLEV)=ZGSDP (JLON, JLEV)*(PFTKE (JLON, JLEV-1)-PFTKE (JLON, JLEV))
    
    ENDDO

  ELSE

    DO JLEV=1, KFLEV
      
      PTENDTKE (JLON, JLEV)=PFTKEI (JLON, JLEV)
    
    ENDDO

  ENDIF

ENDIF


IF (YDMODEL%YRML_PHY_MF%YRPHY%LEFB) THEN

  DO JLEV=1, KFLEV
    
    PTENDEFB1 (JLON, JLEV)=ZGSDP (JLON, JLEV)*(PFEFB1 (JLON, JLEV-1)-PFEFB1 (JLON, JLEV))
    PTENDEFB2 (JLON, JLEV)=ZGSDP (JLON, JLEV)*(PFEFB2 (JLON, JLEV-1)-PFEFB2 (JLON, JLEV))
    PTENDEFB3 (JLON, JLEV)=ZGSDP (JLON, JLEV)*(PFEFB3 (JLON, JLEV-1)-PFEFB3 (JLON, JLEV))
  
  ENDDO

ENDIF


IF (YDMODEL%YRML_PHY_MF%YRARPHY%LMDUST.AND.(YDMODEL%YRML_GCONF%YGFL%NGFL_EXT/=0)) THEN

  DO JGFL=1, YDMODEL%YRML_GCONF%YGFL%NGFL_EXT

    DO JLEV=1, KFLEV
      
      PTENDEXT (JLON, JLEV, JGFL)=ZGSDP (JLON, JLEV)*(PDIFEXT&
      & (JLON, JLEV-1, JGFL)-PDIFEXT (JLON, JLEV, JGFL))
    
    ENDDO

  ENDDO

ENDIF






END SUBROUTINE CPTEND_NEW_OPENACC
