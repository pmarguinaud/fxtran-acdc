SUBROUTINE ACEVADCAPE_OPENACC (YDPHY2, YDCST, KIDIA, KFDIA, KLON, KLEV, PFPLSL, PFPLSN&
&, PFPLCL, PFPLCN, PAPRS, PAPRSF, PT, PCP, PAPHIF, PAPHI, PDCAPE, YDSTACK)
!$ACC ROUTINE (ACEVADCAPE_OPENACC) SEQ
USE PARKIND1,ONLY:JPIM, JPRB

USE YOMCST,ONLY:TCST
USE YOMPHY2,ONLY:TPHY2
#include "fxtran_acdc_stack.h"
USE FXTRAN_ACDC_STACK_MOD
USE FXTRAN_ACDC_ABORT_MOD

IMPLICIT NONE


TYPE (TPHY2), INTENT (IN)::YDPHY2
TYPE (TCST), INTENT (IN)::YDCST
INTEGER (KIND=JPIM), INTENT (IN)::KIDIA
INTEGER (KIND=JPIM), INTENT (IN)::KFDIA
INTEGER (KIND=JPIM), INTENT (IN)::KLON
INTEGER (KIND=JPIM), INTENT (IN)::KLEV
REAL (KIND=JPRB), INTENT (IN)::PFPLSL (KLON, 0:KLEV)
REAL (KIND=JPRB), INTENT (IN)::PFPLSN (KLON, 0:KLEV)
REAL (KIND=JPRB), INTENT (IN)::PFPLCL (KLON, 0:KLEV)
REAL (KIND=JPRB), INTENT (IN)::PFPLCN (KLON, 0:KLEV)
REAL (KIND=JPRB), INTENT (IN)::PAPRS (KLON, 0:KLEV)
REAL (KIND=JPRB), INTENT (IN)::PAPRSF (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PT (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PCP (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PAPHIF (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PAPHI (KLON, 0:KLEV)
REAL (KIND=JPRB), INTENT (OUT)::PDCAPE (KLON)
TYPE(FXTRAN_ACDC_STACK), INTENT (IN) :: YDSTACK
REAL (KIND=JPRB)::ZB
REAL (KIND=JPRB)::ZDELTA
REAL (KIND=JPRB)::ZTAU
REAL (KIND=JPRB)::ZDFP
REAL (KIND=JPRB)::ZTTEND
REAL (KIND=JPRB)::ZSIG
INTEGER (KIND=JPIM)::ISIG
INTEGER (KIND=JPIM)::JLON

#include "fcttrm.func.h"

JLON = KIDIA



ZSIG=0.92_JPRB
ISIG=NINT (ZSIG*REAL (KLEV))
ZTAU=130._JPRB

ZDELTA=MAX (0.0_JPRB, SIGN (1.0_JPRB, YDCST%RTT-PT (JLON, KLEV)))
ZDFP=PFPLSL (JLON, KLEV)+PFPLSN (JLON, KLEV)+PFPLCL (JLON, KLEV)+PFPLCN (JLON, KLEV)&
&-PFPLSL (JLON, ISIG)-PFPLSN (JLON, ISIG)-PFPLCL (JLON, ISIG)-PFPLCN (JLON, ISIG)
ZTTEND=FOLH (PT (JLON, KLEV), ZDELTA)/PCP (JLON, KLEV)*YDCST%RG*MIN&
& (0._JPRB, ZDFP)/(PAPRS (JLON, KLEV)-PAPRSF (JLON, ISIG))
ZB=YDCST%RG/PT (JLON, KLEV)*ZTTEND*ZTAU
PDCAPE (JLON)=ZB*(PAPHIF (JLON, ISIG)-PAPHI (JLON, KLEV))/YDCST%RG



END SUBROUTINE ACEVADCAPE_OPENACC
