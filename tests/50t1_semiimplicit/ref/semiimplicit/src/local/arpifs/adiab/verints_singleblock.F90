SUBROUTINE VERINTS_SINGLEBLOCK (KPROMA, KST, KEND, KLEVIN, KLEVOUT, PINTE, PIN, POUTS, LDACC)
USE PARKIND1,ONLY:JPIM, JPRB, JPRD
USE YOMHOOK,ONLY:LHOOK, DR_HOOK, JPHOOK
USE OML_MOD,ONLY:OML_IN_PARALLEL
USE FXTRAN_ACDC_GEMV_MOD,ONLY:FXTRAN_ACDC_GEMV
USE FXTRAN_ACDC_GEMV_MOD_SINGLEBLOCK, ONLY : FXTRAN_ACDC_GEMV_SINGLEBLOCK
USE FXTRAN_ACDC_STACK_MOD
#include "fxtran_acdc_stack.h"

IMPLICIT NONE


#ifdef FXTRAN_ACDC
#endif
INTEGER (KIND=JPIM), INTENT (IN)::KEND
INTEGER (KIND=JPIM), INTENT (IN)::KST
INTEGER (KIND=JPIM), INTENT (IN)::KLEVOUT
INTEGER (KIND=JPIM), INTENT (IN)::KLEVIN
INTEGER (KIND=JPIM), INTENT (IN)::KPROMA
REAL (KIND=JPRD), INTENT (IN)::PINTE (KLEVOUT, KLEVIN)
REAL (KIND=JPRB), INTENT (IN), TARGET::PIN (KPROMA, KLEVIN)
REAL (KIND=JPRD), INTENT (OUT)::POUTS (KPROMA)
LOGICAL, INTENT (IN) :: LDACC
LOGICAL, PARAMETER::LLDOUBLE=JPRB==JPRD
LOGICAL, PARAMETER::LLVERINT_ON_CPU=.TRUE.
LOGICAL::LLOML_IN_PARALLEL
LOGICAL::LLFXTRAN_ACDC_GEMM
REAL (KIND=JPRD), POINTER::ZIN (:,:)
REAL (KIND=JPRD), TARGET::ZIN0 (KPROMA, MERGE (KLEVIN, 0,.NOT.LLDOUBLE))
INTEGER (KIND=JPIM)::JLEVIN
INTEGER (KIND=JPIM)::JROF
REAL (KIND=JPHOOK)::ZHOOK_HANDLE
TYPE (FXTRAN_ACDC_STACK) :: YLSTACK

!$ACC DATA &
!$ACC&CREATE (ZIN0) &
!$ACC&IF (LDACC) &
!$ACC&PRESENT (PIN, POUTS) 

IF (LHOOK) CALL DR_HOOK ('VERINTS_SINGLEBLOCK', 0, ZHOOK_HANDLE)

LLOML_IN_PARALLEL=.TRUE.


IF (LLDOUBLE) THEN
#ifndef PARKIND1_SINGLE
  ZIN=>PIN
#endif
ELSE
  ZIN=>ZIN0

  DO JLEVIN=1, KLEVIN
    
    !$ACC PARALLEL LOOP GANG VECTOR &
    !$ACC&IF (LDACC) &
    !$ACC&PRESENT (ZIN) &
    !$ACC&PRIVATE (JROF) 

    

    DO JROF = KST, KEND
      ZIN (JROF, JLEVIN)=REAL (PIN (JROF, JLEVIN), JPRD)
    ENDDO

  ENDDO

ENDIF

LLFXTRAN_ACDC_GEMM=.FALSE.
#ifdef FXTRAN_ACDC
CALL FXTRAN_ACDC_GEMV_SINGLEBLOCK (KST, KEND,'N','T', KPROMA, 1, KLEVIN, 1.0_JPRD, ZIN&
&, KPROMA, PINTE, KLEVOUT, 0.0_JPRD, POUTS, KPROMA, LLFXTRAN_ACDC_GEMM, LDACC=LDACC)
#endif

IF (.NOT.LLFXTRAN_ACDC_GEMM) THEN
  CALL ABOR1 ('NOT SUPPORTED')
ENDIF

IF (LHOOK) CALL DR_HOOK ('VERINTS_SINGLEBLOCK', 1, ZHOOK_HANDLE)
!$ACC END DATA

END SUBROUTINE VERINTS_SINGLEBLOCK
