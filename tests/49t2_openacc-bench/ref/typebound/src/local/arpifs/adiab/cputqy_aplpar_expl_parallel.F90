SUBROUTINE CPUTQY_APLPAR_EXPL_PARALLEL (YDCST, YDCPG_BNDS, YDCPG_OPTS, YDDYNA, YDMF_PHYS_NEXT_STATE&
&, YDMF_PHYS_BASE_STATE, YDVARS, YDPHY, PDT, YD_PTENDH, YD_PTENDU, YD_PTENDV, YD_PTENDU_ZDEC&
&, YD_PTENDV_ZDEC, YD_PTENDD, YD_PTENDEFB1, YD_PTENDEFB2, YD_PTENDEFB3, YD_PTENDG, YD_PTENDICONV&
&, YD_PTENDI, YD_PTENDLCONV, YD_PTENDL, YD_PTENDQ, YD_PTENDRCONV, YD_PTENDR, YD_PTENDSCONV&
&, YD_PTENDS, YD_PTENDTKE, YD_PFDIS)

USE YOMHOOK,ONLY:LHOOK, DR_HOOK, JPHOOK
USE YOMCST,ONLY:TCST
USE YOMPHY,ONLY:TPHY
USE YOMDYNA,ONLY:TDYNA
USE FIELD_VARIABLES_MOD,ONLY:FIELD_VARIABLES
USE MF_PHYS_BASE_STATE_TYPE_MOD,ONLY:MF_PHYS_BASE_STATE_TYPE
USE MF_PHYS_NEXT_STATE_TYPE_MOD,ONLY:MF_PHYS_NEXT_STATE_TYPE
USE CPG_OPTS_TYPE_MOD,ONLY:CPG_BNDS_TYPE, CPG_OPTS_TYPE
USE FIELD_MODULE
USE FIELD_FACTORY_MODULE
USE FIELD_ACCESS_MODULE
USE FXTRAN_ACDC_PARALLELMETHOD_MOD
USE FXTRAN_ACDC_STACK_MOD
USE PARKIND1
USE FXTRAN_ACDC_ARRAY_COPY_MOD
USE FXTRAN_ACDC_GPUMEM_MOD
#include "fxtran_acdc_stack.h"

IMPLICIT NONE


TYPE (TCST), INTENT (IN)::YDCST
TYPE (CPG_BNDS_TYPE), INTENT (IN)::YDCPG_BNDS
TYPE (CPG_OPTS_TYPE), INTENT (IN)::YDCPG_OPTS
TYPE (TDYNA), INTENT (IN)::YDDYNA
TYPE (MF_PHYS_NEXT_STATE_TYPE), INTENT (INOUT)::YDMF_PHYS_NEXT_STATE
TYPE (MF_PHYS_BASE_STATE_TYPE), INTENT (IN)::YDMF_PHYS_BASE_STATE
TYPE (FIELD_VARIABLES), INTENT (INOUT)::YDVARS
TYPE (TPHY), INTENT (IN)::YDPHY
REAL (KIND=JPRB), INTENT (IN)::PDT
CLASS (FIELD_3RB), POINTER :: YD_PTENDH
REAL (KIND=JPRB), POINTER::PTENDH (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PTENDU
REAL (KIND=JPRB), POINTER::PTENDU (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PTENDV
REAL (KIND=JPRB), POINTER::PTENDV (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PTENDU_ZDEC
REAL (KIND=JPRB), POINTER::PTENDU_ZDEC (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PTENDV_ZDEC
REAL (KIND=JPRB), POINTER::PTENDV_ZDEC (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PTENDD
REAL (KIND=JPRB), POINTER::PTENDD (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PTENDEFB1
REAL (KIND=JPRB), POINTER::PTENDEFB1 (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PTENDEFB2
REAL (KIND=JPRB), POINTER::PTENDEFB2 (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PTENDEFB3
REAL (KIND=JPRB), POINTER::PTENDEFB3 (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PTENDG
REAL (KIND=JPRB), POINTER::PTENDG (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PTENDICONV
REAL (KIND=JPRB), POINTER::PTENDICONV (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PTENDI
REAL (KIND=JPRB), POINTER::PTENDI (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PTENDLCONV
REAL (KIND=JPRB), POINTER::PTENDLCONV (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PTENDL
REAL (KIND=JPRB), POINTER::PTENDL (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PTENDQ
REAL (KIND=JPRB), POINTER::PTENDQ (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PTENDRCONV
REAL (KIND=JPRB), POINTER::PTENDRCONV (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PTENDR
REAL (KIND=JPRB), POINTER::PTENDR (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PTENDSCONV
REAL (KIND=JPRB), POINTER::PTENDSCONV (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PTENDS
REAL (KIND=JPRB), POINTER::PTENDS (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PTENDTKE
REAL (KIND=JPRB), POINTER::PTENDTKE (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PFDIS
REAL (KIND=JPRB), POINTER::PFDIS (:,:,:)
#include "cputqy0_parallel.intfb.h"
#include "abor1.intfb.h"
#include "acctnd0_parallel.intfb.h"
INTEGER (KIND=JPIM)::JGFL
INTEGER (KIND=JPIM)::IPGFL
INTEGER (KIND=JPIM)::JLON
INTEGER (KIND=JPIM)::JLEV
REAL (KIND=JPRB)::ZH
REAL (KIND=JPRB)::ZRRG
REAL (KIND=JPRB)::ZRDT
REAL (KIND=JPRB)::ZFLAG
REAL (KIND=JPRB)::ZCPF
CLASS (FIELD_3RB), POINTER :: YL_ZDTT1
REAL (KIND=JPRB), POINTER::ZDTT1 (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZTDCP
REAL (KIND=JPRB), POINTER::ZTDCP (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZDEC
REAL (KIND=JPRB), POINTER::ZDEC (:,:,:)
CLASS (FIELD_3RB), POINTER :: YL_ZRRGDELP
REAL (KIND=JPRB), POINTER::ZRRGDELP (:,:,:)
REAL (KIND=JPHOOK)::ZHOOK_HANDLE
LOGICAL::LLTKE
LOGICAL::LLPREC
INTEGER(KIND=JPIM) :: JBLK
TYPE(CPG_BNDS_TYPE) :: YLCPG_BNDS
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_FIELD_API
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_PARALLEL
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_COMPUTE
TYPE(FXTRAN_ACDC_STACK) :: YLSTACK
TYPE(FXTRAN_ACDC_STACK) :: YLOFFSET
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_BASE_STATE_T(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_BASE_STATE_U(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_BASE_STATE_V(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_CP(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_DELP(:,:,:)
IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL', 0, ZHOOK_HANDLE)

CALL FXTRAN_ACDC_GPUMEMSTAT (__FILE__, __LINE__, "BEGIN")


IF (LHOOK) CALL DR_HOOK ('CREATE_TEMPORARIES',0,ZHOOK_HANDLE_FIELD_API)
CALL FIELD_NEW (YL_ZTDCP, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZRRGDELP, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZDTT1, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
CALL FIELD_NEW (YL_ZDEC, UBOUNDS=[YDCPG_OPTS%KLON, YDCPG_OPTS%KFLEVG, YDCPG_OPTS&
&%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
IF (LHOOK) CALL DR_HOOK ('CREATE_TEMPORARIES',1,ZHOOK_HANDLE_FIELD_API)

LLPREC=YDPHY%LPROCLD.OR.YDPHY%L3MT.OR.YDPHY%LSTRAPRO
LLTKE=YDPHY%LECT

IF (PDT<=0.0_JPRB) THEN
  ZFLAG=0.0_JPRB
  ZRDT=0.0_JPRB
ELSE
  ZFLAG=1.0_JPRB
  ZRDT=1.0_JPRB/PDT
ENDIF

ZRRG=1.0_JPRB/YDCST%RG
IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZTDCP',0,ZHOOK_HANDLE_PARALLEL)

IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','CPUTQY_APLPAR_EXPL_PARALLEL:ZTDCP')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZTDCP:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  ZTDCP => GET_HOST_DATA_RDWR (YL_ZTDCP)
  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZTDCP:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZTDCP:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
  !$OMP PARALLEL DO PRIVATE (JBLK) FIRSTPRIVATE (YLCPG_BNDS)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    CALL YLCPG_BNDS%UPDATE (JBLK)
    
    ZTDCP(:,:, JBLK)=0._JPRB
  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZTDCP:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

  IF (FXTRAN_ACDC_LSYNCHOST ('CPUTQY_APLPAR_EXPL_PARALLEL:ZTDCP')) THEN
    IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZTDCP:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
    ZTDCP => GET_HOST_DATA_RDWR (YL_ZTDCP)
    IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZTDCP:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZTDCP:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  ZTDCP => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZTDCP:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMPSINGLECOLUMN','CPUTQY_APLPAR_EXPL_PARALLEL:ZTDCP')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZTDCP:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  ZTDCP => GET_HOST_DATA_RDWR (YL_ZTDCP)
  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZTDCP:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZTDCP:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  !$OMP PARALLEL DO PRIVATE (JBLK, JLON, YLCPG_BNDS)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX

    

    

    DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JLON
      YLCPG_BNDS%KFDIA = JLON
      
      ZTDCP(JLON,:, JBLK)=0._JPRB
    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZTDCP:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

  IF (FXTRAN_ACDC_LSYNCHOST ('CPUTQY_APLPAR_EXPL_PARALLEL:ZTDCP')) THEN
    IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZTDCP:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
    ZTDCP => GET_HOST_DATA_RDWR (YL_ZTDCP)
    IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZTDCP:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZTDCP:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  ZTDCP => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZTDCP:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN&
  &','CPUTQY_APLPAR_EXPL_PARALLEL:ZTDCP')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZTDCP:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  ZTDCP => GET_DEVICE_DATA_RDWR (YL_ZTDCP)
  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZTDCP:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZTDCP:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  
    !$ACC PARALLEL LOOP GANG &
    !$ACC&PRESENT (YDCPG_OPTS, YFXTRAN_ACDC_STACK, ZTDCP) &
    !$ACC&PRIVATE (JBLK) &
    !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
    
    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    
    
    
    !$ACC LOOP VECTOR &
    !$ACC&PRIVATE (JLON, YLCPG_BNDS) 

    

    DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JLON
      YLCPG_BNDS%KFDIA = JLON
      
      ZTDCP(JLON,:, JBLK)=0._JPRB
    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZTDCP:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

  IF (FXTRAN_ACDC_LSYNCHOST ('CPUTQY_APLPAR_EXPL_PARALLEL:ZTDCP')) THEN
    IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZTDCP:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
    ZTDCP => GET_HOST_DATA_RDWR (YL_ZTDCP)
    IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZTDCP:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZTDCP:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  ZTDCP => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZTDCP:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSE
    CALL ABOR1 ('CPUTQY_APLPAR_EXPL_PARALLEL: NOT METHOD WAS FOUND')
ENDIF

IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZTDCP',1,ZHOOK_HANDLE_PARALLEL)
CALL ACCTND0_PARALLEL (YDCST, YDVARS%L%LT1, YDCPG_OPTS&
&, YDCPG_BNDS, YDVARS%L%RCP, YL_ZTDCP, YD_PTENDL)
CALL ACCTND0_PARALLEL (YDCST, YDVARS%I%LT1, YDCPG_OPTS&
&, YDCPG_BNDS, YDVARS%I%RCP, YL_ZTDCP, YD_PTENDI)
CALL ACCTND0_PARALLEL (YDCST, YDVARS%S%LT1, YDCPG_OPTS&
&, YDCPG_BNDS, YDVARS%S%RCP, YL_ZTDCP, YD_PTENDS)
CALL ACCTND0_PARALLEL (YDCST, YDVARS%R%LT1, YDCPG_OPTS&
&, YDCPG_BNDS, YDVARS%R%RCP, YL_ZTDCP, YD_PTENDR)
CALL ACCTND0_PARALLEL (YDCST, YDVARS%LCONV%LT1, YDCPG_OPTS,&
& YDCPG_BNDS, YDVARS%LCONV%RCP, YL_ZTDCP, YD_PTENDLCONV)
CALL ACCTND0_PARALLEL (YDCST, YDVARS%ICONV%LT1, YDCPG_OPTS,&
& YDCPG_BNDS, YDVARS%ICONV%RCP, YL_ZTDCP, YD_PTENDICONV)
CALL ACCTND0_PARALLEL (YDCST, YDVARS%RCONV%LT1, YDCPG_OPTS,&
& YDCPG_BNDS, YDVARS%RCONV%RCP, YL_ZTDCP, YD_PTENDRCONV)
CALL ACCTND0_PARALLEL (YDCST, YDVARS%SCONV%LT1, YDCPG_OPTS,&
& YDCPG_BNDS, YDVARS%SCONV%RCP, YL_ZTDCP, YD_PTENDSCONV)
CALL ACCTND0_PARALLEL (YDCST, YDVARS%Q%LT1, YDCPG_OPTS&
&, YDCPG_BNDS, YDVARS%Q%RCP, YL_ZTDCP, YD_PTENDQ)
IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZDEC',0,ZHOOK_HANDLE_PARALLEL)

IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','CPUTQY_APLPAR_EXPL_PARALLEL:ZDEC')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZDEC:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  PTENDH => GET_HOST_DATA_RDONLY (YD_PTENDH)
  PTENDTKE => GET_HOST_DATA_RDONLY (YD_PTENDTKE)
  PTENDU_ZDEC => GET_HOST_DATA_RDONLY (YD_PTENDU_ZDEC)
  PTENDV_ZDEC => GET_HOST_DATA_RDONLY (YD_PTENDV_ZDEC)
  ZDEC => GET_HOST_DATA_RDWR (YL_ZDEC)
  ZDTT1 => GET_HOST_DATA_RDWR (YL_ZDTT1)
  ZRRGDELP => GET_HOST_DATA_RDWR (YL_ZRRGDELP)
  ZTDCP => GET_HOST_DATA_RDONLY (YL_ZTDCP)
  Z_YDMF_PHYS_BASE_STATE_T => GET_HOST_DATA_RDONLY (YDMF_PHYS_BASE_STATE%F_T)
  Z_YDMF_PHYS_BASE_STATE_U => GET_HOST_DATA_RDONLY (YDMF_PHYS_BASE_STATE%F_U)
  Z_YDMF_PHYS_BASE_STATE_V => GET_HOST_DATA_RDONLY (YDMF_PHYS_BASE_STATE%F_V)
  Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_CP => GET_HOST_DATA_RDONLY&
  & (YDMF_PHYS_BASE_STATE%YCPG_DYN%RCP%F_CP)
  Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_DELP => GET_HOST_DATA_RDONLY&
  & (YDMF_PHYS_BASE_STATE%YCPG_PHY%XYB%F_DELP)
  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZDEC:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZDEC:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
  !$OMP PARALLEL DO PRIVATE (JBLK, JLEV, JLON, ZCPF, ZH) FIRSTPRIVATE (YLCPG_BNDS)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    CALL YLCPG_BNDS%UPDATE (JBLK)

    

    DO JLEV=1, YDCPG_OPTS%KFLEVG

      DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
        ZCPF=1.0_JPRB/(Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_CP&
        & (JLON, JLEV, JBLK)+PDT*ZTDCP (JLON, JLEV, JBLK))
        ZH=Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_CP (JLON, JLEV,&
        & JBLK)*Z_YDMF_PHYS_BASE_STATE_T (JLON, JLEV, JBLK)
        ZDEC (JLON, JLEV, JBLK)=(Z_YDMF_PHYS_BASE_STATE_U (JLON, JLEV, JBLK)*PTENDU_ZDEC (JLON, JLEV&
        &, JBLK)+Z_YDMF_PHYS_BASE_STATE_V (JLON, JLEV, JBLK)*PTENDV_ZDEC (JLON, JLEV, JBLK)+0.5_JPRB&
        &*PDT*((PTENDU_ZDEC (JLON, JLEV, JBLK))**2+(PTENDV_ZDEC (JLON, JLEV, JBLK))**2))
        ZRRGDELP (JLON, JLEV, JBLK)=ZFLAG*ZRRG*Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_DELP (JLON, JLEV, JBLK)
        ZDTT1 (JLON, JLEV, JBLK)=ZFLAG*(ZCPF*(ZH-PDT*ZDEC (JLON, JLEV, JBLK)+PDT*PTENDH&
        & (JLON, JLEV, JBLK))-Z_YDMF_PHYS_BASE_STATE_T (JLON, JLEV, JBLK))

        IF (YDPHY%LPTKE) THEN
          ZDTT1 (JLON, JLEV, JBLK)=ZDTT1 (JLON, JLEV, JBLK)-ZFLAG*ZCPF*PDT*PTENDTKE (JLON, JLEV, JBLK)
        ENDIF

      ENDDO

    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZDEC:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

  IF (FXTRAN_ACDC_LSYNCHOST ('CPUTQY_APLPAR_EXPL_PARALLEL:ZDEC')) THEN
    IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZDEC:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
    PTENDH => GET_HOST_DATA_RDWR (YD_PTENDH)
    PTENDTKE => GET_HOST_DATA_RDWR (YD_PTENDTKE)
    PTENDU_ZDEC => GET_HOST_DATA_RDWR (YD_PTENDU_ZDEC)
    PTENDV_ZDEC => GET_HOST_DATA_RDWR (YD_PTENDV_ZDEC)
    ZDEC => GET_HOST_DATA_RDWR (YL_ZDEC)
    ZDTT1 => GET_HOST_DATA_RDWR (YL_ZDTT1)
    ZRRGDELP => GET_HOST_DATA_RDWR (YL_ZRRGDELP)
    ZTDCP => GET_HOST_DATA_RDWR (YL_ZTDCP)
    Z_YDMF_PHYS_BASE_STATE_T => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%F_T)
    Z_YDMF_PHYS_BASE_STATE_U => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%F_U)
    Z_YDMF_PHYS_BASE_STATE_V => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%F_V)
    Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_CP => GET_HOST_DATA_RDWR&
    & (YDMF_PHYS_BASE_STATE%YCPG_DYN%RCP%F_CP)
    Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_DELP => GET_HOST_DATA_RDWR&
    & (YDMF_PHYS_BASE_STATE%YCPG_PHY%XYB%F_DELP)
    IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZDEC:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZDEC:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  PTENDH => NULL ()
  PTENDTKE => NULL ()
  PTENDU_ZDEC => NULL ()
  PTENDV_ZDEC => NULL ()
  ZDEC => NULL ()
  ZDTT1 => NULL ()
  ZRRGDELP => NULL ()
  ZTDCP => NULL ()
  Z_YDMF_PHYS_BASE_STATE_T => NULL ()
  Z_YDMF_PHYS_BASE_STATE_U => NULL ()
  Z_YDMF_PHYS_BASE_STATE_V => NULL ()
  Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_CP => NULL ()
  Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_DELP => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZDEC:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMPSINGLECOLUMN','CPUTQY_APLPAR_EXPL_PARALLEL:ZDEC')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZDEC:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  PTENDH => GET_HOST_DATA_RDONLY (YD_PTENDH)
  PTENDTKE => GET_HOST_DATA_RDONLY (YD_PTENDTKE)
  PTENDU_ZDEC => GET_HOST_DATA_RDONLY (YD_PTENDU_ZDEC)
  PTENDV_ZDEC => GET_HOST_DATA_RDONLY (YD_PTENDV_ZDEC)
  ZDEC => GET_HOST_DATA_RDWR (YL_ZDEC)
  ZDTT1 => GET_HOST_DATA_RDWR (YL_ZDTT1)
  ZRRGDELP => GET_HOST_DATA_RDWR (YL_ZRRGDELP)
  ZTDCP => GET_HOST_DATA_RDONLY (YL_ZTDCP)
  Z_YDMF_PHYS_BASE_STATE_T => GET_HOST_DATA_RDONLY (YDMF_PHYS_BASE_STATE%F_T)
  Z_YDMF_PHYS_BASE_STATE_U => GET_HOST_DATA_RDONLY (YDMF_PHYS_BASE_STATE%F_U)
  Z_YDMF_PHYS_BASE_STATE_V => GET_HOST_DATA_RDONLY (YDMF_PHYS_BASE_STATE%F_V)
  Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_CP => GET_HOST_DATA_RDONLY&
  & (YDMF_PHYS_BASE_STATE%YCPG_DYN%RCP%F_CP)
  Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_DELP => GET_HOST_DATA_RDONLY&
  & (YDMF_PHYS_BASE_STATE%YCPG_PHY%XYB%F_DELP)
  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZDEC:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZDEC:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  !$OMP PARALLEL DO PRIVATE (JBLK, JLEV, JLON, YLCPG_BNDS, ZCPF, ZH)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX

    

    

    DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JLON
      YLCPG_BNDS%KFDIA = JLON

      

      DO JLEV=1, YDCPG_OPTS%KFLEVG
        
        ZCPF=1.0_JPRB/(Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_CP&
        & (JLON, JLEV, JBLK)+PDT*ZTDCP (JLON, JLEV, JBLK))
        ZH=Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_CP (JLON, JLEV,&
        & JBLK)*Z_YDMF_PHYS_BASE_STATE_T (JLON, JLEV, JBLK)
        ZDEC (JLON, JLEV, JBLK)=(Z_YDMF_PHYS_BASE_STATE_U (JLON, JLEV, JBLK)*PTENDU_ZDEC (JLON, JLEV&
        &, JBLK)+Z_YDMF_PHYS_BASE_STATE_V (JLON, JLEV, JBLK)*PTENDV_ZDEC (JLON, JLEV, JBLK)+0.5_JPRB&
        &*PDT*((PTENDU_ZDEC (JLON, JLEV, JBLK))**2+(PTENDV_ZDEC (JLON, JLEV, JBLK))**2))
        ZRRGDELP (JLON, JLEV, JBLK)=ZFLAG*ZRRG*Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_DELP (JLON, JLEV, JBLK)
        ZDTT1 (JLON, JLEV, JBLK)=ZFLAG*(ZCPF*(ZH-PDT*ZDEC (JLON, JLEV, JBLK)+PDT*PTENDH&
        & (JLON, JLEV, JBLK))-Z_YDMF_PHYS_BASE_STATE_T (JLON, JLEV, JBLK))

        IF (YDPHY%LPTKE) THEN
          ZDTT1 (JLON, JLEV, JBLK)=ZDTT1 (JLON, JLEV, JBLK)-ZFLAG*ZCPF*PDT*PTENDTKE (JLON, JLEV, JBLK)
        ENDIF

      
      ENDDO

    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZDEC:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

  IF (FXTRAN_ACDC_LSYNCHOST ('CPUTQY_APLPAR_EXPL_PARALLEL:ZDEC')) THEN
    IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZDEC:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
    PTENDH => GET_HOST_DATA_RDWR (YD_PTENDH)
    PTENDTKE => GET_HOST_DATA_RDWR (YD_PTENDTKE)
    PTENDU_ZDEC => GET_HOST_DATA_RDWR (YD_PTENDU_ZDEC)
    PTENDV_ZDEC => GET_HOST_DATA_RDWR (YD_PTENDV_ZDEC)
    ZDEC => GET_HOST_DATA_RDWR (YL_ZDEC)
    ZDTT1 => GET_HOST_DATA_RDWR (YL_ZDTT1)
    ZRRGDELP => GET_HOST_DATA_RDWR (YL_ZRRGDELP)
    ZTDCP => GET_HOST_DATA_RDWR (YL_ZTDCP)
    Z_YDMF_PHYS_BASE_STATE_T => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%F_T)
    Z_YDMF_PHYS_BASE_STATE_U => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%F_U)
    Z_YDMF_PHYS_BASE_STATE_V => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%F_V)
    Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_CP => GET_HOST_DATA_RDWR&
    & (YDMF_PHYS_BASE_STATE%YCPG_DYN%RCP%F_CP)
    Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_DELP => GET_HOST_DATA_RDWR&
    & (YDMF_PHYS_BASE_STATE%YCPG_PHY%XYB%F_DELP)
    IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZDEC:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZDEC:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  PTENDH => NULL ()
  PTENDTKE => NULL ()
  PTENDU_ZDEC => NULL ()
  PTENDV_ZDEC => NULL ()
  ZDEC => NULL ()
  ZDTT1 => NULL ()
  ZRRGDELP => NULL ()
  ZTDCP => NULL ()
  Z_YDMF_PHYS_BASE_STATE_T => NULL ()
  Z_YDMF_PHYS_BASE_STATE_U => NULL ()
  Z_YDMF_PHYS_BASE_STATE_V => NULL ()
  Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_CP => NULL ()
  Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_DELP => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZDEC:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN','CPUTQY_APLPAR_EXPL_PARALLEL:ZDEC')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZDEC:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  PTENDH => GET_DEVICE_DATA_RDONLY (YD_PTENDH)
  PTENDTKE => GET_DEVICE_DATA_RDONLY (YD_PTENDTKE)
  PTENDU_ZDEC => GET_DEVICE_DATA_RDONLY (YD_PTENDU_ZDEC)
  PTENDV_ZDEC => GET_DEVICE_DATA_RDONLY (YD_PTENDV_ZDEC)
  ZDEC => GET_DEVICE_DATA_RDWR (YL_ZDEC)
  ZDTT1 => GET_DEVICE_DATA_RDWR (YL_ZDTT1)
  ZRRGDELP => GET_DEVICE_DATA_RDWR (YL_ZRRGDELP)
  ZTDCP => GET_DEVICE_DATA_RDONLY (YL_ZTDCP)
  Z_YDMF_PHYS_BASE_STATE_T => GET_DEVICE_DATA_RDONLY (YDMF_PHYS_BASE_STATE%F_T)
  Z_YDMF_PHYS_BASE_STATE_U => GET_DEVICE_DATA_RDONLY (YDMF_PHYS_BASE_STATE%F_U)
  Z_YDMF_PHYS_BASE_STATE_V => GET_DEVICE_DATA_RDONLY (YDMF_PHYS_BASE_STATE%F_V)
  Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_CP => GET_DEVICE_DATA_RDONLY&
  & (YDMF_PHYS_BASE_STATE%YCPG_DYN%RCP%F_CP)
  Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_DELP => GET_DEVICE_DATA_RDONLY&
  & (YDMF_PHYS_BASE_STATE%YCPG_PHY%XYB%F_DELP)
  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZDEC:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZDEC:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  
    !$ACC PARALLEL LOOP GANG &
    !$ACC&PRESENT (PTENDH, PTENDTKE, PTENDU_ZDEC, PTENDV_ZDEC, YDCPG_OPTS, YDPHY, &
    !$ACC&         YFXTRAN_ACDC_STACK, ZDEC, ZDTT1, ZRRGDELP, ZTDCP, Z_YDMF_PHYS_BASE_STATE_T, &
    !$ACC&         Z_YDMF_PHYS_BASE_STATE_U, Z_YDMF_PHYS_BASE_STATE_V, Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_CP, &
    !$ACC&         Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_DELP) &
    !$ACC&PRIVATE (JBLK) &
    !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
    
    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    
    
    
    !$ACC LOOP VECTOR &
    !$ACC&PRIVATE (JLEV, JLON, YLCPG_BNDS, ZCPF, ZH) 

    

    DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JLON
      YLCPG_BNDS%KFDIA = JLON

      

      DO JLEV=1, YDCPG_OPTS%KFLEVG
        
        ZCPF=1.0_JPRB/(Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_CP&
        & (JLON, JLEV, JBLK)+PDT*ZTDCP (JLON, JLEV, JBLK))
        ZH=Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_CP (JLON, JLEV,&
        & JBLK)*Z_YDMF_PHYS_BASE_STATE_T (JLON, JLEV, JBLK)
        ZDEC (JLON, JLEV, JBLK)=(Z_YDMF_PHYS_BASE_STATE_U (JLON, JLEV, JBLK)*PTENDU_ZDEC (JLON, JLEV&
        &, JBLK)+Z_YDMF_PHYS_BASE_STATE_V (JLON, JLEV, JBLK)*PTENDV_ZDEC (JLON, JLEV, JBLK)+0.5_JPRB&
        &*PDT*((PTENDU_ZDEC (JLON, JLEV, JBLK))**2+(PTENDV_ZDEC (JLON, JLEV, JBLK))**2))
        ZRRGDELP (JLON, JLEV, JBLK)=ZFLAG*ZRRG*Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_DELP (JLON, JLEV, JBLK)
        ZDTT1 (JLON, JLEV, JBLK)=ZFLAG*(ZCPF*(ZH-PDT*ZDEC (JLON, JLEV, JBLK)+PDT*PTENDH&
        & (JLON, JLEV, JBLK))-Z_YDMF_PHYS_BASE_STATE_T (JLON, JLEV, JBLK))

        IF (YDPHY%LPTKE) THEN
          ZDTT1 (JLON, JLEV, JBLK)=ZDTT1 (JLON, JLEV, JBLK)-ZFLAG*ZCPF*PDT*PTENDTKE (JLON, JLEV, JBLK)
        ENDIF

      
      ENDDO

    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZDEC:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

  IF (FXTRAN_ACDC_LSYNCHOST ('CPUTQY_APLPAR_EXPL_PARALLEL:ZDEC')) THEN
    IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZDEC:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
    PTENDH => GET_HOST_DATA_RDWR (YD_PTENDH)
    PTENDTKE => GET_HOST_DATA_RDWR (YD_PTENDTKE)
    PTENDU_ZDEC => GET_HOST_DATA_RDWR (YD_PTENDU_ZDEC)
    PTENDV_ZDEC => GET_HOST_DATA_RDWR (YD_PTENDV_ZDEC)
    ZDEC => GET_HOST_DATA_RDWR (YL_ZDEC)
    ZDTT1 => GET_HOST_DATA_RDWR (YL_ZDTT1)
    ZRRGDELP => GET_HOST_DATA_RDWR (YL_ZRRGDELP)
    ZTDCP => GET_HOST_DATA_RDWR (YL_ZTDCP)
    Z_YDMF_PHYS_BASE_STATE_T => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%F_T)
    Z_YDMF_PHYS_BASE_STATE_U => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%F_U)
    Z_YDMF_PHYS_BASE_STATE_V => GET_HOST_DATA_RDWR (YDMF_PHYS_BASE_STATE%F_V)
    Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_CP => GET_HOST_DATA_RDWR&
    & (YDMF_PHYS_BASE_STATE%YCPG_DYN%RCP%F_CP)
    Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_DELP => GET_HOST_DATA_RDWR&
    & (YDMF_PHYS_BASE_STATE%YCPG_PHY%XYB%F_DELP)
    IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZDEC:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZDEC:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  PTENDH => NULL ()
  PTENDTKE => NULL ()
  PTENDU_ZDEC => NULL ()
  PTENDV_ZDEC => NULL ()
  ZDEC => NULL ()
  ZDTT1 => NULL ()
  ZRRGDELP => NULL ()
  ZTDCP => NULL ()
  Z_YDMF_PHYS_BASE_STATE_T => NULL ()
  Z_YDMF_PHYS_BASE_STATE_U => NULL ()
  Z_YDMF_PHYS_BASE_STATE_V => NULL ()
  Z_YDMF_PHYS_BASE_STATE_YCPG_DYN_RCP_CP => NULL ()
  Z_YDMF_PHYS_BASE_STATE_YCPG_PHY_XYB_DELP => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZDEC:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSE
    CALL ABOR1 ('CPUTQY_APLPAR_EXPL_PARALLEL: NOT METHOD WAS FOUND')
ENDIF

IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:ZDEC',1,ZHOOK_HANDLE_PARALLEL)
IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:PFDIS',0,ZHOOK_HANDLE_PARALLEL)

IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','CPUTQY_APLPAR_EXPL_PARALLEL:PFDIS')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:PFDIS:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  PFDIS => GET_HOST_DATA_RDWR (YD_PFDIS)
  PTENDTKE => GET_HOST_DATA_RDONLY (YD_PTENDTKE)
  ZDEC => GET_HOST_DATA_RDONLY (YL_ZDEC)
  ZRRGDELP => GET_HOST_DATA_RDONLY (YL_ZRRGDELP)
  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:PFDIS:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:PFDIS:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
  !$OMP PARALLEL DO PRIVATE (JBLK, JLEV, JLON) FIRSTPRIVATE (YLCPG_BNDS)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    CALL YLCPG_BNDS%UPDATE (JBLK)
    
    PFDIS (:, 0, JBLK)=0.0_JPRB

    DO JLEV=1, YDCPG_OPTS%KFLEVG

      DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
        PFDIS (JLON, JLEV, JBLK)=PFDIS (JLON, JLEV-1, JBLK)+ZRRGDELP&
        & (JLON, JLEV, JBLK)*ZDEC (JLON, JLEV, JBLK)
      ENDDO


      IF (YDPHY%LPTKE) THEN

        DO JLON=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
          PFDIS (JLON, JLEV, JBLK)=PFDIS (JLON, JLEV, JBLK)+ZRRGDELP&
          & (JLON, JLEV, JBLK)*PTENDTKE (JLON, JLEV, JBLK)
        ENDDO

      ENDIF

    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:PFDIS:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

  IF (FXTRAN_ACDC_LSYNCHOST ('CPUTQY_APLPAR_EXPL_PARALLEL:PFDIS')) THEN
    IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:PFDIS:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
    PFDIS => GET_HOST_DATA_RDWR (YD_PFDIS)
    PTENDTKE => GET_HOST_DATA_RDWR (YD_PTENDTKE)
    ZDEC => GET_HOST_DATA_RDWR (YL_ZDEC)
    ZRRGDELP => GET_HOST_DATA_RDWR (YL_ZRRGDELP)
    IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:PFDIS:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:PFDIS:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  PFDIS => NULL ()
  PTENDTKE => NULL ()
  ZDEC => NULL ()
  ZRRGDELP => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:PFDIS:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMPSINGLECOLUMN','CPUTQY_APLPAR_EXPL_PARALLEL:PFDIS')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:PFDIS:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  PFDIS => GET_HOST_DATA_RDWR (YD_PFDIS)
  PTENDTKE => GET_HOST_DATA_RDONLY (YD_PTENDTKE)
  ZDEC => GET_HOST_DATA_RDONLY (YL_ZDEC)
  ZRRGDELP => GET_HOST_DATA_RDONLY (YL_ZRRGDELP)
  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:PFDIS:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:PFDIS:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  !$OMP PARALLEL DO PRIVATE (JBLK, JLEV, JLON, YLCPG_BNDS)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX

    

    

    DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JLON
      YLCPG_BNDS%KFDIA = JLON
      
      PFDIS (JLON, 0, JBLK)=0.0_JPRB

      DO JLEV=1, YDCPG_OPTS%KFLEVG
        
        PFDIS (JLON, JLEV, JBLK)=PFDIS (JLON, JLEV-1, JBLK)+ZRRGDELP&
        & (JLON, JLEV, JBLK)*ZDEC (JLON, JLEV, JBLK)

        

        IF (YDPHY%LPTKE) THEN
          
          PFDIS (JLON, JLEV, JBLK)=PFDIS (JLON, JLEV, JBLK)+ZRRGDELP&
          & (JLON, JLEV, JBLK)*PTENDTKE (JLON, JLEV, JBLK)
        
        ENDIF

      ENDDO

    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:PFDIS:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

  IF (FXTRAN_ACDC_LSYNCHOST ('CPUTQY_APLPAR_EXPL_PARALLEL:PFDIS')) THEN
    IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:PFDIS:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
    PFDIS => GET_HOST_DATA_RDWR (YD_PFDIS)
    PTENDTKE => GET_HOST_DATA_RDWR (YD_PTENDTKE)
    ZDEC => GET_HOST_DATA_RDWR (YL_ZDEC)
    ZRRGDELP => GET_HOST_DATA_RDWR (YL_ZRRGDELP)
    IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:PFDIS:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:PFDIS:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  PFDIS => NULL ()
  PTENDTKE => NULL ()
  ZDEC => NULL ()
  ZRRGDELP => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:PFDIS:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN&
  &','CPUTQY_APLPAR_EXPL_PARALLEL:PFDIS')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:PFDIS:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  PFDIS => GET_DEVICE_DATA_RDWR (YD_PFDIS)
  PTENDTKE => GET_DEVICE_DATA_RDONLY (YD_PTENDTKE)
  ZDEC => GET_DEVICE_DATA_RDONLY (YL_ZDEC)
  ZRRGDELP => GET_DEVICE_DATA_RDONLY (YL_ZRRGDELP)
  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:PFDIS:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:PFDIS:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  
    !$ACC PARALLEL LOOP GANG &
    !$ACC&PRESENT (PFDIS, PTENDTKE, YDCPG_OPTS, YDPHY, YFXTRAN_ACDC_STACK, ZDEC, ZRRGDELP) &
    !$ACC&PRIVATE (JBLK) &
    !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
    
    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    
    
    
    !$ACC LOOP VECTOR &
    !$ACC&PRIVATE (JLEV, JLON, YLCPG_BNDS) 

    

    DO JLON = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JLON
      YLCPG_BNDS%KFDIA = JLON
      
      PFDIS (JLON, 0, JBLK)=0.0_JPRB

      DO JLEV=1, YDCPG_OPTS%KFLEVG
        
        PFDIS (JLON, JLEV, JBLK)=PFDIS (JLON, JLEV-1, JBLK)+ZRRGDELP&
        & (JLON, JLEV, JBLK)*ZDEC (JLON, JLEV, JBLK)

        

        IF (YDPHY%LPTKE) THEN
          
          PFDIS (JLON, JLEV, JBLK)=PFDIS (JLON, JLEV, JBLK)+ZRRGDELP&
          & (JLON, JLEV, JBLK)*PTENDTKE (JLON, JLEV, JBLK)
        
        ENDIF

      ENDDO

    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:PFDIS:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

  IF (FXTRAN_ACDC_LSYNCHOST ('CPUTQY_APLPAR_EXPL_PARALLEL:PFDIS')) THEN
    IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:PFDIS:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
    PFDIS => GET_HOST_DATA_RDWR (YD_PFDIS)
    PTENDTKE => GET_HOST_DATA_RDWR (YD_PTENDTKE)
    ZDEC => GET_HOST_DATA_RDWR (YL_ZDEC)
    ZRRGDELP => GET_HOST_DATA_RDWR (YL_ZRRGDELP)
    IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:PFDIS:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:PFDIS:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  PFDIS => NULL ()
  PTENDTKE => NULL ()
  ZDEC => NULL ()
  ZRRGDELP => NULL ()
  IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:PFDIS:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSE
    CALL ABOR1 ('CPUTQY_APLPAR_EXPL_PARALLEL: NOT METHOD WAS FOUND')
ENDIF

IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL:PFDIS',1,ZHOOK_HANDLE_PARALLEL)
CALL CPUTQY0_PARALLEL (.TRUE., YDCPG_BNDS, YDCPG_OPTS, YDCPG_OPTS&
&%YRVARS_DIMS%U, PDT, YDMF_PHYS_NEXT_STATE%U%F_P, YD_PTENDU)
CALL CPUTQY0_PARALLEL (.TRUE., YDCPG_BNDS, YDCPG_OPTS, YDCPG_OPTS&
&%YRVARS_DIMS%V, PDT, YDMF_PHYS_NEXT_STATE%V%F_P, YD_PTENDV)
CALL CPUTQY0_PARALLEL (.TRUE., YDCPG_BNDS, YDCPG_OPTS, YDCPG_OPTS&
&%YRVARS_DIMS%T, 1._JPRB, YDMF_PHYS_NEXT_STATE%T%F_P, YL_ZDTT1)
CALL CPUTQY0_PARALLEL (YDDYNA%LNHDYN, YDCPG_BNDS, YDCPG_OPTS, YDCPG_OPTS&
&%YRVARS_DIMS%SVD, PDT, YDMF_PHYS_NEXT_STATE%SVD%F_P, YD_PTENDD)
CALL CPUTQY0_PARALLEL (YDVARS%L%LT1, YDCPG_BNDS, YDCPG_OPTS, YDCPG_OPTS&
&%YRVARS_DIMS%L, PDT, YDMF_PHYS_NEXT_STATE%L%F_P, YD_PTENDL)
CALL CPUTQY0_PARALLEL (YDVARS%I%LT1, YDCPG_BNDS, YDCPG_OPTS, YDCPG_OPTS&
&%YRVARS_DIMS%I, PDT, YDMF_PHYS_NEXT_STATE%I%F_P, YD_PTENDI)
CALL CPUTQY0_PARALLEL (YDVARS%S%LT1, YDCPG_BNDS, YDCPG_OPTS, YDCPG_OPTS&
&%YRVARS_DIMS%S, PDT, YDMF_PHYS_NEXT_STATE%S%F_P, YD_PTENDS)
CALL CPUTQY0_PARALLEL (YDVARS%R%LT1, YDCPG_BNDS, YDCPG_OPTS, YDCPG_OPTS&
&%YRVARS_DIMS%R, PDT, YDMF_PHYS_NEXT_STATE%R%F_P, YD_PTENDR)
CALL CPUTQY0_PARALLEL (YDVARS%G%LT1, YDCPG_BNDS, YDCPG_OPTS, YDCPG_OPTS&
&%YRVARS_DIMS%G, PDT, YDMF_PHYS_NEXT_STATE%G%F_P, YD_PTENDG)
CALL CPUTQY0_PARALLEL (YDVARS%TKE%LT1, YDCPG_BNDS, YDCPG_OPTS, YDCPG_OPTS&
&%YRVARS_DIMS%TKE, PDT, YDMF_PHYS_NEXT_STATE%TKE%F_P, YD_PTENDTKE)
CALL CPUTQY0_PARALLEL (YDVARS%EFB1%LT1, YDCPG_BNDS, YDCPG_OPTS, YDCPG_OPTS&
&%YRVARS_DIMS%EFB1, PDT, YDMF_PHYS_NEXT_STATE%EFB1%F_P, YD_PTENDEFB1)
CALL CPUTQY0_PARALLEL (YDVARS%EFB2%LT1, YDCPG_BNDS, YDCPG_OPTS, YDCPG_OPTS&
&%YRVARS_DIMS%EFB2, PDT, YDMF_PHYS_NEXT_STATE%EFB2%F_P, YD_PTENDEFB2)
CALL CPUTQY0_PARALLEL (YDVARS%EFB3%LT1, YDCPG_BNDS, YDCPG_OPTS, YDCPG_OPTS&
&%YRVARS_DIMS%EFB3, PDT, YDMF_PHYS_NEXT_STATE%EFB3%F_P, YD_PTENDEFB3)
CALL CPUTQY0_PARALLEL (YDVARS%LCONV%LT1, YDCPG_BNDS, YDCPG_OPTS, YDCPG_OPTS&
&%YRVARS_DIMS%LCONV, PDT, YDMF_PHYS_NEXT_STATE%LCONV%F_P, YD_PTENDLCONV)
CALL CPUTQY0_PARALLEL (YDVARS%ICONV%LT1, YDCPG_BNDS, YDCPG_OPTS, YDCPG_OPTS&
&%YRVARS_DIMS%ICONV, PDT, YDMF_PHYS_NEXT_STATE%ICONV%F_P, YD_PTENDICONV)
CALL CPUTQY0_PARALLEL (YDVARS%RCONV%LT1, YDCPG_BNDS, YDCPG_OPTS, YDCPG_OPTS&
&%YRVARS_DIMS%RCONV, PDT, YDMF_PHYS_NEXT_STATE%RCONV%F_P, YD_PTENDRCONV)
CALL CPUTQY0_PARALLEL (YDVARS%SCONV%LT1, YDCPG_BNDS, YDCPG_OPTS, YDCPG_OPTS&
&%YRVARS_DIMS%SCONV, PDT, YDMF_PHYS_NEXT_STATE%SCONV%F_P, YD_PTENDSCONV)
CALL CPUTQY0_PARALLEL (YDVARS%Q%LT1, YDCPG_BNDS, YDCPG_OPTS, YDCPG_OPTS&
&%YRVARS_DIMS%Q, PDT, YDMF_PHYS_NEXT_STATE%Q%F_P, YD_PTENDQ)


CALL FXTRAN_ACDC_GPUMEMSTAT (__FILE__, __LINE__, "END")

IF (LHOOK) CALL DR_HOOK ('DELETE_TEMPORARIES',0,ZHOOK_HANDLE_FIELD_API)
IF (ASSOCIATED (YL_ZDEC)) CALL FIELD_DELETE (YL_ZDEC)
IF (ASSOCIATED (YL_ZDTT1)) CALL FIELD_DELETE (YL_ZDTT1)
IF (ASSOCIATED (YL_ZRRGDELP)) CALL FIELD_DELETE (YL_ZRRGDELP)
IF (ASSOCIATED (YL_ZTDCP)) CALL FIELD_DELETE (YL_ZTDCP)
IF (LHOOK) CALL DR_HOOK ('DELETE_TEMPORARIES',1,ZHOOK_HANDLE_FIELD_API)
IF (LHOOK) CALL DR_HOOK ('CPUTQY_APLPAR_EXPL_PARALLEL', 1, ZHOOK_HANDLE)
END SUBROUTINE CPUTQY_APLPAR_EXPL_PARALLEL
