
SUBROUTINE LAVENT_PARALLEL (YDCST, YDGEOMETRY, YDCPG_OPTS, YDCPG_BNDS, YDVARS&
&, YDCPG_TND, YDCPG_SL1, YDCPG_SL2, YDRIP, YDML_DYN, YDPARAR, YD_KSETTLOFF&
&, LD2TLFF1, PDTS2, YD_PRDELP, YD_PEVEL, YD_PWRL9, YD_PALPHA)
USE MODEL_DYNAMICS_MOD,ONLY:MODEL_DYNAMICS_TYPE
USE FIELD_VARIABLES_MOD,ONLY:FIELD_VARIABLES
USE CPG_TYPE_MOD,ONLY:CPG_TND_TYPE
USE CPG_SL1_TYPE_MOD,ONLY:CPG_SL1B_TYPE
USE CPG_SL2_TYPE_MOD,ONLY:CPG_SL2_TYPE
USE GEOMETRY_MOD,ONLY:GEOMETRY

USE YOMHOOK,ONLY:DR_HOOK, JPHOOK, LHOOK
USE YOMCST,ONLY:TCST
USE CPG_OPTS_TYPE_MOD,ONLY:CPG_BNDS_TYPE, CPG_OPTS_TYPE
USE YOMRIP,ONLY:TRIP
USE YOMPARAR,ONLY:TPARAR
USE FIELD_MODULE
USE FIELD_FACTORY_MODULE
USE FIELD_ACCESS_MODULE
USE FXTRAN_ACDC_PARALLELMETHOD_MOD
USE FXTRAN_ACDC_STACK_MOD
USE PARKIND1
USE FXTRAN_ACDC_ARRAY_COPY_MOD
USE FXTRAN_ACDC_GPUMEM_MOD
#include "fxtran_acdc_stack.h"

IMPLICIT NONE


TYPE (TCST), INTENT (IN)::YDCST
TYPE (GEOMETRY), INTENT (IN)::YDGEOMETRY
TYPE (CPG_OPTS_TYPE), INTENT (IN)::YDCPG_OPTS
TYPE (CPG_BNDS_TYPE), INTENT (IN)::YDCPG_BNDS
TYPE (FIELD_VARIABLES), INTENT (INOUT)::YDVARS
TYPE (CPG_TND_TYPE), INTENT (INOUT)::YDCPG_TND
TYPE (CPG_SL1B_TYPE), INTENT (INOUT)::YDCPG_SL1
TYPE (CPG_SL2_TYPE), INTENT (INOUT)::YDCPG_SL2
TYPE (TRIP), INTENT (IN)::YDRIP
TYPE (MODEL_DYNAMICS_TYPE), INTENT (IN)::YDML_DYN
TYPE (TPARAR), INTENT (IN)::YDPARAR
CLASS (FIELD_3IM), POINTER :: YD_KSETTLOFF
INTEGER (KIND=JPIM), POINTER::KSETTLOFF (:,:,:)
LOGICAL, INTENT (IN)::LD2TLFF1
REAL (KIND=JPRB), INTENT (IN)::PDTS2
CLASS (FIELD_3RB), POINTER :: YD_PRDELP
REAL (KIND=JPRB), POINTER::PRDELP (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PEVEL
REAL (KIND=JPRB), POINTER::PEVEL (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PWRL9
REAL (KIND=JPRB), POINTER::PWRL9 (:,:,:)
CLASS (FIELD_3RB), POINTER :: YD_PALPHA
REAL (KIND=JPRB), POINTER::PALPHA (:,:,:)
INTEGER (KIND=JPIM)::JLEV
INTEGER (KIND=JPIM)::JROF
CLASS (FIELD_3RB), POINTER :: YL_ZWRL0
REAL (KIND=JPRB), POINTER::ZWRL0 (:,:,:)
REAL (KIND=JPRB)::ZZV
REAL (KIND=JPRB)::ZZU
REAL (KIND=JPRB)::ZUCOMP
REAL (KIND=JPRB)::ZALPHA
REAL (KIND=JPRB)::ZUSA
LOGICAL::LLCOND
LOGICAL::LLWSAVE
LOGICAL::LLNESCV
LOGICAL::LLSETTLSV
LOGICAL::LLNESCT
LOGICAL::LLSETTLST
LOGICAL::LLCT
REAL (KIND=JPHOOK)::ZHOOK_HANDLE
#include "local2cartgeov.intfb.h"
#include "abor1.intfb.h"
#include "local2cartgeov_openacc.intfb.h"
INTEGER(KIND=JPIM) :: JBLK
TYPE(CPG_BNDS_TYPE) :: YLCPG_BNDS
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_FIELD_API
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_PARALLEL
REAL(KIND=JPHOOK) :: ZHOOK_HANDLE_COMPUTE
TYPE(FXTRAN_ACDC_STACK) :: YLSTACK
TYPE(FXTRAN_ACDC_STACK) :: YLOFFSET
REAL (KIND=JPRB), POINTER :: Z_YDCPG_SL1_U9_P(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDCPG_SL1_UF9_P(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDCPG_SL1_UR00_P(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDCPG_SL1_UR0_P(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDCPG_SL1_UR9_P(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDCPG_SL1_V9_P(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDCPG_SL1_VF9_P(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDCPG_SL1_VR00_P(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDCPG_SL1_VR0_P(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDCPG_SL1_VR9_P(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDCPG_SL1_WR00_P(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDCPG_SL1_WR0_P(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDCPG_SL1_WRA_P(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDCPG_SL1_ZR00_P(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDCPG_SL1_ZR0_P(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDCPG_SL1_ZR9_P(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDCPG_SL2_URL(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDCPG_SL2_VRL(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDCPG_SL2_WRL(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDCPG_SL2_ZRL(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDCPG_TND_TNDU(:,:,:)
REAL (KIND=JPRB), POINTER :: Z_YDCPG_TND_TNDV(:,:,:)
REAL(KIND=JPRB), POINTER :: Z_YDVARS_EDOT_T9(:,:,:)
REAL(KIND=JPRB), POINTER :: Z_YDVARS_GEOMETRY_GECLO_P(:,:)
REAL(KIND=JPRB), POINTER :: Z_YDVARS_GEOMETRY_GEMU_P(:,:)
REAL(KIND=JPRB), POINTER :: Z_YDVARS_GEOMETRY_GESLO_P(:,:)
REAL(KIND=JPRB), POINTER :: Z_YDVARS_GEOMETRY_GSQM2_P(:,:)
REAL(KIND=JPRB), POINTER :: Z_YDVARS_U_T0(:,:,:)
REAL(KIND=JPRB), POINTER :: Z_YDVARS_U_T9(:,:,:)
REAL(KIND=JPRB), POINTER :: Z_YDVARS_V_T0(:,:,:)
REAL(KIND=JPRB), POINTER :: Z_YDVARS_V_T9(:,:,:)
IF (LHOOK) CALL DR_HOOK ('LAVENT_PARALLEL', 0, ZHOOK_HANDLE)

CALL FXTRAN_ACDC_GPUMEMSTAT (__FILE__, __LINE__, "BEGIN")


IF (LHOOK) CALL DR_HOOK ('CREATE_TEMPORARIES',0,ZHOOK_HANDLE_FIELD_API)
CALL FIELD_NEW (YL_ZWRL0, UBOUNDS=[YDGEOMETRY%YRDIM%NPROMA, YDGEOMETRY%YRDIMV%NFLEVG&
&, YDCPG_OPTS%JBLKMAX], LBOUNDS=[1, 1, YDCPG_OPTS%JBLKMIN], PERSISTENT=.TRUE.)
IF (LHOOK) CALL DR_HOOK ('CREATE_TEMPORARIES',1,ZHOOK_HANDLE_FIELD_API)



ZUSA=1.0_JPRB/YDCST%RA
LLCT=(YDML_DYN%YRDYNA%LPC_FULL.AND.YDML_DYN%YRDYN%NCURRENT_ITER>0)
LLSETTLST=YDML_DYN%YRDYNA%LSETTLST.AND.(.NOT.YDML_DYN%YRDYNA%LELTRA)
LLNESCT=YDML_DYN%YRDYNA%LNESCT
LLSETTLSV=YDML_DYN%YRDYNA%LSETTLSV.AND.(.NOT.YDML_DYN%YRDYNA%LELTRA)
LLNESCV=YDML_DYN%YRDYNA%LNESCV
LLCOND=(YDML_DYN%YRDYN%NSPLTHOI/=0).AND.(YDML_DYN%YRDYN%NWLAG<4)
LLWSAVE=YDML_DYN%YRDYN%LSLDP_XYZ.AND.YDML_DYN%YRDYN%LSLDP_SAVE
IF (LHOOK) CALL DR_HOOK ('LAVENT_PARALLEL:0',0,ZHOOK_HANDLE_PARALLEL)

IF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMP','LAVENT_PARALLEL:0')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('LAVENT_PARALLEL:0:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  KSETTLOFF => GET_HOST_DATA_RDWR (YD_KSETTLOFF)
  PALPHA => GET_HOST_DATA_RDWR (YD_PALPHA)
  PEVEL => GET_HOST_DATA_RDONLY (YD_PEVEL)
  PRDELP => GET_HOST_DATA_RDONLY (YD_PRDELP)
  PWRL9 => GET_HOST_DATA_RDWR (YD_PWRL9)
  ZWRL0 => GET_HOST_DATA_RDWR (YL_ZWRL0)
  Z_YDCPG_SL1_U9_P => GET_HOST_DATA_RDONLY (YDCPG_SL1%U9%F_P)
  Z_YDCPG_SL1_UF9_P => GET_HOST_DATA_RDONLY (YDCPG_SL1%UF9%F_P)
  Z_YDCPG_SL1_UR00_P => GET_HOST_DATA_RDWR (YDCPG_SL1%UR00%F_P)
  Z_YDCPG_SL1_UR0_P => GET_HOST_DATA_RDWR (YDCPG_SL1%UR0%F_P)
  Z_YDCPG_SL1_UR9_P => GET_HOST_DATA_RDWR (YDCPG_SL1%UR9%F_P)
  Z_YDCPG_SL1_V9_P => GET_HOST_DATA_RDONLY (YDCPG_SL1%V9%F_P)
  Z_YDCPG_SL1_VF9_P => GET_HOST_DATA_RDONLY (YDCPG_SL1%VF9%F_P)
  Z_YDCPG_SL1_VR00_P => GET_HOST_DATA_RDWR (YDCPG_SL1%VR00%F_P)
  Z_YDCPG_SL1_VR0_P => GET_HOST_DATA_RDWR (YDCPG_SL1%VR0%F_P)
  Z_YDCPG_SL1_VR9_P => GET_HOST_DATA_RDWR (YDCPG_SL1%VR9%F_P)
  Z_YDCPG_SL1_WR00_P => GET_HOST_DATA_RDWR (YDCPG_SL1%WR00%F_P)
  Z_YDCPG_SL1_WR0_P => GET_HOST_DATA_RDWR (YDCPG_SL1%WR0%F_P)
  Z_YDCPG_SL1_WRA_P => GET_HOST_DATA_RDWR (YDCPG_SL1%WRA%F_P)
  Z_YDCPG_SL1_ZR00_P => GET_HOST_DATA_RDWR (YDCPG_SL1%ZR00%F_P)
  Z_YDCPG_SL1_ZR0_P => GET_HOST_DATA_RDWR (YDCPG_SL1%ZR0%F_P)
  Z_YDCPG_SL1_ZR9_P => GET_HOST_DATA_RDWR (YDCPG_SL1%ZR9%F_P)
  Z_YDCPG_SL2_URL => GET_HOST_DATA_RDWR (YDCPG_SL2%F_URL)
  Z_YDCPG_SL2_VRL => GET_HOST_DATA_RDWR (YDCPG_SL2%F_VRL)
  Z_YDCPG_SL2_WRL => GET_HOST_DATA_RDWR (YDCPG_SL2%F_WRL)
  Z_YDCPG_SL2_ZRL => GET_HOST_DATA_RDWR (YDCPG_SL2%F_ZRL)
  Z_YDCPG_TND_TNDU => GET_HOST_DATA_RDONLY (YDCPG_TND%F_TNDU)
  Z_YDCPG_TND_TNDV => GET_HOST_DATA_RDONLY (YDCPG_TND%F_TNDV)
  Z_YDVARS_EDOT_T9 => GET_HOST_DATA_RDWR (YDVARS%EDOT%FT9)
  Z_YDVARS_GEOMETRY_GECLO_P => GET_HOST_DATA_RDONLY (YDVARS%GEOMETRY%GECLO%FT0)
  Z_YDVARS_GEOMETRY_GEMU_P => GET_HOST_DATA_RDONLY (YDVARS%GEOMETRY%GEMU%FT0)
  Z_YDVARS_GEOMETRY_GESLO_P => GET_HOST_DATA_RDONLY (YDVARS%GEOMETRY%GESLO%FT0)
  Z_YDVARS_GEOMETRY_GSQM2_P => GET_HOST_DATA_RDONLY (YDVARS%GEOMETRY%GSQM2%FT0)
  Z_YDVARS_U_T0 => GET_HOST_DATA_RDONLY (YDVARS%U%FT0)
  Z_YDVARS_U_T9 => GET_HOST_DATA_RDONLY (YDVARS%U%FT9)
  Z_YDVARS_V_T0 => GET_HOST_DATA_RDONLY (YDVARS%V%FT0)
  Z_YDVARS_V_T9 => GET_HOST_DATA_RDONLY (YDVARS%V%FT9)
  IF (LHOOK) CALL DR_HOOK ('LAVENT_PARALLEL:0:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('LAVENT_PARALLEL:0:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  CALL YLCPG_BNDS%INIT (YDCPG_OPTS)
  !$OMP PARALLEL DO PRIVATE (JBLK, JLEV, JROF, ZALPHA, ZZU, ZZV) FIRSTPRIVATE (YLCPG_BNDS)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    CALL YLCPG_BNDS%UPDATE (JBLK)
    
    PALPHA (:, 1:YDGEOMETRY%YRDIMV%NFLEVG, JBLK)=0._JPRB

    IF (YDGEOMETRY%YRVERT_GEOM%YRCVER%LVERTFE) THEN

      DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG

        DO JROF=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
          ZWRL0 (JROF, JLEV, JBLK)=PEVEL (JROF, JLEV, JBLK)*(YDGEOMETRY%YRVERT_GEOM%YRVETA%VETAH&
          & (JLEV)-YDGEOMETRY%YRVERT_GEOM%YRVETA%VETAH (JLEV-1))*PRDELP (JROF, JLEV, JBLK)
        ENDDO

      ENDDO

    ELSE

      DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG

        DO JROF=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
          ZWRL0 (JROF, JLEV, JBLK)=0.5_JPRB*(PEVEL (JROF, JLEV, JBLK)+PEVEL (JROF&
          &, JLEV-1, JBLK))*(YDGEOMETRY%YRVERT_GEOM%YRVETA%VETAH (JLEV)-YDGEOMETRY&
          &%YRVERT_GEOM%YRVETA%VETAH (JLEV-1))*PRDELP (JROF, JLEV, JBLK)
        ENDDO

      ENDDO

    ENDIF


    IF (YDML_DYN%YRDYNA%LTWOTL.AND.YDML_DYN%YRDYN%LSVTSM) THEN

      DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
        Z_YDCPG_SL1_WRA_P (:, JLEV, JBLK)=ZWRL0 (:, JLEV, JBLK)
      ENDDO

    ENDIF


    IF (YDML_DYN%YRDYNA%LTWOTL.AND.YDML_DYN%YRDYNA%LELTRA) THEN

      DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG

        DO JROF=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA

          IF (LLCOND) THEN
            ZZU=Z_YDCPG_SL1_UF9_P (JROF, JLEV, JBLK)
            ZZV=Z_YDCPG_SL1_VF9_P (JROF, JLEV, JBLK)
          ELSE
            ZZU=Z_YDCPG_SL1_U9_P (JROF, JLEV, JBLK)
            ZZV=Z_YDCPG_SL1_V9_P (JROF, JLEV, JBLK)
          ENDIF

          Z_YDCPG_SL1_UR0_P (JROF, JLEV, JBLK)=Z_YDVARS_U_T0 (JROF, JLEV, JBLK&
          &)+0.5_JPRB*ZZU+PDTS2*Z_YDCPG_TND_TNDU (JROF, JLEV, JBLK)
          Z_YDCPG_SL1_VR0_P (JROF, JLEV, JBLK)=Z_YDVARS_V_T0 (JROF, JLEV, JBLK&
          &)+0.5_JPRB*ZZV+PDTS2*Z_YDCPG_TND_TNDV (JROF, JLEV, JBLK)
        ENDDO

      ENDDO


      DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
        Z_YDCPG_SL1_WR0_P (:, JLEV, JBLK)=ZWRL0 (:, JLEV, JBLK)
        Z_YDCPG_SL2_URL (:, JLEV, JBLK)=Z_YDCPG_SL1_UR0_P (:, JLEV, JBLK)
        Z_YDCPG_SL2_VRL (:, JLEV, JBLK)=Z_YDCPG_SL1_VR0_P (:, JLEV, JBLK)
        Z_YDCPG_SL2_WRL (:, JLEV, JBLK)=Z_YDCPG_SL1_WR0_P (:, JLEV, JBLK)
      ENDDO


      IF (LD2TLFF1) THEN

        DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
          Z_YDCPG_SL1_UR9_P (:, JLEV, JBLK)=Z_YDVARS_U_T0 (:, JLEV, JBLK)
          Z_YDCPG_SL1_VR9_P (:, JLEV, JBLK)=Z_YDVARS_V_T0 (:, JLEV, JBLK)
        ENDDO

      ENDIF

    ELSEIF (YDML_DYN%YRDYNA%LTWOTL.AND.(.NOT.YDML_DYN%YRDYNA%LELTRA)) THEN

      IF (.NOT.LLCT) THEN

        IF (YDCPG_OPTS%NSTEP<=YDRIP%NFOST.OR.LLNESCT) THEN

          DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
            Z_YDCPG_SL1_UR0_P (:, JLEV, JBLK)=Z_YDVARS_U_T0 (:, JLEV, JBLK)
            Z_YDCPG_SL1_VR0_P (:, JLEV, JBLK)=Z_YDVARS_V_T0 (:, JLEV, JBLK)
          ENDDO


          DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
            Z_YDCPG_SL2_URL (:, JLEV, JBLK)=Z_YDCPG_SL1_UR0_P (:, JLEV, JBLK)
            Z_YDCPG_SL2_VRL (:, JLEV, JBLK)=Z_YDCPG_SL1_VR0_P (:, JLEV, JBLK)
          ENDDO

        ELSEIF (LLSETTLST) THEN

          DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG

            DO JROF=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
              Z_YDCPG_SL1_UR0_P (JROF, JLEV, JBLK)=2.0_JPRB*Z_YDVARS_U_T0&
              & (JROF, JLEV, JBLK)-Z_YDVARS_U_T9 (JROF, JLEV, JBLK)
              Z_YDCPG_SL1_VR0_P (JROF, JLEV, JBLK)=2.0_JPRB*Z_YDVARS_V_T0&
              & (JROF, JLEV, JBLK)-Z_YDVARS_V_T9 (JROF, JLEV, JBLK)
            ENDDO

          ENDDO


          DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
            Z_YDCPG_SL2_URL (:, JLEV, JBLK)=Z_YDVARS_U_T0 (:, JLEV, JBLK)
            Z_YDCPG_SL2_VRL (:, JLEV, JBLK)=Z_YDVARS_V_T0 (:, JLEV, JBLK)
          ENDDO

        ENDIF


        IF (YDCPG_OPTS%NSTEP<=YDRIP%NFOST.OR.LLNESCV) THEN

          DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
            Z_YDCPG_SL1_WR0_P (:, JLEV, JBLK)=ZWRL0 (:, JLEV, JBLK)
            Z_YDCPG_SL2_WRL (:, JLEV, JBLK)=Z_YDCPG_SL1_WR0_P (:, JLEV, JBLK)
          ENDDO


          IF (YDCPG_OPTS%NSTEP==0) THEN

            IF (YDML_DYN%YRDYN%LSETTLSVF.OR.LLWSAVE)  THEN
              PWRL9 (:, 1:YDGEOMETRY%YRDIMV%NFLEVG, JBLK)=0.0_JPRB
            ENDIF

          ELSEIF (LLWSAVE) THEN
            PWRL9 (:, 1:YDGEOMETRY%YRDIMV%NFLEVG, JBLK)=Z_YDVARS_EDOT_T9 (:, 1:YDGEOMETRY%YRDIMV%NFLEVG, JBLK)
          ENDIF

        ELSEIF (LLSETTLSV) THEN

          IF (YDML_DYN%YRDYN%LSETTLSVF) THEN

            DO JLEV=1, YDML_DYN%YRDYN%NFLEVSF
              KSETTLOFF (:, JLEV, JBLK)=0

              DO JROF=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
                ZALPHA=0.5_JPRB*(1._JPRB-TANH (-YDML_DYN%YRDYN%RSCALE*(ZWRL0 (JROF, JLEV,&
                & JBLK)*Z_YDVARS_EDOT_T9 (JROF, JLEV, JBLK)+YDML_DYN%YRDYN%RSCALEOFF)))
                Z_YDCPG_SL1_WR0_P (JROF, JLEV, JBLK)=ZWRL0 (JROF, JLEV, JBLK)+ZALPHA&
                &*(ZWRL0 (JROF, JLEV, JBLK)-Z_YDVARS_EDOT_T9 (JROF, JLEV, JBLK))

                IF (YDML_DYN%YRDYN%LSETTLSVF_DIFF)  THEN
                  PALPHA (JROF, JLEV, JBLK)=1._JPRB-ZALPHA
                ENDIF


                IF (YDML_DYN%YRDYN%LSETFSTAT)  THEN
                  KSETTLOFF (JROF, JLEV, JBLK)=KSETTLOFF (JROF, JLEV, JBLK)+NINT (1.0_JPRB-ZALPHA)
                ENDIF

              ENDDO

            ENDDO


            DO JLEV=YDML_DYN%YRDYN%NFLEVSF+1, YDGEOMETRY%YRDIMV%NFLEVG

              DO JROF=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
                Z_YDCPG_SL1_WR0_P (JROF, JLEV, JBLK)=2.0_JPRB*ZWRL0 (JROF&
                &, JLEV, JBLK)-Z_YDVARS_EDOT_T9 (JROF, JLEV, JBLK)
              ENDDO

            ENDDO

            PWRL9 (:, 1:YDGEOMETRY%YRDIMV%NFLEVG, JBLK)=Z_YDVARS_EDOT_T9 (:, 1:YDGEOMETRY%YRDIMV%NFLEVG, JBLK)
          ELSE

            DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG

              DO JROF=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
                Z_YDCPG_SL1_WR0_P (JROF, JLEV, JBLK)=2.0_JPRB*ZWRL0 (JROF&
                &, JLEV, JBLK)-Z_YDVARS_EDOT_T9 (JROF, JLEV, JBLK)
              ENDDO

            ENDDO

          ENDIF


          DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
            Z_YDCPG_SL2_WRL (:, JLEV, JBLK)=ZWRL0 (:, JLEV, JBLK)
          ENDDO

        ENDIF

        Z_YDVARS_EDOT_T9 (:, 1:YDGEOMETRY%YRDIMV%NFLEVG, JBLK)=ZWRL0 (:, 1:YDGEOMETRY%YRDIMV%NFLEVG, JBLK)
      ELSE

        DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
          Z_YDCPG_SL1_UR0_P (:, JLEV, JBLK)=Z_YDVARS_U_T9 (:, JLEV, JBLK)
          Z_YDCPG_SL1_VR0_P (:, JLEV, JBLK)=Z_YDVARS_V_T9 (:, JLEV, JBLK)
        ENDDO


        DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
          Z_YDCPG_SL1_WR0_P (:, JLEV, JBLK)=Z_YDVARS_EDOT_T9 (:, JLEV, JBLK)
        ENDDO


        DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
          Z_YDCPG_SL2_URL (:, JLEV, JBLK)=Z_YDVARS_U_T0 (:, JLEV, JBLK)
          Z_YDCPG_SL2_VRL (:, JLEV, JBLK)=Z_YDVARS_V_T0 (:, JLEV, JBLK)
        ENDDO


        DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
          Z_YDCPG_SL2_WRL (:, JLEV, JBLK)=ZWRL0 (:, JLEV, JBLK)
        ENDDO

      ENDIF


      IF (LD2TLFF1) THEN

        DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
          Z_YDCPG_SL1_UR9_P (:, JLEV, JBLK)=Z_YDVARS_U_T0 (:, JLEV, JBLK)
          Z_YDCPG_SL1_VR9_P (:, JLEV, JBLK)=Z_YDVARS_V_T0 (:, JLEV, JBLK)
        ENDDO

      ENDIF

    ELSE

      DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
        Z_YDCPG_SL1_UR0_P (:, JLEV, JBLK)=Z_YDVARS_U_T0 (:, JLEV, JBLK)
        Z_YDCPG_SL1_VR0_P (:, JLEV, JBLK)=Z_YDVARS_V_T0 (:, JLEV, JBLK)
      ENDDO


      DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
        Z_YDCPG_SL1_WR0_P (:, JLEV, JBLK)=ZWRL0 (:, JLEV, JBLK)
        Z_YDCPG_SL2_URL (:, JLEV, JBLK)=Z_YDCPG_SL1_UR0_P (:, JLEV, JBLK)
        Z_YDCPG_SL2_VRL (:, JLEV, JBLK)=Z_YDCPG_SL1_VR0_P (:, JLEV, JBLK)
        Z_YDCPG_SL2_WRL (:, JLEV, JBLK)=Z_YDCPG_SL1_WR0_P (:, JLEV, JBLK)
      ENDDO


      IF (LD2TLFF1) THEN

        DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
          Z_YDCPG_SL1_UR9_P (:, JLEV, JBLK)=Z_YDVARS_U_T9 (:, JLEV, JBLK)
          Z_YDCPG_SL1_VR9_P (:, JLEV, JBLK)=Z_YDVARS_V_T9 (:, JLEV, JBLK)
        ENDDO

      ENDIF

    ENDIF


    IF (YDCPG_OPTS%LAROME.AND.YDPARAR%LSQUALL) THEN

      DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG

        DO JROF=YLCPG_BNDS%KIDIA, YLCPG_BNDS%KFDIA
          Z_YDCPG_SL1_VR0_P (JROF, JLEV, JBLK)=Z_YDCPG_SL1_VR0_P (JROF, JLEV, JBLK)+YDPARAR%VSQUALL
          Z_YDCPG_SL2_VRL (JROF, JLEV, JBLK)=Z_YDCPG_SL2_VRL (JROF, JLEV, JBLK)+YDPARAR%VSQUALL
        ENDDO

      ENDDO

    ENDIF


    IF (YDML_DYN%YRDYN%LSLDP_RK) THEN

      DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
        Z_YDCPG_SL1_UR00_P (:, JLEV, JBLK)=Z_YDCPG_SL2_URL (:, JLEV, JBLK)
        Z_YDCPG_SL1_VR00_P (:, JLEV, JBLK)=Z_YDCPG_SL2_VRL (:, JLEV, JBLK)
        Z_YDCPG_SL1_WR00_P (:, JLEV, JBLK)=Z_YDCPG_SL2_WRL (:, JLEV, JBLK)
      ENDDO

    ENDIF


    IF (YDML_DYN%YRDYN%LSLDP_CURV.OR.YDML_DYN%YRDYN%LSLDP_XYZ) THEN
      CALL LOCAL2CARTGEOV (0, YDGEOMETRY%YRDIMV%NFLEVG, YDGEOMETRY%YRDIM%NPROMA, YLCPG_BNDS%KIDIA&
      &, YLCPG_BNDS%KFDIA, Z_YDVARS_GEOMETRY_GEMU_P(:, JBLK), Z_YDVARS_GEOMETRY_GSQM2_P(:, JBLK&
      &), Z_YDVARS_GEOMETRY_GECLO_P(:, JBLK), Z_YDVARS_GEOMETRY_GESLO_P(:, JBLK), Z_YDCPG_SL1_UR0_P&
      &(:,:, JBLK), Z_YDCPG_SL1_VR0_P(:,:, JBLK), Z_YDCPG_SL1_ZR0_P(:,:, JBLK))

      IF (YDML_DYN%YRDYN%LSLDP_XYZ) THEN
        CALL LOCAL2CARTGEOV (1, YDGEOMETRY%YRDIMV%NFLEVG, YDGEOMETRY%YRDIM%NPROMA, YLCPG_BNDS%KIDIA&
        &, YLCPG_BNDS%KFDIA, Z_YDVARS_GEOMETRY_GEMU_P(:, JBLK), Z_YDVARS_GEOMETRY_GSQM2_P(:, JBLK&
        &), Z_YDVARS_GEOMETRY_GECLO_P(:, JBLK), Z_YDVARS_GEOMETRY_GESLO_P(:, JBLK), Z_YDCPG_SL2_URL&
        &(:,:, JBLK), Z_YDCPG_SL2_VRL(:,:, JBLK), Z_YDCPG_SL2_ZRL(:,:, JBLK))
      ENDIF


      IF (YDML_DYN%YRDYN%LSLDP_RK) THEN
        CALL LOCAL2CARTGEOV (0, YDGEOMETRY%YRDIMV%NFLEVG, YDGEOMETRY%YRDIM%NPROMA, YLCPG_BNDS%KIDIA&
        &, YLCPG_BNDS%KFDIA, Z_YDVARS_GEOMETRY_GEMU_P(:, JBLK), Z_YDVARS_GEOMETRY_GSQM2_P(:, JBLK&
        &), Z_YDVARS_GEOMETRY_GECLO_P(:, JBLK), Z_YDVARS_GEOMETRY_GESLO_P(:, JBLK), Z_YDCPG_SL1_UR00_P&
        &(:,:, JBLK), Z_YDCPG_SL1_VR00_P(:,:, JBLK), Z_YDCPG_SL1_ZR00_P(:,:, JBLK))
      ENDIF

    ENDIF


    IF (YDML_DYN%YRDYN%LRHS_CURV.AND.LD2TLFF1) THEN
      CALL LOCAL2CARTGEOV (0, YDGEOMETRY%YRDIMV%NFLEVG, YDGEOMETRY%YRDIM%NPROMA, YLCPG_BNDS%KIDIA&
      &, YLCPG_BNDS%KFDIA, Z_YDVARS_GEOMETRY_GEMU_P(:, JBLK), Z_YDVARS_GEOMETRY_GSQM2_P(:, JBLK&
      &), Z_YDVARS_GEOMETRY_GECLO_P(:, JBLK), Z_YDVARS_GEOMETRY_GESLO_P(:, JBLK), Z_YDCPG_SL1_UR9_P&
      &(:,:, JBLK), Z_YDCPG_SL1_VR9_P(:,:, JBLK), Z_YDCPG_SL1_ZR9_P(:,:, JBLK))
    ENDIF

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('LAVENT_PARALLEL:0:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

  IF (FXTRAN_ACDC_LSYNCHOST ('LAVENT_PARALLEL:0')) THEN
    IF (LHOOK) CALL DR_HOOK ('LAVENT_PARALLEL:0:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
    KSETTLOFF => GET_HOST_DATA_RDWR (YD_KSETTLOFF)
    PALPHA => GET_HOST_DATA_RDWR (YD_PALPHA)
    PEVEL => GET_HOST_DATA_RDWR (YD_PEVEL)
    PRDELP => GET_HOST_DATA_RDWR (YD_PRDELP)
    PWRL9 => GET_HOST_DATA_RDWR (YD_PWRL9)
    ZWRL0 => GET_HOST_DATA_RDWR (YL_ZWRL0)
    Z_YDCPG_SL1_U9_P => GET_HOST_DATA_RDWR (YDCPG_SL1%U9%F_P)
    Z_YDCPG_SL1_UF9_P => GET_HOST_DATA_RDWR (YDCPG_SL1%UF9%F_P)
    Z_YDCPG_SL1_UR00_P => GET_HOST_DATA_RDWR (YDCPG_SL1%UR00%F_P)
    Z_YDCPG_SL1_UR0_P => GET_HOST_DATA_RDWR (YDCPG_SL1%UR0%F_P)
    Z_YDCPG_SL1_UR9_P => GET_HOST_DATA_RDWR (YDCPG_SL1%UR9%F_P)
    Z_YDCPG_SL1_V9_P => GET_HOST_DATA_RDWR (YDCPG_SL1%V9%F_P)
    Z_YDCPG_SL1_VF9_P => GET_HOST_DATA_RDWR (YDCPG_SL1%VF9%F_P)
    Z_YDCPG_SL1_VR00_P => GET_HOST_DATA_RDWR (YDCPG_SL1%VR00%F_P)
    Z_YDCPG_SL1_VR0_P => GET_HOST_DATA_RDWR (YDCPG_SL1%VR0%F_P)
    Z_YDCPG_SL1_VR9_P => GET_HOST_DATA_RDWR (YDCPG_SL1%VR9%F_P)
    Z_YDCPG_SL1_WR00_P => GET_HOST_DATA_RDWR (YDCPG_SL1%WR00%F_P)
    Z_YDCPG_SL1_WR0_P => GET_HOST_DATA_RDWR (YDCPG_SL1%WR0%F_P)
    Z_YDCPG_SL1_WRA_P => GET_HOST_DATA_RDWR (YDCPG_SL1%WRA%F_P)
    Z_YDCPG_SL1_ZR00_P => GET_HOST_DATA_RDWR (YDCPG_SL1%ZR00%F_P)
    Z_YDCPG_SL1_ZR0_P => GET_HOST_DATA_RDWR (YDCPG_SL1%ZR0%F_P)
    Z_YDCPG_SL1_ZR9_P => GET_HOST_DATA_RDWR (YDCPG_SL1%ZR9%F_P)
    Z_YDCPG_SL2_URL => GET_HOST_DATA_RDWR (YDCPG_SL2%F_URL)
    Z_YDCPG_SL2_VRL => GET_HOST_DATA_RDWR (YDCPG_SL2%F_VRL)
    Z_YDCPG_SL2_WRL => GET_HOST_DATA_RDWR (YDCPG_SL2%F_WRL)
    Z_YDCPG_SL2_ZRL => GET_HOST_DATA_RDWR (YDCPG_SL2%F_ZRL)
    Z_YDCPG_TND_TNDU => GET_HOST_DATA_RDWR (YDCPG_TND%F_TNDU)
    Z_YDCPG_TND_TNDV => GET_HOST_DATA_RDWR (YDCPG_TND%F_TNDV)
    Z_YDVARS_EDOT_T9 => GET_HOST_DATA_RDWR (YDVARS%EDOT%FT9)
    Z_YDVARS_GEOMETRY_GECLO_P => GET_HOST_DATA_RDWR (YDVARS%GEOMETRY%GECLO%FT0)
    Z_YDVARS_GEOMETRY_GEMU_P => GET_HOST_DATA_RDWR (YDVARS%GEOMETRY%GEMU%FT0)
    Z_YDVARS_GEOMETRY_GESLO_P => GET_HOST_DATA_RDWR (YDVARS%GEOMETRY%GESLO%FT0)
    Z_YDVARS_GEOMETRY_GSQM2_P => GET_HOST_DATA_RDWR (YDVARS%GEOMETRY%GSQM2%FT0)
    Z_YDVARS_U_T0 => GET_HOST_DATA_RDWR (YDVARS%U%FT0)
    Z_YDVARS_U_T9 => GET_HOST_DATA_RDWR (YDVARS%U%FT9)
    Z_YDVARS_V_T0 => GET_HOST_DATA_RDWR (YDVARS%V%FT0)
    Z_YDVARS_V_T9 => GET_HOST_DATA_RDWR (YDVARS%V%FT9)
    IF (LHOOK) CALL DR_HOOK ('LAVENT_PARALLEL:0:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('LAVENT_PARALLEL:0:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  KSETTLOFF => NULL ()
  PALPHA => NULL ()
  PEVEL => NULL ()
  PRDELP => NULL ()
  PWRL9 => NULL ()
  ZWRL0 => NULL ()
  Z_YDCPG_SL1_U9_P => NULL ()
  Z_YDCPG_SL1_UF9_P => NULL ()
  Z_YDCPG_SL1_UR00_P => NULL ()
  Z_YDCPG_SL1_UR0_P => NULL ()
  Z_YDCPG_SL1_UR9_P => NULL ()
  Z_YDCPG_SL1_V9_P => NULL ()
  Z_YDCPG_SL1_VF9_P => NULL ()
  Z_YDCPG_SL1_VR00_P => NULL ()
  Z_YDCPG_SL1_VR0_P => NULL ()
  Z_YDCPG_SL1_VR9_P => NULL ()
  Z_YDCPG_SL1_WR00_P => NULL ()
  Z_YDCPG_SL1_WR0_P => NULL ()
  Z_YDCPG_SL1_WRA_P => NULL ()
  Z_YDCPG_SL1_ZR00_P => NULL ()
  Z_YDCPG_SL1_ZR0_P => NULL ()
  Z_YDCPG_SL1_ZR9_P => NULL ()
  Z_YDCPG_SL2_URL => NULL ()
  Z_YDCPG_SL2_VRL => NULL ()
  Z_YDCPG_SL2_WRL => NULL ()
  Z_YDCPG_SL2_ZRL => NULL ()
  Z_YDCPG_TND_TNDU => NULL ()
  Z_YDCPG_TND_TNDV => NULL ()
  Z_YDVARS_EDOT_T9 => NULL ()
  Z_YDVARS_GEOMETRY_GECLO_P => NULL ()
  Z_YDVARS_GEOMETRY_GEMU_P => NULL ()
  Z_YDVARS_GEOMETRY_GESLO_P => NULL ()
  Z_YDVARS_GEOMETRY_GSQM2_P => NULL ()
  Z_YDVARS_U_T0 => NULL ()
  Z_YDVARS_U_T9 => NULL ()
  Z_YDVARS_V_T0 => NULL ()
  Z_YDVARS_V_T9 => NULL ()
  IF (LHOOK) CALL DR_HOOK ('LAVENT_PARALLEL:0:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENMPSINGLECOLUMN','LAVENT_PARALLEL:0')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('LAVENT_PARALLEL:0:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  KSETTLOFF => GET_HOST_DATA_RDWR (YD_KSETTLOFF)
  PALPHA => GET_HOST_DATA_RDWR (YD_PALPHA)
  PEVEL => GET_HOST_DATA_RDONLY (YD_PEVEL)
  PRDELP => GET_HOST_DATA_RDONLY (YD_PRDELP)
  PWRL9 => GET_HOST_DATA_RDWR (YD_PWRL9)
  ZWRL0 => GET_HOST_DATA_RDWR (YL_ZWRL0)
  Z_YDCPG_SL1_U9_P => GET_HOST_DATA_RDONLY (YDCPG_SL1%U9%F_P)
  Z_YDCPG_SL1_UF9_P => GET_HOST_DATA_RDONLY (YDCPG_SL1%UF9%F_P)
  Z_YDCPG_SL1_UR00_P => GET_HOST_DATA_RDWR (YDCPG_SL1%UR00%F_P)
  Z_YDCPG_SL1_UR0_P => GET_HOST_DATA_RDWR (YDCPG_SL1%UR0%F_P)
  Z_YDCPG_SL1_UR9_P => GET_HOST_DATA_RDWR (YDCPG_SL1%UR9%F_P)
  Z_YDCPG_SL1_V9_P => GET_HOST_DATA_RDONLY (YDCPG_SL1%V9%F_P)
  Z_YDCPG_SL1_VF9_P => GET_HOST_DATA_RDONLY (YDCPG_SL1%VF9%F_P)
  Z_YDCPG_SL1_VR00_P => GET_HOST_DATA_RDWR (YDCPG_SL1%VR00%F_P)
  Z_YDCPG_SL1_VR0_P => GET_HOST_DATA_RDWR (YDCPG_SL1%VR0%F_P)
  Z_YDCPG_SL1_VR9_P => GET_HOST_DATA_RDWR (YDCPG_SL1%VR9%F_P)
  Z_YDCPG_SL1_WR00_P => GET_HOST_DATA_RDWR (YDCPG_SL1%WR00%F_P)
  Z_YDCPG_SL1_WR0_P => GET_HOST_DATA_RDWR (YDCPG_SL1%WR0%F_P)
  Z_YDCPG_SL1_WRA_P => GET_HOST_DATA_RDWR (YDCPG_SL1%WRA%F_P)
  Z_YDCPG_SL1_ZR00_P => GET_HOST_DATA_RDWR (YDCPG_SL1%ZR00%F_P)
  Z_YDCPG_SL1_ZR0_P => GET_HOST_DATA_RDWR (YDCPG_SL1%ZR0%F_P)
  Z_YDCPG_SL1_ZR9_P => GET_HOST_DATA_RDWR (YDCPG_SL1%ZR9%F_P)
  Z_YDCPG_SL2_URL => GET_HOST_DATA_RDWR (YDCPG_SL2%F_URL)
  Z_YDCPG_SL2_VRL => GET_HOST_DATA_RDWR (YDCPG_SL2%F_VRL)
  Z_YDCPG_SL2_WRL => GET_HOST_DATA_RDWR (YDCPG_SL2%F_WRL)
  Z_YDCPG_SL2_ZRL => GET_HOST_DATA_RDWR (YDCPG_SL2%F_ZRL)
  Z_YDCPG_TND_TNDU => GET_HOST_DATA_RDONLY (YDCPG_TND%F_TNDU)
  Z_YDCPG_TND_TNDV => GET_HOST_DATA_RDONLY (YDCPG_TND%F_TNDV)
  Z_YDVARS_EDOT_T9 => GET_HOST_DATA_RDWR (YDVARS%EDOT%FT9)
  Z_YDVARS_GEOMETRY_GECLO_P => GET_HOST_DATA_RDONLY (YDVARS%GEOMETRY%GECLO%FT0)
  Z_YDVARS_GEOMETRY_GEMU_P => GET_HOST_DATA_RDONLY (YDVARS%GEOMETRY%GEMU%FT0)
  Z_YDVARS_GEOMETRY_GESLO_P => GET_HOST_DATA_RDONLY (YDVARS%GEOMETRY%GESLO%FT0)
  Z_YDVARS_GEOMETRY_GSQM2_P => GET_HOST_DATA_RDONLY (YDVARS%GEOMETRY%GSQM2%FT0)
  Z_YDVARS_U_T0 => GET_HOST_DATA_RDONLY (YDVARS%U%FT0)
  Z_YDVARS_U_T9 => GET_HOST_DATA_RDONLY (YDVARS%U%FT9)
  Z_YDVARS_V_T0 => GET_HOST_DATA_RDONLY (YDVARS%V%FT0)
  Z_YDVARS_V_T9 => GET_HOST_DATA_RDONLY (YDVARS%V%FT9)
  IF (LHOOK) CALL DR_HOOK ('LAVENT_PARALLEL:0:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('LAVENT_PARALLEL:0:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  !$OMP PARALLEL DO PRIVATE (JBLK, JLEV, JROF, YLCPG_BNDS, YLSTACK, ZALPHA, ZZU, ZZV)

  DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX

    

    

    DO JROF = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JROF
      YLCPG_BNDS%KFDIA = JROF
      YLSTACK%L8 = fxtran_acdc_stack_l8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%U8 = fxtran_acdc_stack_u8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%L4 = fxtran_acdc_stack_l4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%U4 = fxtran_acdc_stack_u4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      
      PALPHA (JROF, 1:YDGEOMETRY%YRDIMV%NFLEVG, JBLK)=0._JPRB

      IF (YDGEOMETRY%YRVERT_GEOM%YRCVER%LVERTFE) THEN

        DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
          
          ZWRL0 (JROF, JLEV, JBLK)=PEVEL (JROF, JLEV, JBLK)*(YDGEOMETRY%YRVERT_GEOM%YRVETA%VETAH&
          & (JLEV)-YDGEOMETRY%YRVERT_GEOM%YRVETA%VETAH (JLEV-1))*PRDELP (JROF, JLEV, JBLK)
        
        ENDDO

      ELSE

        DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
          
          ZWRL0 (JROF, JLEV, JBLK)=0.5_JPRB*(PEVEL (JROF, JLEV, JBLK)+PEVEL (JROF&
          &, JLEV-1, JBLK))*(YDGEOMETRY%YRVERT_GEOM%YRVETA%VETAH (JLEV)-YDGEOMETRY&
          &%YRVERT_GEOM%YRVETA%VETAH (JLEV-1))*PRDELP (JROF, JLEV, JBLK)
        
        ENDDO

      ENDIF


      IF (YDML_DYN%YRDYNA%LTWOTL.AND.YDML_DYN%YRDYN%LSVTSM) THEN

        DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
          Z_YDCPG_SL1_WRA_P (JROF, JLEV, JBLK)=ZWRL0 (JROF, JLEV, JBLK)
        ENDDO

      ENDIF


      IF (YDML_DYN%YRDYNA%LTWOTL.AND.YDML_DYN%YRDYNA%LELTRA) THEN

        DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG

          

          IF (LLCOND) THEN
            ZZU=Z_YDCPG_SL1_UF9_P (JROF, JLEV, JBLK)
            ZZV=Z_YDCPG_SL1_VF9_P (JROF, JLEV, JBLK)
          ELSE
            ZZU=Z_YDCPG_SL1_U9_P (JROF, JLEV, JBLK)
            ZZV=Z_YDCPG_SL1_V9_P (JROF, JLEV, JBLK)
          ENDIF

          Z_YDCPG_SL1_UR0_P (JROF, JLEV, JBLK)=Z_YDVARS_U_T0 (JROF, JLEV, JBLK&
          &)+0.5_JPRB*ZZU+PDTS2*Z_YDCPG_TND_TNDU (JROF, JLEV, JBLK)
          Z_YDCPG_SL1_VR0_P (JROF, JLEV, JBLK)=Z_YDVARS_V_T0 (JROF, JLEV, JBLK&
          &)+0.5_JPRB*ZZV+PDTS2*Z_YDCPG_TND_TNDV (JROF, JLEV, JBLK)
        
        ENDDO


        DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
          Z_YDCPG_SL1_WR0_P (JROF, JLEV, JBLK)=ZWRL0 (JROF, JLEV, JBLK)
          Z_YDCPG_SL2_URL (JROF, JLEV, JBLK)=Z_YDCPG_SL1_UR0_P (JROF, JLEV, JBLK)
          Z_YDCPG_SL2_VRL (JROF, JLEV, JBLK)=Z_YDCPG_SL1_VR0_P (JROF, JLEV, JBLK)
          Z_YDCPG_SL2_WRL (JROF, JLEV, JBLK)=Z_YDCPG_SL1_WR0_P (JROF, JLEV, JBLK)
        ENDDO


        IF (LD2TLFF1) THEN

          DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
            Z_YDCPG_SL1_UR9_P (JROF, JLEV, JBLK)=Z_YDVARS_U_T0 (JROF, JLEV, JBLK)
            Z_YDCPG_SL1_VR9_P (JROF, JLEV, JBLK)=Z_YDVARS_V_T0 (JROF, JLEV, JBLK)
          ENDDO

        ENDIF

      ELSEIF (YDML_DYN%YRDYNA%LTWOTL.AND.(.NOT.YDML_DYN%YRDYNA%LELTRA)) THEN

        IF (.NOT.LLCT) THEN

          IF (YDCPG_OPTS%NSTEP<=YDRIP%NFOST.OR.LLNESCT) THEN

            DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
              Z_YDCPG_SL1_UR0_P (JROF, JLEV, JBLK)=Z_YDVARS_U_T0 (JROF, JLEV, JBLK)
              Z_YDCPG_SL1_VR0_P (JROF, JLEV, JBLK)=Z_YDVARS_V_T0 (JROF, JLEV, JBLK)
            ENDDO


            DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
              Z_YDCPG_SL2_URL (JROF, JLEV, JBLK)=Z_YDCPG_SL1_UR0_P (JROF, JLEV, JBLK)
              Z_YDCPG_SL2_VRL (JROF, JLEV, JBLK)=Z_YDCPG_SL1_VR0_P (JROF, JLEV, JBLK)
            ENDDO

          ELSEIF (LLSETTLST) THEN

            DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
              
              Z_YDCPG_SL1_UR0_P (JROF, JLEV, JBLK)=2.0_JPRB*Z_YDVARS_U_T0&
              & (JROF, JLEV, JBLK)-Z_YDVARS_U_T9 (JROF, JLEV, JBLK)
              Z_YDCPG_SL1_VR0_P (JROF, JLEV, JBLK)=2.0_JPRB*Z_YDVARS_V_T0&
              & (JROF, JLEV, JBLK)-Z_YDVARS_V_T9 (JROF, JLEV, JBLK)
            
            ENDDO


            DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
              Z_YDCPG_SL2_URL (JROF, JLEV, JBLK)=Z_YDVARS_U_T0 (JROF, JLEV, JBLK)
              Z_YDCPG_SL2_VRL (JROF, JLEV, JBLK)=Z_YDVARS_V_T0 (JROF, JLEV, JBLK)
            ENDDO

          ENDIF


          IF (YDCPG_OPTS%NSTEP<=YDRIP%NFOST.OR.LLNESCV) THEN

            DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
              Z_YDCPG_SL1_WR0_P (JROF, JLEV, JBLK)=ZWRL0 (JROF, JLEV, JBLK)
              Z_YDCPG_SL2_WRL (JROF, JLEV, JBLK)=Z_YDCPG_SL1_WR0_P (JROF, JLEV, JBLK)
            ENDDO


            IF (YDCPG_OPTS%NSTEP==0) THEN

              IF (YDML_DYN%YRDYN%LSETTLSVF.OR.LLWSAVE)  THEN
                PWRL9 (JROF, 1:YDGEOMETRY%YRDIMV%NFLEVG, JBLK)=0.0_JPRB
              ENDIF

            ELSEIF (LLWSAVE) THEN
              PWRL9 (JROF, 1:YDGEOMETRY%YRDIMV%NFLEVG, JBLK)=Z_YDVARS_EDOT_T9&
              & (JROF, 1:YDGEOMETRY%YRDIMV%NFLEVG, JBLK)
            ENDIF

          ELSEIF (LLSETTLSV) THEN

            IF (YDML_DYN%YRDYN%LSETTLSVF) THEN

              DO JLEV=1, YDML_DYN%YRDYN%NFLEVSF
                KSETTLOFF (JROF, JLEV, JBLK)=0
                
                ZALPHA=0.5_JPRB*(1._JPRB-TANH (-YDML_DYN%YRDYN%RSCALE*(ZWRL0 (JROF, JLEV,&
                & JBLK)*Z_YDVARS_EDOT_T9 (JROF, JLEV, JBLK)+YDML_DYN%YRDYN%RSCALEOFF)))
                Z_YDCPG_SL1_WR0_P (JROF, JLEV, JBLK)=ZWRL0 (JROF, JLEV, JBLK)+ZALPHA&
                &*(ZWRL0 (JROF, JLEV, JBLK)-Z_YDVARS_EDOT_T9 (JROF, JLEV, JBLK))

                IF (YDML_DYN%YRDYN%LSETTLSVF_DIFF)  THEN
                  PALPHA (JROF, JLEV, JBLK)=1._JPRB-ZALPHA
                ENDIF


                IF (YDML_DYN%YRDYN%LSETFSTAT)  THEN
                  KSETTLOFF (JROF, JLEV, JBLK)=KSETTLOFF (JROF, JLEV, JBLK)+NINT (1.0_JPRB-ZALPHA)
                ENDIF

              
              ENDDO


              DO JLEV=YDML_DYN%YRDYN%NFLEVSF+1, YDGEOMETRY%YRDIMV%NFLEVG
                
                Z_YDCPG_SL1_WR0_P (JROF, JLEV, JBLK)=2.0_JPRB*ZWRL0 (JROF&
                &, JLEV, JBLK)-Z_YDVARS_EDOT_T9 (JROF, JLEV, JBLK)
              
              ENDDO

              PWRL9 (JROF, 1:YDGEOMETRY%YRDIMV%NFLEVG, JBLK)=Z_YDVARS_EDOT_T9&
              & (JROF, 1:YDGEOMETRY%YRDIMV%NFLEVG, JBLK)
            ELSE

              DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
                
                Z_YDCPG_SL1_WR0_P (JROF, JLEV, JBLK)=2.0_JPRB*ZWRL0 (JROF&
                &, JLEV, JBLK)-Z_YDVARS_EDOT_T9 (JROF, JLEV, JBLK)
              
              ENDDO

            ENDIF


            DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
              Z_YDCPG_SL2_WRL (JROF, JLEV, JBLK)=ZWRL0 (JROF, JLEV, JBLK)
            ENDDO

          ENDIF

          Z_YDVARS_EDOT_T9 (JROF, 1:YDGEOMETRY%YRDIMV%NFLEVG, JBLK&
          &)=ZWRL0 (JROF, 1:YDGEOMETRY%YRDIMV%NFLEVG, JBLK)
        ELSE

          DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
            Z_YDCPG_SL1_UR0_P (JROF, JLEV, JBLK)=Z_YDVARS_U_T9 (JROF, JLEV, JBLK)
            Z_YDCPG_SL1_VR0_P (JROF, JLEV, JBLK)=Z_YDVARS_V_T9 (JROF, JLEV, JBLK)
          ENDDO


          DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
            Z_YDCPG_SL1_WR0_P (JROF, JLEV, JBLK)=Z_YDVARS_EDOT_T9 (JROF, JLEV, JBLK)
          ENDDO


          DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
            Z_YDCPG_SL2_URL (JROF, JLEV, JBLK)=Z_YDVARS_U_T0 (JROF, JLEV, JBLK)
            Z_YDCPG_SL2_VRL (JROF, JLEV, JBLK)=Z_YDVARS_V_T0 (JROF, JLEV, JBLK)
          ENDDO


          DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
            Z_YDCPG_SL2_WRL (JROF, JLEV, JBLK)=ZWRL0 (JROF, JLEV, JBLK)
          ENDDO

        ENDIF


        IF (LD2TLFF1) THEN

          DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
            Z_YDCPG_SL1_UR9_P (JROF, JLEV, JBLK)=Z_YDVARS_U_T0 (JROF, JLEV, JBLK)
            Z_YDCPG_SL1_VR9_P (JROF, JLEV, JBLK)=Z_YDVARS_V_T0 (JROF, JLEV, JBLK)
          ENDDO

        ENDIF

      ELSE

        DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
          Z_YDCPG_SL1_UR0_P (JROF, JLEV, JBLK)=Z_YDVARS_U_T0 (JROF, JLEV, JBLK)
          Z_YDCPG_SL1_VR0_P (JROF, JLEV, JBLK)=Z_YDVARS_V_T0 (JROF, JLEV, JBLK)
        ENDDO


        DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
          Z_YDCPG_SL1_WR0_P (JROF, JLEV, JBLK)=ZWRL0 (JROF, JLEV, JBLK)
          Z_YDCPG_SL2_URL (JROF, JLEV, JBLK)=Z_YDCPG_SL1_UR0_P (JROF, JLEV, JBLK)
          Z_YDCPG_SL2_VRL (JROF, JLEV, JBLK)=Z_YDCPG_SL1_VR0_P (JROF, JLEV, JBLK)
          Z_YDCPG_SL2_WRL (JROF, JLEV, JBLK)=Z_YDCPG_SL1_WR0_P (JROF, JLEV, JBLK)
        ENDDO


        IF (LD2TLFF1) THEN

          DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
            Z_YDCPG_SL1_UR9_P (JROF, JLEV, JBLK)=Z_YDVARS_U_T9 (JROF, JLEV, JBLK)
            Z_YDCPG_SL1_VR9_P (JROF, JLEV, JBLK)=Z_YDVARS_V_T9 (JROF, JLEV, JBLK)
          ENDDO

        ENDIF

      ENDIF


      IF (YDCPG_OPTS%LAROME.AND.YDPARAR%LSQUALL) THEN

        DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
          
          Z_YDCPG_SL1_VR0_P (JROF, JLEV, JBLK)=Z_YDCPG_SL1_VR0_P (JROF, JLEV, JBLK)+YDPARAR%VSQUALL
          Z_YDCPG_SL2_VRL (JROF, JLEV, JBLK)=Z_YDCPG_SL2_VRL (JROF, JLEV, JBLK)+YDPARAR%VSQUALL
        
        ENDDO

      ENDIF


      IF (YDML_DYN%YRDYN%LSLDP_RK) THEN

        DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
          Z_YDCPG_SL1_UR00_P (JROF, JLEV, JBLK)=Z_YDCPG_SL2_URL (JROF, JLEV, JBLK)
          Z_YDCPG_SL1_VR00_P (JROF, JLEV, JBLK)=Z_YDCPG_SL2_VRL (JROF, JLEV, JBLK)
          Z_YDCPG_SL1_WR00_P (JROF, JLEV, JBLK)=Z_YDCPG_SL2_WRL (JROF, JLEV, JBLK)
        ENDDO

      ENDIF


      IF (YDML_DYN%YRDYN%LSLDP_CURV.OR.YDML_DYN%YRDYN%LSLDP_XYZ) THEN
        CALL LOCAL2CARTGEOV_OPENACC (0, YDGEOMETRY%YRDIMV%NFLEVG, YDGEOMETRY%YRDIM%NPROMA, YLCPG_BNDS&
        &%KIDIA, YLCPG_BNDS%KFDIA, Z_YDVARS_GEOMETRY_GEMU_P(:, JBLK), Z_YDVARS_GEOMETRY_GSQM2_P(:, JBLK&
        &), Z_YDVARS_GEOMETRY_GECLO_P(:, JBLK), Z_YDVARS_GEOMETRY_GESLO_P(:, JBLK), Z_YDCPG_SL1_UR0_P&
        &(:,:, JBLK), Z_YDCPG_SL1_VR0_P(:,:, JBLK), Z_YDCPG_SL1_ZR0_P(:,:, JBLK),YDSTACK=YLSTACK)

        IF (YDML_DYN%YRDYN%LSLDP_XYZ) THEN
          CALL LOCAL2CARTGEOV_OPENACC (1, YDGEOMETRY%YRDIMV%NFLEVG, YDGEOMETRY%YRDIM%NPROMA, YLCPG_BNDS&
          &%KIDIA, YLCPG_BNDS%KFDIA, Z_YDVARS_GEOMETRY_GEMU_P(:, JBLK), Z_YDVARS_GEOMETRY_GSQM2_P(:, JBLK&
          &), Z_YDVARS_GEOMETRY_GECLO_P(:, JBLK), Z_YDVARS_GEOMETRY_GESLO_P(:, JBLK), Z_YDCPG_SL2_URL(&
          &:,:, JBLK), Z_YDCPG_SL2_VRL(:,:, JBLK), Z_YDCPG_SL2_ZRL(:,:, JBLK),YDSTACK=YLSTACK)
        ENDIF


        IF (YDML_DYN%YRDYN%LSLDP_RK) THEN
          CALL LOCAL2CARTGEOV_OPENACC (0, YDGEOMETRY%YRDIMV%NFLEVG, YDGEOMETRY%YRDIM%NPROMA, YLCPG_BNDS%KIDIA&
          &, YLCPG_BNDS%KFDIA, Z_YDVARS_GEOMETRY_GEMU_P(:, JBLK), Z_YDVARS_GEOMETRY_GSQM2_P(:, JBLK), Z_YDVARS_GEOMETRY_GECLO_P&
          &(:, JBLK), Z_YDVARS_GEOMETRY_GESLO_P(:, JBLK), Z_YDCPG_SL1_UR00_P(:,:, JBLK), Z_YDCPG_SL1_VR00_P&
          &(:,:, JBLK), Z_YDCPG_SL1_ZR00_P(:,:, JBLK),YDSTACK=YLSTACK)
        ENDIF

      ENDIF


      IF (YDML_DYN%YRDYN%LRHS_CURV.AND.LD2TLFF1) THEN
        CALL LOCAL2CARTGEOV_OPENACC (0, YDGEOMETRY%YRDIMV%NFLEVG, YDGEOMETRY%YRDIM%NPROMA, YLCPG_BNDS&
        &%KIDIA, YLCPG_BNDS%KFDIA, Z_YDVARS_GEOMETRY_GEMU_P(:, JBLK), Z_YDVARS_GEOMETRY_GSQM2_P(:, JBLK&
        &), Z_YDVARS_GEOMETRY_GECLO_P(:, JBLK), Z_YDVARS_GEOMETRY_GESLO_P(:, JBLK), Z_YDCPG_SL1_UR9_P&
        &(:,:, JBLK), Z_YDCPG_SL1_VR9_P(:,:, JBLK), Z_YDCPG_SL1_ZR9_P(:,:, JBLK),YDSTACK=YLSTACK)
      ENDIF

    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('LAVENT_PARALLEL:0:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

  IF (FXTRAN_ACDC_LSYNCHOST ('LAVENT_PARALLEL:0')) THEN
    IF (LHOOK) CALL DR_HOOK ('LAVENT_PARALLEL:0:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
    KSETTLOFF => GET_HOST_DATA_RDWR (YD_KSETTLOFF)
    PALPHA => GET_HOST_DATA_RDWR (YD_PALPHA)
    PEVEL => GET_HOST_DATA_RDWR (YD_PEVEL)
    PRDELP => GET_HOST_DATA_RDWR (YD_PRDELP)
    PWRL9 => GET_HOST_DATA_RDWR (YD_PWRL9)
    ZWRL0 => GET_HOST_DATA_RDWR (YL_ZWRL0)
    Z_YDCPG_SL1_U9_P => GET_HOST_DATA_RDWR (YDCPG_SL1%U9%F_P)
    Z_YDCPG_SL1_UF9_P => GET_HOST_DATA_RDWR (YDCPG_SL1%UF9%F_P)
    Z_YDCPG_SL1_UR00_P => GET_HOST_DATA_RDWR (YDCPG_SL1%UR00%F_P)
    Z_YDCPG_SL1_UR0_P => GET_HOST_DATA_RDWR (YDCPG_SL1%UR0%F_P)
    Z_YDCPG_SL1_UR9_P => GET_HOST_DATA_RDWR (YDCPG_SL1%UR9%F_P)
    Z_YDCPG_SL1_V9_P => GET_HOST_DATA_RDWR (YDCPG_SL1%V9%F_P)
    Z_YDCPG_SL1_VF9_P => GET_HOST_DATA_RDWR (YDCPG_SL1%VF9%F_P)
    Z_YDCPG_SL1_VR00_P => GET_HOST_DATA_RDWR (YDCPG_SL1%VR00%F_P)
    Z_YDCPG_SL1_VR0_P => GET_HOST_DATA_RDWR (YDCPG_SL1%VR0%F_P)
    Z_YDCPG_SL1_VR9_P => GET_HOST_DATA_RDWR (YDCPG_SL1%VR9%F_P)
    Z_YDCPG_SL1_WR00_P => GET_HOST_DATA_RDWR (YDCPG_SL1%WR00%F_P)
    Z_YDCPG_SL1_WR0_P => GET_HOST_DATA_RDWR (YDCPG_SL1%WR0%F_P)
    Z_YDCPG_SL1_WRA_P => GET_HOST_DATA_RDWR (YDCPG_SL1%WRA%F_P)
    Z_YDCPG_SL1_ZR00_P => GET_HOST_DATA_RDWR (YDCPG_SL1%ZR00%F_P)
    Z_YDCPG_SL1_ZR0_P => GET_HOST_DATA_RDWR (YDCPG_SL1%ZR0%F_P)
    Z_YDCPG_SL1_ZR9_P => GET_HOST_DATA_RDWR (YDCPG_SL1%ZR9%F_P)
    Z_YDCPG_SL2_URL => GET_HOST_DATA_RDWR (YDCPG_SL2%F_URL)
    Z_YDCPG_SL2_VRL => GET_HOST_DATA_RDWR (YDCPG_SL2%F_VRL)
    Z_YDCPG_SL2_WRL => GET_HOST_DATA_RDWR (YDCPG_SL2%F_WRL)
    Z_YDCPG_SL2_ZRL => GET_HOST_DATA_RDWR (YDCPG_SL2%F_ZRL)
    Z_YDCPG_TND_TNDU => GET_HOST_DATA_RDWR (YDCPG_TND%F_TNDU)
    Z_YDCPG_TND_TNDV => GET_HOST_DATA_RDWR (YDCPG_TND%F_TNDV)
    Z_YDVARS_EDOT_T9 => GET_HOST_DATA_RDWR (YDVARS%EDOT%FT9)
    Z_YDVARS_GEOMETRY_GECLO_P => GET_HOST_DATA_RDWR (YDVARS%GEOMETRY%GECLO%FT0)
    Z_YDVARS_GEOMETRY_GEMU_P => GET_HOST_DATA_RDWR (YDVARS%GEOMETRY%GEMU%FT0)
    Z_YDVARS_GEOMETRY_GESLO_P => GET_HOST_DATA_RDWR (YDVARS%GEOMETRY%GESLO%FT0)
    Z_YDVARS_GEOMETRY_GSQM2_P => GET_HOST_DATA_RDWR (YDVARS%GEOMETRY%GSQM2%FT0)
    Z_YDVARS_U_T0 => GET_HOST_DATA_RDWR (YDVARS%U%FT0)
    Z_YDVARS_U_T9 => GET_HOST_DATA_RDWR (YDVARS%U%FT9)
    Z_YDVARS_V_T0 => GET_HOST_DATA_RDWR (YDVARS%V%FT0)
    Z_YDVARS_V_T9 => GET_HOST_DATA_RDWR (YDVARS%V%FT9)
    IF (LHOOK) CALL DR_HOOK ('LAVENT_PARALLEL:0:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('LAVENT_PARALLEL:0:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  KSETTLOFF => NULL ()
  PALPHA => NULL ()
  PEVEL => NULL ()
  PRDELP => NULL ()
  PWRL9 => NULL ()
  ZWRL0 => NULL ()
  Z_YDCPG_SL1_U9_P => NULL ()
  Z_YDCPG_SL1_UF9_P => NULL ()
  Z_YDCPG_SL1_UR00_P => NULL ()
  Z_YDCPG_SL1_UR0_P => NULL ()
  Z_YDCPG_SL1_UR9_P => NULL ()
  Z_YDCPG_SL1_V9_P => NULL ()
  Z_YDCPG_SL1_VF9_P => NULL ()
  Z_YDCPG_SL1_VR00_P => NULL ()
  Z_YDCPG_SL1_VR0_P => NULL ()
  Z_YDCPG_SL1_VR9_P => NULL ()
  Z_YDCPG_SL1_WR00_P => NULL ()
  Z_YDCPG_SL1_WR0_P => NULL ()
  Z_YDCPG_SL1_WRA_P => NULL ()
  Z_YDCPG_SL1_ZR00_P => NULL ()
  Z_YDCPG_SL1_ZR0_P => NULL ()
  Z_YDCPG_SL1_ZR9_P => NULL ()
  Z_YDCPG_SL2_URL => NULL ()
  Z_YDCPG_SL2_VRL => NULL ()
  Z_YDCPG_SL2_WRL => NULL ()
  Z_YDCPG_SL2_ZRL => NULL ()
  Z_YDCPG_TND_TNDU => NULL ()
  Z_YDCPG_TND_TNDV => NULL ()
  Z_YDVARS_EDOT_T9 => NULL ()
  Z_YDVARS_GEOMETRY_GECLO_P => NULL ()
  Z_YDVARS_GEOMETRY_GEMU_P => NULL ()
  Z_YDVARS_GEOMETRY_GESLO_P => NULL ()
  Z_YDVARS_GEOMETRY_GSQM2_P => NULL ()
  Z_YDVARS_U_T0 => NULL ()
  Z_YDVARS_U_T9 => NULL ()
  Z_YDVARS_V_T0 => NULL ()
  Z_YDVARS_V_T9 => NULL ()
  IF (LHOOK) CALL DR_HOOK ('LAVENT_PARALLEL:0:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSEIF (FXTRAN_ACDC_LPARALLELMETHOD ('OPENACCSINGLECOLUMN','LAVENT_PARALLEL:0')) THEN
  
  IF (LHOOK) CALL DR_HOOK ('LAVENT_PARALLEL:0:GET_DATA',0,ZHOOK_HANDLE_FIELD_API)
  KSETTLOFF => GET_DEVICE_DATA_RDWR (YD_KSETTLOFF)
  PALPHA => GET_DEVICE_DATA_RDWR (YD_PALPHA)
  PEVEL => GET_DEVICE_DATA_RDONLY (YD_PEVEL)
  PRDELP => GET_DEVICE_DATA_RDONLY (YD_PRDELP)
  PWRL9 => GET_DEVICE_DATA_RDWR (YD_PWRL9)
  ZWRL0 => GET_DEVICE_DATA_RDWR (YL_ZWRL0)
  Z_YDCPG_SL1_U9_P => GET_DEVICE_DATA_RDONLY (YDCPG_SL1%U9%F_P)
  Z_YDCPG_SL1_UF9_P => GET_DEVICE_DATA_RDONLY (YDCPG_SL1%UF9%F_P)
  Z_YDCPG_SL1_UR00_P => GET_DEVICE_DATA_RDWR (YDCPG_SL1%UR00%F_P)
  Z_YDCPG_SL1_UR0_P => GET_DEVICE_DATA_RDWR (YDCPG_SL1%UR0%F_P)
  Z_YDCPG_SL1_UR9_P => GET_DEVICE_DATA_RDWR (YDCPG_SL1%UR9%F_P)
  Z_YDCPG_SL1_V9_P => GET_DEVICE_DATA_RDONLY (YDCPG_SL1%V9%F_P)
  Z_YDCPG_SL1_VF9_P => GET_DEVICE_DATA_RDONLY (YDCPG_SL1%VF9%F_P)
  Z_YDCPG_SL1_VR00_P => GET_DEVICE_DATA_RDWR (YDCPG_SL1%VR00%F_P)
  Z_YDCPG_SL1_VR0_P => GET_DEVICE_DATA_RDWR (YDCPG_SL1%VR0%F_P)
  Z_YDCPG_SL1_VR9_P => GET_DEVICE_DATA_RDWR (YDCPG_SL1%VR9%F_P)
  Z_YDCPG_SL1_WR00_P => GET_DEVICE_DATA_RDWR (YDCPG_SL1%WR00%F_P)
  Z_YDCPG_SL1_WR0_P => GET_DEVICE_DATA_RDWR (YDCPG_SL1%WR0%F_P)
  Z_YDCPG_SL1_WRA_P => GET_DEVICE_DATA_RDWR (YDCPG_SL1%WRA%F_P)
  Z_YDCPG_SL1_ZR00_P => GET_DEVICE_DATA_RDWR (YDCPG_SL1%ZR00%F_P)
  Z_YDCPG_SL1_ZR0_P => GET_DEVICE_DATA_RDWR (YDCPG_SL1%ZR0%F_P)
  Z_YDCPG_SL1_ZR9_P => GET_DEVICE_DATA_RDWR (YDCPG_SL1%ZR9%F_P)
  Z_YDCPG_SL2_URL => GET_DEVICE_DATA_RDWR (YDCPG_SL2%F_URL)
  Z_YDCPG_SL2_VRL => GET_DEVICE_DATA_RDWR (YDCPG_SL2%F_VRL)
  Z_YDCPG_SL2_WRL => GET_DEVICE_DATA_RDWR (YDCPG_SL2%F_WRL)
  Z_YDCPG_SL2_ZRL => GET_DEVICE_DATA_RDWR (YDCPG_SL2%F_ZRL)
  Z_YDCPG_TND_TNDU => GET_DEVICE_DATA_RDONLY (YDCPG_TND%F_TNDU)
  Z_YDCPG_TND_TNDV => GET_DEVICE_DATA_RDONLY (YDCPG_TND%F_TNDV)
  Z_YDVARS_EDOT_T9 => GET_DEVICE_DATA_RDWR (YDVARS%EDOT%FT9)
  Z_YDVARS_GEOMETRY_GECLO_P => GET_DEVICE_DATA_RDONLY (YDVARS%GEOMETRY%GECLO%FT0)
  Z_YDVARS_GEOMETRY_GEMU_P => GET_DEVICE_DATA_RDONLY (YDVARS%GEOMETRY%GEMU%FT0)
  Z_YDVARS_GEOMETRY_GESLO_P => GET_DEVICE_DATA_RDONLY (YDVARS%GEOMETRY%GESLO%FT0)
  Z_YDVARS_GEOMETRY_GSQM2_P => GET_DEVICE_DATA_RDONLY (YDVARS%GEOMETRY%GSQM2%FT0)
  Z_YDVARS_U_T0 => GET_DEVICE_DATA_RDONLY (YDVARS%U%FT0)
  Z_YDVARS_U_T9 => GET_DEVICE_DATA_RDONLY (YDVARS%U%FT9)
  Z_YDVARS_V_T0 => GET_DEVICE_DATA_RDONLY (YDVARS%V%FT0)
  Z_YDVARS_V_T9 => GET_DEVICE_DATA_RDONLY (YDVARS%V%FT9)
  IF (LHOOK) CALL DR_HOOK ('LAVENT_PARALLEL:0:GET_DATA',1,ZHOOK_HANDLE_FIELD_API)
  IF (LHOOK) CALL DR_HOOK ('LAVENT_PARALLEL:0:COMPUTE',0,ZHOOK_HANDLE_COMPUTE)
  
  
    !$ACC PARALLEL LOOP GANG &
    !$ACC&PRESENT (KSETTLOFF, PALPHA, PEVEL, PRDELP, PWRL9, YDCPG_OPTS, YDGEOMETRY, &
    !$ACC&         YDML_DYN, YDPARAR, YDRIP, YFXTRAN_ACDC_STACK, ZWRL0, Z_YDCPG_SL1_U9_P, &
    !$ACC&         Z_YDCPG_SL1_UF9_P, Z_YDCPG_SL1_UR00_P, Z_YDCPG_SL1_UR0_P, &
    !$ACC&         Z_YDCPG_SL1_UR9_P, Z_YDCPG_SL1_V9_P, Z_YDCPG_SL1_VF9_P, Z_YDCPG_SL1_VR00_P, &
    !$ACC&         Z_YDCPG_SL1_VR0_P, Z_YDCPG_SL1_VR9_P, Z_YDCPG_SL1_WR00_P, &
    !$ACC&         Z_YDCPG_SL1_WR0_P, Z_YDCPG_SL1_WRA_P, Z_YDCPG_SL1_ZR00_P, &
    !$ACC&         Z_YDCPG_SL1_ZR0_P, Z_YDCPG_SL1_ZR9_P, Z_YDCPG_SL2_URL, Z_YDCPG_SL2_VRL, &
    !$ACC&         Z_YDCPG_SL2_WRL, Z_YDCPG_SL2_ZRL, Z_YDCPG_TND_TNDU, Z_YDCPG_TND_TNDV, &
    !$ACC&         Z_YDVARS_EDOT_T9, Z_YDVARS_GEOMETRY_GECLO_P, Z_YDVARS_GEOMETRY_GEMU_P, &
    !$ACC&         Z_YDVARS_GEOMETRY_GESLO_P, Z_YDVARS_GEOMETRY_GSQM2_P, Z_YDVARS_U_T0, &
    !$ACC&         Z_YDVARS_U_T9, Z_YDVARS_V_T0, Z_YDVARS_V_T9) &
    !$ACC&PRIVATE (JBLK) &
    !$ACC&VECTOR_LENGTH (YDCPG_OPTS%KLON) 
    
    DO JBLK = YDCPG_OPTS%JBLKMIN, YDCPG_OPTS%JBLKMAX
    
    
    
    !$ACC LOOP VECTOR &
    !$ACC&PRIVATE (JLEV, JROF, YLCPG_BNDS, YLSTACK, ZALPHA, ZZU, ZZV) 

    

    DO JROF = 1, MIN (YDCPG_OPTS%KLON, YDCPG_OPTS%KGPCOMP - (JBLK - 1) * YDCPG_OPTS%KLON)
      YLCPG_BNDS%KIDIA = JROF
      YLCPG_BNDS%KFDIA = JROF
      YLSTACK%L8 = fxtran_acdc_stack_l8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%U8 = fxtran_acdc_stack_u8 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%L4 = fxtran_acdc_stack_l4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      YLSTACK%U4 = fxtran_acdc_stack_u4 (YFXTRAN_ACDC_STACK, (JBLK-YDCPG_OPTS%JBLKMIN)+1, YDCPG_OPTS%KGPBLKS)
      
      PALPHA (JROF, 1:YDGEOMETRY%YRDIMV%NFLEVG, JBLK)=0._JPRB

      IF (YDGEOMETRY%YRVERT_GEOM%YRCVER%LVERTFE) THEN

        DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
          
          ZWRL0 (JROF, JLEV, JBLK)=PEVEL (JROF, JLEV, JBLK)*(YDGEOMETRY%YRVERT_GEOM%YRVETA%VETAH&
          & (JLEV)-YDGEOMETRY%YRVERT_GEOM%YRVETA%VETAH (JLEV-1))*PRDELP (JROF, JLEV, JBLK)
        
        ENDDO

      ELSE

        DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
          
          ZWRL0 (JROF, JLEV, JBLK)=0.5_JPRB*(PEVEL (JROF, JLEV, JBLK)+PEVEL (JROF&
          &, JLEV-1, JBLK))*(YDGEOMETRY%YRVERT_GEOM%YRVETA%VETAH (JLEV)-YDGEOMETRY&
          &%YRVERT_GEOM%YRVETA%VETAH (JLEV-1))*PRDELP (JROF, JLEV, JBLK)
        
        ENDDO

      ENDIF


      IF (YDML_DYN%YRDYNA%LTWOTL.AND.YDML_DYN%YRDYN%LSVTSM) THEN

        DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
          Z_YDCPG_SL1_WRA_P (JROF, JLEV, JBLK)=ZWRL0 (JROF, JLEV, JBLK)
        ENDDO

      ENDIF


      IF (YDML_DYN%YRDYNA%LTWOTL.AND.YDML_DYN%YRDYNA%LELTRA) THEN

        DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG

          

          IF (LLCOND) THEN
            ZZU=Z_YDCPG_SL1_UF9_P (JROF, JLEV, JBLK)
            ZZV=Z_YDCPG_SL1_VF9_P (JROF, JLEV, JBLK)
          ELSE
            ZZU=Z_YDCPG_SL1_U9_P (JROF, JLEV, JBLK)
            ZZV=Z_YDCPG_SL1_V9_P (JROF, JLEV, JBLK)
          ENDIF

          Z_YDCPG_SL1_UR0_P (JROF, JLEV, JBLK)=Z_YDVARS_U_T0 (JROF, JLEV, JBLK&
          &)+0.5_JPRB*ZZU+PDTS2*Z_YDCPG_TND_TNDU (JROF, JLEV, JBLK)
          Z_YDCPG_SL1_VR0_P (JROF, JLEV, JBLK)=Z_YDVARS_V_T0 (JROF, JLEV, JBLK&
          &)+0.5_JPRB*ZZV+PDTS2*Z_YDCPG_TND_TNDV (JROF, JLEV, JBLK)
        
        ENDDO


        DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
          Z_YDCPG_SL1_WR0_P (JROF, JLEV, JBLK)=ZWRL0 (JROF, JLEV, JBLK)
          Z_YDCPG_SL2_URL (JROF, JLEV, JBLK)=Z_YDCPG_SL1_UR0_P (JROF, JLEV, JBLK)
          Z_YDCPG_SL2_VRL (JROF, JLEV, JBLK)=Z_YDCPG_SL1_VR0_P (JROF, JLEV, JBLK)
          Z_YDCPG_SL2_WRL (JROF, JLEV, JBLK)=Z_YDCPG_SL1_WR0_P (JROF, JLEV, JBLK)
        ENDDO


        IF (LD2TLFF1) THEN

          DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
            Z_YDCPG_SL1_UR9_P (JROF, JLEV, JBLK)=Z_YDVARS_U_T0 (JROF, JLEV, JBLK)
            Z_YDCPG_SL1_VR9_P (JROF, JLEV, JBLK)=Z_YDVARS_V_T0 (JROF, JLEV, JBLK)
          ENDDO

        ENDIF

      ELSEIF (YDML_DYN%YRDYNA%LTWOTL.AND.(.NOT.YDML_DYN%YRDYNA%LELTRA)) THEN

        IF (.NOT.LLCT) THEN

          IF (YDCPG_OPTS%NSTEP<=YDRIP%NFOST.OR.LLNESCT) THEN

            DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
              Z_YDCPG_SL1_UR0_P (JROF, JLEV, JBLK)=Z_YDVARS_U_T0 (JROF, JLEV, JBLK)
              Z_YDCPG_SL1_VR0_P (JROF, JLEV, JBLK)=Z_YDVARS_V_T0 (JROF, JLEV, JBLK)
            ENDDO


            DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
              Z_YDCPG_SL2_URL (JROF, JLEV, JBLK)=Z_YDCPG_SL1_UR0_P (JROF, JLEV, JBLK)
              Z_YDCPG_SL2_VRL (JROF, JLEV, JBLK)=Z_YDCPG_SL1_VR0_P (JROF, JLEV, JBLK)
            ENDDO

          ELSEIF (LLSETTLST) THEN

            DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
              
              Z_YDCPG_SL1_UR0_P (JROF, JLEV, JBLK)=2.0_JPRB*Z_YDVARS_U_T0&
              & (JROF, JLEV, JBLK)-Z_YDVARS_U_T9 (JROF, JLEV, JBLK)
              Z_YDCPG_SL1_VR0_P (JROF, JLEV, JBLK)=2.0_JPRB*Z_YDVARS_V_T0&
              & (JROF, JLEV, JBLK)-Z_YDVARS_V_T9 (JROF, JLEV, JBLK)
            
            ENDDO


            DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
              Z_YDCPG_SL2_URL (JROF, JLEV, JBLK)=Z_YDVARS_U_T0 (JROF, JLEV, JBLK)
              Z_YDCPG_SL2_VRL (JROF, JLEV, JBLK)=Z_YDVARS_V_T0 (JROF, JLEV, JBLK)
            ENDDO

          ENDIF


          IF (YDCPG_OPTS%NSTEP<=YDRIP%NFOST.OR.LLNESCV) THEN

            DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
              Z_YDCPG_SL1_WR0_P (JROF, JLEV, JBLK)=ZWRL0 (JROF, JLEV, JBLK)
              Z_YDCPG_SL2_WRL (JROF, JLEV, JBLK)=Z_YDCPG_SL1_WR0_P (JROF, JLEV, JBLK)
            ENDDO


            IF (YDCPG_OPTS%NSTEP==0) THEN

              IF (YDML_DYN%YRDYN%LSETTLSVF.OR.LLWSAVE)  THEN
                PWRL9 (JROF, 1:YDGEOMETRY%YRDIMV%NFLEVG, JBLK)=0.0_JPRB
              ENDIF

            ELSEIF (LLWSAVE) THEN
              CALL FXTRAN_ACDC_ARRAY_COPY (JROF, PWRL9 (:, 1:YDGEOMETRY%YRDIMV%NFLEVG&
              &, JBLK), Z_YDVARS_EDOT_T9 (:, 1:YDGEOMETRY%YRDIMV%NFLEVG, JBLK))
            ENDIF

          ELSEIF (LLSETTLSV) THEN

            IF (YDML_DYN%YRDYN%LSETTLSVF) THEN

              DO JLEV=1, YDML_DYN%YRDYN%NFLEVSF
                KSETTLOFF (JROF, JLEV, JBLK)=0
                
                ZALPHA=0.5_JPRB*(1._JPRB-TANH (-YDML_DYN%YRDYN%RSCALE*(ZWRL0 (JROF, JLEV,&
                & JBLK)*Z_YDVARS_EDOT_T9 (JROF, JLEV, JBLK)+YDML_DYN%YRDYN%RSCALEOFF)))
                Z_YDCPG_SL1_WR0_P (JROF, JLEV, JBLK)=ZWRL0 (JROF, JLEV, JBLK)+ZALPHA&
                &*(ZWRL0 (JROF, JLEV, JBLK)-Z_YDVARS_EDOT_T9 (JROF, JLEV, JBLK))

                IF (YDML_DYN%YRDYN%LSETTLSVF_DIFF)  THEN
                  PALPHA (JROF, JLEV, JBLK)=1._JPRB-ZALPHA
                ENDIF


                IF (YDML_DYN%YRDYN%LSETFSTAT)  THEN
                  KSETTLOFF (JROF, JLEV, JBLK)=KSETTLOFF (JROF, JLEV, JBLK)+NINT (1.0_JPRB-ZALPHA)
                ENDIF

              
              ENDDO


              DO JLEV=YDML_DYN%YRDYN%NFLEVSF+1, YDGEOMETRY%YRDIMV%NFLEVG
                
                Z_YDCPG_SL1_WR0_P (JROF, JLEV, JBLK)=2.0_JPRB*ZWRL0 (JROF&
                &, JLEV, JBLK)-Z_YDVARS_EDOT_T9 (JROF, JLEV, JBLK)
              
              ENDDO

              CALL FXTRAN_ACDC_ARRAY_COPY (JROF, PWRL9 (:, 1:YDGEOMETRY%YRDIMV%NFLEVG&
              &, JBLK), Z_YDVARS_EDOT_T9 (:, 1:YDGEOMETRY%YRDIMV%NFLEVG, JBLK))
            ELSE

              DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
                
                Z_YDCPG_SL1_WR0_P (JROF, JLEV, JBLK)=2.0_JPRB*ZWRL0 (JROF&
                &, JLEV, JBLK)-Z_YDVARS_EDOT_T9 (JROF, JLEV, JBLK)
              
              ENDDO

            ENDIF


            DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
              Z_YDCPG_SL2_WRL (JROF, JLEV, JBLK)=ZWRL0 (JROF, JLEV, JBLK)
            ENDDO

          ENDIF

          CALL FXTRAN_ACDC_ARRAY_COPY (JROF, Z_YDVARS_EDOT_T9 (:, 1:YDGEOMETRY%YRDIMV&
          &%NFLEVG, JBLK), ZWRL0 (:, 1:YDGEOMETRY%YRDIMV%NFLEVG, JBLK))
        ELSE

          DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
            Z_YDCPG_SL1_UR0_P (JROF, JLEV, JBLK)=Z_YDVARS_U_T9 (JROF, JLEV, JBLK)
            Z_YDCPG_SL1_VR0_P (JROF, JLEV, JBLK)=Z_YDVARS_V_T9 (JROF, JLEV, JBLK)
          ENDDO


          DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
            Z_YDCPG_SL1_WR0_P (JROF, JLEV, JBLK)=Z_YDVARS_EDOT_T9 (JROF, JLEV, JBLK)
          ENDDO


          DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
            Z_YDCPG_SL2_URL (JROF, JLEV, JBLK)=Z_YDVARS_U_T0 (JROF, JLEV, JBLK)
            Z_YDCPG_SL2_VRL (JROF, JLEV, JBLK)=Z_YDVARS_V_T0 (JROF, JLEV, JBLK)
          ENDDO


          DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
            Z_YDCPG_SL2_WRL (JROF, JLEV, JBLK)=ZWRL0 (JROF, JLEV, JBLK)
          ENDDO

        ENDIF


        IF (LD2TLFF1) THEN

          DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
            Z_YDCPG_SL1_UR9_P (JROF, JLEV, JBLK)=Z_YDVARS_U_T0 (JROF, JLEV, JBLK)
            Z_YDCPG_SL1_VR9_P (JROF, JLEV, JBLK)=Z_YDVARS_V_T0 (JROF, JLEV, JBLK)
          ENDDO

        ENDIF

      ELSE

        DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
          Z_YDCPG_SL1_UR0_P (JROF, JLEV, JBLK)=Z_YDVARS_U_T0 (JROF, JLEV, JBLK)
          Z_YDCPG_SL1_VR0_P (JROF, JLEV, JBLK)=Z_YDVARS_V_T0 (JROF, JLEV, JBLK)
        ENDDO


        DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
          Z_YDCPG_SL1_WR0_P (JROF, JLEV, JBLK)=ZWRL0 (JROF, JLEV, JBLK)
          Z_YDCPG_SL2_URL (JROF, JLEV, JBLK)=Z_YDCPG_SL1_UR0_P (JROF, JLEV, JBLK)
          Z_YDCPG_SL2_VRL (JROF, JLEV, JBLK)=Z_YDCPG_SL1_VR0_P (JROF, JLEV, JBLK)
          Z_YDCPG_SL2_WRL (JROF, JLEV, JBLK)=Z_YDCPG_SL1_WR0_P (JROF, JLEV, JBLK)
        ENDDO


        IF (LD2TLFF1) THEN

          DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
            Z_YDCPG_SL1_UR9_P (JROF, JLEV, JBLK)=Z_YDVARS_U_T9 (JROF, JLEV, JBLK)
            Z_YDCPG_SL1_VR9_P (JROF, JLEV, JBLK)=Z_YDVARS_V_T9 (JROF, JLEV, JBLK)
          ENDDO

        ENDIF

      ENDIF


      IF (YDCPG_OPTS%LAROME.AND.YDPARAR%LSQUALL) THEN

        DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
          
          Z_YDCPG_SL1_VR0_P (JROF, JLEV, JBLK)=Z_YDCPG_SL1_VR0_P (JROF, JLEV, JBLK)+YDPARAR%VSQUALL
          Z_YDCPG_SL2_VRL (JROF, JLEV, JBLK)=Z_YDCPG_SL2_VRL (JROF, JLEV, JBLK)+YDPARAR%VSQUALL
        
        ENDDO

      ENDIF


      IF (YDML_DYN%YRDYN%LSLDP_RK) THEN

        DO JLEV=1, YDGEOMETRY%YRDIMV%NFLEVG
          Z_YDCPG_SL1_UR00_P (JROF, JLEV, JBLK)=Z_YDCPG_SL2_URL (JROF, JLEV, JBLK)
          Z_YDCPG_SL1_VR00_P (JROF, JLEV, JBLK)=Z_YDCPG_SL2_VRL (JROF, JLEV, JBLK)
          Z_YDCPG_SL1_WR00_P (JROF, JLEV, JBLK)=Z_YDCPG_SL2_WRL (JROF, JLEV, JBLK)
        ENDDO

      ENDIF


      IF (YDML_DYN%YRDYN%LSLDP_CURV.OR.YDML_DYN%YRDYN%LSLDP_XYZ) THEN
        CALL LOCAL2CARTGEOV_OPENACC (0, YDGEOMETRY%YRDIMV%NFLEVG, YDGEOMETRY%YRDIM%NPROMA, YLCPG_BNDS&
        &%KIDIA, YLCPG_BNDS%KFDIA, Z_YDVARS_GEOMETRY_GEMU_P(:, JBLK), Z_YDVARS_GEOMETRY_GSQM2_P(:, JBLK&
        &), Z_YDVARS_GEOMETRY_GECLO_P(:, JBLK), Z_YDVARS_GEOMETRY_GESLO_P(:, JBLK), Z_YDCPG_SL1_UR0_P&
        &(:,:, JBLK), Z_YDCPG_SL1_VR0_P(:,:, JBLK), Z_YDCPG_SL1_ZR0_P(:,:, JBLK),YDSTACK=YLSTACK)

        IF (YDML_DYN%YRDYN%LSLDP_XYZ) THEN
          CALL LOCAL2CARTGEOV_OPENACC (1, YDGEOMETRY%YRDIMV%NFLEVG, YDGEOMETRY%YRDIM%NPROMA, YLCPG_BNDS&
          &%KIDIA, YLCPG_BNDS%KFDIA, Z_YDVARS_GEOMETRY_GEMU_P(:, JBLK), Z_YDVARS_GEOMETRY_GSQM2_P(:, JBLK&
          &), Z_YDVARS_GEOMETRY_GECLO_P(:, JBLK), Z_YDVARS_GEOMETRY_GESLO_P(:, JBLK), Z_YDCPG_SL2_URL(&
          &:,:, JBLK), Z_YDCPG_SL2_VRL(:,:, JBLK), Z_YDCPG_SL2_ZRL(:,:, JBLK),YDSTACK=YLSTACK)
        ENDIF


        IF (YDML_DYN%YRDYN%LSLDP_RK) THEN
          CALL LOCAL2CARTGEOV_OPENACC (0, YDGEOMETRY%YRDIMV%NFLEVG, YDGEOMETRY%YRDIM%NPROMA, YLCPG_BNDS%KIDIA&
          &, YLCPG_BNDS%KFDIA, Z_YDVARS_GEOMETRY_GEMU_P(:, JBLK), Z_YDVARS_GEOMETRY_GSQM2_P(:, JBLK), Z_YDVARS_GEOMETRY_GECLO_P&
          &(:, JBLK), Z_YDVARS_GEOMETRY_GESLO_P(:, JBLK), Z_YDCPG_SL1_UR00_P(:,:, JBLK), Z_YDCPG_SL1_VR00_P&
          &(:,:, JBLK), Z_YDCPG_SL1_ZR00_P(:,:, JBLK),YDSTACK=YLSTACK)
        ENDIF

      ENDIF


      IF (YDML_DYN%YRDYN%LRHS_CURV.AND.LD2TLFF1) THEN
        CALL LOCAL2CARTGEOV_OPENACC (0, YDGEOMETRY%YRDIMV%NFLEVG, YDGEOMETRY%YRDIM%NPROMA, YLCPG_BNDS&
        &%KIDIA, YLCPG_BNDS%KFDIA, Z_YDVARS_GEOMETRY_GEMU_P(:, JBLK), Z_YDVARS_GEOMETRY_GSQM2_P(:, JBLK&
        &), Z_YDVARS_GEOMETRY_GECLO_P(:, JBLK), Z_YDVARS_GEOMETRY_GESLO_P(:, JBLK), Z_YDCPG_SL1_UR9_P&
        &(:,:, JBLK), Z_YDCPG_SL1_VR9_P(:,:, JBLK), Z_YDCPG_SL1_ZR9_P(:,:, JBLK),YDSTACK=YLSTACK)
      ENDIF

    ENDDO

  ENDDO

  IF (LHOOK) CALL DR_HOOK ('LAVENT_PARALLEL:0:COMPUTE',1,ZHOOK_HANDLE_COMPUTE)

  IF (FXTRAN_ACDC_LSYNCHOST ('LAVENT_PARALLEL:0')) THEN
    IF (LHOOK) CALL DR_HOOK ('LAVENT_PARALLEL:0:SYNCHOST',0,ZHOOK_HANDLE_FIELD_API)
    KSETTLOFF => GET_HOST_DATA_RDWR (YD_KSETTLOFF)
    PALPHA => GET_HOST_DATA_RDWR (YD_PALPHA)
    PEVEL => GET_HOST_DATA_RDWR (YD_PEVEL)
    PRDELP => GET_HOST_DATA_RDWR (YD_PRDELP)
    PWRL9 => GET_HOST_DATA_RDWR (YD_PWRL9)
    ZWRL0 => GET_HOST_DATA_RDWR (YL_ZWRL0)
    Z_YDCPG_SL1_U9_P => GET_HOST_DATA_RDWR (YDCPG_SL1%U9%F_P)
    Z_YDCPG_SL1_UF9_P => GET_HOST_DATA_RDWR (YDCPG_SL1%UF9%F_P)
    Z_YDCPG_SL1_UR00_P => GET_HOST_DATA_RDWR (YDCPG_SL1%UR00%F_P)
    Z_YDCPG_SL1_UR0_P => GET_HOST_DATA_RDWR (YDCPG_SL1%UR0%F_P)
    Z_YDCPG_SL1_UR9_P => GET_HOST_DATA_RDWR (YDCPG_SL1%UR9%F_P)
    Z_YDCPG_SL1_V9_P => GET_HOST_DATA_RDWR (YDCPG_SL1%V9%F_P)
    Z_YDCPG_SL1_VF9_P => GET_HOST_DATA_RDWR (YDCPG_SL1%VF9%F_P)
    Z_YDCPG_SL1_VR00_P => GET_HOST_DATA_RDWR (YDCPG_SL1%VR00%F_P)
    Z_YDCPG_SL1_VR0_P => GET_HOST_DATA_RDWR (YDCPG_SL1%VR0%F_P)
    Z_YDCPG_SL1_VR9_P => GET_HOST_DATA_RDWR (YDCPG_SL1%VR9%F_P)
    Z_YDCPG_SL1_WR00_P => GET_HOST_DATA_RDWR (YDCPG_SL1%WR00%F_P)
    Z_YDCPG_SL1_WR0_P => GET_HOST_DATA_RDWR (YDCPG_SL1%WR0%F_P)
    Z_YDCPG_SL1_WRA_P => GET_HOST_DATA_RDWR (YDCPG_SL1%WRA%F_P)
    Z_YDCPG_SL1_ZR00_P => GET_HOST_DATA_RDWR (YDCPG_SL1%ZR00%F_P)
    Z_YDCPG_SL1_ZR0_P => GET_HOST_DATA_RDWR (YDCPG_SL1%ZR0%F_P)
    Z_YDCPG_SL1_ZR9_P => GET_HOST_DATA_RDWR (YDCPG_SL1%ZR9%F_P)
    Z_YDCPG_SL2_URL => GET_HOST_DATA_RDWR (YDCPG_SL2%F_URL)
    Z_YDCPG_SL2_VRL => GET_HOST_DATA_RDWR (YDCPG_SL2%F_VRL)
    Z_YDCPG_SL2_WRL => GET_HOST_DATA_RDWR (YDCPG_SL2%F_WRL)
    Z_YDCPG_SL2_ZRL => GET_HOST_DATA_RDWR (YDCPG_SL2%F_ZRL)
    Z_YDCPG_TND_TNDU => GET_HOST_DATA_RDWR (YDCPG_TND%F_TNDU)
    Z_YDCPG_TND_TNDV => GET_HOST_DATA_RDWR (YDCPG_TND%F_TNDV)
    Z_YDVARS_EDOT_T9 => GET_HOST_DATA_RDWR (YDVARS%EDOT%FT9)
    Z_YDVARS_GEOMETRY_GECLO_P => GET_HOST_DATA_RDWR (YDVARS%GEOMETRY%GECLO%FT0)
    Z_YDVARS_GEOMETRY_GEMU_P => GET_HOST_DATA_RDWR (YDVARS%GEOMETRY%GEMU%FT0)
    Z_YDVARS_GEOMETRY_GESLO_P => GET_HOST_DATA_RDWR (YDVARS%GEOMETRY%GESLO%FT0)
    Z_YDVARS_GEOMETRY_GSQM2_P => GET_HOST_DATA_RDWR (YDVARS%GEOMETRY%GSQM2%FT0)
    Z_YDVARS_U_T0 => GET_HOST_DATA_RDWR (YDVARS%U%FT0)
    Z_YDVARS_U_T9 => GET_HOST_DATA_RDWR (YDVARS%U%FT9)
    Z_YDVARS_V_T0 => GET_HOST_DATA_RDWR (YDVARS%V%FT0)
    Z_YDVARS_V_T9 => GET_HOST_DATA_RDWR (YDVARS%V%FT9)
    IF (LHOOK) CALL DR_HOOK ('LAVENT_PARALLEL:0:SYNCHOST',1,ZHOOK_HANDLE_FIELD_API)
    
    
  ENDIF

  IF (LHOOK) CALL DR_HOOK ('LAVENT_PARALLEL:0:NULLIFY',0,ZHOOK_HANDLE_FIELD_API)
  KSETTLOFF => NULL ()
  PALPHA => NULL ()
  PEVEL => NULL ()
  PRDELP => NULL ()
  PWRL9 => NULL ()
  ZWRL0 => NULL ()
  Z_YDCPG_SL1_U9_P => NULL ()
  Z_YDCPG_SL1_UF9_P => NULL ()
  Z_YDCPG_SL1_UR00_P => NULL ()
  Z_YDCPG_SL1_UR0_P => NULL ()
  Z_YDCPG_SL1_UR9_P => NULL ()
  Z_YDCPG_SL1_V9_P => NULL ()
  Z_YDCPG_SL1_VF9_P => NULL ()
  Z_YDCPG_SL1_VR00_P => NULL ()
  Z_YDCPG_SL1_VR0_P => NULL ()
  Z_YDCPG_SL1_VR9_P => NULL ()
  Z_YDCPG_SL1_WR00_P => NULL ()
  Z_YDCPG_SL1_WR0_P => NULL ()
  Z_YDCPG_SL1_WRA_P => NULL ()
  Z_YDCPG_SL1_ZR00_P => NULL ()
  Z_YDCPG_SL1_ZR0_P => NULL ()
  Z_YDCPG_SL1_ZR9_P => NULL ()
  Z_YDCPG_SL2_URL => NULL ()
  Z_YDCPG_SL2_VRL => NULL ()
  Z_YDCPG_SL2_WRL => NULL ()
  Z_YDCPG_SL2_ZRL => NULL ()
  Z_YDCPG_TND_TNDU => NULL ()
  Z_YDCPG_TND_TNDV => NULL ()
  Z_YDVARS_EDOT_T9 => NULL ()
  Z_YDVARS_GEOMETRY_GECLO_P => NULL ()
  Z_YDVARS_GEOMETRY_GEMU_P => NULL ()
  Z_YDVARS_GEOMETRY_GESLO_P => NULL ()
  Z_YDVARS_GEOMETRY_GSQM2_P => NULL ()
  Z_YDVARS_U_T0 => NULL ()
  Z_YDVARS_U_T9 => NULL ()
  Z_YDVARS_V_T0 => NULL ()
  Z_YDVARS_V_T9 => NULL ()
  IF (LHOOK) CALL DR_HOOK ('LAVENT_PARALLEL:0:NULLIFY',1,ZHOOK_HANDLE_FIELD_API)
  
  
ELSE
    CALL ABOR1 ('LAVENT_PARALLEL: NOT METHOD WAS FOUND')
ENDIF

IF (LHOOK) CALL DR_HOOK ('LAVENT_PARALLEL:0',1,ZHOOK_HANDLE_PARALLEL)




CALL FXTRAN_ACDC_GPUMEMSTAT (__FILE__, __LINE__, "END")

IF (LHOOK) CALL DR_HOOK ('DELETE_TEMPORARIES',0,ZHOOK_HANDLE_FIELD_API)
IF (ASSOCIATED (YL_ZWRL0)) CALL FIELD_DELETE (YL_ZWRL0)
IF (LHOOK) CALL DR_HOOK ('DELETE_TEMPORARIES',1,ZHOOK_HANDLE_FIELD_API)
IF (LHOOK) CALL DR_HOOK ('LAVENT_PARALLEL', 1, ZHOOK_HANDLE)
END SUBROUTINE LAVENT_PARALLEL
