SUBROUTINE LAITRE_GFL_OPENACC (YDGEOMETRY, YGFL, YDML_DYN, KASLB1, KPROMA&
&, KST, KEND, KFLEV, KFLDN, KFLDX, KHVI, KWK, CDINT, PWENOALPHA, LDMOM&
&, KNOWENO, KL0, PLSCAW, PRSCAW, PXSL, POUT, PXSPSL, YDSTACK)
!$ACC ROUTINE (LAITRE_GFL_OPENACC) SEQ
USE YOM_YGFL,ONLY:TYPE_GFLD
USE GEOMETRY_MOD,ONLY:GEOMETRY
USE PARKIND1,ONLY:JPIM, JPRB

USE MODEL_DYNAMICS_MOD,ONLY:MODEL_DYNAMICS_TYPE
#include "fxtran_acdc_stack.h"
USE FXTRAN_ACDC_STACK_MOD
USE FXTRAN_ACDC_ABORT_MOD

IMPLICIT NONE


TYPE (GEOMETRY), INTENT (IN)::YDGEOMETRY
TYPE (TYPE_GFLD), INTENT (IN)::YGFL
TYPE (MODEL_DYNAMICS_TYPE), INTENT (IN)::YDML_DYN
INTEGER (KIND=JPIM), INTENT (IN)::KASLB1
INTEGER (KIND=JPIM), INTENT (IN)::KPROMA
INTEGER (KIND=JPIM), INTENT (IN)::KST
INTEGER (KIND=JPIM), INTENT (IN)::KEND
INTEGER (KIND=JPIM), INTENT (IN)::KFLEV
INTEGER (KIND=JPIM), INTENT (IN)::KFLDN
INTEGER (KIND=JPIM), INTENT (IN)::KFLDX
INTEGER (KIND=JPIM), INTENT (IN)::KHVI
INTEGER (KIND=JPIM), INTENT (IN)::KWK
CHARACTER (LEN=12), INTENT (IN)::CDINT
REAL (KIND=JPRB), INTENT (IN)::PWENOALPHA
LOGICAL, INTENT (IN)::LDMOM
INTEGER (KIND=JPIM), INTENT (IN)::KNOWENO (KPROMA, KFLEV)
INTEGER (KIND=JPIM), INTENT (IN)::KL0 (KPROMA, KFLEV, 0:3)
REAL (KIND=JPRB), INTENT (IN)::PLSCAW (KPROMA, KFLEV, YDML_DYN%YYTLSCAW%NDIM)
REAL (KIND=JPRB), INTENT (IN)::PRSCAW (KPROMA, KFLEV, YDML_DYN%YYTRSCAW%NDIM)
REAL (KIND=JPRB), INTENT (IN)::PXSL (KASLB1, KFLDN:KFLDX)
REAL (KIND=JPRB), INTENT (OUT)::POUT (KPROMA, KFLEV)
REAL (KIND=JPRB), INTENT (IN), OPTIONAL::PXSPSL (KASLB1, KFLDN:KFLDX)
TYPE(FXTRAN_ACDC_STACK), INTENT (IN) :: YDSTACK
TYPE(FXTRAN_ACDC_STACK) :: YLSTACK
INTEGER (KIND=JPIM)::IQM


#include "laihvt_openacc.intfb.h"
#include "laitvspcqm_openacc.intfb.h"
#include "laitri_openacc.intfb.h"
#include "laitriqm3d_openacc.intfb.h"
#include "laqmlimiter_openacc.intfb.h"
#include "laitri_weno_openacc.intfb.h"
INTEGER (KIND=JPIM) :: JROF

YLSTACK = YDSTACK



JROF = KST





IF (CDINT (1:7)=="LAITQMH".OR.CDINT (1:7)=="LAITQML".OR.CDINT&
  & (1:9)=="LAIHVTQMH".OR.CDINT=='LAITRWENOQMH') THEN
  IQM=1
ELSEIF (CDINT (1:8)=="LAIHVTQM".OR.CDINT (1:7)=='LAITQM3'.OR.CDINT=='LAITRWENOQM') THEN
  IQM=2
ELSEIF (CDINT (1:6)=="LAITRI".OR.CDINT (1:6)=="LAIHVT".OR.CDINT=='LAITRWENO') THEN
  IQM=0
ELSEIF (CDINT=="LAITRWENOQM3") THEN
  IQM=-1
ELSEIF (CDINT (1:6)=="LAITQM") THEN
  IQM=YDML_DYN%YRDYNA%NQMGFL
ELSEIF (CDINT/='LAITVSPCQM  ') THEN
  CALL FXTRAN_ACDC_ABORT ("unknown type of QM limiter for GFL interpolation: "//CDINT)
ENDIF


IF (CDINT=='LAITQM(SLD) '.OR.CDINT=='LAITQMH(SLD)'.OR.CDINT&
  &=='LAITRI(SLD) '.OR.CDINT=='LAITQM3D(SLD') THEN

  IF (CDINT=='LAITQM3D(SLD') THEN
    CALL FXTRAN_ACDC_ABORT ('LAITRE_GFL: LAITQM3D(SLD) IS NOT YET AVAILABLE')
  ENDIF


  IF (LDMOM) THEN
    CALL LAITRI_OPENACC (KASLB1, KPROMA, KST, KEND, KFLEV, KFLDN, KFLDX, IQM, YDML_DYN%YRDYN%CLAITRI_TYPE&
    &, PLSCAW (:,:, YDML_DYN%YYTLSCAW%M_WDLAT), PRSCAW (:,:, YDML_DYN%YYTRSCAW%M_WCLASLD (KWK)),&
    & PLSCAW (:,:, YDML_DYN%YYTLSCAW%M_WDLO), PRSCAW (:,:, YDML_DYN%YYTRSCAW%M_WCLOSLD (KWK)), KL0&
    &, PRSCAW (:,:, YDML_DYN%YYTRSCAW%M_WVINTWSLD), PXSL, POUT, YDSTACK=YLSTACK)
  ELSE
    CALL LAITRI_OPENACC (KASLB1, KPROMA, KST, KEND, KFLEV, KFLDN, KFLDX, IQM, YDML_DYN%YRDYN%CLAITRI_TYPE&
    &, PLSCAW (:,:, YDML_DYN%YYTLSCAW%M_WDLAT), PRSCAW (:,:, YDML_DYN%YYTRSCAW%M_WCLASLT), PLSCAW&
    & (:,:, YDML_DYN%YYTLSCAW%M_WDLO), PRSCAW (:,:, YDML_DYN%YYTRSCAW%M_WCLOSLT), KL0, PRSCAW&
    & (:,:, YDML_DYN%YYTRSCAW%M_WVINTWSLT), PXSL, POUT, YDSTACK=YLSTACK)
  ENDIF


  IF (CDINT=='LAITQM3D(SLD') THEN
    CALL LAQMLIMITER_OPENACC (YDML_DYN%YRSLINT%YRVSLETA%VRDETAR, YGFL%LQM3DCONS, KASLB1&
    &, KPROMA, KST, KEND, KFLEV, KFLDN, KFLDX, KL0, PXSL, POUT, YDSTACK=YLSTACK)
  ENDIF

ELSEIF (CDINT=='LAITQM(MAD) '.OR.CDINT=='LAITQMH(MAD)'.OR.CDINT=='LAITRI(MAD) ') THEN
  CALL LAITRI_OPENACC (KASLB1, KPROMA, KST, KEND, KFLEV, KFLDN, KFLDX, IQM, YDML_DYN%YRDYN%CLAITRI_TYPE&
  &, PLSCAW (:,:, YDML_DYN%YYTLSCAW%M_WDLAMAD), PRSCAW (:,:, YDML_DYN%YYTRSCAW%M_WCLAMAD (KWK))&
  &, PLSCAW (:,:, YDML_DYN%YYTLSCAW%M_WDLOMAD), PRSCAW (:,:, YDML_DYN%YYTRSCAW%M_WCLOMAD (KWK))&
  &, KL0, PRSCAW (:,:, YDML_DYN%YYTRSCAW%M_WVINTWMAD), PXSL, POUT, YDSTACK=YLSTACK)
ELSEIF (CDINT (1:6)=='LAIHVT') THEN
  CALL LAIHVT_OPENACC (KASLB1, KPROMA, KST, KEND, KFLEV, KFLDN, KFLDX, IQM, PLSCAW (:,:, YDML_DYN&
  &%YYTLSCAW%M_WDLAT), PRSCAW (:,:, YDML_DYN%YYTRSCAW%M_WCLA (KWK)), PLSCAW (:,:, YDML_DYN%YYTLSCAW&
  &%M_WDLO), PRSCAW (:,:, YDML_DYN%YYTRSCAW%M_WCLO (KWK)), KL0, PRSCAW (:,:, YDML_DYN%YYTRSCAW&
  &%M_WVDERW), PRSCAW (:,:, YDML_DYN%YYTRSCAW%M_WHVW), PXSL, POUT, YDSTACK=YLSTACK)
ELSEIF (CDINT=='LAITVSPCQM  ') THEN

  IF (.NOT.PRESENT (PXSPSL))  THEN
    CALL FXTRAN_ACDC_ABORT ('LAITRE_GFL: MISSING ARGUMENT PXSPSL FOR INTERPOLATION TYPE LAITVSPCQM')
  ENDIF

  CALL LAITVSPCQM_OPENACC (YDML_DYN%YRSLINT%YRVSLETA, KASLB1, KPROMA, KST, KEND, KFLEV, KFLDN&
  &, KFLDX, PLSCAW (:,:, YDML_DYN%YYTLSCAW%M_WDLAT), PRSCAW (:,:, YDML_DYN%YYTRSCAW%M_WCLA (KWK&
  &)), PLSCAW (:,:, YDML_DYN%YYTLSCAW%M_WDLO), PRSCAW (:,:, YDML_DYN%YYTRSCAW%M_WCLO (KWK)), KL0&
  &, PRSCAW (:,:, YDML_DYN%YYTRSCAW%M_WVINTWS), PXSPSL, POUT, PXSL, YDSTACK=YLSTACK)
ELSEIF (CDINT=='LAITQM3(MAD) '.OR.CDINT=='LAITQML(MAD)') THEN
  CALL LAITRIQM3D_OPENACC (YDGEOMETRY%YRVERT_GEOM%YRVETA, YGFL%LQM3DCONS, KASLB1, KPROMA, KST&
  &, KEND, KFLEV, KFLDN, KFLDX, IQM, PLSCAW (:,:, YDML_DYN%YYTLSCAW%M_WDLAMAD), PRSCAW (:,&
  &:, YDML_DYN%YYTRSCAW%M_WCLAMAD (KWK)), PLSCAW (:,:, YDML_DYN%YYTLSCAW%M_WDLOMAD), PRSCAW&
  & (:,:, YDML_DYN%YYTRSCAW%M_WCLOMAD (KWK)), KL0, PRSCAW (:,:, YDML_DYN%YYTRSCAW%M_WVINTWMAD&
  &), PLSCAW (:,:, YDML_DYN%YYTLSCAW%M_WDVERMAD), PXSL, POUT, YDSTACK=YLSTACK)
ELSEIF (CDINT=='LAITQM3D    '.OR.CDINT=='LAITQML3D   ') THEN
  CALL LAITRIQM3D_OPENACC (YDGEOMETRY%YRVERT_GEOM%YRVETA, YGFL%LQM3DCONS, KASLB1, KPROMA&
  &, KST, KEND, KFLEV, KFLDN, KFLDX, IQM, PLSCAW (:,:, YDML_DYN%YYTLSCAW%M_WDLAT), PRSCAW&
  & (:,:, YDML_DYN%YYTRSCAW%M_WCLA (KWK)), PLSCAW (:,:, YDML_DYN%YYTLSCAW%M_WDLO), PRSCAW&
  & (:,:, YDML_DYN%YYTRSCAW%M_WCLO (KWK)), KL0, PRSCAW (:,:, YDML_DYN%YYTRSCAW%M_WVINTW&
  &), PLSCAW (:,:, YDML_DYN%YYTLSCAW%M_WDVER), PXSL, POUT, YDSTACK=YLSTACK)
ELSEIF (CDINT (1:6)=='LAITQM'.OR.CDINT (1:6)=='LAITRI') THEN
  CALL LAITRI_OPENACC (KASLB1, KPROMA, KST, KEND, KFLEV, KFLDN, KFLDX, IQM, YDML_DYN%YRDYN%CLAITRI_TYPE&
  &, PLSCAW (:,:, YDML_DYN%YYTLSCAW%M_WDLAT), PRSCAW (:,:, YDML_DYN%YYTRSCAW%M_WCLA (KWK)),&
  & PLSCAW (:,:, YDML_DYN%YYTLSCAW%M_WDLO), PRSCAW (:,:, YDML_DYN%YYTRSCAW%M_WCLO (KWK)), KL0&
  &, PRSCAW (:,:, YDML_DYN%YYTRSCAW%M_WVINTW), PXSL, POUT, YDSTACK=YLSTACK)
ELSEIF (CDINT (1:9)=='LAITRWENO') THEN
  CALL LAITRI_WENO_OPENACC (YDML_DYN%YRDYN, KASLB1, KPROMA, KST, KEND, KFLEV, KFLDN, KFLDX, IQM, YDML_DYN&
  &%YRDYN%CLAITRI_WENO_TYPE, PLSCAW (:,:, YDML_DYN%YYTLSCAW%M_WDLAT), PRSCAW (:,:, YDML_DYN%YYTRSCAW%M_WCLA&
  & (KWK)), PLSCAW (:,:, YDML_DYN%YYTLSCAW%M_WDLO), PRSCAW (:,:, YDML_DYN%YYTRSCAW%M_WCLO (KWK)), KL0&
  &, KNOWENO, PRSCAW (:,:, YDML_DYN%YYTRSCAW%M_CW), PRSCAW (:,:, YDML_DYN%YYTRSCAW%M_WVINTW), PXSL, POUT&
  &, PWENOALPHA, YDML_DYN%YRSLINT%YRVSLETA%VRDETAR, YGFL%LQM3DCONS, YDSTACK=YLSTACK)
ELSE
  CALL FXTRAN_ACDC_ABORT ('LAITRE_GFL: UNKNOWN INTERPOLATION TYPE: '//CDINT)
ENDIF




END SUBROUTINE LAITRE_GFL_OPENACC
