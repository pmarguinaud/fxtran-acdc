SUBROUTINE ACTKE1_OPENACC (YDCST, YDLDDH, YDMDDH, YDML_PHY_MF, KIDIA, KFDIA, KLON, KTDIAT, KTDIAN&
&, KLEV, PAPHI, PAPHIF, PAPRS, PAPRSF, PDELP, PR, PT, PU, PV, PQ, PLSCPE, PCD, PCH, PGZ0, PTS, PQS&
&, PQICE, PQLI, PECT, PPRODTH, PNLAB, PNLABCVP, PKTROV, PKQROV, PKQLROV, PKUROV, PXTROV, PXUROV&
&, PNBVNO, PNEBS, PQCS, PNEBS0, PQCS0, PCOEFN, PUSLE, PKCLS, PECTCLS, PPRODTH2, YDSTACK)
!$ACC ROUTINE (ACTKE1_OPENACC) SEQ
USE MODEL_PHYSICS_MF_MOD,ONLY:MODEL_PHYSICS_MF_TYPE
USE YOMMDDH,ONLY:TMDDH
USE PARKIND1,ONLY:JPIM, JPRB

USE YOMCST,ONLY:TCST
USE YOMLDDH,ONLY:TLDDH
#include "fxtran_acdc_stack.h"
USE FXTRAN_ACDC_STACK_MOD
USE FXTRAN_ACDC_ABORT_MOD

IMPLICIT NONE


TYPE (TCST), INTENT (IN)::YDCST
TYPE (TLDDH), INTENT (IN)::YDLDDH
TYPE (TMDDH), INTENT (IN)::YDMDDH
TYPE (MODEL_PHYSICS_MF_TYPE), INTENT (IN)::YDML_PHY_MF
INTEGER (KIND=JPIM), INTENT (IN)::KIDIA
INTEGER (KIND=JPIM), INTENT (IN)::KFDIA
INTEGER (KIND=JPIM), INTENT (IN)::KLON
INTEGER (KIND=JPIM), INTENT (IN)::KTDIAT
INTEGER (KIND=JPIM), INTENT (IN)::KTDIAN
INTEGER (KIND=JPIM), INTENT (IN)::KLEV
REAL (KIND=JPRB), INTENT (IN)::PAPHI (KLON, 0:KLEV)
REAL (KIND=JPRB), INTENT (IN)::PAPHIF (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PAPRS (KLON, 0:KLEV)
REAL (KIND=JPRB), INTENT (IN)::PAPRSF (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PDELP (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PR (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PT (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PU (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PV (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PQ (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PLSCPE (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PCD (KLON)
REAL (KIND=JPRB), INTENT (IN)::PCH (KLON)
REAL (KIND=JPRB), INTENT (IN)::PGZ0 (KLON)
REAL (KIND=JPRB), INTENT (IN)::PTS (KLON)
REAL (KIND=JPRB), INTENT (IN)::PQS (KLON)
REAL (KIND=JPRB), INTENT (INOUT)::PQICE (KLON, KLEV)
REAL (KIND=JPRB), INTENT (INOUT)::PQLI (KLON, KLEV)
REAL (KIND=JPRB), INTENT (INOUT)::PECT (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PPRODTH (KLON, 0:KLEV)
REAL (KIND=JPRB), INTENT (OUT)::PPRODTH2 (KLON, KLEV)
TYPE(FXTRAN_ACDC_STACK), INTENT (IN) :: YDSTACK
TYPE(FXTRAN_ACDC_STACK) :: YLSTACK
REAL (KIND=JPRB), INTENT (IN)::PNLAB (KLON, KLEV)
REAL (KIND=JPRB), INTENT (IN)::PNLABCVP (KLON, KLEV)
REAL (KIND=JPRB), INTENT (OUT)::PKTROV (KLON, 0:KLEV)
REAL (KIND=JPRB), INTENT (OUT)::PKQROV (KLON, 0:KLEV)
REAL (KIND=JPRB), INTENT (OUT)::PKQLROV (KLON, 0:KLEV)
REAL (KIND=JPRB), INTENT (OUT)::PKUROV (KLON, 0:KLEV)
REAL (KIND=JPRB), INTENT (OUT)::PXTROV (KLON, 0:KLEV)
REAL (KIND=JPRB), INTENT (OUT)::PXUROV (KLON, 0:KLEV)
REAL (KIND=JPRB), INTENT (OUT)::PNBVNO (KLON, 0:KLEV)
REAL (KIND=JPRB), INTENT (OUT)::PNEBS (KLON, KLEV)
REAL (KIND=JPRB), INTENT (OUT)::PQCS (KLON, KLEV)
REAL (KIND=JPRB), INTENT (OUT)::PNEBS0 (KLON, KLEV)
REAL (KIND=JPRB), INTENT (OUT)::PQCS0 (KLON, KLEV)
REAL (KIND=JPRB), INTENT (OUT)::PCOEFN (KLON, KLEV)
REAL (KIND=JPRB), INTENT (OUT)::PUSLE (KLON, KLEV)
REAL (KIND=JPRB), INTENT (OUT)::PKCLS (KLON)
REAL (KIND=JPRB), INTENT (OUT)::PECTCLS (KLON)
INTEGER (KIND=JPIM)::JLON
INTEGER (KIND=JPIM)::JLEV
fxtran_acdc_temp (REAL (KIND=JPRB), ZPHI3, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZLMECT, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZPRODTH, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZDIAG, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZECT, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZDELPSG, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZDET, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZDIFFAR, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZFCORTKE, (KLON, 0:KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZFDIFF, (KLON, 0:KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZFDISS, (KLON, 0:KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZFPRDY, (KLON, 0:KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZFPRTH, (KLON, 0:KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZTCORTKE, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZTDIFF, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZTDISS, (KLON, KLEV))
fxtran_acdc_temp (REAL (KIND=JPRB), ZTPRTH, (KLON, KLEV))
REAL (KIND=JPRB)::ZEPSQ
fxtran_acdc_temp (LOGICAL, LLCONV, (KLON, KLEV))

#include "acbl89_openacc.intfb.h"
#include "acturb_openacc.intfb.h"
#include "fl2hl_openacc.intfb.h"
#include "aclender_openacc.intfb.h"

YLSTACK = YDSTACK



IF (KIND (ZPHI3) == 8) THEN
    fxtran_acdc_alloc8 (ZPHI3)
ELSEIF (KIND (ZPHI3) == 4) THEN
    fxtran_acdc_alloc4 (ZPHI3)
ELSE
    STOP 1
ENDIF


IF (KIND (ZLMECT) == 8) THEN
    fxtran_acdc_alloc8 (ZLMECT)
ELSEIF (KIND (ZLMECT) == 4) THEN
    fxtran_acdc_alloc4 (ZLMECT)
ELSE
    STOP 1
ENDIF


IF (KIND (ZPRODTH) == 8) THEN
    fxtran_acdc_alloc8 (ZPRODTH)
ELSEIF (KIND (ZPRODTH) == 4) THEN
    fxtran_acdc_alloc4 (ZPRODTH)
ELSE
    STOP 1
ENDIF


IF (KIND (ZDIAG) == 8) THEN
    fxtran_acdc_alloc8 (ZDIAG)
ELSEIF (KIND (ZDIAG) == 4) THEN
    fxtran_acdc_alloc4 (ZDIAG)
ELSE
    STOP 1
ENDIF


IF (KIND (ZECT) == 8) THEN
    fxtran_acdc_alloc8 (ZECT)
ELSEIF (KIND (ZECT) == 4) THEN
    fxtran_acdc_alloc4 (ZECT)
ELSE
    STOP 1
ENDIF


IF (KIND (ZDELPSG) == 8) THEN
    fxtran_acdc_alloc8 (ZDELPSG)
ELSEIF (KIND (ZDELPSG) == 4) THEN
    fxtran_acdc_alloc4 (ZDELPSG)
ELSE
    STOP 1
ENDIF


IF (KIND (ZDET) == 8) THEN
    fxtran_acdc_alloc8 (ZDET)
ELSEIF (KIND (ZDET) == 4) THEN
    fxtran_acdc_alloc4 (ZDET)
ELSE
    STOP 1
ENDIF


IF (KIND (ZDIFFAR) == 8) THEN
    fxtran_acdc_alloc8 (ZDIFFAR)
ELSEIF (KIND (ZDIFFAR) == 4) THEN
    fxtran_acdc_alloc4 (ZDIFFAR)
ELSE
    STOP 1
ENDIF


IF (KIND (ZFCORTKE) == 8) THEN
    fxtran_acdc_alloc8 (ZFCORTKE)
ELSEIF (KIND (ZFCORTKE) == 4) THEN
    fxtran_acdc_alloc4 (ZFCORTKE)
ELSE
    STOP 1
ENDIF


IF (KIND (ZFDIFF) == 8) THEN
    fxtran_acdc_alloc8 (ZFDIFF)
ELSEIF (KIND (ZFDIFF) == 4) THEN
    fxtran_acdc_alloc4 (ZFDIFF)
ELSE
    STOP 1
ENDIF


IF (KIND (ZFDISS) == 8) THEN
    fxtran_acdc_alloc8 (ZFDISS)
ELSEIF (KIND (ZFDISS) == 4) THEN
    fxtran_acdc_alloc4 (ZFDISS)
ELSE
    STOP 1
ENDIF


IF (KIND (ZFPRDY) == 8) THEN
    fxtran_acdc_alloc8 (ZFPRDY)
ELSEIF (KIND (ZFPRDY) == 4) THEN
    fxtran_acdc_alloc4 (ZFPRDY)
ELSE
    STOP 1
ENDIF


IF (KIND (ZFPRTH) == 8) THEN
    fxtran_acdc_alloc8 (ZFPRTH)
ELSEIF (KIND (ZFPRTH) == 4) THEN
    fxtran_acdc_alloc4 (ZFPRTH)
ELSE
    STOP 1
ENDIF


IF (KIND (ZTCORTKE) == 8) THEN
    fxtran_acdc_alloc8 (ZTCORTKE)
ELSEIF (KIND (ZTCORTKE) == 4) THEN
    fxtran_acdc_alloc4 (ZTCORTKE)
ELSE
    STOP 1
ENDIF


IF (KIND (ZTDIFF) == 8) THEN
    fxtran_acdc_alloc8 (ZTDIFF)
ELSEIF (KIND (ZTDIFF) == 4) THEN
    fxtran_acdc_alloc4 (ZTDIFF)
ELSE
    STOP 1
ENDIF


IF (KIND (ZTDISS) == 8) THEN
    fxtran_acdc_alloc8 (ZTDISS)
ELSEIF (KIND (ZTDISS) == 4) THEN
    fxtran_acdc_alloc4 (ZTDISS)
ELSE
    STOP 1
ENDIF


IF (KIND (ZTPRTH) == 8) THEN
    fxtran_acdc_alloc8 (ZTPRTH)
ELSEIF (KIND (ZTPRTH) == 4) THEN
    fxtran_acdc_alloc4 (ZTPRTH)
ELSE
    STOP 1
ENDIF


IF (KIND (LLCONV) == 8) THEN
    fxtran_acdc_alloc8 (LLCONV)
ELSEIF (KIND (LLCONV) == 4) THEN
    fxtran_acdc_alloc4 (LLCONV)
ELSE
    STOP 1
ENDIF


JLON = KIDIA



ZEPSQ=1.E-10_JPRB
ZTDIFF (JLON,:)=0.0_JPRB
ZTDISS (JLON,:)=0.0_JPRB
ZTPRTH (JLON,:)=0.0_JPRB
ZTCORTKE (JLON,:)=0.0_JPRB
ZFDIFF (JLON,:)=0.0_JPRB
ZFDISS (JLON,:)=0.0_JPRB
ZFPRTH (JLON,:)=0.0_JPRB
ZFPRDY (JLON,:)=0.0_JPRB
ZFCORTKE (JLON,:)=0.0_JPRB
ZDET (JLON,:)=0.0_JPRB
ZDELPSG (JLON,:)=0.0_JPRB
ZDIAG (JLON,:)=0.0_JPRB
ZDIFFAR (JLON,:)=0._JPRB

IF (YDML_PHY_MF%YRPHY%LECTFL) THEN
  CALL FL2HL_OPENACC (KIDIA, KFDIA, KLON, 1, KLEV, PAPRS, PAPRSF, PECT, ZECT, 1, YDSTACK=YLSTACK)
ELSE

  DO JLEV=1, KLEV
    
    ZECT (JLON, JLEV)=PECT (JLON, JLEV)
  
  ENDDO

ENDIF


DO JLEV=1, KLEV
  
  PUSLE (JLON, JLEV)=0.0_JPRB
  ZLMECT (JLON, JLEV)=0.0_JPRB
  ZPHI3 (JLON, JLEV)=0.0_JPRB
  
ENDDO


PECTCLS (JLON)=0.0_JPRB
PKCLS (JLON)=0.0_JPRB


DO JLEV=KTDIAT, KLEV
  
  ZECT (JLON, JLEV)=MAX (YDML_PHY_MF%YRPHY0%ECTMIN, ZECT (JLON, JLEV))
  ZDELPSG (JLON, JLEV)=PDELP (JLON, JLEV)/YDCST%RG
  
ENDDO


IF (YDML_PHY_MF%YRPHY%NLEND==0) THEN
  CALL ACBL89_OPENACC (YDCST, YDML_PHY_MF%YRPHY, YDML_PHY_MF%YRPHY0, KIDIA, KFDIA&
  &, KLON, KTDIAN, KLEV, PAPHI, PAPHIF, PAPRS, PAPRSF, PT, ZECT, PQ, PQICE, PQLI&
  &, PNLAB, PNLABCVP, PGZ0, PTS, PUSLE, ZLMECT, ZPHI3, YDSTACK=YLSTACK)
ELSEIF (YDML_PHY_MF%YRPHY%NLEND>0) THEN
  CALL ACLENDER_OPENACC (YDCST, YDML_PHY_MF%YRPHY, YDML_PHY_MF%YRPHY0, KIDIA, KFDIA&
  &, KLON, KTDIAN, KLEV, PAPHI, PAPHIF, PAPRS, PAPRSF, PT, PQ, PQICE, PQLI, PNLAB, PNLABCVP&
  &, PLSCPE, PU, PV, ZECT, PGZ0, PUSLE, ZLMECT, ZPHI3, YDSTACK=YLSTACK)
ENDIF

CALL ACTURB_OPENACC (YDCST, YDML_PHY_MF%YRPHY, YDML_PHY_MF%YRPHY0, KIDIA, KFDIA, KLON,&
& KTDIAT, KTDIAN, KLEV, PAPHI, PAPHIF, PAPRS, PAPRSF, PR, PT, PU, PV, ZECT, PQ, LLCONV&
&, PLSCPE, ZLMECT, ZPHI3, PCD, PCH, PGZ0, PTS, PQS, PQICE, PQLI, PKTROV, PKQROV, PKQLROV&
&, PKUROV, PNBVNO, ZPRODTH, PNEBS, PQCS, PCOEFN, PKCLS, PECTCLS, YDSTACK=YLSTACK)
PNEBS0 (JLON,:)=PNEBS (JLON,:)
PQCS0 (JLON,:)=PQCS (JLON,:)
PXTROV (JLON,:)=1.0_JPRB
PXUROV (JLON,:)=1.0_JPRB

DO JLEV=KTDIAT, KLEV
  
  ZPRODTH (JLON, JLEV)=ZPRODTH (JLON, JLEV)+YDML_PHY_MF&
  &%YRPHY0%RPRTH*MAX (0._JPRB, PPRODTH (JLON, JLEV))
  
ENDDO

PPRODTH2 (JLON,:)=0._JPRB

DO JLEV=KTDIAT, KLEV
  
  PPRODTH2 (JLON, JLEV)=ZPRODTH (JLON, JLEV)
  
ENDDO



END SUBROUTINE ACTKE1_OPENACC
