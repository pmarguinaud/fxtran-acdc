
SUBROUTINE CONVECT_MIXING_FUNCT_OPENACC (D, PMIXC, KMF, PER, PDR, YDSTACK)
!$ACC ROUTINE (CONVECT_MIXING_FUNCT_OPENACC) SEQ

USE MODD_DIMPHYEX,ONLY:DIMPHYEX_T
#include "fxtran_acdc_stack.h"
USE FXTRAN_ACDC_STACK_MOD
USE FXTRAN_ACDC_ABORT_MOD

IMPLICIT NONE


TYPE (DIMPHYEX_T), INTENT (IN)::D
REAL, INTENT (IN)::PMIXC(D%NIT)
INTEGER, INTENT (IN)::KMF
REAL, INTENT (OUT)::PER(D%NIT)
REAL, INTENT (OUT)::PDR(D%NIT)
TYPE(FXTRAN_ACDC_STACK), INTENT (IN) :: YDSTACK
REAL, PARAMETER::ZSIGMA=0.166666667
REAL, PARAMETER::ZFE=4.931813949
REAL, PARAMETER::ZP=0.33267
REAL, PARAMETER::ZSQRTP=2.506628
REAL, PARAMETER::ZA2=-0.1201676
REAL, PARAMETER::ZA1=0.4361836
REAL, PARAMETER::ZT1=0.500498
REAL, PARAMETER::ZA3=0.9372980
REAL, PARAMETER::ZE45=0.01111
REAL::ZW2
REAL::ZW1
REAL::ZY
REAL::ZX
REAL::ZW11
INTEGER::JI


JI = D%NIB



IF (KMF==1) THEN
  
  ZX =6.*PMIXC (JI)-3.
  ZW1 =1./(1.+ZP*ABS (ZX ))
  ZY =EXP (-0.5*ZX *ZX )
  ZW2 =ZA1*ZW1 +ZA2*ZW1 *ZW1 +ZA3*ZW1 *ZW1 *ZW1 
  ZW11=ZA1*ZT1+ZA2*ZT1*ZT1+ZA3*ZT1*ZT1*ZT1
  
ENDIF



IF (KMF==1.AND.ZX >=0.) THEN
  PER (JI)=ZSIGMA*(0.5*(ZSQRTP-ZE45*ZW11-ZY *ZW2 )+ZSIGMA*(ZE45-ZY ))-0.5*ZE45*PMIXC (JI)*PMIXC (JI)
  PDR (JI)=ZSIGMA*(0.5*(ZY *ZW2 -ZE45*ZW11)+ZSIGMA*(ZE45-ZY&
  & ))-ZE45*(0.5+0.5*PMIXC (JI)*PMIXC (JI)-PMIXC (JI))
ENDIF




IF (KMF==1.AND.ZX <0.) THEN
  PER (JI)=ZSIGMA*(0.5*(ZY *ZW2 -ZE45*ZW11)+ZSIGMA*(ZE45-ZY ))-0.5*ZE45*PMIXC (JI)*PMIXC (JI)
  PDR (JI)=ZSIGMA*(0.5*(ZSQRTP-ZE45*ZW11-ZY *ZW2 )+ZSIGMA*(ZE45&
  &-ZY ))-ZE45*(0.5+0.5*PMIXC (JI)*PMIXC (JI)-PMIXC (JI))
ENDIF



PER (JI)=PER (JI)*ZFE
PDR (JI)=PDR (JI)*ZFE


END SUBROUTINE CONVECT_MIXING_FUNCT_OPENACC
