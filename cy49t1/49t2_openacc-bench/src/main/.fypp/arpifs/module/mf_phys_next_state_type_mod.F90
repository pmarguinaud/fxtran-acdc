MODULE MF_PHYS_NEXT_STATE_TYPE_MOD

!$ACDC methods --methods-list=wipe,copy --field-api --field-api-class cpg


USE PARKIND1, ONLY : JPIM, JPRB
USE FIELD_MODULE
USE CPG_OPTS_TYPE_MOD, ONLY : CPG_DIMS_VARS_TYPE
IMPLICIT NONE

TYPE MF_PHYS_NEXT_STATE_2D_TYPE
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: P (:) => NULL ()
  CLASS (FIELD_2RB), POINTER :: F_P => NULL ()
END TYPE MF_PHYS_NEXT_STATE_2D_TYPE

TYPE MF_PHYS_NEXT_STATE_3D_TYPE
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: P (:, :) => NULL ()
  CLASS (FIELD_3RB), POINTER :: F_P => NULL ()
END TYPE MF_PHYS_NEXT_STATE_3D_TYPE

TYPE MF_PHYS_NEXT_STATE_TYPE

  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: U
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: V
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: T
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: SVD
  TYPE (MF_PHYS_NEXT_STATE_2D_TYPE) :: SP

  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: Q
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: I
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: L
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: IMF
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: LMF
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: LCONV
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: ICONV
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: RCONV
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: SCONV
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: IRAD
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: LRAD
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: S
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: R
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: G
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: H
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: TKE
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: TTE
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: EFB1
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: EFB2
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: EFB3
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: A
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: AMF
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: O3
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: SRC
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: MXL
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: SHTUR
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: FQTUR
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: FSTUR
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: CPF
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: SPF
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: CVGQ
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: QVA
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE), ALLOCATABLE :: GHG (:)
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE), ALLOCATABLE :: CHEM (:)
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE), ALLOCATABLE :: AERO (:)
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: LRCH4
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE), ALLOCATABLE :: FORC (:)
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE), ALLOCATABLE :: EZDIAG (:)
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE), ALLOCATABLE :: ERA40 (:)
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE), ALLOCATABLE :: NOGW (:)
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE), ALLOCATABLE :: EMIS3D (:)
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE), ALLOCATABLE :: EDRP (:)
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE), ALLOCATABLE :: SLDIA (:)
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE), ALLOCATABLE :: AERAOT (:)
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE), ALLOCATABLE :: AERLISI (:)
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE), ALLOCATABLE :: AEROUT (:)
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE), ALLOCATABLE :: AEROCLIM (:)
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE), ALLOCATABLE :: UVP (:)
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: PHYCTY
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: RSPEC
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: SDSAT
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: CVV
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: RKTH
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: RKTQV
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: RKTQC
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: UOM
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: UAL
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: DOM
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: DAL
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: UEN
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: UNEBH
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE), ALLOCATABLE :: LIMA (:)
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE) :: FSD
  TYPE (MF_PHYS_NEXT_STATE_3D_TYPE), ALLOCATABLE :: EXT (:)


  TYPE (CPG_DIMS_VARS_TYPE) :: DIMS

CONTAINS

  PROCEDURE :: INIT => MF_PHYS_NEXT_STATE_TYPE_INIT
  PROCEDURE :: UPDATE_VIEW => MF_PHYS_NEXT_STATE_TYPE_UPDATE_VIEW

END TYPE MF_PHYS_NEXT_STATE_TYPE

CONTAINS

SUBROUTINE MF_PHYS_NEXT_STATE_TYPE_INIT (SELF, YDCPG_SL1, YDGEOMETRY, YDVARS, YDMODEL)

USE GEOMETRY_MOD       , ONLY : GEOMETRY
USE FIELD_VARIABLES_MOD, ONLY : FIELD_VARIABLES
USE CPG_SL1_TYPE_MOD   , ONLY : CPG_SL1B_TYPE
USE TYPE_MODEL         , ONLY : MODEL

CLASS (MF_PHYS_NEXT_STATE_TYPE)     :: SELF
TYPE (CPG_SL1B_TYPE),   INTENT (IN) :: YDCPG_SL1
TYPE(GEOMETRY),         INTENT (IN) :: YDGEOMETRY
TYPE (FIELD_VARIABLES), INTENT (IN) :: YDVARS
TYPE(MODEL),            INTENT (IN) :: YDMODEL

INTEGER (KIND=JPIM) :: JGFL

ASSOCIATE (YDDYN => YDMODEL%YRML_DYN%YRDYN)

CALL SELF%DIMS%INIT (YDGEOMETRY, YDMODEL, YDVARS)

IF (YDMODEL%YRML_DYN%YRDYNA%LSLAG) THEN

  ! Taken from cp_ptrslb1.F90
  
  IF (YDDYN%NWLAG == 4) THEN
    SELF%U%P   => YDCPG_SL1%U0%P 
    SELF%U%F_P => YDCPG_SL1%U0%F_P
    SELF%V%P   => YDCPG_SL1%V0%P 
    SELF%V%F_P => YDCPG_SL1%V0%F_P
  ELSE
    IF (YDDYN%NSPLTHOI /= 0) THEN
      SELF%U%P   => YDCPG_SL1%UF9%P 
      SELF%U%F_P => YDCPG_SL1%UF9%F_P
      SELF%V%P   => YDCPG_SL1%VF9%P 
      SELF%V%F_P => YDCPG_SL1%VF9%F_P
    ELSE
      SELF%U%P   => YDCPG_SL1%U9%P 
      SELF%U%F_P => YDCPG_SL1%U9%F_P
      SELF%V%P   => YDCPG_SL1%V9%P 
      SELF%V%F_P => YDCPG_SL1%V9%F_P
    ENDIF
  ENDIF
  ! * temperature
  IF (YDDYN%NTLAG == 4) THEN
    SELF%T%P   => YDCPG_SL1%T0%P 
    SELF%T%F_P => YDCPG_SL1%T0%F_P
  ELSE
    IF (YDDYN%NSPLTHOI /= 0) THEN
      SELF%T%P   => YDCPG_SL1%TF9%P 
      SELF%T%F_P => YDCPG_SL1%TF9%F_P
    ELSE
      SELF%T%P   => YDCPG_SL1%T9%P 
      SELF%T%F_P => YDCPG_SL1%T9%F_P
    ENDIF
  ENDIF
  ! * vertical divergence
  IF (YDDYN%NSVDLAG == 4) THEN
    SELF%SVD%P   => YDCPG_SL1%VD0%P
    SELF%SVD%F_P => YDCPG_SL1%VD0%F_P
  ELSE
    IF (YDDYN%NSPLTHOI /= 0) THEN
      SELF%SVD%P   => YDCPG_SL1%VDF9%P
      SELF%SVD%F_P => YDCPG_SL1%VDF9%F_P
    ELSE
      SELF%SVD%P   => YDCPG_SL1%VD9%P
      SELF%SVD%F_P => YDCPG_SL1%VD9%F_P
    ENDIF
  ENDIF

  SELF%SP%P   => YDCPG_SL1%SP9%P
  SELF%SP%F_P => YDCPG_SL1%SP9%F_P

  ! * GFL arrays
  IF (YDDYN%LSPLTHOIGFL.OR.(YDDYN%NSPLTHOI /= 0)) THEN
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%Q, SELF%Q, YDCPG_SL1%Q)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%I, SELF%I, YDCPG_SL1%I)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%L, SELF%L, YDCPG_SL1%L)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%IMF, SELF%IMF, YDCPG_SL1%IMF)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%LMF, SELF%LMF, YDCPG_SL1%LMF)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%LCONV, SELF%LCONV, YDCPG_SL1%LCONV)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%ICONV, SELF%ICONV, YDCPG_SL1%ICONV)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%RCONV, SELF%RCONV, YDCPG_SL1%RCONV)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%SCONV, SELF%SCONV, YDCPG_SL1%SCONV)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%IRAD, SELF%IRAD, YDCPG_SL1%IRAD)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%LRAD, SELF%LRAD, YDCPG_SL1%LRAD)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%S, SELF%S, YDCPG_SL1%S)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%R, SELF%R, YDCPG_SL1%R)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%G, SELF%G, YDCPG_SL1%G)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%H, SELF%H, YDCPG_SL1%H)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%TKE, SELF%TKE, YDCPG_SL1%TKE)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%TTE, SELF%TTE, YDCPG_SL1%TTE)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%EFB1, SELF%EFB1, YDCPG_SL1%EFB1)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%EFB2, SELF%EFB2, YDCPG_SL1%EFB2)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%EFB3, SELF%EFB3, YDCPG_SL1%EFB3)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%A, SELF%A, YDCPG_SL1%A)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%AMF, SELF%AMF, YDCPG_SL1%AMF)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%O3, SELF%O3, YDCPG_SL1%O3)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%SRC, SELF%SRC, YDCPG_SL1%SRC)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%MXL, SELF%MXL, YDCPG_SL1%MXL)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%SHTUR, SELF%SHTUR, YDCPG_SL1%SHTUR)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%FQTUR, SELF%FQTUR, YDCPG_SL1%FQTUR)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%FSTUR, SELF%FSTUR, YDCPG_SL1%FSTUR)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%CPF, SELF%CPF, YDCPG_SL1%CPF)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%SPF, SELF%SPF, YDCPG_SL1%SPF)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%CVGQ, SELF%CVGQ, YDCPG_SL1%CVGQ)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%QVA, SELF%QVA, YDCPG_SL1%QVA)
    IF (ALLOCATED (YDVARS%GHG)) THEN
      ALLOCATE (SELF%GHG (SIZE (YDVARS%GHG)))
      DO JGFL = 1, SIZE (YDVARS%GHG)
        CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%GHG(JGFL), SELF%GHG(JGFL), YDCPG_SL1%GHG(JGFL))
      ENDDO
    ENDIF
    IF (ALLOCATED (YDVARS%CHEM)) THEN
      ALLOCATE (SELF%CHEM (SIZE (YDVARS%CHEM)))
      DO JGFL = 1, SIZE (YDVARS%CHEM)
        CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%CHEM(JGFL), SELF%CHEM(JGFL), YDCPG_SL1%CHEM(JGFL))
      ENDDO
    ENDIF
    IF (ALLOCATED (YDVARS%AERO)) THEN
      ALLOCATE (SELF%AERO (SIZE (YDVARS%AERO)))
      DO JGFL = 1, SIZE (YDVARS%AERO)
        CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%AERO(JGFL), SELF%AERO(JGFL), YDCPG_SL1%AERO(JGFL))
      ENDDO
    ENDIF
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%LRCH4, SELF%LRCH4, YDCPG_SL1%LRCH4)
    IF (ALLOCATED (YDVARS%FORC)) THEN
      ALLOCATE (SELF%FORC (SIZE (YDVARS%FORC)))
      DO JGFL = 1, SIZE (YDVARS%FORC)
        CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%FORC(JGFL), SELF%FORC(JGFL), YDCPG_SL1%FORC(JGFL))
      ENDDO
    ENDIF
    IF (ALLOCATED (YDVARS%EZDIAG)) THEN
      ALLOCATE (SELF%EZDIAG (SIZE (YDVARS%EZDIAG)))
      DO JGFL = 1, SIZE (YDVARS%EZDIAG)
        CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%EZDIAG(JGFL), SELF%EZDIAG(JGFL), YDCPG_SL1%EZDIAG(JGFL))
      ENDDO
    ENDIF
    IF (ALLOCATED (YDVARS%ERA40)) THEN
      ALLOCATE (SELF%ERA40 (SIZE (YDVARS%ERA40)))
      DO JGFL = 1, SIZE (YDVARS%ERA40)
        CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%ERA40(JGFL), SELF%ERA40(JGFL), YDCPG_SL1%ERA40(JGFL))
      ENDDO
    ENDIF
    IF (ALLOCATED (YDVARS%NOGW)) THEN
      ALLOCATE (SELF%NOGW (SIZE (YDVARS%NOGW)))
      DO JGFL = 1, SIZE (YDVARS%NOGW)
        CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%NOGW(JGFL), SELF%NOGW(JGFL), YDCPG_SL1%NOGW(JGFL))
      ENDDO
    ENDIF
    IF (ALLOCATED (YDVARS%EMIS3D)) THEN
      ALLOCATE (SELF%EMIS3D (SIZE (YDVARS%EMIS3D)))
      DO JGFL = 1, SIZE (YDVARS%EMIS3D)
        CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%EMIS3D(JGFL), SELF%EMIS3D(JGFL), YDCPG_SL1%EMIS3D(JGFL))
      ENDDO
    ENDIF
    IF (ALLOCATED (YDVARS%EDRP)) THEN
      ALLOCATE (SELF%EDRP (SIZE (YDVARS%EDRP)))
      DO JGFL = 1, SIZE (YDVARS%EDRP)
        CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%EDRP(JGFL), SELF%EDRP(JGFL), YDCPG_SL1%EDRP(JGFL))
      ENDDO
    ENDIF
    IF (ALLOCATED (YDVARS%SLDIA)) THEN
      ALLOCATE (SELF%SLDIA (SIZE (YDVARS%SLDIA)))
      DO JGFL = 1, SIZE (YDVARS%SLDIA)
        CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%SLDIA(JGFL), SELF%SLDIA(JGFL), YDCPG_SL1%SLDIA(JGFL))
      ENDDO
    ENDIF
    IF (ALLOCATED (YDVARS%AERAOT)) THEN
      ALLOCATE (SELF%AERAOT (SIZE (YDVARS%AERAOT)))
      DO JGFL = 1, SIZE (YDVARS%AERAOT)
        CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%AERAOT(JGFL), SELF%AERAOT(JGFL), YDCPG_SL1%AERAOT(JGFL))
      ENDDO
    ENDIF
    IF (ALLOCATED (YDVARS%AERLISI)) THEN
      ALLOCATE (SELF%AERLISI (SIZE (YDVARS%AERLISI)))
      DO JGFL = 1, SIZE (YDVARS%AERLISI)
        CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%AERLISI(JGFL), SELF%AERLISI(JGFL), YDCPG_SL1%AERLISI(JGFL))
      ENDDO
    ENDIF
    IF (ALLOCATED (YDVARS%AEROUT)) THEN
      ALLOCATE (SELF%AEROUT (SIZE (YDVARS%AEROUT)))
      DO JGFL = 1, SIZE (YDVARS%AEROUT)
        CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%AEROUT(JGFL), SELF%AEROUT(JGFL), YDCPG_SL1%AEROUT(JGFL))
      ENDDO
    ENDIF
    IF (ALLOCATED (YDVARS%AEROCLIM)) THEN
      ALLOCATE (SELF%AEROCLIM (SIZE (YDVARS%AEROCLIM)))
      DO JGFL = 1, SIZE (YDVARS%AEROCLIM)
        CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%AEROCLIM(JGFL), SELF%AEROCLIM(JGFL), YDCPG_SL1%AEROCLIM(JGFL))
      ENDDO
    ENDIF
    IF (ALLOCATED (YDVARS%UVP)) THEN
      ALLOCATE (SELF%UVP (SIZE (YDVARS%UVP)))
      DO JGFL = 1, SIZE (YDVARS%UVP)
        CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%UVP(JGFL), SELF%UVP(JGFL), YDCPG_SL1%UVP(JGFL))
      ENDDO
    ENDIF
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%PHYCTY, SELF%PHYCTY, YDCPG_SL1%PHYCTY)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%RSPEC, SELF%RSPEC, YDCPG_SL1%RSPEC)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%SDSAT, SELF%SDSAT, YDCPG_SL1%SDSAT)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%CVV, SELF%CVV, YDCPG_SL1%CVV)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%RKTH, SELF%RKTH, YDCPG_SL1%RKTH)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%RKTQV, SELF%RKTQV, YDCPG_SL1%RKTQV)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%RKTQC, SELF%RKTQC, YDCPG_SL1%RKTQC)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%UOM, SELF%UOM, YDCPG_SL1%UOM)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%UAL, SELF%UAL, YDCPG_SL1%UAL)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%DOM, SELF%DOM, YDCPG_SL1%DOM)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%DAL, SELF%DAL, YDCPG_SL1%DAL)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%UEN, SELF%UEN, YDCPG_SL1%UEN)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%UNEBH, SELF%UNEBH, YDCPG_SL1%UNEBH)
    IF (ALLOCATED (YDVARS%LIMA)) THEN
      ALLOCATE (SELF%LIMA (SIZE (YDVARS%LIMA)))
      DO JGFL = 1, SIZE (YDVARS%LIMA)
        CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%LIMA(JGFL), SELF%LIMA(JGFL), YDCPG_SL1%LIMA(JGFL))
      ENDDO
    ENDIF
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%FSD, SELF%FSD, YDCPG_SL1%FSD)
    IF (ALLOCATED (YDVARS%EXT)) THEN
      ALLOCATE (SELF%EXT (SIZE (YDVARS%EXT)))
      DO JGFL = 1, SIZE (YDVARS%EXT)
        CALL MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDVARS%EXT(JGFL), SELF%EXT(JGFL), YDCPG_SL1%EXT(JGFL))
      ENDDO
    ENDIF
  ELSE
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%Q, SELF%Q, YDCPG_SL1%Q)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%I, SELF%I, YDCPG_SL1%I)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%L, SELF%L, YDCPG_SL1%L)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%IMF, SELF%IMF, YDCPG_SL1%IMF)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%LMF, SELF%LMF, YDCPG_SL1%LMF)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%LCONV, SELF%LCONV, YDCPG_SL1%LCONV)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%ICONV, SELF%ICONV, YDCPG_SL1%ICONV)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%RCONV, SELF%RCONV, YDCPG_SL1%RCONV)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%SCONV, SELF%SCONV, YDCPG_SL1%SCONV)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%IRAD, SELF%IRAD, YDCPG_SL1%IRAD)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%LRAD, SELF%LRAD, YDCPG_SL1%LRAD)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%S, SELF%S, YDCPG_SL1%S)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%R, SELF%R, YDCPG_SL1%R)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%G, SELF%G, YDCPG_SL1%G)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%H, SELF%H, YDCPG_SL1%H)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%TKE, SELF%TKE, YDCPG_SL1%TKE)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%TTE, SELF%TTE, YDCPG_SL1%TTE)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%EFB1, SELF%EFB1, YDCPG_SL1%EFB1)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%EFB2, SELF%EFB2, YDCPG_SL1%EFB2)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%EFB3, SELF%EFB3, YDCPG_SL1%EFB3)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%A, SELF%A, YDCPG_SL1%A)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%AMF, SELF%AMF, YDCPG_SL1%AMF)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%O3, SELF%O3, YDCPG_SL1%O3)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%SRC, SELF%SRC, YDCPG_SL1%SRC)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%MXL, SELF%MXL, YDCPG_SL1%MXL)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%SHTUR, SELF%SHTUR, YDCPG_SL1%SHTUR)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%FQTUR, SELF%FQTUR, YDCPG_SL1%FQTUR)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%FSTUR, SELF%FSTUR, YDCPG_SL1%FSTUR)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%CPF, SELF%CPF, YDCPG_SL1%CPF)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%SPF, SELF%SPF, YDCPG_SL1%SPF)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%CVGQ, SELF%CVGQ, YDCPG_SL1%CVGQ)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%QVA, SELF%QVA, YDCPG_SL1%QVA)
    IF (ALLOCATED (YDVARS%GHG)) THEN
      ALLOCATE (SELF%GHG (SIZE (YDVARS%GHG)))
      DO JGFL = 1, SIZE (YDVARS%GHG)
        CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%GHG(JGFL), SELF%GHG(JGFL), YDCPG_SL1%GHG(JGFL))
      ENDDO
    ENDIF
    IF (ALLOCATED (YDVARS%CHEM)) THEN
      ALLOCATE (SELF%CHEM (SIZE (YDVARS%CHEM)))
      DO JGFL = 1, SIZE (YDVARS%CHEM)
        CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%CHEM(JGFL), SELF%CHEM(JGFL), YDCPG_SL1%CHEM(JGFL))
      ENDDO
    ENDIF
    IF (ALLOCATED (YDVARS%AERO)) THEN
      ALLOCATE (SELF%AERO (SIZE (YDVARS%AERO)))
      DO JGFL = 1, SIZE (YDVARS%AERO)
        CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%AERO(JGFL), SELF%AERO(JGFL), YDCPG_SL1%AERO(JGFL))
      ENDDO
    ENDIF
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%LRCH4, SELF%LRCH4, YDCPG_SL1%LRCH4)
    IF (ALLOCATED (YDVARS%FORC)) THEN
      ALLOCATE (SELF%FORC (SIZE (YDVARS%FORC)))
      DO JGFL = 1, SIZE (YDVARS%FORC)
        CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%FORC(JGFL), SELF%FORC(JGFL), YDCPG_SL1%FORC(JGFL))
      ENDDO
    ENDIF
    IF (ALLOCATED (YDVARS%EZDIAG)) THEN
      ALLOCATE (SELF%EZDIAG (SIZE (YDVARS%EZDIAG)))
      DO JGFL = 1, SIZE (YDVARS%EZDIAG)
        CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%EZDIAG(JGFL), SELF%EZDIAG(JGFL), YDCPG_SL1%EZDIAG(JGFL))
      ENDDO
    ENDIF
    IF (ALLOCATED (YDVARS%ERA40)) THEN
      ALLOCATE (SELF%ERA40 (SIZE (YDVARS%ERA40)))
      DO JGFL = 1, SIZE (YDVARS%ERA40)
        CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%ERA40(JGFL), SELF%ERA40(JGFL), YDCPG_SL1%ERA40(JGFL))
      ENDDO
    ENDIF
    IF (ALLOCATED (YDVARS%NOGW)) THEN
      ALLOCATE (SELF%NOGW (SIZE (YDVARS%NOGW)))
      DO JGFL = 1, SIZE (YDVARS%NOGW)
        CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%NOGW(JGFL), SELF%NOGW(JGFL), YDCPG_SL1%NOGW(JGFL))
      ENDDO
    ENDIF
    IF (ALLOCATED (YDVARS%EMIS3D)) THEN
      ALLOCATE (SELF%EMIS3D (SIZE (YDVARS%EMIS3D)))
      DO JGFL = 1, SIZE (YDVARS%EMIS3D)
        CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%EMIS3D(JGFL), SELF%EMIS3D(JGFL), YDCPG_SL1%EMIS3D(JGFL))
      ENDDO
    ENDIF
    IF (ALLOCATED (YDVARS%EDRP)) THEN
      ALLOCATE (SELF%EDRP (SIZE (YDVARS%EDRP)))
      DO JGFL = 1, SIZE (YDVARS%EDRP)
        CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%EDRP(JGFL), SELF%EDRP(JGFL), YDCPG_SL1%EDRP(JGFL))
      ENDDO
    ENDIF
    IF (ALLOCATED (YDVARS%SLDIA)) THEN
      ALLOCATE (SELF%SLDIA (SIZE (YDVARS%SLDIA)))
      DO JGFL = 1, SIZE (YDVARS%SLDIA)
        CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%SLDIA(JGFL), SELF%SLDIA(JGFL), YDCPG_SL1%SLDIA(JGFL))
      ENDDO
    ENDIF
    IF (ALLOCATED (YDVARS%AERAOT)) THEN
      ALLOCATE (SELF%AERAOT (SIZE (YDVARS%AERAOT)))
      DO JGFL = 1, SIZE (YDVARS%AERAOT)
        CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%AERAOT(JGFL), SELF%AERAOT(JGFL), YDCPG_SL1%AERAOT(JGFL))
      ENDDO
    ENDIF
    IF (ALLOCATED (YDVARS%AERLISI)) THEN
      ALLOCATE (SELF%AERLISI (SIZE (YDVARS%AERLISI)))
      DO JGFL = 1, SIZE (YDVARS%AERLISI)
        CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%AERLISI(JGFL), SELF%AERLISI(JGFL), YDCPG_SL1%AERLISI(JGFL))
      ENDDO
    ENDIF
    IF (ALLOCATED (YDVARS%AEROUT)) THEN
      ALLOCATE (SELF%AEROUT (SIZE (YDVARS%AEROUT)))
      DO JGFL = 1, SIZE (YDVARS%AEROUT)
        CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%AEROUT(JGFL), SELF%AEROUT(JGFL), YDCPG_SL1%AEROUT(JGFL))
      ENDDO
    ENDIF
    IF (ALLOCATED (YDVARS%AEROCLIM)) THEN
      ALLOCATE (SELF%AEROCLIM (SIZE (YDVARS%AEROCLIM)))
      DO JGFL = 1, SIZE (YDVARS%AEROCLIM)
        CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%AEROCLIM(JGFL), SELF%AEROCLIM(JGFL), YDCPG_SL1%AEROCLIM(JGFL))
      ENDDO
    ENDIF
    IF (ALLOCATED (YDVARS%UVP)) THEN
      ALLOCATE (SELF%UVP (SIZE (YDVARS%UVP)))
      DO JGFL = 1, SIZE (YDVARS%UVP)
        CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%UVP(JGFL), SELF%UVP(JGFL), YDCPG_SL1%UVP(JGFL))
      ENDDO
    ENDIF
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%PHYCTY, SELF%PHYCTY, YDCPG_SL1%PHYCTY)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%RSPEC, SELF%RSPEC, YDCPG_SL1%RSPEC)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%SDSAT, SELF%SDSAT, YDCPG_SL1%SDSAT)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%CVV, SELF%CVV, YDCPG_SL1%CVV)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%RKTH, SELF%RKTH, YDCPG_SL1%RKTH)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%RKTQV, SELF%RKTQV, YDCPG_SL1%RKTQV)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%RKTQC, SELF%RKTQC, YDCPG_SL1%RKTQC)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%UOM, SELF%UOM, YDCPG_SL1%UOM)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%UAL, SELF%UAL, YDCPG_SL1%UAL)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%DOM, SELF%DOM, YDCPG_SL1%DOM)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%DAL, SELF%DAL, YDCPG_SL1%DAL)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%UEN, SELF%UEN, YDCPG_SL1%UEN)
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%UNEBH, SELF%UNEBH, YDCPG_SL1%UNEBH)
    IF (ALLOCATED (YDVARS%LIMA)) THEN
      ALLOCATE (SELF%LIMA (SIZE (YDVARS%LIMA)))
      DO JGFL = 1, SIZE (YDVARS%LIMA)
        CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%LIMA(JGFL), SELF%LIMA(JGFL), YDCPG_SL1%LIMA(JGFL))
      ENDDO
    ENDIF
    CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%FSD, SELF%FSD, YDCPG_SL1%FSD)
    IF (ALLOCATED (YDVARS%EXT)) THEN
      ALLOCATE (SELF%EXT (SIZE (YDVARS%EXT)))
      DO JGFL = 1, SIZE (YDVARS%EXT)
        CALL MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDVARS%EXT(JGFL), SELF%EXT(JGFL), YDCPG_SL1%EXT(JGFL))
      ENDDO
    ENDIF
  ENDIF  

ELSE

  SELF%U%P     => YDVARS%U%T1
  SELF%U%F_P   => YDVARS%U%FT1
  SELF%V%P     => YDVARS%V%T1
  SELF%V%F_P   => YDVARS%V%FT1
  SELF%T%P     => YDVARS%T%T1
  SELF%T%F_P   => YDVARS%T%FT1
  SELF%SVD%P   => YDVARS%SVD%T1
  SELF%SVD%F_P => YDVARS%SVD%FT1
  SELF%SP%P    => YDVARS%SP%T1
  SELF%SP%F_P  => YDVARS%SP%FT1

  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%Q, SELF%Q)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%I, SELF%I)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%L, SELF%L)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%IMF, SELF%IMF)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%LMF, SELF%LMF)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%LCONV, SELF%LCONV)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%ICONV, SELF%ICONV)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%RCONV, SELF%RCONV)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%SCONV, SELF%SCONV)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%IRAD, SELF%IRAD)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%LRAD, SELF%LRAD)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%S, SELF%S)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%R, SELF%R)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%G, SELF%G)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%H, SELF%H)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%TKE, SELF%TKE)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%TTE, SELF%TTE)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%EFB1, SELF%EFB1)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%EFB2, SELF%EFB2)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%EFB3, SELF%EFB3)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%A, SELF%A)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%AMF, SELF%AMF)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%O3, SELF%O3)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%SRC, SELF%SRC)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%MXL, SELF%MXL)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%SHTUR, SELF%SHTUR)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%FQTUR, SELF%FQTUR)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%FSTUR, SELF%FSTUR)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%CPF, SELF%CPF)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%SPF, SELF%SPF)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%CVGQ, SELF%CVGQ)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%QVA, SELF%QVA)
  IF (ALLOCATED (YDVARS%GHG)) THEN
    ALLOCATE (SELF%GHG (SIZE (YDVARS%GHG)))
    DO JGFL = 1, SIZE (YDVARS%GHG)
      CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%GHG(JGFL), SELF%GHG(JGFL))
    ENDDO
  ENDIF
  IF (ALLOCATED (YDVARS%CHEM)) THEN
    ALLOCATE (SELF%CHEM (SIZE (YDVARS%CHEM)))
    DO JGFL = 1, SIZE (YDVARS%CHEM)
      CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%CHEM(JGFL), SELF%CHEM(JGFL))
    ENDDO
  ENDIF
  IF (ALLOCATED (YDVARS%AERO)) THEN
    ALLOCATE (SELF%AERO (SIZE (YDVARS%AERO)))
    DO JGFL = 1, SIZE (YDVARS%AERO)
      CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%AERO(JGFL), SELF%AERO(JGFL))
    ENDDO
  ENDIF
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%LRCH4, SELF%LRCH4)
  IF (ALLOCATED (YDVARS%FORC)) THEN
    ALLOCATE (SELF%FORC (SIZE (YDVARS%FORC)))
    DO JGFL = 1, SIZE (YDVARS%FORC)
      CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%FORC(JGFL), SELF%FORC(JGFL))
    ENDDO
  ENDIF
  IF (ALLOCATED (YDVARS%EZDIAG)) THEN
    ALLOCATE (SELF%EZDIAG (SIZE (YDVARS%EZDIAG)))
    DO JGFL = 1, SIZE (YDVARS%EZDIAG)
      CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%EZDIAG(JGFL), SELF%EZDIAG(JGFL))
    ENDDO
  ENDIF
  IF (ALLOCATED (YDVARS%ERA40)) THEN
    ALLOCATE (SELF%ERA40 (SIZE (YDVARS%ERA40)))
    DO JGFL = 1, SIZE (YDVARS%ERA40)
      CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%ERA40(JGFL), SELF%ERA40(JGFL))
    ENDDO
  ENDIF
  IF (ALLOCATED (YDVARS%NOGW)) THEN
    ALLOCATE (SELF%NOGW (SIZE (YDVARS%NOGW)))
    DO JGFL = 1, SIZE (YDVARS%NOGW)
      CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%NOGW(JGFL), SELF%NOGW(JGFL))
    ENDDO
  ENDIF
  IF (ALLOCATED (YDVARS%EMIS3D)) THEN
    ALLOCATE (SELF%EMIS3D (SIZE (YDVARS%EMIS3D)))
    DO JGFL = 1, SIZE (YDVARS%EMIS3D)
      CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%EMIS3D(JGFL), SELF%EMIS3D(JGFL))
    ENDDO
  ENDIF
  IF (ALLOCATED (YDVARS%EDRP)) THEN
    ALLOCATE (SELF%EDRP (SIZE (YDVARS%EDRP)))
    DO JGFL = 1, SIZE (YDVARS%EDRP)
      CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%EDRP(JGFL), SELF%EDRP(JGFL))
    ENDDO
  ENDIF
  IF (ALLOCATED (YDVARS%SLDIA)) THEN
    ALLOCATE (SELF%SLDIA (SIZE (YDVARS%SLDIA)))
    DO JGFL = 1, SIZE (YDVARS%SLDIA)
      CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%SLDIA(JGFL), SELF%SLDIA(JGFL))
    ENDDO
  ENDIF
  IF (ALLOCATED (YDVARS%AERAOT)) THEN
    ALLOCATE (SELF%AERAOT (SIZE (YDVARS%AERAOT)))
    DO JGFL = 1, SIZE (YDVARS%AERAOT)
      CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%AERAOT(JGFL), SELF%AERAOT(JGFL))
    ENDDO
  ENDIF
  IF (ALLOCATED (YDVARS%AERLISI)) THEN
    ALLOCATE (SELF%AERLISI (SIZE (YDVARS%AERLISI)))
    DO JGFL = 1, SIZE (YDVARS%AERLISI)
      CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%AERLISI(JGFL), SELF%AERLISI(JGFL))
    ENDDO
  ENDIF
  IF (ALLOCATED (YDVARS%AEROUT)) THEN
    ALLOCATE (SELF%AEROUT (SIZE (YDVARS%AEROUT)))
    DO JGFL = 1, SIZE (YDVARS%AEROUT)
      CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%AEROUT(JGFL), SELF%AEROUT(JGFL))
    ENDDO
  ENDIF
  IF (ALLOCATED (YDVARS%AEROCLIM)) THEN
    ALLOCATE (SELF%AEROCLIM (SIZE (YDVARS%AEROCLIM)))
    DO JGFL = 1, SIZE (YDVARS%AEROCLIM)
      CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%AEROCLIM(JGFL), SELF%AEROCLIM(JGFL))
    ENDDO
  ENDIF
  IF (ALLOCATED (YDVARS%UVP)) THEN
    ALLOCATE (SELF%UVP (SIZE (YDVARS%UVP)))
    DO JGFL = 1, SIZE (YDVARS%UVP)
      CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%UVP(JGFL), SELF%UVP(JGFL))
    ENDDO
  ENDIF
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%PHYCTY, SELF%PHYCTY)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%RSPEC, SELF%RSPEC)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%SDSAT, SELF%SDSAT)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%CVV, SELF%CVV)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%RKTH, SELF%RKTH)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%RKTQV, SELF%RKTQV)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%RKTQC, SELF%RKTQC)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%UOM, SELF%UOM)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%UAL, SELF%UAL)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%DOM, SELF%DOM)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%DAL, SELF%DAL)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%UEN, SELF%UEN)
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%UNEBH, SELF%UNEBH)
  IF (ALLOCATED (YDVARS%LIMA)) THEN
    ALLOCATE (SELF%LIMA (SIZE (YDVARS%LIMA)))
    DO JGFL = 1, SIZE (YDVARS%LIMA)
      CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%LIMA(JGFL), SELF%LIMA(JGFL))
    ENDDO
  ENDIF
  CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%FSD, SELF%FSD)
  IF (ALLOCATED (YDVARS%EXT)) THEN
    ALLOCATE (SELF%EXT (SIZE (YDVARS%EXT)))
    DO JGFL = 1, SIZE (YDVARS%EXT)
      CALL MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDVARS%EXT(JGFL), SELF%EXT(JGFL))
    ENDDO
  ENDIF

ENDIF

END ASSOCIATE

CONTAINS

SUBROUTINE MF_PHYS_NEXT_STATE_TYPE_INIT_EUL_3D (YDV3D, YDN3D)

USE VARIABLE_MODULE, ONLY: VARIABLE_3RB

TYPE (VARIABLE_3RB),               INTENT (IN)    :: YDV3D
TYPE (MF_PHYS_NEXT_STATE_3D_TYPE), INTENT (INOUT) :: YDN3D

YDN3D%P   => YDV3D%T1
YDN3D%F_P => YDV3D%FT1

END SUBROUTINE 

SUBROUTINE MF_PHYS_NEXT_STATE_TYPE_INIT_3D (YDV3D, YDN3D, YDF3D)

USE CPG_SL1_TYPE_MOD, ONLY : CPG_SL1B_3D_TYPE
USE VARIABLE_MODULE , ONLY : VARIABLE_3RB

TYPE (VARIABLE_3RB),               INTENT (IN)    :: YDV3D
TYPE (MF_PHYS_NEXT_STATE_3D_TYPE), INTENT (INOUT) :: YDN3D
TYPE (CPG_SL1B_3D_TYPE),           INTENT (IN)    :: YDF3D

IF (YDV3D%LADV) THEN
  YDN3D%P   => YDF3D%P
  YDN3D%F_P => YDF3D%F_P
ELSE
  YDN3D%P   => YDV3D%T1
  YDN3D%F_P => YDV3D%FT1
ENDIF

END SUBROUTINE 

SUBROUTINE MF_PHYS_NEXT_STATE_TYPE_INIT_SPLTHOI_3D (YDV3D, YDN3D, YDF3D)

USE CPG_SL1_TYPE_MOD, ONLY : CPG_SL1B_3D_TYPE
USE VARIABLE_MODULE , ONLY : VARIABLE_3RB

TYPE (VARIABLE_3RB),               INTENT (IN)    :: YDV3D
TYPE (MF_PHYS_NEXT_STATE_3D_TYPE), INTENT (INOUT) :: YDN3D
TYPE (CPG_SL1B_3D_TYPE),           INTENT (IN)    :: YDF3D

IF (YDV3D%LADV) THEN
  YDN3D%P   => YDF3D%P_F
  YDN3D%F_P => YDF3D%F_P_F
ELSE
  YDN3D%P   => YDV3D%T1
  YDN3D%F_P => YDV3D%FT1
ENDIF

END SUBROUTINE

END SUBROUTINE MF_PHYS_NEXT_STATE_TYPE_INIT

SUBROUTINE MF_PHYS_NEXT_STATE_TYPE_UPDATE_VIEW (SELF, BLOCK_INDEX)
CLASS (MF_PHYS_NEXT_STATE_TYPE)              :: SELF
INTEGER(KIND=JPIM), INTENT (IN)   :: BLOCK_INDEX

INTEGER (KIND=JPIM) :: JGFL

IF (ASSOCIATED (SELF%U%F_P)) THEN
  SELF%U%P => SELF%U%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF

IF (ASSOCIATED (SELF%V%F_P)) THEN
  SELF%V%P => SELF%V%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF

IF (ASSOCIATED (SELF%T%F_P)) THEN
  SELF%T%P => SELF%T%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF

IF (ASSOCIATED (SELF%SVD%F_P)) THEN
  SELF%SVD%P => SELF%SVD%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF

IF (ASSOCIATED (SELF%SP%F_P)) THEN
  SELF%SP%P => SELF%SP%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF

IF (ASSOCIATED (SELF%Q%F_P)) THEN
  SELF%Q%P => SELF%Q%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%I%F_P)) THEN
  SELF%I%P => SELF%I%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%L%F_P)) THEN
  SELF%L%P => SELF%L%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%IMF%F_P)) THEN
  SELF%IMF%P => SELF%IMF%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%LMF%F_P)) THEN
  SELF%LMF%P => SELF%LMF%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%LCONV%F_P)) THEN
  SELF%LCONV%P => SELF%LCONV%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%ICONV%F_P)) THEN
  SELF%ICONV%P => SELF%ICONV%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%RCONV%F_P)) THEN
  SELF%RCONV%P => SELF%RCONV%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%SCONV%F_P)) THEN
  SELF%SCONV%P => SELF%SCONV%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%IRAD%F_P)) THEN
  SELF%IRAD%P => SELF%IRAD%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%LRAD%F_P)) THEN
  SELF%LRAD%P => SELF%LRAD%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%S%F_P)) THEN
  SELF%S%P => SELF%S%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%R%F_P)) THEN
  SELF%R%P => SELF%R%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%G%F_P)) THEN
  SELF%G%P => SELF%G%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%H%F_P)) THEN
  SELF%H%P => SELF%H%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%TKE%F_P)) THEN
  SELF%TKE%P => SELF%TKE%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%TTE%F_P)) THEN
  SELF%TTE%P => SELF%TTE%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%EFB1%F_P)) THEN
  SELF%EFB1%P => SELF%EFB1%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%EFB2%F_P)) THEN
  SELF%EFB2%P => SELF%EFB2%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%EFB3%F_P)) THEN
  SELF%EFB3%P => SELF%EFB3%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%A%F_P)) THEN
  SELF%A%P => SELF%A%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%AMF%F_P)) THEN
  SELF%AMF%P => SELF%AMF%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%O3%F_P)) THEN
  SELF%O3%P => SELF%O3%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%SRC%F_P)) THEN
  SELF%SRC%P => SELF%SRC%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%MXL%F_P)) THEN
  SELF%MXL%P => SELF%MXL%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%SHTUR%F_P)) THEN
  SELF%SHTUR%P => SELF%SHTUR%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%FQTUR%F_P)) THEN
  SELF%FQTUR%P => SELF%FQTUR%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%FSTUR%F_P)) THEN
  SELF%FSTUR%P => SELF%FSTUR%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%CPF%F_P)) THEN
  SELF%CPF%P => SELF%CPF%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%SPF%F_P)) THEN
  SELF%SPF%P => SELF%SPF%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%CVGQ%F_P)) THEN
  SELF%CVGQ%P => SELF%CVGQ%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%QVA%F_P)) THEN
  SELF%QVA%P => SELF%QVA%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ALLOCATED (SELF%GHG)) THEN
  DO JGFL = 1, SIZE (SELF%GHG)
    IF (ASSOCIATED (SELF%GHG(JGFL)%F_P)) THEN
      SELF%GHG(JGFL)%P => SELF%GHG(JGFL)%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ENDDO
ENDIF
IF (ALLOCATED (SELF%CHEM)) THEN
  DO JGFL = 1, SIZE (SELF%CHEM)
    IF (ASSOCIATED (SELF%CHEM(JGFL)%F_P)) THEN
      SELF%CHEM(JGFL)%P => SELF%CHEM(JGFL)%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ENDDO
ENDIF
IF (ALLOCATED (SELF%AERO)) THEN
  DO JGFL = 1, SIZE (SELF%AERO)
    IF (ASSOCIATED (SELF%AERO(JGFL)%F_P)) THEN
      SELF%AERO(JGFL)%P => SELF%AERO(JGFL)%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ENDDO
ENDIF
IF (ASSOCIATED (SELF%LRCH4%F_P)) THEN
  SELF%LRCH4%P => SELF%LRCH4%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ALLOCATED (SELF%FORC)) THEN
  DO JGFL = 1, SIZE (SELF%FORC)
    IF (ASSOCIATED (SELF%FORC(JGFL)%F_P)) THEN
      SELF%FORC(JGFL)%P => SELF%FORC(JGFL)%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ENDDO
ENDIF
IF (ALLOCATED (SELF%EZDIAG)) THEN
  DO JGFL = 1, SIZE (SELF%EZDIAG)
    IF (ASSOCIATED (SELF%EZDIAG(JGFL)%F_P)) THEN
      SELF%EZDIAG(JGFL)%P => SELF%EZDIAG(JGFL)%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ENDDO
ENDIF
IF (ALLOCATED (SELF%ERA40)) THEN
  DO JGFL = 1, SIZE (SELF%ERA40)
    IF (ASSOCIATED (SELF%ERA40(JGFL)%F_P)) THEN
      SELF%ERA40(JGFL)%P => SELF%ERA40(JGFL)%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ENDDO
ENDIF
IF (ALLOCATED (SELF%NOGW)) THEN
  DO JGFL = 1, SIZE (SELF%NOGW)
    IF (ASSOCIATED (SELF%NOGW(JGFL)%F_P)) THEN
      SELF%NOGW(JGFL)%P => SELF%NOGW(JGFL)%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ENDDO
ENDIF
IF (ALLOCATED (SELF%EMIS3D)) THEN
  DO JGFL = 1, SIZE (SELF%EMIS3D)
    IF (ASSOCIATED (SELF%EMIS3D(JGFL)%F_P)) THEN
      SELF%EMIS3D(JGFL)%P => SELF%EMIS3D(JGFL)%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ENDDO
ENDIF
IF (ALLOCATED (SELF%EDRP)) THEN
  DO JGFL = 1, SIZE (SELF%EDRP)
    IF (ASSOCIATED (SELF%EDRP(JGFL)%F_P)) THEN
      SELF%EDRP(JGFL)%P => SELF%EDRP(JGFL)%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ENDDO
ENDIF
IF (ALLOCATED (SELF%SLDIA)) THEN
  DO JGFL = 1, SIZE (SELF%SLDIA)
    IF (ASSOCIATED (SELF%SLDIA(JGFL)%F_P)) THEN
      SELF%SLDIA(JGFL)%P => SELF%SLDIA(JGFL)%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ENDDO
ENDIF
IF (ALLOCATED (SELF%AERAOT)) THEN
  DO JGFL = 1, SIZE (SELF%AERAOT)
    IF (ASSOCIATED (SELF%AERAOT(JGFL)%F_P)) THEN
      SELF%AERAOT(JGFL)%P => SELF%AERAOT(JGFL)%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ENDDO
ENDIF
IF (ALLOCATED (SELF%AERLISI)) THEN
  DO JGFL = 1, SIZE (SELF%AERLISI)
    IF (ASSOCIATED (SELF%AERLISI(JGFL)%F_P)) THEN
      SELF%AERLISI(JGFL)%P => SELF%AERLISI(JGFL)%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ENDDO
ENDIF
IF (ALLOCATED (SELF%AEROUT)) THEN
  DO JGFL = 1, SIZE (SELF%AEROUT)
    IF (ASSOCIATED (SELF%AEROUT(JGFL)%F_P)) THEN
      SELF%AEROUT(JGFL)%P => SELF%AEROUT(JGFL)%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ENDDO
ENDIF
IF (ALLOCATED (SELF%AEROCLIM)) THEN
  DO JGFL = 1, SIZE (SELF%AEROCLIM)
    IF (ASSOCIATED (SELF%AEROCLIM(JGFL)%F_P)) THEN
      SELF%AEROCLIM(JGFL)%P => SELF%AEROCLIM(JGFL)%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ENDDO
ENDIF
IF (ALLOCATED (SELF%UVP)) THEN
  DO JGFL = 1, SIZE (SELF%UVP)
    IF (ASSOCIATED (SELF%UVP(JGFL)%F_P)) THEN
      SELF%UVP(JGFL)%P => SELF%UVP(JGFL)%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ENDDO
ENDIF
IF (ASSOCIATED (SELF%PHYCTY%F_P)) THEN
  SELF%PHYCTY%P => SELF%PHYCTY%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%RSPEC%F_P)) THEN
  SELF%RSPEC%P => SELF%RSPEC%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%SDSAT%F_P)) THEN
  SELF%SDSAT%P => SELF%SDSAT%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%CVV%F_P)) THEN
  SELF%CVV%P => SELF%CVV%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%RKTH%F_P)) THEN
  SELF%RKTH%P => SELF%RKTH%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%RKTQV%F_P)) THEN
  SELF%RKTQV%P => SELF%RKTQV%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%RKTQC%F_P)) THEN
  SELF%RKTQC%P => SELF%RKTQC%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%UOM%F_P)) THEN
  SELF%UOM%P => SELF%UOM%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%UAL%F_P)) THEN
  SELF%UAL%P => SELF%UAL%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%DOM%F_P)) THEN
  SELF%DOM%P => SELF%DOM%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%DAL%F_P)) THEN
  SELF%DAL%P => SELF%DAL%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%UEN%F_P)) THEN
  SELF%UEN%P => SELF%UEN%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ASSOCIATED (SELF%UNEBH%F_P)) THEN
  SELF%UNEBH%P => SELF%UNEBH%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ALLOCATED (SELF%LIMA)) THEN
  DO JGFL = 1, SIZE (SELF%LIMA)
    IF (ASSOCIATED (SELF%LIMA(JGFL)%F_P)) THEN
      SELF%LIMA(JGFL)%P => SELF%LIMA(JGFL)%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ENDDO
ENDIF
IF (ASSOCIATED (SELF%FSD%F_P)) THEN
  SELF%FSD%P => SELF%FSD%F_P%GET_VIEW (BLOCK_INDEX)
ENDIF
IF (ALLOCATED (SELF%EXT)) THEN
  DO JGFL = 1, SIZE (SELF%EXT)
    IF (ASSOCIATED (SELF%EXT(JGFL)%F_P)) THEN
      SELF%EXT(JGFL)%P => SELF%EXT(JGFL)%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ENDDO
ENDIF

END SUBROUTINE MF_PHYS_NEXT_STATE_TYPE_UPDATE_VIEW 

END MODULE MF_PHYS_NEXT_STATE_TYPE_MOD
