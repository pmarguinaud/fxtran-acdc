MODULE UTIL_SPP_PERT_MOD

USE spp_gen_mod, ONLY : SPP_PERT

INTERFACE SAVE
MODULE PROCEDURE SAVE_SPP_PERT
END INTERFACE

INTERFACE LOAD
MODULE PROCEDURE LOAD_SPP_PERT
END INTERFACE

INTERFACE COPY
MODULE PROCEDURE COPY_SPP_PERT
END INTERFACE

INTERFACE HOST
MODULE PROCEDURE HOST_SPP_PERT
END INTERFACE

     
INTERFACE CRC64
MODULE PROCEDURE CRC64_SPP_PERT
END INTERFACE

INTERFACE WIPE
MODULE PROCEDURE WIPE_SPP_PERT
END INTERFACE

INTERFACE SIZE
MODULE PROCEDURE SIZE_SPP_PERT
END INTERFACE


CONTAINS

SUBROUTINE SAVE_SPP_PERT (KLUN, YD)

IMPLICIT NONE
INTEGER, INTENT (IN) :: KLUN
TYPE (SPP_PERT), INTENT (IN), TARGET :: YD

WRITE (KLUN) YD%LABEL
WRITE (KLUN) YD%ON
WRITE (KLUN) YD%IDISTR
WRITE (KLUN) YD%XMAG
WRITE (KLUN) YD%MU
WRITE (KLUN) YD%XCLIPMIN
WRITE (KLUN) YD%XCLIPMAX
WRITE (KLUN) YD%XUNIFORM_OFFSET
WRITE (KLUN) YD%NMAG
WRITE (KLUN) YD%LN1
WRITE (KLUN) YD%NSEED_OFF
WRITE (KLUN) YD%NOFF
WRITE (KLUN) YD%NRF
WRITE (KLUN) YD%NRF_RADGRID
WRITE (KLUN) YD%RADGRID
WRITE (KLUN) YD%RF_PERT_LABEL
WRITE (KLUN) YD%IC
WRITE (KLUN) YD%MP
WRITE (KLUN) YD%MP_RADGRID
WRITE (KLUN) YD%TAU
WRITE (KLUN) YD%SDEV
WRITE (KLUN) YD%XLCOR
END SUBROUTINE

SUBROUTINE LOAD_SPP_PERT (KLUN, YD)
USE PARKIND1, ONLY : JPRD

IMPLICIT NONE
INTEGER, INTENT (IN) :: KLUN
TYPE (SPP_PERT), INTENT (OUT), TARGET :: YD
REAL(KIND=JPRD) :: ZTMP0
REAL(KIND=JPRD), ALLOCATABLE :: ZTMP1 (:)
READ (KLUN) YD%LABEL
READ (KLUN) YD%ON
READ (KLUN) YD%IDISTR
ALLOCATE (ZTMP1(LBOUND(YD%XMAG,1):UBOUND(YD%XMAG,1)))
READ (KLUN) ZTMP1
YD%XMAG = ZTMP1
DEALLOCATE (ZTMP1)
ALLOCATE (ZTMP1(LBOUND(YD%MU,1):UBOUND(YD%MU,1)))
READ (KLUN) ZTMP1
YD%MU = ZTMP1
DEALLOCATE (ZTMP1)
READ (KLUN) ZTMP0
YD%XCLIPMIN = ZTMP0
READ (KLUN) ZTMP0
YD%XCLIPMAX = ZTMP0
READ (KLUN) ZTMP0
YD%XUNIFORM_OFFSET = ZTMP0
READ (KLUN) YD%NMAG
READ (KLUN) YD%LN1
READ (KLUN) YD%NSEED_OFF
READ (KLUN) YD%NOFF
READ (KLUN) YD%NRF
READ (KLUN) YD%NRF_RADGRID
READ (KLUN) YD%RADGRID
READ (KLUN) YD%RF_PERT_LABEL
READ (KLUN) YD%IC
READ (KLUN) YD%MP
READ (KLUN) YD%MP_RADGRID
READ (KLUN) ZTMP0
YD%TAU = ZTMP0
READ (KLUN) ZTMP0
YD%SDEV = ZTMP0
READ (KLUN) ZTMP0
YD%XLCOR = ZTMP0
END SUBROUTINE


SUBROUTINE COPY_SPP_PERT (YD, LDCREATED, LDFIELDAPI)

IMPLICIT NONE
TYPE (SPP_PERT), INTENT (IN), TARGET :: YD
LOGICAL, OPTIONAL, INTENT (IN) :: LDCREATED, LDFIELDAPI
LOGICAL :: LLCREATED
LOGICAL :: LLFIELDAPI

LLFIELDAPI = .FALSE.
IF (PRESENT (LDFIELDAPI)) THEN
  LLFIELDAPI = LDFIELDAPI
ENDIF
LLCREATED = .FALSE.
IF (PRESENT (LDCREATED)) THEN
  LLCREATED = LDCREATED
ENDIF
IF (.NOT. LLCREATED) THEN
  !$ACC ENTER DATA CREATE (YD)
  !$ACC UPDATE DEVICE (YD)
ENDIF






















END SUBROUTINE

SUBROUTINE HOST_SPP_PERT (YD)

IMPLICIT NONE
TYPE (SPP_PERT), TARGET :: YD























END SUBROUTINE

     

SUBROUTINE CRC64_SPP_PERT (YD, KLUN, CDPATH)
USE CRC64_INTRINSIC, ONLY : FCRC64 => CRC64

IMPLICIT NONE
TYPE (SPP_PERT), TARGET :: YD
INTEGER, INTENT (IN) :: KLUN
CHARACTER(LEN=*), INTENT (IN) :: CDPATH
CHARACTER(LEN=128) :: CLIND

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%LABEL), CDPATH//'%LABEL'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%ON), CDPATH//'%ON'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%IDISTR), CDPATH//'%IDISTR'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%XMAG), CDPATH//'%XMAG'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%MU), CDPATH//'%MU'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%XCLIPMIN), CDPATH//'%XCLIPMIN'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%XCLIPMAX), CDPATH//'%XCLIPMAX'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%XUNIFORM_OFFSET), CDPATH//'%XUNIFORM_OFFSET'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%NMAG), CDPATH//'%NMAG'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%LN1), CDPATH//'%LN1'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%NSEED_OFF), CDPATH//'%NSEED_OFF'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%NOFF), CDPATH//'%NOFF'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%NRF), CDPATH//'%NRF'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%NRF_RADGRID), CDPATH//'%NRF_RADGRID'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%RADGRID), CDPATH//'%RADGRID'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%RF_PERT_LABEL), CDPATH//'%RF_PERT_LABEL'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%IC), CDPATH//'%IC'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%MP), CDPATH//'%MP'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%MP_RADGRID), CDPATH//'%MP_RADGRID'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%TAU), CDPATH//'%TAU'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%SDEV), CDPATH//'%SDEV'

WRITE (KLUN, '(Z16.16," ",A)') FCRC64 (YD%XLCOR), CDPATH//'%XLCOR'

END SUBROUTINE

SUBROUTINE WIPE_SPP_PERT (YD, LDDELETED, LDFIELDAPI)

IMPLICIT NONE
TYPE (SPP_PERT), INTENT (IN), TARGET :: YD
LOGICAL, OPTIONAL, INTENT (IN) :: LDDELETED, LDFIELDAPI
LOGICAL :: LLDELETED
LOGICAL :: LLFIELDAPI

LLFIELDAPI = .FALSE.
IF (PRESENT (LDFIELDAPI)) THEN
  LLFIELDAPI = LDFIELDAPI
ENDIF






















LLDELETED = .FALSE.
IF (PRESENT (LDDELETED)) THEN
  LLDELETED = LDDELETED
ENDIF
IF (.NOT. LLDELETED) THEN
  !$ACC EXIT DATA DELETE (YD)
ENDIF
END SUBROUTINE

INTEGER*8 FUNCTION SIZE_SPP_PERT (YD, CDPATH, LDPRINT) RESULT (KSIZE)

IMPLICIT NONE
TYPE (SPP_PERT),     INTENT (IN), TARGET :: YD
CHARACTER(LEN=*), INTENT (IN), OPTIONAL :: CDPATH
LOGICAL,          INTENT (IN), OPTIONAL :: LDPRINT
INTEGER*8 :: ISIZE, JSIZE
LOGICAL :: LLPRINT
CHARACTER(LEN=128) :: CLPATH

LLPRINT = .FALSE.
IF (PRESENT (LDPRINT)) THEN
  LLPRINT = LDPRINT
ENDIF
CLPATH=''
IF (PRESENT (CDPATH)) THEN
  CLPATH = CDPATH
ENDIF
KSIZE = 0
ISIZE = KIND (YD%LABEL) * LEN (YD%LABEL)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%LABEL'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%ON)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%ON'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%IDISTR)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%IDISTR'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%XMAG) * SIZE (YD%XMAG)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%XMAG'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%MU) * SIZE (YD%MU)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%MU'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%XCLIPMIN)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%XCLIPMIN'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%XCLIPMAX)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%XCLIPMAX'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%XUNIFORM_OFFSET)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%XUNIFORM_OFFSET'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%NMAG)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NMAG'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%LN1)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%LN1'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%NSEED_OFF) * SIZE (YD%NSEED_OFF)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NSEED_OFF'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%NOFF)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NOFF'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%NRF)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NRF'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%NRF_RADGRID)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NRF_RADGRID'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%RADGRID)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%RADGRID'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%RF_PERT_LABEL) * LEN (YD%RF_PERT_LABEL)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%RF_PERT_LABEL'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%IC)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%IC'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%MP)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%MP'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%MP_RADGRID)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%MP_RADGRID'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%TAU)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%TAU'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%SDEV)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%SDEV'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%XLCOR)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%XLCOR'
ENDIF
KSIZE = KSIZE + ISIZE
END FUNCTION

END MODULE
